<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="咸鱼">
    <meta name="author" content="9unk">
    
    <title>
        
            80386汇编-过程 |
        
        9unk Blog
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    <link rel="shortcut icon" href="/images/logo.jpg">
    
<link rel="stylesheet" href="/css/font-awesome.min.css">

    <script id="hexo-configurations">
    let KEEP = window.KEEP || {};
    KEEP.hexo_config = {"hostname":"example.com","root":"/","language":"zh-CN"};
    KEEP.theme_config = {"toc":{"enable":true,"number":true,"expand_all":false,"init_open":true},"style":{"primary_color":"#0066CC","avatar":"/images/logo.jpg","favicon":"/images/logo.jpg","article_img_align":"left","left_side_width":"260px","content_max_width":"920px","hover":{"shadow":false,"scale":false},"first_screen":{"enable":true,"background_img":"/images/bg.svg","description":"人初做事，如鸡伏卵，不舍而生气渐充。如燕营巢，不息而结构渐牢。如滋培之木，不见其长，有时而大。如有本之泉，不舍昼夜，盈科而后进，放乎四海。"},"scroll":{"progress_bar":{"enable":false},"percent":{"enable":true}}},"local_search":{"enable":true,"preload":true},"code_copy":{"enable":true,"style":"mac"},"pjax":{"enable":true},"lazyload":{"enable":true},"version":"3.4.5"};
    KEEP.language_ago = {"second":"%s 秒前","minute":"%s 分钟前","hour":"%s 小时前","day":"%s 天前","week":"%s 周前","month":"%s 个月前","year":"%s 年前"};
  </script>
<meta name="generator" content="Hexo 6.0.0"></head>


<body>
<div class="progress-bar-container">
    

    
        <span class="pjax-progress-bar"></span>
        <span class="pjax-progress-icon">
            <i class="fas fa-circle-notch fa-spin"></i>
        </span>
    
</div>


<main class="page-container">

    

    <div class="page-main-content">

        <div class="page-main-content-top">
            <header class="header-wrapper">

    <div class="header-content">
        <div class="left">
            
            <a class="logo-title" href="/">
                9unk Blog
            </a>
        </div>

        <div class="right">
            <div class="pc">
                <ul class="menu-list">
                    
                        <li class="menu-item">
                            <a class=""
                               href="/"
                            >
                                首页
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/archives"
                            >
                                归档
                            </a>
                        </li>
                    
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="fas fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/">首页</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/archives">归档</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle">

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    <div class="article-content-container">

        <div class="article-title">
            <span class="title-hover-animation">80386汇编-过程</span>
        </div>

        
            <div class="article-header">
                <div class="avatar">
                    <img src="/images/logo.jpg">
                </div>
                <div class="info">
                    <div class="author">
                        <span class="name">9unk</span>
                        
                            <span class="author-label">Lv5</span>
                        
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fas fa-edit"></i>&nbsp;
        <span class="pc">2022-11-13 23:53:00</span>
        <span class="mobile">2022-11-13 23:53</span>
    </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fas fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/%E6%B1%87%E7%BC%96/">汇编</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
        <span class="article-wordcount article-meta-item">
            <i class="fas fa-file-word"></i>&nbsp;<span>5.5k 字</span>
        </span>
    
    
        <span class="article-min2read article-meta-item">
            <i class="fas fa-clock"></i>&nbsp;<span>23 分钟</span>
        </span>
    
    
</div>

                    </div>
                </div>
            </div>
        

        <div class="article-content markdown-body">
            <h1 id="背景知识"><a href="#背景知识" class="headerlink" title="背景知识"></a>背景知识</h1><ul>
<li>链接库 Irvine32.lib 用于 32 位保护模式下编写的程序，其中进行输入输出的过程调用了 MS-Windows API。</li>
<li>链接库 Irvine16.lib 用于 16 位实地址模式下编写的程序，其中进行输入输出的过程调用了 MS-DOS 中断。</li>
</ul>
<h2 id="链接库"><a href="#链接库" class="headerlink" title="链接库"></a>链接库</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/202835661-d5f9fedc-34fb-4405-8b7f-5e4bc164db4b.png"
                      alt="1"
                ><br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/202835678-067ae6dd-0136-4f52-926c-c13b3ce4f0e1.png"
                      alt="2"
                ><br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/202835710-0ffe3f23-decf-4369-a63c-a2fa2e531e51.png"
                      alt="3"
                ></p>
<h2 id="本书中附带的链接库"><a href="#本书中附带的链接库" class="headerlink" title="本书中附带的链接库"></a>本书中附带的链接库</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/202835779-0ea76cae-3385-43d1-8df2-89c7951734a2.png"
                      alt="4"
                ><br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/202835799-37c9ec5c-eda9-4823-913d-0e810d520505.png"
                      alt="5"
                ><br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/202835990-439a2975-81fe-4b0a-b859-2a08dcffc9b7.png"
                      alt="6"
                ><br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/202835889-08c78fa5-7cf5-4772-81f9-6159b14a6831.png"
                      alt="7"
                ></p>
<h3 id="控制台窗口"><a href="#控制台窗口" class="headerlink" title="控制台窗口"></a>控制台窗口</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/202837514-bd499a53-4e1b-47b8-bf14-71cd74507393.png"
                      alt="8"
                ></p>
<p>向控制台输出内容：本质上是显存分出一小部分用来给控制台输出内容，当我们向显存的固定的位置写入字符，控制台就会显示内容。如果输出的内容超出控制台的大小（默认是25*80），那么控制台就会向下移动一行显示后面的内容。这个程序我们在16位汇编中写过，理解起来比较简单。在 32 位汇编中，显存地址由控制台句柄代替，句柄指的就是指针的指针。控制台窗口颜色属性设置，默认是黑底白字。</p>
<h3 id="重定向输入输出"><a href="#重定向输入输出" class="headerlink" title="重定向输入输出"></a>重定向输入输出</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/202839399-f226e642-1da6-45f7-aba6-cbb75a32349c.png"
                      alt="9"
                ></p>
<h2 id="过程描述"><a href="#过程描述" class="headerlink" title="过程描述"></a>过程描述</h2><h3 id="CloseFile（仅Irvine32）"><a href="#CloseFile（仅Irvine32）" class="headerlink" title="CloseFile（仅Irvine32）"></a>CloseFile（仅Irvine32）</h3><p>CloseFile 过程关闭一个以前打开的文件。文件是以文件句柄（handle）标识的，文件句柄通过 EAX 传递。如果文件被成功关闭，EAX中返回非零值。例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MOV EAX,FileHandle</span><br><span class="line">CALL CloseFile</span><br></pre></td></tr></table></figure>

<h3 id="CLrscr"><a href="#CLrscr" class="headerlink" title="CLrscr"></a>CLrscr</h3><p>CLrscr 过程用于清除控制台窗口的内容，它通过在程序的开始和结束时使用。最好在调用 Clrscr 之前暂停一下程序（调用 WaitMsg），以便用户在清屏之前看清已有的信息。例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CALL WaitMsg</span><br><span class="line">CALL Clrscr</span><br></pre></td></tr></table></figure>

<h3 id="Crlf"><a href="#Crlf" class="headerlink" title="Crlf"></a>Crlf</h3><p>Crlf 过程把光标定位到控制台窗口下一行的开始，该功能是通过向标准输出写入 0DH 和 0AH 两个字符来实现的。例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CALL Crlf</span><br></pre></td></tr></table></figure>

<h3 id="CreateOutputFile（仅Irvine32）"><a href="#CreateOutputFile（仅Irvine32）" class="headerlink" title="CreateOutputFile（仅Irvine32）"></a>CreateOutputFile（仅Irvine32）</h3><p>CreateOutputFile 过程创建一个磁盘文件并以输出模式打开。使用时通过 EDX 传递要创建的文件名的偏移地址。过程返回时，如果文件创建成功，则 EAX 包含一个有效的文件句柄（一个32位整数）。如果创建失败，EAX 中的值是 INVALID_HANDLE_VALUE &#x3D; -1（一个预定义的常量）。例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">.data</span><br><span class="line">filename BYTE &quot;newfile.txt&quot;,0</span><br><span class="line">handle DWORD ?</span><br><span class="line"></span><br><span class="line">.code</span><br><span class="line">mov edx,OFFSET filename</span><br><span class="line">call CreateOutputFile</span><br><span class="line">cmp eax,INVALID_HANDLE_VALUE</span><br><span class="line">je file_error                   ;显示文件错误信息</span><br><span class="line">mov handle,eax                  ;保存文件句柄</span><br></pre></td></tr></table></figure>

<h3 id="Delay"><a href="#Delay" class="headerlink" title="Delay"></a>Delay</h3><p>Delay 过程暂停程序指定的毫秒数。EAX 是入口参数，因此在调用该过程之前要把 EAX 初始化为预期暂停的事件，以毫秒为单位计算。例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mov eax,1000    ;1s</span><br><span class="line">call Delay</span><br></pre></td></tr></table></figure>

<h3 id="DumpMem"><a href="#DumpMem" class="headerlink" title="DumpMem"></a>DumpMem</h3><p>DumpMem 过程以十六进制数格式在控制台窗口中新鲜事一块内存的内容。在调用之前，需要将 ESI 设置为内存的开始地址，ECX设置为元素数目，EBX设置为元素尺寸。下面的语句显示一个名为 array 的包含 11 个双字变量的数组。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">INCLUDE Irvine32.inc</span><br><span class="line"></span><br><span class="line">.data</span><br><span class="line">array DWORD 1,2,3,4,5,6,7,8,9,0AH,0BH</span><br><span class="line"></span><br><span class="line">.code</span><br><span class="line">main PROC</span><br><span class="line">    MOV esi,OFFSET array</span><br><span class="line">    MOV ECX,LENGTHOF array</span><br><span class="line">    MOV EBX,TYPE array</span><br><span class="line">    CALL DumpMem</span><br><span class="line">    exit</span><br><span class="line">main ENDP</span><br><span class="line">END main</span><br></pre></td></tr></table></figure>

<h3 id="DumpRegs"><a href="#DumpRegs" class="headerlink" title="DumpRegs"></a>DumpRegs</h3><p>DumpRegs 过程以十六进制数格式显示 EAX,EBX,ECX,EDX,ESI,EDI,EBP,ESP,EIP,EFL(EFLAGS)寄存器的内容，并同时显示进位、符号、零和溢出标志位的值。例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">call DumpRegs</span><br></pre></td></tr></table></figure>

<h3 id="GetCommandTail"><a href="#GetCommandTail" class="headerlink" title="GetCommandTail"></a>GetCommandTail</h3><p>GetCommandTail 过程把程序的命令行复制到一个以空字符结尾的字符串中。如果命令行为空，则设置进位标志位。这个过程允许用户通过命令行传递信息。例如：下面的程序读取并输出参数。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">STD_OUTPUT_HANDLE = -11</span><br><span class="line">NULL = 0</span><br><span class="line"></span><br><span class="line">INCLUDE Irvine32.inc</span><br><span class="line"></span><br><span class="line">.data</span><br><span class="line">cmdTail BYTE 129 DUP(0)</span><br><span class="line"></span><br><span class="line">.code</span><br><span class="line">main PROC</span><br><span class="line">    MOV edx,OFFSET cmdTail</span><br><span class="line">    CALL GetCommandtail</span><br><span class="line">    INVOKE GetStdHandle,STD_OUTPUT_HANDLE</span><br><span class="line">    INVOKE WriteConsole,eax,addr cmdTail,sizeof cmdTail,ebx,NULL</span><br><span class="line">    exit</span><br><span class="line">main ENDP</span><br><span class="line">END main</span><br></pre></td></tr></table></figure>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/202844791-7464d626-565d-48cc-a100-0346634b8186.png"
                      alt="10"
                ></p>
<blockquote>
<p>这个原理和 8086 汇编中的 PSP 段一样。</p>
</blockquote>
<h3 id="GetMaxXY（仅Irvine32）"><a href="#GetMaxXY（仅Irvine32）" class="headerlink" title="GetMaxXY（仅Irvine32）"></a>GetMaxXY（仅Irvine32）</h3><p>GetMaxXY 过程返回控制台窗口缓冲区大小。如果控制台窗口缓冲区的大小大于可见窗口部分，控制台会出现滚动条。GetMaxXY 无输入参数。返回时，DL存放窗口缓冲区的列数，DH存放窗口缓冲区的行数。该过程要求行数和列数都不能大于 255，实际窗口缓冲区的行列大小会超过255，不过从这种情况少见。例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">INCLUDE Irvine32.inc</span><br><span class="line"></span><br><span class="line">.data</span><br><span class="line">rows BYTE ?</span><br><span class="line">cols BYTE ?</span><br><span class="line"></span><br><span class="line">.code</span><br><span class="line">main PROC</span><br><span class="line">    CALL GetMaxXY</span><br><span class="line">    MOV rows,dh</span><br><span class="line">    MOV cols,dl</span><br><span class="line">    MOV esi,OFFSET rows</span><br><span class="line">    MOV ECX,2</span><br><span class="line">    MOV EBX,TYPE rows</span><br><span class="line">    CALL DumpMem</span><br><span class="line">    exit</span><br><span class="line">main ENDP</span><br><span class="line">END main</span><br></pre></td></tr></table></figure>

<h3 id="GetMseconds"><a href="#GetMseconds" class="headerlink" title="GetMseconds"></a>GetMseconds</h3><p>GetMseconds 计算程序运行的毫秒数，返回值在 EAX 中，这个过程可用来测量两个事件之间的间隔。该过程不需要输入参数。例如，程序首先调用该过程并保存其返回值，然后执行循环。循环结束后再次调用 GetMseconds 过程并把这两次调用的返回值相减，这样就得到以毫秒计算的循环执行的大致时间：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">INCLUDE Irvine32.inc</span><br><span class="line"></span><br><span class="line">.data</span><br><span class="line">startTime DWORD ?</span><br><span class="line"></span><br><span class="line">.code</span><br><span class="line">main PROC</span><br><span class="line">    CALL GetMseconds</span><br><span class="line">    MOV startTime,eax</span><br><span class="line">    MOV ecx,5</span><br><span class="line">L1:</span><br><span class="line">    ADD eax,1</span><br><span class="line">    LOOP L1</span><br><span class="line">    SUB eax,startTime</span><br><span class="line">    CALL DumpRegs</span><br><span class="line">    exit</span><br><span class="line">main ENDP</span><br><span class="line">END main</span><br></pre></td></tr></table></figure>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/202865283-435bccf3-306f-4b4f-834c-dd33583ffcb9.png"
                      alt="11"
                ><br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/202865310-45bf00f2-2783-4abd-b4ac-b30bc6f09d29.png"
                      alt="12"
                ><br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/202865345-d23eea53-e02d-41d5-b092-2bf8d3df16cb.png"
                      alt="13"
                ><br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/202865379-0ddbd043-7865-446b-bc47-2c94d612a6f5.png"
                      alt="14"
                ><br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/202865423-e6f071b0-6dbe-4749-9849-f59e4bb6e3eb.png"
                      alt="15"
                ><br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/202865443-433e2326-bcb1-4a84-9548-df8f088f8765.png"
                      alt="16"
                ><br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/202865487-636fc723-ecca-493f-baf4-a66b9437eac7.png"
                      alt="17"
                ><br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/202865510-9af636e7-8014-46f6-be79-04851f19d287.png"
                      alt="18"
                ><br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/202865544-792d8444-8b80-4965-9a60-6fc7ac9db94d.png"
                      alt="19"
                ><br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/202865621-1a614bf5-81f7-4807-88c6-8222cb63d923.png"
                      alt="20"
                ><br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/202865652-13403429-ece6-417d-937a-f791c4be7294.png"
                      alt="21"
                ><br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/202865700-c0665a92-db2b-4b96-b28a-9f174fe7194d.png"
                      alt="22"
                ><br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/202865721-1aea7e63-5a78-45fe-aedb-b4bc3bf7c390.png"
                      alt="23"
                ><br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/202865760-c1ea949b-3175-4d98-b55e-2023320ce522.png"
                      alt="24"
                ><br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/202865828-2f626265-821a-4410-90ca-aae72fc3eeec.png"
                      alt="25"
                ></p>
<blockquote>
<p>后续还有很多函数，有兴趣的自行阅读。</p>
</blockquote>
<h2 id="库测试程序"><a href="#库测试程序" class="headerlink" title="库测试程序"></a>库测试程序</h2><h3 id="整数-I-x2F-O"><a href="#整数-I-x2F-O" class="headerlink" title="整数 I&#x2F;O"></a>整数 I&#x2F;O</h3><p>把文本的颜色改为蓝底黄字，然后以十六进制数显示数组的内容，最后提示用户输入一个有符号整数，再分别以十进制、十六进制和二进制数格式重复显示该整数：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">;---------------------------</span><br><span class="line">;程序名：Testlib1.asm</span><br><span class="line">;功能：把文本的颜色改为蓝底黄字，然后以十六进制数显示数组的内容，最后提示用户输入一个有符号整数，再分别以十进制、十六进制和二进制数格式重复显示该整数</span><br><span class="line">;作者：9unk</span><br><span class="line">;编写时间：2022-11-20</span><br><span class="line">;----------------------------</span><br><span class="line"></span><br><span class="line">INCLUDE Irvine32.inc</span><br><span class="line"></span><br><span class="line">.data</span><br><span class="line">arrayD DWORD 1000h,2000h,3000h</span><br><span class="line">prompt1 BYTE &quot;Enter a 32-bit signed integer: &quot;,0</span><br><span class="line">dwordVal DWORD ?</span><br><span class="line"></span><br><span class="line">.code</span><br><span class="line">main PROC</span><br><span class="line">;使用 SetTextColor 函数设置蓝底黄字</span><br><span class="line">    MOV eax,yellow + (blue*16)</span><br><span class="line">    CALL SetTextColor</span><br><span class="line">    CALL Clrscr             ;清屏</span><br><span class="line">;输出数组内容</span><br><span class="line">    MOV esi,OFFSET arrayD</span><br><span class="line">    MOV ecx,LENGTHOF arrayD</span><br><span class="line">    MOV ebx,TYPE arrayD</span><br><span class="line">    CALL DumpMem</span><br><span class="line">    CALL crlf</span><br><span class="line">;提示用户输入一个十进制整数</span><br><span class="line">    MOV edx,OFFSET prompt1</span><br><span class="line">    CALL WriteString</span><br><span class="line">    CALL ReadInt</span><br><span class="line">    MOV dwordVal,eax</span><br><span class="line">;以十进制、十六进制和二进制数显示整数</span><br><span class="line">    CALL crlf</span><br><span class="line">    CALL WriteInt</span><br><span class="line">    CALL crlf</span><br><span class="line">    CALL WriteHex</span><br><span class="line">    call crlf</span><br><span class="line">    CALL WriteBin</span><br><span class="line">    CALL crlf</span><br><span class="line">    CALL WaitMsg</span><br><span class="line">;将控制台窗口设为默认颜色</span><br><span class="line">    MOV eax,lightGray + (black*16)</span><br><span class="line">    CALL SetTextColor</span><br><span class="line">    CALL Clrscr</span><br><span class="line">    exit</span><br><span class="line">main ENDP</span><br><span class="line">END main</span><br></pre></td></tr></table></figure>

<h3 id="随机整数"><a href="#随机整数" class="headerlink" title="随机整数"></a>随机整数</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">;---------------------------</span><br><span class="line">;程序名：Testlib2.asm</span><br><span class="line">;功能：测试 Irvine32 链接库中的随机数生成过程</span><br><span class="line">;作者：9unk</span><br><span class="line">;编写时间：2022-11-21</span><br><span class="line">;----------------------------</span><br><span class="line"></span><br><span class="line">INCLUDE Irvine32.inc</span><br><span class="line"></span><br><span class="line">TAB = 9</span><br><span class="line"></span><br><span class="line">.code</span><br><span class="line">main PROC</span><br><span class="line">    CALL Randomize      ;初始化随机数发生器</span><br><span class="line">    CALL Rand1</span><br><span class="line">    CALL rand2</span><br><span class="line">    exit</span><br><span class="line">main ENDP</span><br><span class="line"></span><br><span class="line">Rand1 PROC</span><br><span class="line">;生成 10 个伪随机整数</span><br><span class="line">    MOV ecx,10</span><br><span class="line">L1:</span><br><span class="line">    CALL Random32</span><br><span class="line">    CALL WriteDec</span><br><span class="line">    MOV al,TAB</span><br><span class="line">    CALL WriteChar</span><br><span class="line">    LOOP L1</span><br><span class="line">    CALL Crlf</span><br><span class="line">    RET</span><br><span class="line">Rand1 ENDP</span><br><span class="line"></span><br><span class="line">Rand2 PROC</span><br><span class="line">;生成10个在范围-50~+49之间的伪随机整数</span><br><span class="line">    MOV ecx,10</span><br><span class="line">L1:</span><br><span class="line">    MOV eax,100</span><br><span class="line">    CALL RandomRange</span><br><span class="line">    SUB eax,50</span><br><span class="line">    CALL WriteInt</span><br><span class="line">    MOV al,TAB</span><br><span class="line">    CALL WriteChar</span><br><span class="line">    LOOP L1</span><br><span class="line">    CALL Crlf</span><br><span class="line">    RET</span><br><span class="line">Rand2 ENDP</span><br><span class="line">END main</span><br></pre></td></tr></table></figure>

<h3 id="性能度量"><a href="#性能度量" class="headerlink" title="性能度量"></a>性能度量</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">;---------------------------</span><br><span class="line">;程序名：Testlib3.asm</span><br><span class="line">;功能：计算执行嵌套循环用去的时间</span><br><span class="line">;作者：9unk</span><br><span class="line">;编写时间：2022-11-21</span><br><span class="line">;----------------------------</span><br><span class="line"></span><br><span class="line">INCLUDE Irvine32.inc</span><br><span class="line"></span><br><span class="line">OUTER_LOOP_COUNT = 3</span><br><span class="line"></span><br><span class="line">.data</span><br><span class="line">startTime DWORD ?</span><br><span class="line">msg1 BYTE &quot;Please wait...&quot;,0dh,0ah,0</span><br><span class="line">msg2 BYTE &quot;Elapsed milliseconds: &quot;,0</span><br><span class="line"></span><br><span class="line">.code</span><br><span class="line">main PROC</span><br><span class="line">    MOV edx,OFFSET msg1</span><br><span class="line">    CALL WriteString</span><br><span class="line">;保存起始时间</span><br><span class="line">    CALL GetMSeconds</span><br><span class="line">    MOV startTime,eax</span><br><span class="line">    MOV ecx,OUTER_LOOP_COUNT</span><br><span class="line">;执行循环</span><br><span class="line">L1:</span><br><span class="line">    CALL innerLoop</span><br><span class="line">    LOOP L1</span><br><span class="line">;显示用去的时间</span><br><span class="line">    CALL GetMSeconds</span><br><span class="line">    SUB eax,startTime</span><br><span class="line">    MOV edx,OFFSET msg2</span><br><span class="line">    CALL WriteString</span><br><span class="line">    CALL WriteDec</span><br><span class="line">    CALL Crlf</span><br><span class="line">    exit</span><br><span class="line">main ENDP</span><br><span class="line"></span><br><span class="line">innerLoop PROC</span><br><span class="line">    PUSH ecx</span><br><span class="line">    MOV ecx,0ffffffffh</span><br><span class="line">L1:</span><br><span class="line">    MOV eax,eax</span><br><span class="line">    LOOP L1</span><br><span class="line">    POP ecx</span><br><span class="line">    RET</span><br><span class="line">innerLoop ENDP</span><br><span class="line">END main</span><br></pre></td></tr></table></figure>

<h1 id="堆栈操作"><a href="#堆栈操作" class="headerlink" title="堆栈操作"></a>堆栈操作</h1><p>运行时栈是由 CPU 进行管理的，它使用两个寄存器：SS 和 ESP。在保护模式下，SS寄存器存放的位置是段选择子，用户模式下不应对其进行修改。ESP 寄存器存放的是指向堆栈内特定位置的一个 32 位偏移值。ESP寄存器的值通常是由 CALL，RET，PUSH和POP等指令间接修改的。如下图所示，堆栈 PUSH（压入）的过程：<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/203199119-2a07093f-0c57-4638-9695-e6da023221af.png"
                      alt="26"
                ></p>
<p>堆栈 POP（出栈）的过程：<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/203200044-2e1d1921-1fab-462b-84bd-c0168e0d3409.png"
                      alt="27"
                ></p>
<blockquote>
<p>X86系统，堆栈是32位的，因此每次 PUSH 压入 ESP 都会减4，每次 POP 弹出 ESP 都会加4。</p>
</blockquote>
<p><strong>本节中的其他内容和 80x86 一样这里就不再重复看了。</strong></p>
<h2 id="例子：反转字符串"><a href="#例子：反转字符串" class="headerlink" title="例子：反转字符串"></a>例子：反转字符串</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">;---------------------------</span><br><span class="line">;程序名：RevStr.asm</span><br><span class="line">;功能：将字符串压入堆栈，来实现字符串反转。</span><br><span class="line">;作者：9unk</span><br><span class="line">;编写时间：2022-11-22</span><br><span class="line">;----------------------------</span><br><span class="line">INCLUDE Irvine32.inc</span><br><span class="line"></span><br><span class="line">.data</span><br><span class="line">aName BYTE &quot;Abraham Lincoln&quot;,0</span><br><span class="line">nameSize = ($-aName)-1</span><br><span class="line"></span><br><span class="line">.code</span><br><span class="line">main PROC</span><br><span class="line">    ;字符串压入堆栈</span><br><span class="line">    XOR esi,esi</span><br><span class="line">    MOV ecx,nameSize</span><br><span class="line">L1:</span><br><span class="line">    MOVZX eax,aName[esi]</span><br><span class="line">    PUSH eax</span><br><span class="line">    INC esi</span><br><span class="line">    LOOP L1</span><br><span class="line">    ;字符串弹出堆栈</span><br><span class="line">    XOR esi,esi</span><br><span class="line">    MOV ecx,nameSize</span><br><span class="line">L2:</span><br><span class="line">    POP eax</span><br><span class="line">    MOV aName[esi],al</span><br><span class="line">    INC esi</span><br><span class="line">    LOOP L2</span><br><span class="line">    ;</span><br><span class="line">    MOV edx,OFFSET aName</span><br><span class="line">    CALL WriteString</span><br><span class="line">    CALL Crlf</span><br><span class="line">    exit</span><br><span class="line">main ENDP</span><br><span class="line">END main</span><br></pre></td></tr></table></figure>

<h1 id="过程的定义和使用"><a href="#过程的定义和使用" class="headerlink" title="过程的定义和使用"></a>过程的定义和使用</h1><h2 id="PROC-伪指令"><a href="#PROC-伪指令" class="headerlink" title="PROC 伪指令"></a>PROC 伪指令</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/203210951-04a0f2b3-4d67-4e43-9be5-6f16aad57d71.png"
                      alt="28"
                ></p>
<h2 id="CALL-和-RET-指令"><a href="#CALL-和-RET-指令" class="headerlink" title="CALL 和 RET 指令"></a>CALL 和 RET 指令</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/203211536-90aebb8d-7cbf-404e-b31d-0eedaa280433.png"
                      alt="29"
                ><br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/203211638-fbe31d38-93e7-4dee-a61f-003f51011c09.png"
                      alt="30"
                ><br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/203211773-04183443-16a0-487c-af8c-7db86007be93.png"
                      alt="31"
                ><br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/203211864-1df3e801-12b4-4c92-93f4-c19d887dd073.png"
                      alt="32"
                ><br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/203212217-0e2891fa-16ae-4369-9c44-0e72b269c234.png"
                      alt="33"
                ><br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/203212763-4e1cb6a1-cd5c-4d11-9e7f-312060651f24.png"
                      alt="34"
                ></p>
<h2 id="例子：创建一个子程序，对整数数组求和。"><a href="#例子：创建一个子程序，对整数数组求和。" class="headerlink" title="例子：创建一个子程序，对整数数组求和。"></a>例子：创建一个子程序，对整数数组求和。</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">;---------------------------</span><br><span class="line">;程序名：ArraySum.asm</span><br><span class="line">;功能：创建一个子程序，对整数数组求和。</span><br><span class="line">;作者：9unk</span><br><span class="line">;编写时间：2022-11-22</span><br><span class="line">;----------------------------</span><br><span class="line">INCLUDE Irvine32.inc</span><br><span class="line"></span><br><span class="line">.data</span><br><span class="line">array DWORD 10000h,20000h,30000h,40000h,50000h</span><br><span class="line">theSum DWORD ?</span><br><span class="line"></span><br><span class="line">.code</span><br><span class="line">main PROC</span><br><span class="line">    MOV esi,OFFSET array</span><br><span class="line">    MOV ecx,LENGTHOF array</span><br><span class="line">    CALL ArraySum</span><br><span class="line">    MOV theSum,eax</span><br><span class="line">    CALL DumpRegs</span><br><span class="line">    exit</span><br><span class="line">main ENDP</span><br><span class="line">;------------------------------</span><br><span class="line">ArraySum PROC</span><br><span class="line">;Calculates the sum of an array of 32-bit integers</span><br><span class="line">;Recevies: ESI = the array offset</span><br><span class="line">;          ECX = number of elements in the array</span><br><span class="line">;Returns:  EAX = sum of the array elements</span><br><span class="line">;------------------------------</span><br><span class="line">    PUSH esi</span><br><span class="line">    PUSH ecx</span><br><span class="line">    MOV eax,0</span><br><span class="line">L1:</span><br><span class="line">    ADD eax,[esi]</span><br><span class="line">    ADD esi,TYPE DWORD</span><br><span class="line">    LOOP L1</span><br><span class="line">    ;</span><br><span class="line">    POP ecx</span><br><span class="line">    POP esi</span><br><span class="line">    RET</span><br><span class="line">ArraySum ENDP </span><br><span class="line">END main</span><br></pre></td></tr></table></figure>

<h2 id="流程图"><a href="#流程图" class="headerlink" title="流程图"></a>流程图</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/203235675-8f01a979-9cf4-4e5f-8490-bfa43efff0d3.png"
                      alt="35"
                ><br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/203235906-f87e65d7-b2d0-4f78-90b6-2217ff902166.png"
                      alt="36"
                ><br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/203236055-898de92b-c8d7-415f-b657-f5cf5262f15a.png"
                      alt="37"
                ></p>
<blockquote>
<p>大多数入门的程序设计教科书都已经不再介绍流程图了，应为对于已经封装好的函数和数据结构（面向对象程序设计）而言流程图并不适用。</p>
</blockquote>
<h1 id="保护和恢复寄存器"><a href="#保护和恢复寄存器" class="headerlink" title="保护和恢复寄存器"></a>保护和恢复寄存器</h1><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/203240967-b91a3e8c-02d0-433c-8dba-258d4c89bc70.png"
                      alt="38"
                ><br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/203241161-3df1be2d-3611-459a-839d-abf715d23f9f.png"
                      alt="39"
                ></p>
<blockquote>
<p>注意：恢复堆栈时，不要把返回值带进去</p>
</blockquote>
<h1 id="使用过程进行程序设计"><a href="#使用过程进行程序设计" class="headerlink" title="使用过程进行程序设计"></a>使用过程进行程序设计</h1><h2 id="整数求和程序（设计）"><a href="#整数求和程序（设计）" class="headerlink" title="整数求和程序（设计）"></a>整数求和程序（设计）</h2><ul>
<li><p>第一步：审题</p>
<blockquote>
<p>写一个程序，提示用户输入 3 个 32 位整数，将其保存在数组中，计算数组内的元素的和并在屏幕上显示。</p>
</blockquote>
</li>
<li><p>第二步：分解任务，并用伪代码写出</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">整数求和程序</span><br><span class="line">    提示用户输入3个整数</span><br><span class="line">    计算整数数组的和</span><br><span class="line">    显示结果</span><br></pre></td></tr></table></figure>
</li>
<li><p>第三步：在准备写程序之前，为每个任务起一个过程名</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Mian</span><br><span class="line">    PromptForIntegers</span><br><span class="line">    ArraySum</span><br><span class="line">    DisplaySum</span><br></pre></td></tr></table></figure>
</li>
<li><p>第四步：思考这个程序需要调用哪些函数库种的程序，并完善第二步</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Mian</span><br><span class="line">    Clrscr                  ;清屏</span><br><span class="line">    PromptForIntegers</span><br><span class="line">        WriteString         ;显示字符串</span><br><span class="line">        ReadInt             ;输入整数</span><br><span class="line">    ArraySum                ;对整数求和</span><br><span class="line">    DisplaySum</span><br><span class="line">        WriteString         ;显示字符串</span><br><span class="line">        WriteInt            ;显示整数</span><br></pre></td></tr></table></figure>
</li>
<li><p>第五步：画出程序结构图<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/203244390-bb62aef3-0785-4d2b-a8a6-dea55cd746bf.png"
                      alt="40"
                ></p>
</li>
<li><p>第六步：设计简化版程序框架，其中包含各个子程序的功能描述、入口参数、出口参数<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/203245489-6407d257-efc9-47e1-82ca-90998e5d4f13.png"
                      alt="41"
                ><br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/203245711-c2ecf7b5-d348-4d37-a1f2-46665e46c0e2.png"
                      alt="42"
                ><br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/203246023-3fc53e2a-f326-4320-ac69-105262e33a03.png"
                      alt="43"
                ></p>
</li>
<li><p>第七步：填写需要的变量和各子程序之间入口参数，实现程序。<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/203246885-1de19a64-2d57-4b9c-9be5-c805c57690a9.png"
                      alt="44"
                ><br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/203247003-37735ba9-1bab-47c0-be07-335ea574883d.png"
                      alt="45"
                ></p>
</li>
<li><p>编写程序</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">;---------------------------</span><br><span class="line">;程序名：Sum2.asm</span><br><span class="line">;功能：写一个程序，提示用户输入 3 个 32 位整数，将其保存在数组中，计算数组内的元素的和并在屏幕上显示。</span><br><span class="line">;作者：9unk</span><br><span class="line">;编写时间：2022-11-22</span><br><span class="line">;----------------------------</span><br><span class="line"></span><br><span class="line">INCLUDE Irvine32.inc</span><br><span class="line">INTEGER_COUNT = 3</span><br><span class="line"></span><br><span class="line">.data</span><br><span class="line">str1 BYTE &quot;Enter a signed integer: &quot;,0</span><br><span class="line">str2 BYTE &quot;The sum of the integer is: &quot;,0</span><br><span class="line">array DWORD INTEGER_COUNT DUP(?)</span><br><span class="line"></span><br><span class="line">.code</span><br><span class="line">main PROC</span><br><span class="line">    CALL Clrscr</span><br><span class="line">    MOV esi,OFFSET array</span><br><span class="line">    MOV ecx,INTEGER_COUNT</span><br><span class="line">    CALL PromptForIntegers</span><br><span class="line">    CALL ArraySum</span><br><span class="line">    CALL DisplaySum</span><br><span class="line">    exit</span><br><span class="line">main ENDP</span><br><span class="line"></span><br><span class="line">;------------------------------------------------</span><br><span class="line">PromptForIntegers PROC USES ecx edx esi</span><br><span class="line">;功能：提示用户输入任意数量的整数，并将整数插入数组。</span><br><span class="line">;入口参数: ESI = 数组指针, ecx = 数组的大小</span><br><span class="line">;出口参数: 无</span><br><span class="line">;------------------------------------------------</span><br><span class="line">    MOV edx,OFFSET str1</span><br><span class="line">L1:</span><br><span class="line">    CALL WriteString</span><br><span class="line">    CALL ReadInt</span><br><span class="line">    CALL Crlf</span><br><span class="line">    MOV [esi],eax</span><br><span class="line">    ADD esi,TYPE DWORD</span><br><span class="line">    LOOP L1</span><br><span class="line">    RET</span><br><span class="line">PromptForIntegers ENDP</span><br><span class="line"></span><br><span class="line">;-------------------------------------------------</span><br><span class="line">ArraySum PROC USES esi ecx</span><br><span class="line">;功能：计算32位整数数组的和。</span><br><span class="line">;入口参数：esi = 数组指针，ecx = 数组的元素个数</span><br><span class="line">;出口参数：eax = 数组元素的和</span><br><span class="line">    MOV eax,0</span><br><span class="line">L1:</span><br><span class="line">    ADD eax,[esi]</span><br><span class="line">    ADD esi,TYPE DWORD</span><br><span class="line">    LOOP L1</span><br><span class="line">    RET</span><br><span class="line">ArraySum ENDP</span><br><span class="line"></span><br><span class="line">;------------------------------------------------</span><br><span class="line">DisplaySum PROC USES edx</span><br><span class="line">;功能：在屏幕上显示数字</span><br><span class="line">;入口参数：eax</span><br><span class="line">;出口参数：无 </span><br><span class="line">;------------------------------------------------</span><br><span class="line">    MOV edx,OFFSET str2</span><br><span class="line">    CALL WriteString</span><br><span class="line">    CALL WriteInt</span><br><span class="line">    CALL Crlf</span><br><span class="line">    RET</span><br><span class="line">DisplaySum ENDP</span><br><span class="line">END main</span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="课后练习"><a href="#课后练习" class="headerlink" title="课后练习"></a>课后练习</h1><h2 id="绘制彩色文本"><a href="#绘制彩色文本" class="headerlink" title="绘制彩色文本"></a>绘制彩色文本</h2><p>写一个程序，调用本书链接库中的 SetTextColor 过程，以 4 种不同的颜色显示同一种字符串，要求使用一个循环。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">;---------------------------</span><br><span class="line">;程序名：lx5-1.asm</span><br><span class="line">;功能：写一个程序，调用本书链接库中的 SetTextColor 过程，以 4 种不同的颜色显示同一种字符串，要求使用一个循环。</span><br><span class="line">;作者：9unk</span><br><span class="line">;编写时间：2022-11-29</span><br><span class="line">;----------------------------</span><br><span class="line"></span><br><span class="line">;1、数据：定义一个颜色变量 color，初始值是 “黑底蓝字“</span><br><span class="line">;2、定义一个以 0 结尾的字符串变量 message： Hello World!</span><br><span class="line">;3、清屏</span><br><span class="line">;4、构造循环体输出 4 次不同颜色的字符串，每次循环 color变量加1 </span><br><span class="line">;5、恢复窗口颜色</span><br><span class="line">INCLUDE Irvine32.inc</span><br><span class="line"></span><br><span class="line">.data</span><br><span class="line">message db &#x27;Hello World!&#x27;,0</span><br><span class="line">color dd blue + (black*16)</span><br><span class="line"></span><br><span class="line">.code</span><br><span class="line">main PROC</span><br><span class="line">    CALL Clrscr</span><br><span class="line">    MOV ecx,4</span><br><span class="line">print:</span><br><span class="line">    MOV eax,color</span><br><span class="line">    CALL SetTextColor</span><br><span class="line">    MOV edx,OFFSET message</span><br><span class="line">    CALL WriteString</span><br><span class="line">    CALL Crlf</span><br><span class="line">    INC color</span><br><span class="line">    LOOP print</span><br><span class="line">    MOV eax,gray + (black*16)</span><br><span class="line">    CALL SetTextColor</span><br><span class="line">    exit</span><br><span class="line">main ENDP</span><br><span class="line">END main</span><br></pre></td></tr></table></figure>

<h2 id="斐波那契数文件"><a href="#斐波那契数文件" class="headerlink" title="斐波那契数文件"></a>斐波那契数文件</h2><p>写一个斐波那契数列的前 47 个值，把这 47 个值存储在一个双数组中并把双字数组写入一个磁盘文件。打开文件内容如下：<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/204122674-414202a2-481e-4719-875f-4b6fa8c3794e.png"
                      alt="46"
                ></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">;---------------------------</span><br><span class="line">;程序名：lx5-2.asm</span><br><span class="line">;功能：写一个斐波那契数列的前 47 个值，把这 47 个值存储在一个双数组中并把双字数组写入一个磁盘文件。</span><br><span class="line">;作者：9unk</span><br><span class="line">;编写时间：2022-11-30</span><br><span class="line">;----------------------------</span><br><span class="line"></span><br><span class="line">;1、把 lx4-6.asm 改写为子函数，向指定大小数组写入斐波那契数列</span><br><span class="line">;2、创建文件</span><br><span class="line">;3、写入数据</span><br><span class="line">;4、关闭文件</span><br><span class="line"></span><br><span class="line">INCLUDE Irvine32.inc</span><br><span class="line"></span><br><span class="line">.data</span><br><span class="line">filename BYTE &quot;Fib.txt&quot;,0</span><br><span class="line">handles DWORD ?</span><br><span class="line">FibSeq dd 47 DUP(0)</span><br><span class="line">create_err db &#x27;Failed to create file!&#x27;,0</span><br><span class="line">write_err db &#x27;Failed to write file!&#x27;,0</span><br><span class="line"></span><br><span class="line">.code</span><br><span class="line">main PROC</span><br><span class="line">    ;存储数组</span><br><span class="line">    MOV ecx,47</span><br><span class="line">    MOV esi,OFFSET FibSeq</span><br><span class="line">    CALL FibSeqs</span><br><span class="line">    ;创建文件</span><br><span class="line">    MOV edx,OFFSET filename</span><br><span class="line">    CALL CreateOutputFile</span><br><span class="line">    CMP eax,INVALID_HANDLE_VALUE</span><br><span class="line">    JE create_error</span><br><span class="line">    ;MOV handle,eax</span><br><span class="line">    ;写入数据</span><br><span class="line">    ;MOV eax,handle</span><br><span class="line">    MOV edx,OFFSET FibSeq</span><br><span class="line">    MOV ecx,LENGTHOF FibSeq*4</span><br><span class="line">    CALL writeToFile</span><br><span class="line">    CMP eax,LENGTHOF FibSeq*4</span><br><span class="line">    jnz write_error</span><br><span class="line">    ;关闭文件</span><br><span class="line">    MOV eax,handles</span><br><span class="line">    CALL CloseFile</span><br><span class="line">    JMP file_stop</span><br><span class="line">create_error:</span><br><span class="line">    MOV edx,OFFSET create_err</span><br><span class="line">    CALL WriteString</span><br><span class="line">    JMP file_stop</span><br><span class="line">write_error:</span><br><span class="line">    MOV edx,OFFSET write_err</span><br><span class="line">    CALL WriteString</span><br><span class="line">file_stop:</span><br><span class="line">    exit</span><br><span class="line">main ENDP</span><br><span class="line"></span><br><span class="line">;------------------------------------------</span><br><span class="line">FibSeqs PROC</span><br><span class="line">;功能：将指定数量的斐波那契数列存储到数组中。</span><br><span class="line">;入口参数：esi=数组指针；ecx=斐波那契数列数量</span><br><span class="line">;出口参数：无</span><br><span class="line">;------------------------------------------</span><br><span class="line">    MOV DWORD PTR [esi-4],0</span><br><span class="line">    MOV DWORD PTR [esi],1</span><br><span class="line">FibSeqs1:</span><br><span class="line">    ADD esi,4</span><br><span class="line">    MOV eax,[esi-4]</span><br><span class="line">    MOV edx,[esi-8]</span><br><span class="line">    ADD eax,edx</span><br><span class="line">    MOV DWORD PTR [esi],eax</span><br><span class="line">    LOOP FibSeqs1</span><br><span class="line">    RET</span><br><span class="line">FibSeqs ENDP</span><br><span class="line">END main</span><br></pre></td></tr></table></figure>

<h2 id="简单加法1"><a href="#简单加法1" class="headerlink" title="简单加法1"></a>简单加法1</h2><p>写一个程序，首先清除屏幕并把光标定位在屏幕的中间位置，然后提示用户输入两个整数，把它们相加并显示和。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">;---------------------------</span><br><span class="line">;程序名：lx5-3.asm</span><br><span class="line">;功能：写一个程序，首先清除屏幕并把光标定位在屏幕的中间位置，然后提示用户输入两个整数，把它们相加并显示和。</span><br><span class="line">;作者：9unk</span><br><span class="line">;编写时间：2022-11-30</span><br><span class="line">;----------------------------</span><br><span class="line"></span><br><span class="line">;1、清屏</span><br><span class="line">;2、获取窗口大小</span><br><span class="line">;3、重新定位光标</span><br><span class="line">;4、输出提示信息，要求用户输入两个整数。</span><br><span class="line">;5、显示两个数的和</span><br><span class="line"></span><br><span class="line">INCLUDE Irvine32.inc</span><br><span class="line"></span><br><span class="line">.data</span><br><span class="line">msg db &#x27;Please Input Integer: &#x27;,0</span><br><span class="line">cloumn db 0</span><br><span class="line">line db 0</span><br><span class="line"></span><br><span class="line">.code</span><br><span class="line">main PROC</span><br><span class="line">    CALL Clrscr</span><br><span class="line">    CALL GETMaxXY</span><br><span class="line">    ;行和列除以2</span><br><span class="line">    SHR dh,1</span><br><span class="line">    SHR dl,1</span><br><span class="line">    MOV line,dh</span><br><span class="line">    MOV cloumn,dl</span><br><span class="line">    CALL Gotoxy</span><br><span class="line">    ;提示并输入第一个整数</span><br><span class="line">    MOV edx,OFFSET msg</span><br><span class="line">    CALL WriteString</span><br><span class="line">    CALL ReadInt</span><br><span class="line">    MOV ebx,eax</span><br><span class="line">    ;换行</span><br><span class="line">    CALL Crlf</span><br><span class="line">    ;光标定位到下一行的屏幕中间位置</span><br><span class="line">    INC line</span><br><span class="line">    MOV dh,line</span><br><span class="line">    MOV dl,cloumn</span><br><span class="line">    CALL Gotoxy</span><br><span class="line">    ;提示输入第二个整数</span><br><span class="line">    MOV edx,OFFSET msg</span><br><span class="line">    CALL WriteString</span><br><span class="line">    CALL ReadInt</span><br><span class="line">    ;光标定位到下一行的屏幕中间位置</span><br><span class="line">    INC line</span><br><span class="line">    MOV dh,line</span><br><span class="line">    MOV dl,cloumn</span><br><span class="line">    CALL Gotoxy</span><br><span class="line">    ;输出结果</span><br><span class="line">    ADD eax,ebx</span><br><span class="line">    CALL WriteInt</span><br><span class="line">    exit</span><br><span class="line">main ENDP</span><br><span class="line">END main</span><br></pre></td></tr></table></figure>

<h2 id="简单加法2"><a href="#简单加法2" class="headerlink" title="简单加法2"></a>简单加法2</h2><p>用上一程序作为起点，使用循环令其重复执行三次，每次重复之后清除屏幕。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">;---------------------------</span><br><span class="line">;程序名：lx5-4.asm</span><br><span class="line">;功能：用上一程序(lx5-3)作为起点，使用循环令其重复执行三次，每次重复之后清除屏幕。</span><br><span class="line">;作者：9unk</span><br><span class="line">;编写时间：2022-11-30</span><br><span class="line">;----------------------------</span><br><span class="line"></span><br><span class="line">;1、清屏</span><br><span class="line">;2、获取窗口大小</span><br><span class="line">;3、重新定位光标</span><br><span class="line">;4、输出提示信息，要求用户输入两个整数。</span><br><span class="line">;5、显示两个数的和</span><br><span class="line"></span><br><span class="line">INCLUDE Irvine32.inc</span><br><span class="line"></span><br><span class="line">.data</span><br><span class="line">msg db &#x27;Please Input Integer: &#x27;,0</span><br><span class="line">cloumn db 0</span><br><span class="line">line db 0</span><br><span class="line"></span><br><span class="line">.code</span><br><span class="line">main PROC</span><br><span class="line">    MOV ecx,3</span><br><span class="line">loop1:</span><br><span class="line">    CALL inputint</span><br><span class="line">    ;CALL Clrscr</span><br><span class="line">    CALL Crlf</span><br><span class="line">    CALL WaitMsg</span><br><span class="line">    LOOP loop1</span><br><span class="line">    exit</span><br><span class="line">main ENDP</span><br><span class="line"></span><br><span class="line">inputint PROC</span><br><span class="line">    CALL Clrscr</span><br><span class="line">    CALL GETMaxXY</span><br><span class="line">    ;行和列除以2</span><br><span class="line">    SHR dh,1</span><br><span class="line">    SHR dl,1</span><br><span class="line">    MOV line,dh</span><br><span class="line">    MOV cloumn,dl</span><br><span class="line">    CALL Gotoxy</span><br><span class="line">    ;提示并输入第一个整数</span><br><span class="line">    MOV edx,OFFSET msg</span><br><span class="line">    CALL WriteString</span><br><span class="line">    CALL ReadInt</span><br><span class="line">    MOV ebx,eax</span><br><span class="line">    ;换行</span><br><span class="line">    CALL Crlf</span><br><span class="line">    ;光标定位到下一行的屏幕中间位置</span><br><span class="line">    INC line</span><br><span class="line">    MOV dh,line</span><br><span class="line">    MOV dl,cloumn</span><br><span class="line">    CALL Gotoxy</span><br><span class="line">    ;提示输入第二个整数</span><br><span class="line">    MOV edx,OFFSET msg</span><br><span class="line">    CALL WriteString</span><br><span class="line">    CALL ReadInt</span><br><span class="line">    ;光标定位到下一行的屏幕中间位置</span><br><span class="line">    INC line</span><br><span class="line">    MOV dh,line</span><br><span class="line">    MOV dl,cloumn</span><br><span class="line">    CALL Gotoxy</span><br><span class="line">    ;输出结果</span><br><span class="line">    ADD eax,ebx</span><br><span class="line">    CALL WriteInt</span><br><span class="line">    RET</span><br><span class="line">inputint ENDP</span><br><span class="line">END main</span><br></pre></td></tr></table></figure>

<h2 id="随机整数-1"><a href="#随机整数-1" class="headerlink" title="随机整数"></a>随机整数</h2><p>写一个程序，生成并显示 50 个 -20~+20 之间的随机整数。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">;-------------------------------------------------------</span><br><span class="line">;程序名：lx5-5.asm</span><br><span class="line">;功能：写一个程序，生成并显示 50 个 -20~+20 之间的随机整数。</span><br><span class="line">;作者：9unk</span><br><span class="line">;编写时间：2022-11-30</span><br><span class="line">;-------------------------------------------------------</span><br><span class="line"></span><br><span class="line">;使用 Randomize 生成随机数种子</span><br><span class="line">;使用循环生成并打印出结果</span><br><span class="line">;使用 RandomRange 生成0~40的伪随机数，然后再减 20 实现生成 -20~20 之间的随机数。</span><br><span class="line"></span><br><span class="line">INCLUDE Irvine32.inc</span><br><span class="line"></span><br><span class="line">.code</span><br><span class="line">main PROC</span><br><span class="line">    CALL Randomize</span><br><span class="line">    MOV ecx,50</span><br><span class="line">L1:</span><br><span class="line">    MOV eax,41</span><br><span class="line">    CALL RandomRange</span><br><span class="line">    SUB eax,20</span><br><span class="line">    CALL WriteInt</span><br><span class="line">    MOV al,TAB</span><br><span class="line">    CALL WriteChar</span><br><span class="line">    LOOP L1</span><br><span class="line">    exit</span><br><span class="line">main ENDP</span><br><span class="line">END main</span><br></pre></td></tr></table></figure>

<h2 id="随机字符串"><a href="#随机字符串" class="headerlink" title="随机字符串"></a>随机字符串</h2><p>写一个程序，生成并显示 20 个随机字符串，每个字符串包含 10 个大写字母（A~Z）。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">;-------------------------------------------------------</span><br><span class="line">;程序名：lx5-6.asm</span><br><span class="line">;功能：写一个程序，生成并显示 20 个随机字符串，每个字符串包含 10 个大写字母（A~Z）。</span><br><span class="line">;作者：9unk</span><br><span class="line">;编写时间：2022-11-30</span><br><span class="line">;-------------------------------------------------------</span><br><span class="line"></span><br><span class="line">;1、设计子程序循环随机生成一个字符 10 次</span><br><span class="line">;2、循环运行上面的子程序 20 次。</span><br><span class="line">;3、为了实现字符串随机，我们还需要在循环中加上随机延时来达到目的。</span><br><span class="line">;随机延时时间在0~15ms就可以达到目的。</span><br><span class="line"></span><br><span class="line">INCLUDE Irvine32.inc</span><br><span class="line"></span><br><span class="line">.code</span><br><span class="line">main PROC</span><br><span class="line">    MOV ecx,20</span><br><span class="line">L1:    </span><br><span class="line">    CALL RandomStr</span><br><span class="line">    CALL Crlf</span><br><span class="line">    ;定义一个随机延时</span><br><span class="line">    CALL Randomize</span><br><span class="line">    MOV eax,15</span><br><span class="line">    CALL RandomRange</span><br><span class="line">    CALL Delay</span><br><span class="line">    LOOP L1</span><br><span class="line">    exit</span><br><span class="line">main ENDP</span><br><span class="line"></span><br><span class="line">;-------------------------------------------------</span><br><span class="line">RandomStr PROC USES ecx</span><br><span class="line">;功能：随机生成使用 10 个 A~Z 之间的字母生成的字符串</span><br><span class="line">;入口参数：无</span><br><span class="line">;出口参数：无</span><br><span class="line">;-------------------------------------------------</span><br><span class="line">    CALL Randomize</span><br><span class="line">    MOV ecx,10</span><br><span class="line">RandomStr1:</span><br><span class="line">    MOV eax,26</span><br><span class="line">    CALL RandomRange</span><br><span class="line">    ADD eax,65</span><br><span class="line">    CALL WriteChar</span><br><span class="line">    LOOP RandomStr1</span><br><span class="line">    RET</span><br><span class="line">Randomstr ENDP</span><br><span class="line">END main</span><br></pre></td></tr></table></figure>

<h2 id="随机屏幕位置"><a href="#随机屏幕位置" class="headerlink" title="随机屏幕位置"></a>随机屏幕位置</h2><p>写一个程序，在100个随机的屏幕位置显示一个字符，在显示字符时使用 100ms 的延迟。提示：使用 GetMaxXY 过程确定当前控制台窗口的大小。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">;------------------------------------------------------------------------------</span><br><span class="line">;程序名：lx5-7.asm</span><br><span class="line">;功能：写一个程序，在100个随机的屏幕位置显示一个字符，在显示字符时使用 100ms 的延迟。提示：使用 GetMaxXY 过程确定当前控制台窗口的大小。</span><br><span class="line">;作者：9unk</span><br><span class="line">;编写时间：2022-11-30</span><br><span class="line">;-------------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">;1、清屏</span><br><span class="line">;2、GetMaxXY 获取屏幕大小</span><br><span class="line">;3、分别用行和列生成对应的随机数</span><br><span class="line">;4、使用 GotoXY 定位到屏幕位置</span><br><span class="line">;5、输出随机字母</span><br><span class="line">;6、延迟 100ms</span><br><span class="line">;7、循环执行 100 次</span><br><span class="line"></span><br><span class="line">INCLUDE Irvine32.inc</span><br><span class="line"></span><br><span class="line">.data</span><br><span class="line">cloumn db 0</span><br><span class="line">line db 0</span><br><span class="line"></span><br><span class="line">.code</span><br><span class="line">main PROC</span><br><span class="line">    CALL Clrscr</span><br><span class="line">    MOV ecx,100</span><br><span class="line">L1:</span><br><span class="line">    CALL GetMaxXY</span><br><span class="line">    MOV line,dh</span><br><span class="line">    MOV cloumn,dl</span><br><span class="line">    ;随机生成行</span><br><span class="line">    MOVZX eax,dh</span><br><span class="line">    INC al</span><br><span class="line">    CALL RandomRange</span><br><span class="line">    MOV line,al</span><br><span class="line">    ;随机生成列</span><br><span class="line">    MOVZX eax,dl</span><br><span class="line">    INC al</span><br><span class="line">    CALL RandomRange</span><br><span class="line">    MOV cloumn,al</span><br><span class="line">    ;定位光标</span><br><span class="line">    MOV dh,line</span><br><span class="line">    MOV dl,cloumn</span><br><span class="line">    CALL GotoXY</span><br><span class="line">    ;随机输出一个字符</span><br><span class="line">    CALL Randomchr</span><br><span class="line">    ;延迟100毫秒</span><br><span class="line">    MOV eax,100</span><br><span class="line">    CALL Delay</span><br><span class="line">    LOOP L1</span><br><span class="line">    ;</span><br><span class="line">    exit</span><br><span class="line">main ENDP</span><br><span class="line"></span><br><span class="line">;-------------------------------------------------</span><br><span class="line">Randomchr PROC</span><br><span class="line">;功能：随机生成一个字符</span><br><span class="line">;入口参数：无</span><br><span class="line">;出口参数：无</span><br><span class="line">;-------------------------------------------------</span><br><span class="line">    CALL Randomize</span><br><span class="line">    ;</span><br><span class="line">    MOV eax,26</span><br><span class="line">    CALL RandomRange</span><br><span class="line">    ADD eax,65</span><br><span class="line">    CALL WriteChar</span><br><span class="line">    RET</span><br><span class="line">Randomchr ENDP</span><br><span class="line">END main</span><br></pre></td></tr></table></figure>

<h2 id="色彩矩阵"><a href="#色彩矩阵" class="headerlink" title="色彩矩阵"></a>色彩矩阵</h2><p>写一个程序，以所有可能的前景和背景色的组合（16X16&#x3D;256）显示某个字符。颜色值的取值范围是0~15，因此可以使用一个嵌套的循环来产生所有可能的组合。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">;--------------------------------------------------------------------------</span><br><span class="line">;程序名：lx5-8.asm</span><br><span class="line">;功能：写一个程序，以所有可能的前景和背景色的组合（16X16=256）显示某个字符。</span><br><span class="line">;颜色值的取值范围是0~15，因此可以使用一个嵌套的循环来产生所有可能的组合。</span><br><span class="line">;作者：9unk</span><br><span class="line">;编写时间：2022-12-1</span><br><span class="line">;--------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">;1、清屏</span><br><span class="line">;2、每次循环：生成一个随机数 0~15 的随机数作为前景色</span><br><span class="line">;3、每次循环：生成一个随机数 0~15 的随机数作为背景色</span><br><span class="line">;4、每次循环：输出一个随机字母 A~Z</span><br><span class="line">;5、循环结束：恢复原有屏幕颜色</span><br><span class="line">;6、结束程序</span><br><span class="line"></span><br><span class="line">INCLUDE Irvine32.inc</span><br><span class="line"></span><br><span class="line">.data</span><br><span class="line">Fore dW ?</span><br><span class="line">Back dW ?</span><br><span class="line"></span><br><span class="line">.code</span><br><span class="line">main PROC</span><br><span class="line">    CALL Clrscr</span><br><span class="line">    MOV ecx,5</span><br><span class="line">L1:</span><br><span class="line">    ;随机生成前景色</span><br><span class="line">    CALL Randomize</span><br><span class="line">    MOV eax,16</span><br><span class="line">    CALL RandomRange</span><br><span class="line">    MOV Fore,ax</span><br><span class="line">    ;随机延时15ms</span><br><span class="line">    CALL Randomize</span><br><span class="line">    MOV eax,15</span><br><span class="line">    CALL RandomRange</span><br><span class="line">    CALL Delay</span><br><span class="line">    ;随机生成背景色</span><br><span class="line">    CALL Randomize</span><br><span class="line">    MOV eax,16</span><br><span class="line">    CALL RandomRange</span><br><span class="line">    ;设置窗口颜色</span><br><span class="line">    ;MOV cl,4</span><br><span class="line">    SHL ax,4</span><br><span class="line">    ADD ax,Fore</span><br><span class="line">    CALL SetTextColor</span><br><span class="line">    ;输出随机字母</span><br><span class="line">    CALL Randomchr</span><br><span class="line">    LOOP L1</span><br><span class="line">    ;恢复窗口颜色</span><br><span class="line">    MOV eax,gray+(black*16)</span><br><span class="line">    CALL SetTextColor</span><br><span class="line">    ;结束程序</span><br><span class="line">    exit</span><br><span class="line">main ENDP</span><br><span class="line"></span><br><span class="line">;-------------------------------------------------</span><br><span class="line">Randomchr PROC</span><br><span class="line">;功能：随机生成一个字符</span><br><span class="line">;入口参数：无</span><br><span class="line">;出口参数：无</span><br><span class="line">;-------------------------------------------------</span><br><span class="line">    CALL Randomize</span><br><span class="line">    ;</span><br><span class="line">    MOV eax,26</span><br><span class="line">    CALL RandomRange</span><br><span class="line">    ADD eax,65</span><br><span class="line">    CALL WriteChar</span><br><span class="line">    RET</span><br><span class="line">Randomchr ENDP</span><br><span class="line"></span><br><span class="line">END main</span><br></pre></td></tr></table></figure>
<h2 id="求和程序"><a href="#求和程序" class="headerlink" title="求和程序"></a>求和程序</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/204566421-b7b8e052-a0e6-4727-8617-16123c76247e.png"
                      alt="47"
                ></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line">;---------------------------</span><br><span class="line">;程序名：lx5-9.asm</span><br><span class="line">;功能：按题目要求修改 sum2.asm</span><br><span class="line">;作者：9unk</span><br><span class="line">;编写时间：2022-12-1</span><br><span class="line">;----------------------------</span><br><span class="line"></span><br><span class="line">INCLUDE Irvine32.inc</span><br><span class="line">ARRAY_SIZE = 20</span><br><span class="line"></span><br><span class="line">.data</span><br><span class="line">str1 BYTE &quot;Enter a signed integer: &quot;,0</span><br><span class="line">str2 BYTE &quot;The sum of the integer is: &quot;,0</span><br><span class="line">str3 BYTE &quot;How many integers whiLbe added? &quot;,0</span><br><span class="line">str4 BYTE &quot;The Array cannot be larger than 20&quot;,0</span><br><span class="line">array DWORD ARRAY_SIZE DUP(?)</span><br><span class="line"></span><br><span class="line">.code</span><br><span class="line">main PROC</span><br><span class="line">    CALL Clrscr</span><br><span class="line">    CALL Tips</span><br><span class="line">    MOV esi,OFFSET array</span><br><span class="line">    MOV ecx,eax</span><br><span class="line">    CALL PromptForIntegers</span><br><span class="line">    CALL ArraySum</span><br><span class="line">    CALL DisplaySum</span><br><span class="line">    exit</span><br><span class="line">main ENDP</span><br><span class="line"></span><br><span class="line">;------------------------------------------------</span><br><span class="line">PromptForIntegers PROC USES ecx edx esi</span><br><span class="line">;功能：提示用户输入任意数量的整数，并将整数插入数组。</span><br><span class="line">;入口参数: ESI = 数组指针, ecx = 数组的大小</span><br><span class="line">;出口参数: 无</span><br><span class="line">;------------------------------------------------</span><br><span class="line">    MOV edx,OFFSET str1</span><br><span class="line">L1:</span><br><span class="line">    CALL WriteString</span><br><span class="line">    CALL ReadInt</span><br><span class="line">    CALL Crlf</span><br><span class="line">    MOV [esi],eax</span><br><span class="line">    ADD esi,TYPE DWORD</span><br><span class="line">    LOOP L1</span><br><span class="line">    RET</span><br><span class="line">PromptForIntegers ENDP</span><br><span class="line"></span><br><span class="line">;-------------------------------------------------</span><br><span class="line">ArraySum PROC USES esi ecx</span><br><span class="line">;功能：计算32位整数数组的和。</span><br><span class="line">;入口参数：esi = 数组指针，ecx = 数组的元素个数</span><br><span class="line">;出口参数：eax = 数组元素的和</span><br><span class="line">    MOV eax,0</span><br><span class="line">L1:</span><br><span class="line">    ADD eax,[esi]</span><br><span class="line">    ADD esi,TYPE DWORD</span><br><span class="line">    LOOP L1</span><br><span class="line">    RET</span><br><span class="line">ArraySum ENDP</span><br><span class="line"></span><br><span class="line">;------------------------------------------------</span><br><span class="line">DisplaySum PROC USES edx</span><br><span class="line">;功能：在屏幕上显示数字</span><br><span class="line">;入口参数：eax</span><br><span class="line">;出口参数：无 </span><br><span class="line">;------------------------------------------------</span><br><span class="line">    MOV edx,OFFSET str2</span><br><span class="line">    CALL WriteString</span><br><span class="line">    CALL WriteInt</span><br><span class="line">    CALL Crlf</span><br><span class="line">    RET</span><br><span class="line">DisplaySum ENDP</span><br><span class="line"></span><br><span class="line">;------------------------------------------------</span><br><span class="line">Tips PROC USES edx</span><br><span class="line">;功能：输出提示信息，如果数组数量小于20，返回值到eax</span><br><span class="line">;如果大于20，提示报错信息，并终止程序。</span><br><span class="line">;入口参数：eax</span><br><span class="line">;出口参数：eax</span><br><span class="line">;------------------------------------------------</span><br><span class="line">    MOV edx,OFFSET str3</span><br><span class="line">    CALL WriteString</span><br><span class="line">    CALL ReadInt</span><br><span class="line">    ;CALL WriteInt</span><br><span class="line">    CMP eax,20</span><br><span class="line">    JG pro_stop</span><br><span class="line">    RET</span><br><span class="line">pro_stop:</span><br><span class="line">    CALL Crlf</span><br><span class="line">    MOV edx,OFFSET str4</span><br><span class="line">    CALL WriteString</span><br><span class="line">    ;报错就直接终止程序</span><br><span class="line">    exit</span><br><span class="line">Tips ENDP</span><br><span class="line">END main</span><br></pre></td></tr></table></figure>
        </div>

        
            <div class="post-copyright-info">
                <div class="article-copyright-info-container">
    <ul>
        <li>本文标题：80386汇编-过程</li>
        <li>本文作者：9unk</li>
        <li>创建时间：2022-11-13 23:53:00</li>
        <li>
            本文链接：https://9unkk.github.io/2022/11/13/80386-hui-bian-guo-cheng/
        </li>
        <li>
            版权声明：本博客所有文章除特别声明外，均采用 <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">BY-NC-SA</a> 许可协议。转载请注明出处！
        </li>
    </ul>
</div>

            </div>
        

        
            <ul class="post-tags-box">
                
                    <li class="tag-item">
                        <a href="/tags/%E6%B1%87%E7%BC%96/">#汇编</a>&nbsp;
                    </li>
                
            </ul>
        

        
            <div class="article-nav">
                
                    <div class="article-prev">
                        <a class="prev"
                           rel="prev"
                           href="/2022/11/13/80386-hui-bian-zhi-ling-ji/"
                        >
                            <span class="left arrow-icon flex-center">
                              <i class="fas fa-chevron-left"></i>
                            </span>
                            <span class="title flex-center">
                                <span class="post-nav-title-item">80386汇编-指令集</span>
                                <span class="post-nav-item">上一篇</span>
                            </span>
                        </a>
                    </div>
                
                
                    <div class="article-next">
                        <a class="next"
                           rel="next"
                           href="/2022/11/08/80386-hui-bian-shu-ju-chu-li/"
                        >
                            <span class="title flex-center">
                                <span class="post-nav-title-item">80386汇编-数据传送、寻址和算数运算</span>
                                <span class="post-nav-item">下一篇</span>
                            </span>
                            <span class="right arrow-icon flex-center">
                              <i class="fas fa-chevron-right"></i>
                            </span>
                        </a>
                    </div>
                
            </div>
        

        
    </div>
</div>


                
            </div>

        </div>

        <div class="page-main-content-bottom">
            <footer class="footer">
    <div class="info-container">
        <div class="copyright-info info-item">
            &copy;
            
              <span>2022</span>
              -
            
            2023&nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;<a href="/">9unk</a>
        </div>
        
        <div class="theme-info info-item">
            由 <a target="_blank" href="https://hexo.io">Hexo</a> 驱动&nbsp;|&nbsp;主题&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep v3.4.5</a>
        </div>
        
        
    </div>
</footer>

        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="tools-list">
        <!-- TOC aside toggle -->
        
            <li class="tools-item page-aside-toggle">
                <i class="fas fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
    </ul>
</div>

        </div>
    

    <div class="right-bottom-side-tools">
        <div class="side-tools-container">
    <ul class="side-tools-list">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-expand-width flex-center">
            <i class="fas fa-arrows-alt-h"></i>
        </li>

        <li class="tools-item tool-dark-light-toggle flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        

        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list">
        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>
        
            <li class="tools-item tool-scroll-to-top flex-center">
                <i class="arrow-up fas fa-arrow-up"></i>
                <span class="percent"></span>
            </li>
        
    </ul>
</div>

    </div>

    
        <aside class="page-aside">
            <div class="post-toc-wrap">
    <div class="post-toc">
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%83%8C%E6%99%AF%E7%9F%A5%E8%AF%86"><span class="nav-number">1.</span> <span class="nav-text">背景知识</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%93%BE%E6%8E%A5%E5%BA%93"><span class="nav-number">1.1.</span> <span class="nav-text">链接库</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%AC%E4%B9%A6%E4%B8%AD%E9%99%84%E5%B8%A6%E7%9A%84%E9%93%BE%E6%8E%A5%E5%BA%93"><span class="nav-number">1.2.</span> <span class="nav-text">本书中附带的链接库</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8E%A7%E5%88%B6%E5%8F%B0%E7%AA%97%E5%8F%A3"><span class="nav-number">1.2.1.</span> <span class="nav-text">控制台窗口</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%87%8D%E5%AE%9A%E5%90%91%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA"><span class="nav-number">1.2.2.</span> <span class="nav-text">重定向输入输出</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BF%87%E7%A8%8B%E6%8F%8F%E8%BF%B0"><span class="nav-number">1.3.</span> <span class="nav-text">过程描述</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#CloseFile%EF%BC%88%E4%BB%85Irvine32%EF%BC%89"><span class="nav-number">1.3.1.</span> <span class="nav-text">CloseFile（仅Irvine32）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CLrscr"><span class="nav-number">1.3.2.</span> <span class="nav-text">CLrscr</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Crlf"><span class="nav-number">1.3.3.</span> <span class="nav-text">Crlf</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CreateOutputFile%EF%BC%88%E4%BB%85Irvine32%EF%BC%89"><span class="nav-number">1.3.4.</span> <span class="nav-text">CreateOutputFile（仅Irvine32）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Delay"><span class="nav-number">1.3.5.</span> <span class="nav-text">Delay</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#DumpMem"><span class="nav-number">1.3.6.</span> <span class="nav-text">DumpMem</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#DumpRegs"><span class="nav-number">1.3.7.</span> <span class="nav-text">DumpRegs</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#GetCommandTail"><span class="nav-number">1.3.8.</span> <span class="nav-text">GetCommandTail</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#GetMaxXY%EF%BC%88%E4%BB%85Irvine32%EF%BC%89"><span class="nav-number">1.3.9.</span> <span class="nav-text">GetMaxXY（仅Irvine32）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#GetMseconds"><span class="nav-number">1.3.10.</span> <span class="nav-text">GetMseconds</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BA%93%E6%B5%8B%E8%AF%95%E7%A8%8B%E5%BA%8F"><span class="nav-number">1.4.</span> <span class="nav-text">库测试程序</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B4%E6%95%B0-I-x2F-O"><span class="nav-number">1.4.1.</span> <span class="nav-text">整数 I&#x2F;O</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9A%8F%E6%9C%BA%E6%95%B4%E6%95%B0"><span class="nav-number">1.4.2.</span> <span class="nav-text">随机整数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%A7%E8%83%BD%E5%BA%A6%E9%87%8F"><span class="nav-number">1.4.3.</span> <span class="nav-text">性能度量</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%A0%86%E6%A0%88%E6%93%8D%E4%BD%9C"><span class="nav-number">2.</span> <span class="nav-text">堆栈操作</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BE%8B%E5%AD%90%EF%BC%9A%E5%8F%8D%E8%BD%AC%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="nav-number">2.1.</span> <span class="nav-text">例子：反转字符串</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%BF%87%E7%A8%8B%E7%9A%84%E5%AE%9A%E4%B9%89%E5%92%8C%E4%BD%BF%E7%94%A8"><span class="nav-number">3.</span> <span class="nav-text">过程的定义和使用</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#PROC-%E4%BC%AA%E6%8C%87%E4%BB%A4"><span class="nav-number">3.1.</span> <span class="nav-text">PROC 伪指令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#CALL-%E5%92%8C-RET-%E6%8C%87%E4%BB%A4"><span class="nav-number">3.2.</span> <span class="nav-text">CALL 和 RET 指令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BE%8B%E5%AD%90%EF%BC%9A%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E5%AD%90%E7%A8%8B%E5%BA%8F%EF%BC%8C%E5%AF%B9%E6%95%B4%E6%95%B0%E6%95%B0%E7%BB%84%E6%B1%82%E5%92%8C%E3%80%82"><span class="nav-number">3.3.</span> <span class="nav-text">例子：创建一个子程序，对整数数组求和。</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B5%81%E7%A8%8B%E5%9B%BE"><span class="nav-number">3.4.</span> <span class="nav-text">流程图</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BF%9D%E6%8A%A4%E5%92%8C%E6%81%A2%E5%A4%8D%E5%AF%84%E5%AD%98%E5%99%A8"><span class="nav-number">4.</span> <span class="nav-text">保护和恢复寄存器</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E8%BF%87%E7%A8%8B%E8%BF%9B%E8%A1%8C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1"><span class="nav-number">5.</span> <span class="nav-text">使用过程进行程序设计</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B4%E6%95%B0%E6%B1%82%E5%92%8C%E7%A8%8B%E5%BA%8F%EF%BC%88%E8%AE%BE%E8%AE%A1%EF%BC%89"><span class="nav-number">5.1.</span> <span class="nav-text">整数求和程序（设计）</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%AF%BE%E5%90%8E%E7%BB%83%E4%B9%A0"><span class="nav-number">6.</span> <span class="nav-text">课后练习</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%98%E5%88%B6%E5%BD%A9%E8%89%B2%E6%96%87%E6%9C%AC"><span class="nav-number">6.1.</span> <span class="nav-text">绘制彩色文本</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%90%E6%B3%A2%E9%82%A3%E5%A5%91%E6%95%B0%E6%96%87%E4%BB%B6"><span class="nav-number">6.2.</span> <span class="nav-text">斐波那契数文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AE%80%E5%8D%95%E5%8A%A0%E6%B3%951"><span class="nav-number">6.3.</span> <span class="nav-text">简单加法1</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AE%80%E5%8D%95%E5%8A%A0%E6%B3%952"><span class="nav-number">6.4.</span> <span class="nav-text">简单加法2</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%9A%8F%E6%9C%BA%E6%95%B4%E6%95%B0-1"><span class="nav-number">6.5.</span> <span class="nav-text">随机整数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%9A%8F%E6%9C%BA%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="nav-number">6.6.</span> <span class="nav-text">随机字符串</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%9A%8F%E6%9C%BA%E5%B1%8F%E5%B9%95%E4%BD%8D%E7%BD%AE"><span class="nav-number">6.7.</span> <span class="nav-text">随机屏幕位置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%89%B2%E5%BD%A9%E7%9F%A9%E9%98%B5"><span class="nav-number">6.8.</span> <span class="nav-text">色彩矩阵</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B1%82%E5%92%8C%E7%A8%8B%E5%BA%8F"><span class="nav-number">6.9.</span> <span class="nav-text">求和程序</span></a></li></ol></li></ol>
    </div>
</div>
        </aside>
    

    <div class="image-viewer-container">
    <img src="">
</div>


    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="搜索..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="popup-btn-close">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

</main>




<script src="/js/utils.js"></script>

<script src="/js/main.js"></script>

<script src="/js/header-shrink.js"></script>

<script src="/js/back2top.js"></script>

<script src="/js/dark-light-toggle.js"></script>



    
<script src="/js/local-search.js"></script>




    
<script src="/js/code-copy.js"></script>




    
<script src="/js/lazyload.js"></script>



<div class="post-scripts pjax">
    
        
<script src="/js/left-side-toggle.js"></script>

<script src="/js/libs/anime.min.js"></script>

<script src="/js/toc.js"></script>

    
</div>


    
<script src="/js/libs/pjax.min.js"></script>

<script>
    window.addEventListener('DOMContentLoaded', () => {
        window.pjax = new Pjax({
            selectors: [
                'head title',
                '.page-container',
                '.pjax'
            ],
            history: true,
            debug: false,
            cacheBust: false,
            timeout: 0,
            analytics: false,
            currentUrlFullReload: false,
            scrollRestoration: false,
            // scrollTo: true,
        });

        document.addEventListener('pjax:send', () => {
            KEEP.utils.pjaxProgressBarStart();
        });

        document.addEventListener('pjax:complete', () => {
            KEEP.utils.pjaxProgressBarEnd();
            window.pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'));
            KEEP.refresh();
        });
    });
</script>



</body>
</html>
