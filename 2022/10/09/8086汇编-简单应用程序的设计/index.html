<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="咸鱼">
    <meta name="author" content="9unk">
    
    <title>
        
            8086汇编-简单应用程序的设计 |
        
        9unk Blog
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    <link rel="shortcut icon" href="/images/logo.jpg">
    
<link rel="stylesheet" href="/css/font-awesome.min.css">

    <script id="hexo-configurations">
    let KEEP = window.KEEP || {};
    KEEP.hexo_config = {"hostname":"example.com","root":"/","language":"zh-CN"};
    KEEP.theme_config = {"toc":{"enable":true,"number":true,"expand_all":false,"init_open":true},"style":{"primary_color":"#0066CC","avatar":"/images/logo.jpg","favicon":"/images/logo.jpg","article_img_align":"left","left_side_width":"260px","content_max_width":"920px","hover":{"shadow":false,"scale":false},"first_screen":{"enable":true,"background_img":"/images/bg.svg","description":"人初做事，如鸡伏卵，不舍而生气渐充。如燕营巢，不息而结构渐牢。如滋培之木，不见其长，有时而大。如有本之泉，不舍昼夜，盈科而后进，放乎四海。"},"scroll":{"progress_bar":{"enable":false},"percent":{"enable":true}}},"local_search":{"enable":true,"preload":true},"code_copy":{"enable":true,"style":"mac"},"pjax":{"enable":true},"lazyload":{"enable":true},"version":"3.4.5"};
    KEEP.language_ago = {"second":"%s 秒前","minute":"%s 分钟前","hour":"%s 小时前","day":"%s 天前","week":"%s 周前","month":"%s 个月前","year":"%s 年前"};
  </script>
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
<div class="progress-bar-container">
    

    
        <span class="pjax-progress-bar"></span>
        <span class="pjax-progress-icon">
            <i class="fas fa-circle-notch fa-spin"></i>
        </span>
    
</div>


<main class="page-container">

    

    <div class="page-main-content">

        <div class="page-main-content-top">
            <header class="header-wrapper">

    <div class="header-content">
        <div class="left">
            
            <a class="logo-title" href="/">
                9unk Blog
            </a>
        </div>

        <div class="right">
            <div class="pc">
                <ul class="menu-list">
                    
                        <li class="menu-item">
                            <a class=""
                               href="/"
                            >
                                首页
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/archives"
                            >
                                归档
                            </a>
                        </li>
                    
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="fas fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/">首页</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/archives">归档</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle">

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    <div class="article-content-container">

        <div class="article-title">
            <span class="title-hover-animation">8086汇编-简单应用程序的设计</span>
        </div>

        
            <div class="article-header">
                <div class="avatar">
                    <img src="/images/logo.jpg">
                </div>
                <div class="info">
                    <div class="author">
                        <span class="name">9unk</span>
                        
                            <span class="author-label">Lv5</span>
                        
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fas fa-edit"></i>&nbsp;
        <span class="pc">2022-10-09 21:53:00</span>
        <span class="mobile">2022-10-09 21:53</span>
    </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fas fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/%E6%B1%87%E7%BC%96/">汇编</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
    
    
</div>

                    </div>
                </div>
            </div>
        

        <div class="article-content markdown-body">
            <h1 id="字符串处理"><a href="#字符串处理" class="headerlink" title="字符串处理"></a>字符串处理</h1><p>字符串就是一组连续的字符数据。对字符串的操作处理包括复制、检索、插入、删除和替换等。为了方便对字符串将进行有效的处理，8086&#x2F;8088提供了专门用于处理字符串的指令，这些指令称为字符串操作指令，简称为串操作指令。本节先介绍串操作指令与串操作指令密切相关的重复前缀，并举例说明如何利用它们进行字符串处理。</p>
<h2 id="字符串操作指令"><a href="#字符串操作指令" class="headerlink" title="字符串操作指令"></a>字符串操作指令</h2><h3 id="简单说明"><a href="#简单说明" class="headerlink" title="简单说明"></a>简单说明</h3><p>8086&#x2F;8088 共有五种基本的串操作指令。每种基本的串操作指令包含两条指令，一条适用于以字节为单元的字符串，另一条是适用于以字为单元的字符串。<br>在字符串操作指令中，由 SI 指向源操作数（串），由 DI 指向目的操作数（串）。规定源串存放在当前 ds（数据段）中，目的串存放在当前 es（附加段）中，即 DS:SI 指向源串，ES:DI指向目的串。<br>串操作指令执行时会自动调整 SI 和 DI 的值。此外，字符串操作的方向是由 DF（方向） 标志位控制。DF 默认为0，按递增的方式调整 SI 或 DI 值；当DF置为1时，按递减当方式调整 SI 和 DI 的值。</p>
<h3 id="字符串装入指令（LOAD-String）"><a href="#字符串装入指令（LOAD-String）" class="headerlink" title="字符串装入指令（LOAD String）"></a>字符串装入指令（LOAD String）</h3><p>字符串装入指令如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">LODSB   ;装入字节（Byte）</span><br><span class="line">LODSW   ;装入字（Word）</span><br></pre></td></tr></table></figure>
<p>字符串装入指令只是把字符串中的一个字符装入到累加器中。</p>
<ul>
<li>LODSB 把 SI 所指向的一个字节装入 AL 中，然后根据方向标志位 DF 使 SI 的值递增1或递减1。</li>
<li>LODSW 把 SI 所指向的一个字节装入 AX 中，然后根据方向标志位 DF 使 SI 的值递增2或递减2。</li>
</ul>
<blockquote>
<p>字符串装入指令的源操作数是存储操作数，所以引用数据段寄存器DS，该指令不影响标志位。</p>
</blockquote>
<p>例1：修改 T3-12.asm ，使用 LODSB 指令 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">;程序名：T6-1.asm</span><br><span class="line">;功能：把一个字符串中的所有大写字母改写成小写，使用 LODSB 指令</span><br><span class="line"></span><br><span class="line">assume ds:data,cs:code</span><br><span class="line"></span><br><span class="line">data segment</span><br><span class="line">char db &#x27;HOW are yoU !&#x27;,0</span><br><span class="line">data ends</span><br><span class="line"></span><br><span class="line">code segment</span><br><span class="line">start:</span><br><span class="line">    mov ax,data</span><br><span class="line">    mov ds,ax</span><br><span class="line">    ;</span><br><span class="line">    CLD         ;清除方向标志位</span><br><span class="line">char_A:</span><br><span class="line">    LODSB       ;读字节，同时si+1</span><br><span class="line">    cmp al,0</span><br><span class="line">    jz stop</span><br><span class="line">    ;</span><br><span class="line">    cmp al,41h</span><br><span class="line">    jb output</span><br><span class="line">    cmp al,5Ah</span><br><span class="line">    ja output</span><br><span class="line">    add al,20h</span><br><span class="line">    ;</span><br><span class="line">output:</span><br><span class="line">    mov dl,al</span><br><span class="line">    mov ah,2</span><br><span class="line">    int 21h</span><br><span class="line">    jmp char_A</span><br><span class="line">    ;</span><br><span class="line">stop:</span><br><span class="line">    mov ax,4c00h</span><br><span class="line">    int 21h</span><br><span class="line">code ends</span><br><span class="line">    end start</span><br></pre></td></tr></table></figure>

<p>在汇编语言中，两条字符串装入指令的格式可统一写成如下格式：<br><code>LODS OPRD</code></p>
<p>汇编程序根据操作数的类型，决定使用字节装入指令还是字装入指令。</p>
<p>案例：演示LODS指令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">;程序名：T6-1-1.asm</span><br><span class="line">;功能：演示 LODS 指令</span><br><span class="line"></span><br><span class="line">assume ds:data,cs:code</span><br><span class="line"></span><br><span class="line">data segment</span><br><span class="line">char db &#x27;HOW are yoU !&#x27;,0</span><br><span class="line">data ends</span><br><span class="line"></span><br><span class="line">code segment</span><br><span class="line">start:</span><br><span class="line">    mov ax,data</span><br><span class="line">    mov ds,ax</span><br><span class="line">    ;</span><br><span class="line">    CLD         ;清除方向标志位</span><br><span class="line">char_A:</span><br><span class="line">    LODS char      ;读字节，同时si+1</span><br><span class="line">    cmp al,0</span><br><span class="line">    jz stop</span><br><span class="line">    ;</span><br><span class="line">    cmp al,41h</span><br><span class="line">    jb output</span><br><span class="line">    cmp al,5Ah</span><br><span class="line">    ja output</span><br><span class="line">    add al,20h</span><br><span class="line">    ;</span><br><span class="line">output:</span><br><span class="line">    mov dl,al</span><br><span class="line">    mov ah,2</span><br><span class="line">    int 21h</span><br><span class="line">    jmp char_A</span><br><span class="line">    ;</span><br><span class="line">stop:</span><br><span class="line">    mov ax,4c00h</span><br><span class="line">    int 21h</span><br><span class="line">code ends</span><br><span class="line">    end start</span><br></pre></td></tr></table></figure>

<h3 id="字符串存储指令（Store-String）"><a href="#字符串存储指令（Store-String）" class="headerlink" title="字符串存储指令（Store String）"></a>字符串存储指令（Store String）</h3><p>字符串存储指令格式如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">STOSB</span><br><span class="line">STOSW</span><br></pre></td></tr></table></figure>
<p>字符串存储指令是把累加器的值存储到字符串中，即替换字符串中的一个字符。</p>
<ul>
<li>字节存储指令 STOSB：把累加器 AL 的内容送到寄存器 DI 所指向的存储单元中，然后根据方向标志位 DF 的值增1或减1</li>
<li>字存储指令 STOSW：把累加器 AX 的内容送到寄存器 DI 所指向的存储单元中，然后根据方向标志位 DF 的值增2或减2</li>
</ul>
<blockquote>
<p>字符串操作指令引用当前附加段寄存器 ES，该指令不影响标志位。</p>
</blockquote>
<p>在汇编语言中，两条字符串存储指令的格式可统一写成如下格式：<br><code>STOS OPRD</code></p>
<p>汇编程序根据操作数的类型，决定使用字节装入指令还是字装入指令。</p>
<p>案例：把当前数据段中偏移 1000H 开始的 100 个字节的数据传送到从偏移2000H 开始的单元中。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">;程序名：T6-2.asm</span><br><span class="line">;功能：把当前数据段中偏移 1000H 开始的 100 个字节的数据传送到从偏移2000H 开始的单元中。</span><br><span class="line"></span><br><span class="line">assume cs:code</span><br><span class="line"></span><br><span class="line">code segment</span><br><span class="line">start:</span><br><span class="line">    mov ax,data</span><br><span class="line">    mov ds,ax</span><br><span class="line">    mov si,1000H</span><br><span class="line">    mov di,2000H</span><br><span class="line">    mov cx,100</span><br><span class="line">    ;</span><br><span class="line">    CLD         ;清除方向标志位</span><br><span class="line">NEXT:</span><br><span class="line">    LODSB</span><br><span class="line">    STOSB </span><br><span class="line">    loop NEXT</span><br><span class="line">    ;</span><br><span class="line">    mov ax,4c00h</span><br><span class="line">    int 21h</span><br><span class="line">code ends</span><br><span class="line">    end start</span><br></pre></td></tr></table></figure>

<h3 id="字符串传送指令（Move-String）"><a href="#字符串传送指令（Move-String）" class="headerlink" title="字符串传送指令（Move String）"></a>字符串传送指令（Move String）</h3><p>字符串传送指令格式如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MOVSB   ;字节传送</span><br><span class="line">MOVSW   ;字传送</span><br></pre></td></tr></table></figure>
<ul>
<li>MOVSB 把寄存器SI所指向的一个字节数据传送到由寄存器 DI 所指向的存储单元中，然后根据方向标志位 DF 的值增1或减1</li>
<li>MOVSW 把寄存器SI所指向的一个字数据传送到由寄存器 DI 所指向的存储单元中，然后根据方向标志位 DF 的值增2或减2<blockquote>
<p>DS:SI为源操作数地址，ES:DI为目的操作数地址。字符串传送指令不影响标志位。</p>
</blockquote>
</li>
</ul>
<p>在汇编语言中，两条字符串存储指令的格式可统一写成如下格式：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MOVS OPRD1,OPRD2</span><br></pre></td></tr></table></figure>

<p>案例：修改T6-2.asm</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">;程序名：T6-3.asm</span><br><span class="line">;功能：演示字符串传送指令</span><br><span class="line"></span><br><span class="line">assume ds:data,cs:code</span><br><span class="line"></span><br><span class="line">data segment</span><br><span class="line">char db &#x27;HOW are yoU !&#x27;,0</span><br><span class="line">data ends</span><br><span class="line"></span><br><span class="line">code segment</span><br><span class="line">start:</span><br><span class="line">    mov ax,data</span><br><span class="line">    mov ds,ax</span><br><span class="line">    mov si,1000H</span><br><span class="line">    mov di,2000H</span><br><span class="line">    ;mov cx,100</span><br><span class="line">    mov cx,100/2</span><br><span class="line">    ;</span><br><span class="line">    CLD         ;清除方向标志位</span><br><span class="line">NEXT:</span><br><span class="line">    ;MOVSB</span><br><span class="line">    MOVSW </span><br><span class="line">    loop NEXT</span><br><span class="line">    ;</span><br><span class="line">    mov ax,4c00h</span><br><span class="line">    int 21h</span><br><span class="line">code ends</span><br><span class="line">    end start</span><br></pre></td></tr></table></figure>

<h3 id="字符串扫描指令-Scan-String"><a href="#字符串扫描指令-Scan-String" class="headerlink" title="字符串扫描指令(Scan String)"></a>字符串扫描指令(Scan String)</h3><p>字符串扫描指令如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SCASB   ;串字节扫描</span><br><span class="line">SCASW   ;串字扫描</span><br></pre></td></tr></table></figure>

<ul>
<li>SCASB 把 AL 的内容与由 DI 所指向的一个字节数据采用相减的方式比较，相减结果反映到有关标志位（AF,CF,OF,PF,SF和ZF），但不影响两个操作数，然后根据方向标志位 DF 的值增1或减1。</li>
<li>SCASW 把 AX 的内容与由 DI 所指向的一个字节数据采用相减的方式比较，相减结果反映到有关标志位（AF,CF,OF,PF,SF和ZF），但不影响两个操作数，然后根据方向标志位 DF 的值增2或减2。</li>
</ul>
<p>案例：判断字符串中的字符是否有特殊字符’#’</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">;程序名：T6-4.asm</span><br><span class="line">;功能：判断字符串中的字符是否有特殊字符&#x27;#&#x27;</span><br><span class="line"></span><br><span class="line">assume ds:data,cs:code</span><br><span class="line"></span><br><span class="line">data segment</span><br><span class="line">char db &#x27;012345#ABCD&#x27;,0</span><br><span class="line">char_len = $ - char</span><br><span class="line">mess db &quot;NOT FOUND CHAR #&quot;,&#x27;$&#x27;</span><br><span class="line">mess1 db &quot;FOUND CHAR #&quot;,&#x27;$&#x27;</span><br><span class="line">data ends</span><br><span class="line"></span><br><span class="line">code segment</span><br><span class="line">start:</span><br><span class="line">    mov ax,data</span><br><span class="line">    mov ds,ax</span><br><span class="line">    mov es,ax</span><br><span class="line">    xor di,di</span><br><span class="line">    mov cx,char_len</span><br><span class="line">    mov al,&#x27;#&#x27;</span><br><span class="line">    ;</span><br><span class="line">    CLD         ;清除方向标志位</span><br><span class="line">NEXT:</span><br><span class="line">    SCASB</span><br><span class="line">    loopnz NEXT</span><br><span class="line">    jnz NOT_FOUND</span><br><span class="line">    lea dx,mess1</span><br><span class="line">    mov ah,9</span><br><span class="line">    int 21h</span><br><span class="line">    jmp stop</span><br><span class="line">NOT_FOUND:</span><br><span class="line">    lea dx,mess</span><br><span class="line">    mov ah,9</span><br><span class="line">    int 21h</span><br><span class="line">stop:</span><br><span class="line">    mov ax,4c00h</span><br><span class="line">    int 21h</span><br><span class="line">code ends</span><br><span class="line">    end start</span><br></pre></td></tr></table></figure>

<p>在汇编语言中，两条字符串扫描指令的格式可统一写成如下格式：<br><code>SCAS OPRD</code></p>
<h3 id="字符串比较指令"><a href="#字符串比较指令" class="headerlink" title="字符串比较指令"></a>字符串比较指令</h3><p>字符串比较指令格式如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CMPSB   ;串字节比较</span><br><span class="line">CMPSW   ;串字比较</span><br></pre></td></tr></table></figure>

<ul>
<li><p>CMPSB 把 SI 所指向的一个字节数据与 DI 所指向的一个字节数据采用相减方式比较，相减结果反映到各相关标志位（AF、CF、OF、PF、SF、ZF），但不影响两个操作数，然后根据方向标志位 DF 的值增1或减1。</p>
</li>
<li><p>CMPSW 把 SI 所指向的一个字数据与 DI 所指向的一个字数据采用相减方式比较，相减结果反映到各相关标志位（AF、CF、OF、PF、SF、ZF），但不影响两个操作数，然后根据方向标志位 DF 的值增2或减2。</p>
</li>
</ul>
<p>在汇编语言中，两条字符串比较指令的格式可统一写成如下格式：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CMPS OPRD1,OPRD2</span><br></pre></td></tr></table></figure>

<h2 id="重复前缀"><a href="#重复前缀" class="headerlink" title="重复前缀"></a>重复前缀</h2><p>由于串操作指令每次只能对字符串中的一个字符进行处理，所以使用了一个循环，以便完成对整个字符串的处理。为了进一步提高效率，8086&#x2F;8088还提供了重复指令前缀。重复前缀 可加在串操作指令之前，达到重复执行其后的串操作指令的目的。</p>
<h3 id="重复前缀-REP"><a href="#重复前缀-REP" class="headerlink" title="重复前缀 REP"></a>重复前缀 REP</h3><p>REP 作为一个串操作指令的前缀，它重复其后的串操作指令动作。每次重复都会先判断CX是否为0，如为0就结束重复，否则CX的值减1</p>
<blockquote>
<p>在重复过程中的 CX减1操作，不影响各标志位。<br>重复前缀 REP 主要用在串传送指令 MOVS 和串存储指令 STOS 之前。值得指出的是，一般不在 LODSB 或 LODSW 指令之前使用任何重复前缀。</p>
</blockquote>
<p>案例：设计一个子程序，用指定字符填充缓冲区。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">;程序名：T6-5.asm</span><br><span class="line">;功能：设计一个子程序，用指定字符填充缓冲区。</span><br><span class="line"></span><br><span class="line">assume ds:data,cs:code</span><br><span class="line"></span><br><span class="line">data segment</span><br><span class="line">buffer db 0,0,0,0,0</span><br><span class="line">buffer_len = $ - buffer</span><br><span class="line">data ends</span><br><span class="line"></span><br><span class="line">code segment</span><br><span class="line">start:</span><br><span class="line">    mov ax,data</span><br><span class="line">    mov ds,ax</span><br><span class="line">    mov es,ax</span><br><span class="line">    xor di,di</span><br><span class="line">    ;</span><br><span class="line">    mov cx,buffer_len</span><br><span class="line">    mov al,0CCh</span><br><span class="line">    call FILLB</span><br><span class="line">stop:</span><br><span class="line">    mov ax,4c00h</span><br><span class="line">    int 21h</span><br><span class="line"></span><br><span class="line">;-------------------------------------------------</span><br><span class="line">FILLB  PROC</span><br><span class="line">;子程序名：FILLB</span><br><span class="line">;功能：用指定字符填充缓冲区</span><br><span class="line">;入口参数：ES:DI=缓冲区首地址</span><br><span class="line">;          CX=缓冲区长度，AL=填充字符</span><br><span class="line">;出口参数：无</span><br><span class="line">    push ax</span><br><span class="line">    cld</span><br><span class="line">    shr cx,1</span><br><span class="line">    mov ah,al   ;mov 不影响标志位</span><br><span class="line">    rep stosw   ;stosw 不影响标志位</span><br><span class="line">    jnc FILLB1</span><br><span class="line">    stosb       ;有溢出，再传送1个字节</span><br><span class="line">FILLB1:</span><br><span class="line">    pop ax</span><br><span class="line">    ret</span><br><span class="line">FILLB ENDP</span><br><span class="line">code ends</span><br><span class="line">    end start</span><br></pre></td></tr></table></figure>

<h3 id="重复前缀-REPZ-x2F-REPE"><a href="#重复前缀-REPZ-x2F-REPE" class="headerlink" title="重复前缀 REPZ&#x2F;REPE"></a>重复前缀 REPZ&#x2F;REPE</h3><p>REPZ 与 REPE 是一个前缀的两个助记符。<br>REPZ 用作为一个串操作指令的前缀，它重复其后的串操作指令动作。每重复一次，CX的值减1，直到 cx&#x3D;0 或 ZF&#x3D;0 时止。</p>
<blockquote>
<p>再重复过程中的 CX 值减 1 操作，不影响标志。</p>
</blockquote>
<p>重复前缀 REPZ 主要用在字符串比较指令 CMPS 和 字符串扫描指令 SCAS 之前。由于传送指令 MOVS 和串存储指令 STOS 都不影响标志位，所以在这些操作指令前使用 REP 和前缀 REPZ 的效果一样。</p>
<p>案例：设计一个子程序，使用 REPZ 与 CMPSB 配合，比较两个字符串是否相同。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">;程序名：T6-6.asm</span><br><span class="line">;功能：设计一个子程序，使用 REPZ 与 CMPSB 配合，比较两个字符串是否相同。</span><br><span class="line"></span><br><span class="line">assume ds:data,cs:code</span><br><span class="line"></span><br><span class="line">data segment</span><br><span class="line">string db &#x27;hello&#x27;,0</span><br><span class="line">string1 db &#x27;hello&#x27;,0</span><br><span class="line"></span><br><span class="line">mess db &#x27;Two strings are the same&#x27;,&#x27;$&#x27;</span><br><span class="line">data ends</span><br><span class="line"></span><br><span class="line">code segment</span><br><span class="line">start:</span><br><span class="line">    mov ax,data</span><br><span class="line">    mov ds,ax</span><br><span class="line">    mov es,ax</span><br><span class="line">    ;</span><br><span class="line">    lea si,string</span><br><span class="line">    lea di,string1</span><br><span class="line">    call STRCMP</span><br><span class="line">    cmp ax,0</span><br><span class="line">    jnz stop</span><br><span class="line">    mov ah,9</span><br><span class="line">    lea dx,mess</span><br><span class="line">    int 21h</span><br><span class="line">stop:</span><br><span class="line">    mov ax,4c00h</span><br><span class="line">    int 21h</span><br><span class="line"></span><br><span class="line">;-------------------------------------------------</span><br><span class="line">STRCMP  PROC</span><br><span class="line">;子程序名：STRCMP</span><br><span class="line">;功能：比较两个字符串是否相同</span><br><span class="line">;入口参数：DS:SI=字符串1首地址</span><br><span class="line">;          ES:DI=字符串2首地址</span><br><span class="line">;出口参数：AX=0（两个字符串相同）</span><br><span class="line">    push di</span><br><span class="line">    cld             ;DF位置0</span><br><span class="line">    xor al,al</span><br><span class="line">    mov cx,0ffffh</span><br><span class="line">NEXT:</span><br><span class="line">    SCASB           ;0是字符串结束标志位，指针会多减1</span><br><span class="line">    loopnz NEXT</span><br><span class="line">    inc cx</span><br><span class="line">    not cx          ;计算字符串（ES:DI）的长度</span><br><span class="line">    ;</span><br><span class="line">    pop di          ;重置di</span><br><span class="line">    REPZ CMPSB</span><br><span class="line">    ;比较两个字符串的结束标志</span><br><span class="line">    mov al,[si]</span><br><span class="line">    mov bl,es:[di]</span><br><span class="line">    xor ah,ah</span><br><span class="line">    mov bh,ah</span><br><span class="line">    sub ax,bx</span><br><span class="line">    ret</span><br><span class="line">STRCMP ENDP</span><br><span class="line">code ends</span><br><span class="line">    end start</span><br></pre></td></tr></table></figure>

<h3 id="重复前缀-REPNZ-x2F-REPNE"><a href="#重复前缀-REPNZ-x2F-REPNE" class="headerlink" title="重复前缀 REPNZ&#x2F;REPNE"></a>重复前缀 REPNZ&#x2F;REPNE</h3><p>REPNZ 与 REPNE 是一个前缀的两个助记符。<br>REPNZ 用作为一个串操作指令的前缀。与REPZ类似，直到 CX&#x3D;0 或 ZF&#x3D;1 时止。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">;程序名：T6-7.asm</span><br><span class="line">;功能：设计一个子程序，使用 REPNZ 与 CMPSB 配合，比较两个字符串是否相同。</span><br><span class="line"></span><br><span class="line">assume ds:data,cs:code</span><br><span class="line"></span><br><span class="line">data segment</span><br><span class="line">string db &#x27;hello&#x27;,&#x27;$&#x27;</span><br><span class="line">string1 db &#x27;hello&#x27;,0</span><br><span class="line"></span><br><span class="line">mess db &#x27;Two strings are the same&#x27;,&#x27;$&#x27;</span><br><span class="line">data ends</span><br><span class="line"></span><br><span class="line">code segment</span><br><span class="line">start:</span><br><span class="line">    mov ax,data</span><br><span class="line">    mov ds,ax</span><br><span class="line">    mov es,ax</span><br><span class="line">    ;</span><br><span class="line">    lea si,string</span><br><span class="line">    lea di,string1</span><br><span class="line">    call STRCMP</span><br><span class="line">    cmp ax,0</span><br><span class="line">    jnz stop</span><br><span class="line">    mov ah,9</span><br><span class="line">    lea dx,mess</span><br><span class="line">    int 21h</span><br><span class="line">stop:</span><br><span class="line">    mov ax,4c00h</span><br><span class="line">    int 21h</span><br><span class="line"></span><br><span class="line">;-------------------------------------------------</span><br><span class="line">STRCMP  PROC</span><br><span class="line">;子程序名：STRCMP</span><br><span class="line">;功能：比较两个字符串是否相同</span><br><span class="line">;入口参数：DS:SI=字符串1首地址</span><br><span class="line">;          ES:DI=字符串2首地址</span><br><span class="line">;出口参数：AX=0（两个字符串相同）</span><br><span class="line">    push di</span><br><span class="line">    cld             ;DF位置0</span><br><span class="line">    xor al,al</span><br><span class="line">    mov cx,0ffffh</span><br><span class="line">    ;</span><br><span class="line">    REPNZ SCASB     ;0是字符串结束标志位，指针会多减1</span><br><span class="line">    not cx          ;计算字符串（ES:DI）的长度,cx多加1</span><br><span class="line">    ;</span><br><span class="line">    pop di          ;重置di</span><br><span class="line">    REPZ CMPSB      ;正好比较完字符串所有值，包括结束字符</span><br><span class="line">    ret</span><br><span class="line">STRCMP ENDP</span><br><span class="line">code ends</span><br><span class="line">    end start</span><br></pre></td></tr></table></figure>

<h3 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h3><p>重复字符串处理操作过程可被中断。CPU在处理字符串的下一个字符之前识别中断。如果发生中断，那么在中断处理返回以后，重读过程再从中断点继续执行下去。但应注意，如指令前还有其他前缀的话，中断返回时其他的前缀就不再生效。因为 CPU 在中断时，只能 “记住” 一个前缀，即字符串操作指令前的重复前缀。如字符操作指令必须使用一个以上的前缀，则可在之前禁止中断。</p>
<h2 id="字符串操作指令-1"><a href="#字符串操作指令-1" class="headerlink" title="字符串操作指令"></a>字符串操作指令</h2><p>例1：写一个判别字符是否在字符串中出现的子程序。设字符串以 0 结尾。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">;程序名：T6-8.asm</span><br><span class="line">;功能：写一个判别字符是否在字符串中出现的子程序。设字符串以 0 结尾。</span><br><span class="line">assume ds:data,cs:code</span><br><span class="line"></span><br><span class="line">data segment</span><br><span class="line">char db &#x27;l&#x27;</span><br><span class="line">string1 db &#x27;hello&#x27;,0</span><br><span class="line"></span><br><span class="line">mess db &#x27;The string contains characters: &#x27;,&#x27;$&#x27;</span><br><span class="line">data ends</span><br><span class="line"></span><br><span class="line">code segment</span><br><span class="line">start:</span><br><span class="line">    mov ax,data</span><br><span class="line">    mov ds,ax</span><br><span class="line">    ;</span><br><span class="line">    mov al,char</span><br><span class="line">    lea si,string1</span><br><span class="line">    call STRCHR</span><br><span class="line">    jc stop</span><br><span class="line">    mov ah,9</span><br><span class="line">    lea dx,mess</span><br><span class="line">    int 21h</span><br><span class="line">    mov dl,char</span><br><span class="line">    mov ah,2</span><br><span class="line">    int 21h</span><br><span class="line">stop:</span><br><span class="line">    mov ax,4c00h</span><br><span class="line">    int 21h</span><br><span class="line"></span><br><span class="line">;-------------------------------------------------</span><br><span class="line">STRCHR  PROC</span><br><span class="line">;子程序名：STRCHR</span><br><span class="line">;功能：判别字符是否在字符串中出现</span><br><span class="line">;入口参数：AL=字符</span><br><span class="line">;          ES:SI=字符串首地址</span><br><span class="line">;出口参数：CF=0 表示字符在字符串中，AX=字符首地址出现处的偏移</span><br><span class="line">;          CF=1 表示字符不在字符串中 </span><br><span class="line">    push bx</span><br><span class="line">    push si</span><br><span class="line">    cld             ;DF位置0</span><br><span class="line">    mov bl,al</span><br><span class="line">    test si,1</span><br><span class="line">    jz STRCHAR1</span><br><span class="line">    LODSB</span><br><span class="line">    cmp al,bl</span><br><span class="line">    jz STRCHAR3</span><br><span class="line">    and al,al</span><br><span class="line">    jz STRCHAR2</span><br><span class="line">    ;</span><br><span class="line">STRCHAR1:</span><br><span class="line">    LODSW</span><br><span class="line">    cmp al,bl</span><br><span class="line">    jz STRCHAR4</span><br><span class="line">    and al,al</span><br><span class="line">    jz STRCHAR2</span><br><span class="line">    cmp ah,bl</span><br><span class="line">    jz STRCHAR3</span><br><span class="line">    and ah,ah</span><br><span class="line">    jnz STRCHAR1</span><br><span class="line">STRCHAR2:</span><br><span class="line">    stc</span><br><span class="line">    jmp SHORT STRCHAR5</span><br><span class="line">STRCHAR3:</span><br><span class="line">    inc SI</span><br><span class="line">STRCHAR4:</span><br><span class="line">    lea ax,[si-2]</span><br><span class="line">STRCHAR5:</span><br><span class="line">    pop si</span><br><span class="line">    pop bx</span><br><span class="line">    ret</span><br><span class="line">STRCHR ENDP</span><br><span class="line">code ends</span><br><span class="line">    end start</span><br></pre></td></tr></table></figure>

<p>例2：写一个在字符串1后追加字符串2的子程序。设字符串均以0结尾。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">;程序名：T6-9.asm</span><br><span class="line">;功能：写一个在字符串1后追加字符串2的子程序。设字符串均以0结尾。</span><br><span class="line">assume ds:data,cs:code</span><br><span class="line"></span><br><span class="line">data segment</span><br><span class="line">string1 db &#x27;hello &#x27;,0</span><br><span class="line">string2 db &#x27;word!&#x27;,0</span><br><span class="line">data ends</span><br><span class="line"></span><br><span class="line">code segment</span><br><span class="line">start:</span><br><span class="line">    mov ax,data</span><br><span class="line">    mov ds,ax</span><br><span class="line">    mov es,ax</span><br><span class="line">    ;</span><br><span class="line">    lea si,string1</span><br><span class="line">    lea di,string2</span><br><span class="line">    call STRCAT</span><br><span class="line">    jc stop</span><br><span class="line">    mov ah,9</span><br><span class="line">    lea dx,string1</span><br><span class="line">    int 21h</span><br><span class="line">stop:</span><br><span class="line">    mov ax,4c00h</span><br><span class="line">    int 21h</span><br><span class="line"></span><br><span class="line">;-------------------------------------------------</span><br><span class="line">STRCAT  PROC</span><br><span class="line">;子程序名：STRCAT</span><br><span class="line">;功能：在字符串1末追加字符串2</span><br><span class="line">;入口参数：DS:SI=字符串1起始地址的段值：偏移</span><br><span class="line">;          ES:DI=字符串2起始地址的段值：偏移</span><br><span class="line">;出口参数：无</span><br><span class="line">    pushf</span><br><span class="line">    push bx</span><br><span class="line">    push dx</span><br><span class="line">    push si</span><br><span class="line">    push di</span><br><span class="line">    push es</span><br><span class="line">    push ds</span><br><span class="line">    ;</span><br><span class="line">    cld             ;DF位置0</span><br><span class="line">    ;保存字符串2的偏移</span><br><span class="line">    push di</span><br><span class="line">    ;计算字符串2的长度</span><br><span class="line">    mov cx,0ffffh</span><br><span class="line">    xor al,al</span><br><span class="line">    REPNZ SCASB</span><br><span class="line">    not cx</span><br><span class="line">    ;恢复di，并调换 DS:SI 和 ES:DI</span><br><span class="line">    pop di</span><br><span class="line">    xchg si,di</span><br><span class="line">    mov bx,ds</span><br><span class="line">    mov dx,es</span><br><span class="line">    mov es,bx</span><br><span class="line">    mov ds,dx</span><br><span class="line">    ;调整字符串1的偏移</span><br><span class="line">    push cx</span><br><span class="line">    mov cx,0ffffh</span><br><span class="line">    REPNZ SCASB</span><br><span class="line">    dec di</span><br><span class="line">    ;恢复原字符串2的长度</span><br><span class="line">    pop cx</span><br><span class="line">    ;判断使用 movsb 还是 movsw</span><br><span class="line">    shr cx,1</span><br><span class="line">    jnc STRCAT1</span><br><span class="line">    movsb</span><br><span class="line">STRCAT1:</span><br><span class="line">    rep movsw</span><br><span class="line">    ;为方便输出字符串</span><br><span class="line">    mov byte ptr es:[di-1],&#x27;$&#x27;</span><br><span class="line">    pop ds</span><br><span class="line">    pop es</span><br><span class="line">    pop di</span><br><span class="line">    pop si</span><br><span class="line">    pop dx</span><br><span class="line">    pop bx</span><br><span class="line">    popf</span><br><span class="line">    ret</span><br><span class="line">STRCAT ENDP</span><br><span class="line">code ends</span><br><span class="line">    end start</span><br></pre></td></tr></table></figure>
<blockquote>
<p>书中用 “PUSH DS；POP ES” 来使得DS&#x3D;ES，而我写的例子使用 mov 指令来调换 DS 和 ES 的值。</p>
</blockquote>
<p>例3：写一个程序，它先接收一个字符串，然后抽去其中的空格，最后按相反的顺序显示它。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br></pre></td><td class="code"><pre><span class="line">;程序名：T6-10.asm</span><br><span class="line">;功能：写一个程序，它先接收一个字符串，然后抽去其中的空格，最后按相反的顺序显示它。</span><br><span class="line">assume ds:data,cs:code</span><br><span class="line"></span><br><span class="line">data segment</span><br><span class="line">buffer db 128 dup(0)</span><br><span class="line">data ends</span><br><span class="line"></span><br><span class="line">code segment</span><br><span class="line">start:</span><br><span class="line">    mov ax,data</span><br><span class="line">    mov ds,ax</span><br><span class="line">    mov es,ax</span><br><span class="line">    ;</span><br><span class="line">    lea di,buffer</span><br><span class="line">    call STRINV</span><br><span class="line">stop:</span><br><span class="line">    mov ax,4c00h</span><br><span class="line">    int 21h</span><br><span class="line"></span><br><span class="line">;-------------------------------------------------</span><br><span class="line">STRINV  PROC</span><br><span class="line">;子程序名：STRINV</span><br><span class="line">;功能：它先接收一个字符串，然后抽去其中的空格，最后按相反的顺序显示它。</span><br><span class="line">;入口参数：ES:DI=字符串2起始地址的段值：偏移</span><br><span class="line">;          </span><br><span class="line">;出口参数：无</span><br><span class="line">    pushf</span><br><span class="line">    push bx</span><br><span class="line">    push dx</span><br><span class="line">    push si</span><br><span class="line">    push di</span><br><span class="line">    push es</span><br><span class="line">    push ds</span><br><span class="line">    ;让 DS:SI 和 ES:DI 都指向缓冲区 BUFFER</span><br><span class="line">    push ds</span><br><span class="line">    pop es</span><br><span class="line">    ;接收字符串</span><br><span class="line">    mov dx,di</span><br><span class="line">    call INPUT</span><br><span class="line">    push di</span><br><span class="line">    ;计算字符串长度</span><br><span class="line">    xor al,al</span><br><span class="line">    mov cx,0ffffh</span><br><span class="line">    REPNZ SCASB</span><br><span class="line">    not cx</span><br><span class="line">    ;还原di的值</span><br><span class="line">    pop di</span><br><span class="line">STRINV1:</span><br><span class="line">    ;删除空格</span><br><span class="line">    call DELSP</span><br><span class="line">    call NEWLINE</span><br><span class="line">    ;反向输出</span><br><span class="line">    mov cx,ax</span><br><span class="line">    ;定位字符串末尾的偏移</span><br><span class="line">    add di,ax</span><br><span class="line">    lea si,[di-1]</span><br><span class="line">    std</span><br><span class="line">STRINV2:</span><br><span class="line">    LODSB</span><br><span class="line">    mov dl,al</span><br><span class="line">    mov ah,2</span><br><span class="line">    int 21h</span><br><span class="line">    loop STRINV2</span><br><span class="line">    ;</span><br><span class="line">    pop ds</span><br><span class="line">    pop es</span><br><span class="line">    pop di</span><br><span class="line">    pop si</span><br><span class="line">    pop dx</span><br><span class="line">    pop bx</span><br><span class="line">    popf</span><br><span class="line">    ret</span><br><span class="line">STRINV ENDP</span><br><span class="line"></span><br><span class="line">;--------------------------------------------------------</span><br><span class="line">INPUT PROC</span><br><span class="line">; 功能：接收输入，并存储到 128 字节大小的 buffer 缓冲区中</span><br><span class="line">; 入口参数：dx=buffer缓冲区首地址</span><br><span class="line">; 出口参数：dx=buffer缓冲区首地址</span><br><span class="line">; 说    明：通过显示回车符形成回车，通过显示换行符形成换行</span><br><span class="line">;---------------------------------------------------------</span><br><span class="line">    pushf</span><br><span class="line">    push ax</span><br><span class="line">    push dx</span><br><span class="line">    push bx</span><br><span class="line">    mov bx,dx</span><br><span class="line">INPUT1:</span><br><span class="line">    mov ah,1</span><br><span class="line">    int 21h</span><br><span class="line">    cmp al,0dh</span><br><span class="line">    jz INPUT2</span><br><span class="line">    mov [bx],al</span><br><span class="line">    inc bx</span><br><span class="line">    jmp INPUT1</span><br><span class="line">INPUT2:</span><br><span class="line">    pop bx</span><br><span class="line">    pop dx</span><br><span class="line">    pop ax</span><br><span class="line">    popf</span><br><span class="line">    ;</span><br><span class="line">    ret</span><br><span class="line">INPUT endp</span><br><span class="line">;-------------------------------------</span><br><span class="line">;功能：删除字符串中的空格符</span><br><span class="line">;入口参数：DS:SI=ES:DI=字符串缓冲区首地址</span><br><span class="line">;出口参数：AX=字符串去除空格后的长度</span><br><span class="line">DELSP PROC</span><br><span class="line">    pushf</span><br><span class="line">    push bx</span><br><span class="line">    push dx</span><br><span class="line">    push si</span><br><span class="line">    push di</span><br><span class="line">    push cx</span><br><span class="line"></span><br><span class="line">    cld             ;DF位置0</span><br><span class="line">    ;dx保存字符串真实长度</span><br><span class="line">    mov dx,cx</span><br><span class="line">    mov al,20h</span><br><span class="line">    jmp DELSP2</span><br><span class="line">DELSP1:</span><br><span class="line">    pop di</span><br><span class="line">    pop cx</span><br><span class="line">    ;</span><br><span class="line">DELSP2:</span><br><span class="line">    REPNZ SCASB</span><br><span class="line">    ;计数器，每出现一个空格dx减1</span><br><span class="line">    dec dx</span><br><span class="line">    ;bl判断有没有处理完字符串,bl为0，说明字符串已经处理结束</span><br><span class="line">    mov bl,[di]</span><br><span class="line">    cmp bl,0</span><br><span class="line">    jz DELSP3</span><br><span class="line">    ;保存 cx 和 di 的值</span><br><span class="line">    push cx</span><br><span class="line">    push di</span><br><span class="line">    ;移动字符串DI、SI、CX的值都会改变</span><br><span class="line">    mov si,di</span><br><span class="line">    dec di</span><br><span class="line">    REPZ MOVSB</span><br><span class="line">    jmp DELSP1</span><br><span class="line">DELSP3:</span><br><span class="line">    ;返回值</span><br><span class="line">    mov ax,dx</span><br><span class="line">    ;</span><br><span class="line">    pop cx</span><br><span class="line">    pop di</span><br><span class="line">    pop si</span><br><span class="line">    pop dx</span><br><span class="line">    pop bx</span><br><span class="line">    popf</span><br><span class="line">    ret</span><br><span class="line">DELSP ENDP</span><br><span class="line"></span><br><span class="line">;--------------------------------------------------------</span><br><span class="line">NEWLINE PROC</span><br><span class="line">; 功能：形成回车和换行（光标移到写一行首）</span><br><span class="line">; 入口参数：无</span><br><span class="line">; 出口参数：无</span><br><span class="line">; 说    明：通过显示回车符形成回车，通过显示换行符形成换行</span><br><span class="line">;---------------------------------------------------------</span><br><span class="line">    push ax</span><br><span class="line">    push dx</span><br><span class="line">    mov dl,0dh</span><br><span class="line">    mov ah,2</span><br><span class="line">    int 21h</span><br><span class="line">    mov dl,0ah</span><br><span class="line">    mov ah,2</span><br><span class="line">    int 21h</span><br><span class="line">    pop dx</span><br><span class="line">    pop ax</span><br><span class="line">    ret</span><br><span class="line">NEWLINE endp</span><br><span class="line">code ends</span><br><span class="line">    end start</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">;程序名：T6-10-1.asm</span><br><span class="line">;功能：接收一个字符串，去掉其中的空格后，最后按相反的顺序显示它。</span><br><span class="line">;注：书中代码有些问题，CX=字符串长度+1</span><br><span class="line">assume ds:data,cs:code</span><br><span class="line"></span><br><span class="line">MAXLEN = 64</span><br><span class="line">SPACE = &#x27; &#x27;</span><br><span class="line">CR = 0DH</span><br><span class="line">LF = 0AH</span><br><span class="line"></span><br><span class="line">data segment</span><br><span class="line">buffer DB MAXLEN+1,0,MAXLEN+1 DUP(0)</span><br><span class="line">STRING DB MAXLEN+3 DUP(0)</span><br><span class="line">data ends</span><br><span class="line"></span><br><span class="line">code segment</span><br><span class="line">start:</span><br><span class="line">    mov ax,data</span><br><span class="line">    mov ds,ax</span><br><span class="line">    mov es,ax</span><br><span class="line">    ;</span><br><span class="line">    MOV DX,OFFSET BUFFER</span><br><span class="line">    MOV AH,10</span><br><span class="line">    INT 21h             ;0AH号功能：DS:DX=缓冲区最大字符数；DS:DX+1=实际输入的字符数</span><br><span class="line">    XOR CH,CH</span><br><span class="line">    MOV CL,BUFFER+1     ;CX=字符串长度</span><br><span class="line">    INC CL              ;循环次数=字符串长度+1</span><br><span class="line">    JCXZ OK</span><br><span class="line">    ;</span><br><span class="line">    CLD</span><br><span class="line">    MOV SI,OFFSET BUFFER+2  ;输入字符串偏移</span><br><span class="line">    MOV DI,OFFSET STRING    ;目的字符串</span><br><span class="line">    XOR AL,AL</span><br><span class="line">    STOSB                   ;改变 DI 的偏移</span><br><span class="line">    MOV AL,SPACE</span><br><span class="line">PP1:</span><br><span class="line">    XCHG SI,DI              ;调换 SI 和 DI 的偏移</span><br><span class="line">    REPZ SCASB              ;比较字符串是否有空格，每比较一个字符 DI+1</span><br><span class="line">    XCHG SI,DI              ;还原 DI 和 SI</span><br><span class="line">    JCXZ PP3                ;CX=0，比较结束</span><br><span class="line">    DEC SI</span><br><span class="line">    INC CX</span><br><span class="line">PP2:</span><br><span class="line">    CMP BYTE PTR [SI],SPACE     ;删除空格，按顺序把不是空格的字符，放到目的字符串中</span><br><span class="line">    JZ PP1                      ;双循环比较，移动字符</span><br><span class="line">    MOVSB</span><br><span class="line">    LOOP PP2</span><br><span class="line">    ;</span><br><span class="line">PP3:</span><br><span class="line">    MOV AL,CR</span><br><span class="line">    STOSB</span><br><span class="line">    MOV AL,LF</span><br><span class="line">    MOV [DI],AL</span><br><span class="line">    STD</span><br><span class="line">    MOV SI,DI</span><br><span class="line">PP4:</span><br><span class="line">    LODSB</span><br><span class="line">    OR AL,AL</span><br><span class="line">    JZ OK</span><br><span class="line">    MOV DL,AL</span><br><span class="line">    MOV AH,2</span><br><span class="line">    INT 21H</span><br><span class="line">    JMP PP4</span><br><span class="line">    ;</span><br><span class="line">OK:</span><br><span class="line">    MOV AH,4CH</span><br><span class="line">    INT 21H</span><br><span class="line">code ends</span><br><span class="line">    end start</span><br></pre></td></tr></table></figure>

<blockquote>
<p>书中代码有些问题，CX&#x3D;字符串长度+1</p>
</blockquote>
<p>例4：写一个判断字符串2是否为字符串1的子程序。具体要求如下：（1）子程序是一个远过程；（2）指向字符串的指针是远指针（即包括段值）；（3）通过堆栈传递两个分别指向字符串1和字符串2的远指针；（4）由DX:AX返回指向字符串2在字符串1中首次出现的指针，如字符串2不是字符串1的子串，则返回空指针；（5）字符串均以0为结束符。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">;程序名：T6-11.asm</span><br><span class="line">;功能：写一个判断字符串2是否为字符串1的子程序。</span><br><span class="line">assume ds:data,cs:code</span><br><span class="line"></span><br><span class="line">data segment</span><br><span class="line">string1 db &#x27;hello word!&#x27;,0</span><br><span class="line">string2 db &#x27;word&#x27;,0</span><br><span class="line">data ends</span><br><span class="line"></span><br><span class="line">code segment</span><br><span class="line">start:</span><br><span class="line">    mov ax,data</span><br><span class="line">    mov ds,ax</span><br><span class="line">    ;</span><br><span class="line">    ;mov ax,SEG string1</span><br><span class="line">    push ds</span><br><span class="line">    lea si,string1</span><br><span class="line">    push si</span><br><span class="line">    mov ax,SEG string2</span><br><span class="line">    push ax</span><br><span class="line">    lea di,string2</span><br><span class="line">    push di</span><br><span class="line">    call FAR PTR STRSTR</span><br><span class="line">    ;</span><br><span class="line">    MOV AH,4CH</span><br><span class="line">    INT 21H</span><br><span class="line"></span><br><span class="line">;--------------------------------------------</span><br><span class="line">STRSTR PROC FAR</span><br><span class="line">;子程序名：STRSTR</span><br><span class="line">;功能：判断字符串2是否为字符串1的子串</span><br><span class="line">;入口参数：指向字符串的远指针,DS:SI=字符串1地址；ES:DI=字符串2地址</span><br><span class="line">;出口参数：DX:AX返回指向字符串2在字符串1中首次出现的处的指针</span><br><span class="line">;--------------------------------------------</span><br><span class="line">    push bp</span><br><span class="line">    mov bp,sp</span><br><span class="line">    push bx</span><br><span class="line">    push cx</span><br><span class="line">    push di</span><br><span class="line">    push si</span><br><span class="line">    ;</span><br><span class="line">    xor bx,bx</span><br><span class="line">    mov ax,[bp+12]</span><br><span class="line">    mov ds,ax</span><br><span class="line">    mov si,[bp+10]</span><br><span class="line">    mov ax,[bp+8]</span><br><span class="line">    mov es,ax</span><br><span class="line">    mov di,[bp+6]</span><br><span class="line">    ;计算字符串2长度，不包括结束字符</span><br><span class="line">    mov cx,0ffffh</span><br><span class="line">    mov al,0</span><br><span class="line">    repnz scasb</span><br><span class="line">    mov di,[bp+6]   ;还原di</span><br><span class="line">    not cx</span><br><span class="line">    dec cx          ;字符串2的长度</span><br><span class="line">    jmp STRSTR2</span><br><span class="line">    ;</span><br><span class="line">STRSTR1:</span><br><span class="line">    pop cx          ;每次循环还原si</span><br><span class="line">    mov di,[bp+6]   ;每次循环还原di</span><br><span class="line">    mov si,[bp+10]   ;还原si</span><br><span class="line">STRSTR2:</span><br><span class="line">    inc bx</span><br><span class="line">    add si,bx       ;si+1</span><br><span class="line">    push cx</span><br><span class="line">    repnz cmpsb     ;si=7，di=6找到第一个字符</span><br><span class="line">    mov dx,ds       ;</span><br><span class="line">    mov ax,si       ;保存&quot;段值:偏移&quot;，直至循环判断到最后一次</span><br><span class="line">    dec ax          ;指针指向下一个字符的偏移，还原当前偏移</span><br><span class="line">    ;</span><br><span class="line">    repz cmpsb      ;如果后面的字符匹配出错，就继续循环</span><br><span class="line">    jnz STRSTR1     ;找不到相等的字符继续循环</span><br><span class="line">    ;</span><br><span class="line">    jcxz STRSTR4</span><br><span class="line">    xor dx,dx       ;返回空指针</span><br><span class="line">    xor ax,ax</span><br><span class="line">STRSTR4:</span><br><span class="line">    ;</span><br><span class="line">    pop cx          ;把之前的 cx 提取出来，主要用于还原堆栈</span><br><span class="line">    pop si</span><br><span class="line">    pop di</span><br><span class="line">    pop cx</span><br><span class="line">    pop bx</span><br><span class="line">    mov sp,bp</span><br><span class="line">    pop bp</span><br><span class="line">    ret</span><br><span class="line">STRSTR ENDP</span><br><span class="line">code ends</span><br><span class="line">    end start</span><br></pre></td></tr></table></figure>

<h1 id="十进制数算数运算调整指令及应用"><a href="#十进制数算数运算调整指令及应用" class="headerlink" title="十进制数算数运算调整指令及应用"></a>十进制数算数运算调整指令及应用</h1><p>8086&#x2F;8088 的十进制算数运算调整指令所认可的十进制数是以8421BCD码表示的，它分为未组合和组合的两种。组合的BCD码是指一字节含两位 BCD 码；未组合的BCD码是指一字节含一位BCD码，字节的高四位无意义。</p>
<h2 id="组合的BCD码的算数运算调整指令"><a href="#组合的BCD码的算数运算调整指令" class="headerlink" title="组合的BCD码的算数运算调整指令"></a>组合的BCD码的算数运算调整指令</h2><h3 id="组合的BCD码加法调整指令DAA（Decimal-Adjust-for-Addition）"><a href="#组合的BCD码加法调整指令DAA（Decimal-Adjust-for-Addition）" class="headerlink" title="组合的BCD码加法调整指令DAA（Decimal Adjust for Addition）"></a>组合的BCD码加法调整指令DAA（Decimal Adjust for Addition）</h3><p>组合的 BCD 码加法调整指令格式如下：<br><code>DAA</code></p>
<p>这条指令对在 AL 中的和（由两个组合的 BCD 码相加后的结果）进行调整，产生一个组合的 BCD 码。<br>（1）如 AL 中的低 4 位在 A~F 之间，或 A~F 为 1，则 AL&lt;-(AL)+6，且 AF 位置 1<br>（2）如 AL 中的高4位在 A~F 之间，或 CF 为 1，则 AL&lt;-(AL)+60H，且 CF 位置 1<br>该指令影响标志位 AF,CF,PF,SF和ZF，但不影响标志位 OF。</p>
<p>案例：演示 DAA 指令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">;程序名：T6-12.asm</span><br><span class="line">;功能：演示 DAA 指令</span><br><span class="line">assume cs:code</span><br><span class="line"></span><br><span class="line">code segment</span><br><span class="line">start:</span><br><span class="line">    xor ax,ax</span><br><span class="line">    mov al,34h</span><br><span class="line">    add al,47h</span><br><span class="line">    DAA         ;34h+47h=7b，7b+6=81,十进制数 34+47=81</span><br><span class="line">    adc al,87h  ;81h+87h=108h，但是 al只能存储1字节，所以结果是08h</span><br><span class="line">    DAA         ;因为有溢出 CF=1，08h+60h=68h</span><br><span class="line">    adc al,79h  ;AL=E2h</span><br><span class="line">    DAA         ;高4位在 A~F 之间，E2h+60h=42h；低4位+6，42+6=48h</span><br><span class="line">    ;</span><br><span class="line">    mov ax,4c00h</span><br><span class="line">    int 21h</span><br><span class="line">code ends</span><br><span class="line">    end start</span><br></pre></td></tr></table></figure>

<h3 id="组合的-BCD-码减法调整指令-DAS（Decimal-Adjust-for-Subtraction）"><a href="#组合的-BCD-码减法调整指令-DAS（Decimal-Adjust-for-Subtraction）" class="headerlink" title="组合的 BCD 码减法调整指令 DAS（Decimal Adjust for Subtraction）"></a>组合的 BCD 码减法调整指令 DAS（Decimal Adjust for Subtraction）</h3><p>组合的 BCD 码减法调整指令的格式如下：<br><code>DAS</code><br>这条指令对在 AL 中的差（由两个组合 BCD 码相减后的结果）进行调整，产生一个组合的 BCD 码。调整方法如下：<br>（1）如 AL 中的低 4 位在 A~F 之间，或 AF 为 1，则 AL&lt;-(AL)-6，且 AF 位置 1。<br>（2）如 AL 中的高 4 位在 A~F 之间，或 CF 为 1，则 AL&lt;-(AL)-60h，且 CF 位置 1。<br>该指令影响标志 AF,CF,PF,SF和ZF，但不影响标志 OF。</p>
<p>案例：演示 DAS 指令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">;程序名：T6-13.asm</span><br><span class="line">;功能：演示 DAS 指令</span><br><span class="line">assume cs:code</span><br><span class="line"></span><br><span class="line">code segment</span><br><span class="line">start:</span><br><span class="line">    xor ax,ax</span><br><span class="line">    mov al,45h</span><br><span class="line">    sub al,27h      ;AL=1EH,AF=1,CF=0</span><br><span class="line">    DAS             ;因为 AF=1，AL=1EH-6=18H</span><br><span class="line">    sbb al,49h      ;AL=CFH,AF=1,CF=1</span><br><span class="line">    DAS             ;AL=CFH-66H=69H</span><br><span class="line">    ;</span><br><span class="line">    mov ax,4c00h</span><br><span class="line">    int 21h</span><br><span class="line">code ends</span><br><span class="line">    end start</span><br></pre></td></tr></table></figure>

<h3 id="未组合的-BCD-码加法调整指令AAA（ASCII-Adjust-for-Addition）"><a href="#未组合的-BCD-码加法调整指令AAA（ASCII-Adjust-for-Addition）" class="headerlink" title="未组合的 BCD 码加法调整指令AAA（ASCII Adjust for Addition）"></a>未组合的 BCD 码加法调整指令AAA（ASCII Adjust for Addition）</h3><p>未组合的 BCD 码加法调整指令格式如下：<br><code>AAA</code><br>这条指令对在 AL 中的和（由两个未组合的 BCD 码相加后的结果）进行调整，产生一个未组合的 BCD 码。调整方法如下：<br>（1）如 AL 中的低 4 位在 0~9 之间，且 AF为0，则跳到（3）进行处理<br>（2）如 AL 中的低 4 位在 A~F 之间，或AF为1，则 AL&lt;-(AL)+6,AH&lt;-(AH)+1,且 AF 位置1<br>（3）清除 AL 的高 4 位。<br>（4）AF 位的值送 CF 位。<br>该指令影响标志位 AF 和 CF，对其他标志均无定义</p>
<p>案例：演示 AAA 指令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">;程序名：T6-14.asm</span><br><span class="line">;功能：演示 AAA 指令</span><br><span class="line">assume cs:code</span><br><span class="line"></span><br><span class="line">code segment</span><br><span class="line">start:</span><br><span class="line">    xor ax,ax</span><br><span class="line">    mov ax,7</span><br><span class="line">    add al,6    ;AL=0DH</span><br><span class="line">    AAA         ;AL=0DH+6=13H；AL高4位清0 AL=03；AH=1；AF=1，CF=1</span><br><span class="line">    adc al,5    ;AL=09H</span><br><span class="line">    AAA         ;AH=1</span><br><span class="line">    add al,39h  ;AL=42H，AF=1</span><br><span class="line">    AAA         ;AL=48J，AH=2，AL=08H，AF=1，CF=1</span><br><span class="line">    ;</span><br><span class="line">    mov ax,4c00h</span><br><span class="line">    int 21h</span><br><span class="line">code ends</span><br><span class="line">    end start</span><br></pre></td></tr></table></figure>

<h3 id="未组合的-BCD-码减法调整指令AAS（ASCII-Adjust-for-Subtraction）"><a href="#未组合的-BCD-码减法调整指令AAS（ASCII-Adjust-for-Subtraction）" class="headerlink" title="未组合的 BCD 码减法调整指令AAS（ASCII Adjust for Subtraction）"></a>未组合的 BCD 码减法调整指令AAS（ASCII Adjust for Subtraction）</h3><p>未组合的 BCD 码减法调整指令格式如下：<br><code>AAS</code><br>这条指令在对 AL 中的差（由两个未组合的BCD码相减后的结果）进行调整，产生一个未组合的 BCD 码。调整方法如下：<br>（1）如 AL 中的低 4 位在 0~9 之间，且 AF 为 0，则跳转到（3）进行处理；<br>（2）如 AL 中的低 4 位在 A~F 之间，或 AF 为 1，则 AL&lt;-(AL)-6,AH&lt;-(AH)-1，且 AF 位置1；<br>（3）清除 AL 的高 4 位；<br>（4）AF 位送至 CF 位。<br>该指令影响标志位 AF 和 CF，对其他标志均无定义。</p>
<p>案例：演示 AAS 指令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">;程序名：T6-15.asm</span><br><span class="line">;功能：演示 AAS 指令</span><br><span class="line">assume cs:code</span><br><span class="line"></span><br><span class="line">code segment</span><br><span class="line">start:</span><br><span class="line">    xor ax,ax</span><br><span class="line">    mov al,34h</span><br><span class="line">    sub al,09h  ;AL=2BH，AF=1，CF=0</span><br><span class="line">    AAS         ;AL=05,AH=0FFH，AF=1，CF=1</span><br><span class="line">    ;</span><br><span class="line">    mov ax,4c00h</span><br><span class="line">    int 21h</span><br><span class="line">code ends</span><br><span class="line">    end start</span><br></pre></td></tr></table></figure>

<h3 id="未组合的-BCD-乘法调整指令AAM（ASCII-Adjust-for-Multiplication）"><a href="#未组合的-BCD-乘法调整指令AAM（ASCII-Adjust-for-Multiplication）" class="headerlink" title="未组合的 BCD 乘法调整指令AAM（ASCII Adjust for Multiplication）"></a>未组合的 BCD 乘法调整指令AAM（ASCII Adjust for Multiplication）</h3><p>未组合的 BCD 码乘法调整指令的格式如下：<br><code>AAM</code><br>这条指令对在 AL 中的积（由两个组合的 BCD 码相乘的结果）进行调整，产生两个未组合的 BCD 码。调整方法如下：<br>（1）把 AL 中值除以10，商放到 AH 中，余数放到 AL 中。<br>该指令影响标志SF,ZF和PF，对其他标志无影响。</p>
<p>案例：演示 AAM 指令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">;程序名：T6-16.asm</span><br><span class="line">;功能：演示 AAM 指令</span><br><span class="line">assume cs:code</span><br><span class="line"></span><br><span class="line">code segment</span><br><span class="line">start:</span><br><span class="line">    xor ax,ax</span><br><span class="line">    mov al,3</span><br><span class="line">    mov bl,4</span><br><span class="line">    mul bl      ;AL=0CH,AH=0</span><br><span class="line">    AAM         ;AL=2,AH=1</span><br><span class="line">    mov ax,4c00h</span><br><span class="line">    int 21h</span><br><span class="line">code ends</span><br><span class="line">    end start</span><br></pre></td></tr></table></figure>

<h3 id="未组合的-BCD-码除法调整指令AAD（ASCII-Adjust-for-Division）"><a href="#未组合的-BCD-码除法调整指令AAD（ASCII-Adjust-for-Division）" class="headerlink" title="未组合的 BCD 码除法调整指令AAD（ASCII Adjust for Division）"></a>未组合的 BCD 码除法调整指令AAD（ASCII Adjust for Division）</h3><p>未组合的 BCD 码除法调整指令的格式如下：<br><code>AAD</code><br>该指令和其他调整指令的使用次序上不同，其他调整指令均安排在有关算数运算指令后，而这条指令应该安排在除法运算指令之前。它的功能是：把存放在寄存器 AH（高位十进制数）及存放在寄存器 AL 中的两位非组合 BCD 码，调整为一个二进制数，存放在寄存器 AL 中。调整的方法如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">AL&lt;-AH*10+(AL)</span><br><span class="line">AH&lt;-0</span><br></pre></td></tr></table></figure>
<p>改指令影响标志 SF,ZF和PF，对其他标志无影响。</p>
<p>案例：演示 AAD 指令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">;程序名：T6-17.asm</span><br><span class="line">;功能：演示 AAD 指令</span><br><span class="line">assume cs:code</span><br><span class="line"></span><br><span class="line">code segment</span><br><span class="line">start:</span><br><span class="line">    xor ax,ax</span><br><span class="line">    mov ah,4</span><br><span class="line">    mov al,3</span><br><span class="line">    mov bl,8</span><br><span class="line">    AAD         ;AL=4*10+3=43=2BH，AH=0</span><br><span class="line">    div bl      ;AL=5,AH=3</span><br><span class="line">    mov ax,4c00h</span><br><span class="line">    int 21h</span><br><span class="line">code ends</span><br><span class="line">    end start</span><br></pre></td></tr></table></figure>

<h2 id="应用举例"><a href="#应用举例" class="headerlink" title="应用举例"></a>应用举例</h2><p>例1：设在缓冲区 DATA 中存放着12个组合的BCD码，求它们的和，把结果存放到缓冲区 SUM 中。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">;程序名：T6-18.asm</span><br><span class="line">;功能：设在缓冲区 DATA 中存放着12个组合的BCD码，求它们的和，把结果存放到缓冲区 SUM 中。</span><br><span class="line">assume ds:data,cs:code</span><br><span class="line"></span><br><span class="line">data segment</span><br><span class="line">NUM1 DB 23H,45H,67H,89H,32H,93H,36H,12H,66H,78H,43H,99H</span><br><span class="line">RESULT DB 2 DUP(0)</span><br><span class="line">data ends</span><br><span class="line"></span><br><span class="line">code segment</span><br><span class="line">start:</span><br><span class="line">    mov ax,data</span><br><span class="line">    mov ds,ax</span><br><span class="line">    mov bx,offset NUM1</span><br><span class="line">    mov cx,10</span><br><span class="line">    xor ax,ax</span><br><span class="line">next:</span><br><span class="line">    add al,[bx]</span><br><span class="line">    DAA</span><br><span class="line">    ADC ah,0</span><br><span class="line">    xchg  ah,al</span><br><span class="line">    DAA</span><br><span class="line">    xchg ah,al</span><br><span class="line">    inc bx</span><br><span class="line">    loop next</span><br><span class="line">    mov ax,4c00h</span><br><span class="line">    int 21h</span><br><span class="line">code ends</span><br><span class="line">    end start</span><br></pre></td></tr></table></figure>

<p>例2：使用 DAA 指令改写把一位十六进制数转换为对应的 ASCII 码符的子程序 HTOASC。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">;程序名：T6-19.asm</span><br><span class="line">;功能：使用 DAA 指令改写把一位十六进制数转换为对应的 ASCII 码符的子程序 HTOASC。</span><br><span class="line">assume cs:code</span><br><span class="line"></span><br><span class="line">code segment</span><br><span class="line">start:</span><br><span class="line">    mov al,0ch</span><br><span class="line">    call HTOASC</span><br><span class="line">    mov ax,4c00h</span><br><span class="line">    int 21h</span><br><span class="line"></span><br><span class="line">HTOASC PROC</span><br><span class="line">;-------------------------------------------------------</span><br><span class="line">;子程序名：HTOASC</span><br><span class="line">;功能：把一个十六进制数转换为对应的 ASCII</span><br><span class="line">;入口参数：AL 的低4位为要转换的十六进制数</span><br><span class="line">;出口参数：AL含对应的 ASCII 码</span><br><span class="line">;-------------------------------------------------------</span><br><span class="line">and al,0fh</span><br><span class="line">add al,90h      ;主要作用是把al的高4位清零，如：9Ch+6=A2h</span><br><span class="line">DAA             ;AL=60h+A2h=102h,al=02h，此时出现溢出（这两行代码，巧妙的使 al 高 4 位清零，同时又出现溢出）</span><br><span class="line">adc al,40h      ;AL=42h+1=43h</span><br><span class="line">DAA</span><br><span class="line">ret</span><br><span class="line">HTOASC ENDP</span><br><span class="line">code ends</span><br><span class="line">    end start</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">;程序名：T6-19-1.asm</span><br><span class="line">;功能：使用 DAA 指令改写把一位十六进制数转换为对应的 ASCII 码符的子程序 HTOASC。</span><br><span class="line">assume cs:code</span><br><span class="line"></span><br><span class="line">code segment</span><br><span class="line">start:</span><br><span class="line">    mov al,0Dh</span><br><span class="line">    call HTOASC</span><br><span class="line">    mov ax,4c00h</span><br><span class="line">    int 21h</span><br><span class="line"></span><br><span class="line">HTOASC PROC</span><br><span class="line">;-------------------------------------------------------</span><br><span class="line">;子程序名：HTOASC</span><br><span class="line">;功能：把一个十六进制数转换为对应的 ASCII</span><br><span class="line">;入口参数：AL 的低4位为要转换的十六进制数</span><br><span class="line">;出口参数：AL含对应的 ASCII 码</span><br><span class="line">;-------------------------------------------------------</span><br><span class="line">and al,0fh</span><br><span class="line">DAA             </span><br><span class="line">add al,31h</span><br><span class="line">ret</span><br><span class="line">HTOASC ENDP</span><br><span class="line">code ends</span><br><span class="line">    end start</span><br></pre></td></tr></table></figure>
<blockquote>
<p>书中的例子固然巧妙，但在这个例子中，可以人为确认的规律，就没必要多写无关紧要的代码。</p>
</blockquote>
<p>例3：写一个能实现两个十进制数的加法运算处理的程序。设每个十进制数最多10位。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br></pre></td><td class="code"><pre><span class="line">;程序名：T6-20.asm</span><br><span class="line">;功能：写一个能实现两个十进制数的加法运算处理的程序。设每个十进制数最多10位。</span><br><span class="line">assume ds:data,cs:code</span><br><span class="line"></span><br><span class="line">;常数定义</span><br><span class="line">MAXLEN = 10</span><br><span class="line">BUFFLEN = MAXLEN+1</span><br><span class="line"></span><br><span class="line">data segment</span><br><span class="line">BUFF1 DB BUFFLEN,0,BUFFLEN DUP(?)</span><br><span class="line">NUM1 EQU BUFF1+2</span><br><span class="line">BUFF2 DB BUFFLEN,0,BUFFLEN DUP(?)</span><br><span class="line">NUM2 EQU BUFF2+2</span><br><span class="line">RESULT DB BUFFLEN DUP(?),24H</span><br><span class="line">DIGITL DB &#x27;0123456789&#x27;</span><br><span class="line">DIGITLEN EQU $-DIGITL</span><br><span class="line">MESS DB &#x27;Invalid number!&#x27;,0DH,0AH,24H</span><br><span class="line">data ends</span><br><span class="line"></span><br><span class="line">code segment</span><br><span class="line">start:</span><br><span class="line">    MOV AX,data</span><br><span class="line">    MOV DS,AX</span><br><span class="line">    MOV ES,AX               ;置DS和ES</span><br><span class="line">    MOV DX,OFFSET BUFF1</span><br><span class="line">    CALL GETNUM             ;接收被加数</span><br><span class="line">    JC OVER</span><br><span class="line">    MOV DX,OFFSET BUFF2</span><br><span class="line">    CALL GETNUM</span><br><span class="line">    JC OVER</span><br><span class="line">    MOV SI,OFFSET NUM1</span><br><span class="line">    MOV DI,OFFSET NUM2</span><br><span class="line">    MOV BX,OFFSET RESULT</span><br><span class="line">    MOV CX,MAXLEN</span><br><span class="line">    CALL ADDITION</span><br><span class="line">    MOV DX,OFFSET RESULT</span><br><span class="line">    CALL DISPNUM</span><br><span class="line">    JMP SHORT OK</span><br><span class="line">OVER:</span><br><span class="line">    MOV DX,OFFSET MESS</span><br><span class="line">    MOV AH,9</span><br><span class="line">    INT 21h</span><br><span class="line">OK:</span><br><span class="line">    MOV AX,4c00h</span><br><span class="line">    INT 21h</span><br><span class="line">GETNUM PROC</span><br><span class="line">;-------------------------------------------------------</span><br><span class="line">;子程序名：GETNUM</span><br><span class="line">;功能：接收一个十进制数字串，且扩展成10位</span><br><span class="line">;入口参数：DX=缓冲区偏移</span><br><span class="line">;出口参数：CF=0,表示成功；CF=1，表示不成功</span><br><span class="line">;-------------------------------------------------------</span><br><span class="line">    MOV AH,10</span><br><span class="line">    INT 21h       </span><br><span class="line">    CALL NEWLINE</span><br><span class="line">    CALL ISDNUM</span><br><span class="line">    JC GETNUM2</span><br><span class="line">    MOV SI,DX</span><br><span class="line">    INC SI</span><br><span class="line">    MOV CL,[SI]</span><br><span class="line">    XOR CH,CH</span><br><span class="line">    MOV AX,MAXLEN</span><br><span class="line">    STD</span><br><span class="line">    MOV DI,SI</span><br><span class="line">    ADD DI,AX</span><br><span class="line">    ADD SI,CX</span><br><span class="line">    SUB AX,CX</span><br><span class="line">    REP MOVSB</span><br><span class="line">    MOV CX,AX</span><br><span class="line">    JCXZ GETNUM1</span><br><span class="line">    XOR AL,AL</span><br><span class="line">    REP STOSB</span><br><span class="line">GETNUM1:</span><br><span class="line">    CLD</span><br><span class="line">    CLC</span><br><span class="line">GETNUM2:</span><br><span class="line">    RET</span><br><span class="line">GETNUM ENDP</span><br><span class="line"></span><br><span class="line">ADDITION PROC</span><br><span class="line">;-------------------------------------------------------</span><br><span class="line">;子程序名：ADDITION</span><br><span class="line">;功能：多位非组合 bcd 码数相加</span><br><span class="line">;入口参数：SI=代表被加数的非组合 BCD 码串开始地址偏移</span><br><span class="line">;         DI=代表加数的非组合 BCD 码串开始地址偏移</span><br><span class="line">;         CX=BCD码串长度（字节数）</span><br><span class="line">;         BX=存放结果的缓冲区开始地址偏移</span><br><span class="line">;出口参数：结果缓冲区结果</span><br><span class="line">;说    明：在非组合的 BCD 码中，十进制数的高位在低地址</span><br><span class="line">;-------------------------------------------------------</span><br><span class="line">    STD</span><br><span class="line">    ADD BX,CX</span><br><span class="line">    ADD SI,CX</span><br><span class="line">    ADD DI,CX</span><br><span class="line">    DEC SI</span><br><span class="line">    DEC DI</span><br><span class="line">    XCHG DI,BX</span><br><span class="line">    INC BX</span><br><span class="line">    CLC</span><br><span class="line">ADDP1:</span><br><span class="line">    DEC BX</span><br><span class="line">    LODSB</span><br><span class="line">    ADC AL,[BX]</span><br><span class="line">    AAA</span><br><span class="line">    STOSB</span><br><span class="line">    LOOP ADDP1</span><br><span class="line">    MOV AL,0</span><br><span class="line">    ADC AL,0</span><br><span class="line">    STOSB</span><br><span class="line">    CLD</span><br><span class="line">    RET</span><br><span class="line">ADDITION ENDP</span><br><span class="line"></span><br><span class="line">DISPNUM PROC</span><br><span class="line">;-------------------------------------------------------</span><br><span class="line">;子程序名：DISPNUM</span><br><span class="line">;功能：显示结果</span><br><span class="line">;入口参数：DX=结果缓冲区开始地址偏移</span><br><span class="line">;出口参数：无</span><br><span class="line">;-------------------------------------------------------</span><br><span class="line">    ;OR CX,1       ;把标志位 zf 置 0</span><br><span class="line">    MOV DI,DX</span><br><span class="line">    MOV AL,0</span><br><span class="line">    MOV CX,MAXLEN</span><br><span class="line">    REPZ SCASB</span><br><span class="line">    ;计算有效字符长度</span><br><span class="line">    DEC DI</span><br><span class="line">    mov bx,di</span><br><span class="line">    sub bx,dx</span><br><span class="line">    lea cx,[bx-MAXLEN-1]</span><br><span class="line">    not cx</span><br><span class="line">    ;</span><br><span class="line">    MOV DX,DI</span><br><span class="line">    MOV SI,DI</span><br><span class="line">    ;</span><br><span class="line">    INC CX</span><br><span class="line">DISPNU2:</span><br><span class="line">    LODSB</span><br><span class="line">    ADD AL,30H</span><br><span class="line">    STOSB</span><br><span class="line">    LOOP DISPNU2</span><br><span class="line">    MOV AH,9</span><br><span class="line">    INT 21h</span><br><span class="line">    RET</span><br><span class="line">DISPNUM ENDP</span><br><span class="line"></span><br><span class="line">ISDNUM PROC</span><br><span class="line">;-------------------------------------------------------</span><br><span class="line">;子程序名：ISDNUM</span><br><span class="line">;功能：判断一个利用 DOS 的 0AH 号功能调用输入的字符串是否为数字字符串</span><br><span class="line">;入口参数：DX=缓冲区开始地址偏移</span><br><span class="line">;出口参数：CF=0，表示是；CF=1，表示否</span><br><span class="line">;-------------------------------------------------------</span><br><span class="line">    MOV SI,DX</span><br><span class="line">    LODSB</span><br><span class="line">    LODSB</span><br><span class="line">    MOV CL,AL</span><br><span class="line">    XOR CH,CH</span><br><span class="line">    JCXZ ISDNUM2</span><br><span class="line">ISDNUM1:</span><br><span class="line">    LODSB</span><br><span class="line">    CALL ISDECM</span><br><span class="line">    JNZ ISDNUM2</span><br><span class="line">    LOOP ISDNUM1</span><br><span class="line">    RET</span><br><span class="line">ISDNUM2:</span><br><span class="line">    STC</span><br><span class="line">    RET</span><br><span class="line">ISDNUM ENDP</span><br><span class="line"></span><br><span class="line">ISDECM PROC</span><br><span class="line">;-------------------------------------------------------</span><br><span class="line">;子程序名：ISDECM</span><br><span class="line">;功能：判断一个字符是否为十进制字符</span><br><span class="line">;入口参数：AL=字符</span><br><span class="line">;出口参数：ZF=1，表示是；zf=0，表示否</span><br><span class="line">;-------------------------------------------------------</span><br><span class="line">    PUSH CX</span><br><span class="line">    MOV DI,OFFSET DIGITL</span><br><span class="line">    MOV CX,DIGITLEN</span><br><span class="line">    REPNZ SCASB</span><br><span class="line">    POP CX</span><br><span class="line">    RET</span><br><span class="line">ISDECM ENDP</span><br><span class="line"></span><br><span class="line">NEWLINE PROC</span><br><span class="line">;-------------------------------------------------------</span><br><span class="line">;子程序名：NEWLINE</span><br><span class="line">;功能：打印换行</span><br><span class="line">;入口参数：无</span><br><span class="line">;出口参数：无</span><br><span class="line">;-------------------------------------------------------</span><br><span class="line">    push ax</span><br><span class="line">    push dx</span><br><span class="line">    mov dl,0dh</span><br><span class="line">    mov ah,2</span><br><span class="line">    int 21h</span><br><span class="line">    mov dl,0ah</span><br><span class="line">    mov ah,2</span><br><span class="line">    int 21h</span><br><span class="line">    pop dx</span><br><span class="line">    pop ax</span><br><span class="line">    ret</span><br><span class="line">NEWLINE ENDP</span><br><span class="line">code ends</span><br><span class="line">    end start</span><br></pre></td></tr></table></figure>

<blockquote>
<p>书中的例子中 DISPNUM 子程序，并没有计算有效字符长度，导致输出结果少一位。</p>
</blockquote>
<h1 id="DOS-程序段前缀和特殊情况处理程序"><a href="#DOS-程序段前缀和特殊情况处理程序" class="headerlink" title="DOS 程序段前缀和特殊情况处理程序"></a>DOS 程序段前缀和特殊情况处理程序</h1><h2 id="DOS程序段前缀-PSP"><a href="#DOS程序段前缀-PSP" class="headerlink" title="DOS程序段前缀 PSP"></a>DOS程序段前缀 PSP</h2><p>程序段前缀（简称：PSP）是 DOS 加载一个外部命令或应用程序（EXE或COM类型）时，在程序段之前设置一个具有 256 字节的信息区。<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/196043681-bd6e0774-d752-45b8-af21-224da23218fa.png"
                      alt="2"
                ></p>
<blockquote>
<p>DOS 系统刚加载程序，但未开始执行程序时，此时红框中的 256 个字节就是 DOS 程序段前缀。注意：这些数据是属于 DOS 操作系统的，并不属于我们调试的 EXE 程序。</p>
</blockquote>
<p>PSP 含有多个可用信息，其中常用信息的安排如下表：<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/196041545-00024247-9872-4d97-af59-ad97ad52b183.png"
                      alt="1"
                ></p>
<blockquote>
<p>根据上图中的偏移，我们可以在 DOS 程序段前缀找到相应的数据。如：偏移 0 处，的十六进制是 “CD 20”，这里表示的就是指令 “INT 20H”</p>
</blockquote>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/196044208-94f26842-b436-456b-9976-315160023672.png"
                      alt="3"
                ></p>
<blockquote>
<p>如上图所示，这里演示了命令行参数的偏移。</p>
</blockquote>
<p>当 DOS 把控制权转给外部命令或应用程序时，数据段寄存器 DS 和附加段寄存器 ES 均指向其 PSP，即均含有 PSP 的段值，并不指向程序的数据段和附加段。这样应用程序可方便地使用到 PSP 中地有关信息。</p>
<h2 id="终止程序的另一途径"><a href="#终止程序的另一途径" class="headerlink" title="终止程序的另一途径"></a>终止程序的另一途径</h2><p>利用 DOS　的　4CH 号系统功能调用能终止程序，把控制权转交给DOS，这是我们现在常用的方法。但早先常利用 DOS 提供的 20H 号中断处理程序来终止程序。<br>通过 20H 号中断处理程序终止程序有一个条件，即进入 20H 号中断处理程序之前，代码段寄存器 CS 必须含有 PSP 的段值。由于对 EXE 类型的应用程序而言，其代码段与 PSP 不是同一个段，所以不能简单地直接利用指令 “INT  20H”来终止程序。DOS 注意到了这一点，在 PSP 的偏移 0 处，安排了一条 “INT 21H” 来终止程序。 于是，应用程序只要设法转到 PSP 的偏移 0 处，就能实现程序的终止。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">;程序名：T6-21.asm</span><br><span class="line">;功能：另一种终止程序的方式，利用 INT 20H。</span><br><span class="line">assume ds:data,cs:code,ss:stack</span><br><span class="line"></span><br><span class="line">stack segment</span><br><span class="line">    DW 256 DUP(?)</span><br><span class="line">stack ends</span><br><span class="line"></span><br><span class="line">data segment</span><br><span class="line">MESS  db &#x27;HELLO&#x27;,0DH,0AH,&#x27;$&#x27;</span><br><span class="line">data ends</span><br><span class="line"></span><br><span class="line">code segment</span><br><span class="line">MAIN PROC FAR</span><br><span class="line">START:</span><br><span class="line">    PUSH DS     ;把 PSP 的段值压入堆栈</span><br><span class="line">    XOR AX,AX   ;偏移地址置0</span><br><span class="line">    PUSH AX     ;压入偏移地址</span><br><span class="line">    ;</span><br><span class="line">    MOV AX,data</span><br><span class="line">    MOV DS,AX</span><br><span class="line">    MOV DX,OFFSET MESS</span><br><span class="line">    MOV AH,9</span><br><span class="line">    INT 21h</span><br><span class="line">    RET</span><br><span class="line">MAIN ENDP</span><br><span class="line">code ends</span><br><span class="line">    end start</span><br></pre></td></tr></table></figure>

<ol>
<li>在标号 start 开始处的三条指令把 PSP 的段值和偏移地址 0 压入堆栈；</li>
<li>ret 从堆栈中弹出程序开始时压入堆栈的 PSP 段值和偏移 0 到 CS 和 IP 中；</li>
<li>执行位于 PSP 首的指令 “INT 20H”，程序终止。</li>
</ol>
<blockquote>
<p>这里多了一个名为 MAIN 的远过程子程序，这样做的目的是告诉汇编程序，把为了终止程序返回 DOS 而设的 RET 指令汇编成远返回指令。</p>
</blockquote>
<h2 id="应用程序取得命令行参数"><a href="#应用程序取得命令行参数" class="headerlink" title="应用程序取得命令行参数"></a>应用程序取得命令行参数</h2><p>DOS 加载一个外部命令或应用程序时，允许在被加载的程序名之后，输入多达 127 个字符（包括最后的回车符）的参数，并把这些参数送到 PSP 的非格式化参数区，即 PSP 中从偏移 80H 开始的区域。注意，命令行中的重定向符和管道符及有关信息不作为命令行参数送到 PSP。</p>
<p>例1：写一个显示命令行参数的程序</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">;程序名：T6-22.asm</span><br><span class="line">;功能：显示命令行参数。。</span><br><span class="line">assume ds:data,cs:code</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">data segment</span><br><span class="line">parameter  db 127 dup(0)</span><br><span class="line">data ends</span><br><span class="line"></span><br><span class="line">code segment</span><br><span class="line">START:</span><br><span class="line">    mov ax,ds</span><br><span class="line">    mov es,ax</span><br><span class="line">    mov di,81h      ;要打印的参数从 81 开始</span><br><span class="line">    ;</span><br><span class="line">    mov ax,data</span><br><span class="line">    mov ds,ax</span><br><span class="line">    lea si,parameter</span><br><span class="line">    push di</span><br><span class="line">    ;</span><br><span class="line">    mov al,0dh</span><br><span class="line">    mov cx,0ffffh</span><br><span class="line">    repnz scasb</span><br><span class="line">    not cx</span><br><span class="line">    ;</span><br><span class="line">    pop di</span><br><span class="line">    xchg si,di</span><br><span class="line">    mov ax,es</span><br><span class="line">    mov bx,ds</span><br><span class="line">    mov es,bx</span><br><span class="line">    mov ds,ax</span><br><span class="line">    rep movsb</span><br><span class="line">    ;</span><br><span class="line">    mov byte ptr es:[di-1],24h</span><br><span class="line">    MOV AX,data</span><br><span class="line">    MOV DS,AX</span><br><span class="line">    MOV DX,OFFSET parameter</span><br><span class="line">    MOV AH,9</span><br><span class="line">    INT 21h</span><br><span class="line">    ;</span><br><span class="line">    mov ax,4c00h</span><br><span class="line">    int 21h</span><br><span class="line">code ends</span><br><span class="line">    end start</span><br></pre></td></tr></table></figure>

<p>例2：写一个显示文本文件内容的程序。文件名作为命令行参数给出。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line">;程序名：T6-23.asm</span><br><span class="line">;功能：写一个显示文本内容的程序文件名作为命令行参数给出。</span><br><span class="line">assume ds:data,cs:code</span><br><span class="line"></span><br><span class="line">EOF = 1AH</span><br><span class="line"></span><br><span class="line">data segment</span><br><span class="line">filename db 128 dup(0)</span><br><span class="line">handle dw 0</span><br><span class="line">buffer db 128 dup(0)</span><br><span class="line">data ends</span><br><span class="line"></span><br><span class="line">code segment</span><br><span class="line">START:</span><br><span class="line">    mov ax,data</span><br><span class="line">    mov ds,ax</span><br><span class="line">    lea dx,filename</span><br><span class="line">    call MOVPAR</span><br><span class="line">    ;打开文件</span><br><span class="line">    mov ah,3dh</span><br><span class="line">    mov al,0</span><br><span class="line">    int 21h</span><br><span class="line">    jc stop</span><br><span class="line">    mov bx,ax</span><br><span class="line">    mov handle,ax</span><br><span class="line">cont:</span><br><span class="line">    call READCH     ;从文件中读一个字符</span><br><span class="line">    jc stop</span><br><span class="line">    cmp al,EOF</span><br><span class="line">    jz stop</span><br><span class="line">    call putch</span><br><span class="line">    jmp cont</span><br><span class="line">    ;关闭文件</span><br><span class="line">    mov ah,3EH</span><br><span class="line">    int 21h</span><br><span class="line">stop:</span><br><span class="line">    mov ax,4c00h</span><br><span class="line">    int 21h</span><br><span class="line"></span><br><span class="line">;----------------------------------------------</span><br><span class="line">;子程序名：MOVPAR</span><br><span class="line">;功能：传递-f参数到缓冲区</span><br><span class="line">;入口参数：dx=存放“-f”参数的缓冲区</span><br><span class="line">;出口参数：无</span><br><span class="line">;注：该子程序必须要放在代码段最前面</span><br><span class="line">MOVPAR PROC</span><br><span class="line">    pushf</span><br><span class="line">    push ds</span><br><span class="line">    push es</span><br><span class="line">    push ax</span><br><span class="line">    push bx</span><br><span class="line">    push cx</span><br><span class="line">    push dx</span><br><span class="line">    push si</span><br><span class="line">    push di</span><br><span class="line">    ;</span><br><span class="line">    mov di,80h</span><br><span class="line">    mov cx,0ffffh</span><br><span class="line">    mov al,&#x27;-&#x27;</span><br><span class="line">    repnz scasb</span><br><span class="line">    mov ax,&#x27;f-&#x27;</span><br><span class="line">    cmp ax,es:[di-1]</span><br><span class="line">    jnz stop</span><br><span class="line">next:</span><br><span class="line">    inc di</span><br><span class="line">    cmp byte ptr es:[di],20h</span><br><span class="line">    jz next         ;如果第一个字符是空格就剔除掉</span><br><span class="line">    ;</span><br><span class="line">    push di</span><br><span class="line">    mov cx,0ffffh</span><br><span class="line">    mov al,0dh</span><br><span class="line">    repnz scasb</span><br><span class="line">    not cx</span><br><span class="line">    dec cx</span><br><span class="line">    ;</span><br><span class="line">    pop di</span><br><span class="line">    xchg si,di</span><br><span class="line">    push ds</span><br><span class="line">    push es</span><br><span class="line">    pop ds</span><br><span class="line">    pop es</span><br><span class="line">    mov di,dx</span><br><span class="line">    rep movsb</span><br><span class="line">    ;</span><br><span class="line">    pop di</span><br><span class="line">    pop si</span><br><span class="line">    pop dx</span><br><span class="line">    pop cx</span><br><span class="line">    pop bx</span><br><span class="line">    pop ax</span><br><span class="line">    pop es</span><br><span class="line">    pop ds</span><br><span class="line">    popf</span><br><span class="line">    ret</span><br><span class="line">MOVPAR ENDP</span><br><span class="line"></span><br><span class="line">;-----------------------------------------------------</span><br><span class="line">READCH PROC</span><br><span class="line">; 功能：每次从文件中按顺序读一个字符。</span><br><span class="line">; 传参方式：寄存器传参</span><br><span class="line">; 入口参数：AL=十六进制</span><br><span class="line">; 出口参数：AX=高4位，低4位</span><br><span class="line">; 说    明：子程序通过进位标志CF来反映是否正确读到字符，</span><br><span class="line">;如果读时发生错误，则CF置位，否则CF清零。考虑到万一文本</span><br><span class="line">;文件没有文件结束符的情况，所以该子程序还判断是否的却已</span><br><span class="line">;读到文件尾（如果实际读到的字符为0就意味着文件结束），</span><br><span class="line">;当这种情况发生时，就返回一个文件结束符。</span><br><span class="line">;------------------------------------------------------</span><br><span class="line">    mov cx,1</span><br><span class="line">    mov dx,offset buffer</span><br><span class="line">    mov ah,3FH</span><br><span class="line">    int 21h</span><br><span class="line">    jc READCH2</span><br><span class="line">    cmp ax,cx</span><br><span class="line">    mov al,EOF</span><br><span class="line">    jb READCH1</span><br><span class="line">    mov AL,BUFFER</span><br><span class="line">READCH1:</span><br><span class="line">    CLC</span><br><span class="line">READCH2:</span><br><span class="line">    ret</span><br><span class="line">READCH endp</span><br><span class="line"></span><br><span class="line">;-----------------------------------------------------</span><br><span class="line">PUTCH PROC</span><br><span class="line">;</span><br><span class="line">; 功能：使用 int 21h的 2 号功能输出字符。</span><br><span class="line">; 传参方式：寄存器传参</span><br><span class="line">; 入口参数：al</span><br><span class="line">; 出口参数：无</span><br><span class="line">;-----------------------------------------------------</span><br><span class="line">    push dx</span><br><span class="line">    mov dl,al</span><br><span class="line">    mov ah,2</span><br><span class="line">    int 21h</span><br><span class="line">    pop dx</span><br><span class="line">    ret</span><br><span class="line">PUTCH endp</span><br><span class="line">code ends</span><br><span class="line">    end start</span><br></pre></td></tr></table></figure>

<h2 id="对-CTRL-C-键和-CTRL-BREAK-键的处理"><a href="#对-CTRL-C-键和-CTRL-BREAK-键的处理" class="headerlink" title="对 CTRL+C 键和 CTRL+BREAK 键的处理"></a>对 CTRL+C 键和 CTRL+BREAK 键的处理</h2><h3 id="CTRL-C-键的处理程序"><a href="#CTRL-C-键的处理程序" class="headerlink" title="CTRL + C 键的处理程序"></a>CTRL + C 键的处理程序</h3><p>先看如下程序，它的功能是在屏幕上显示用户所按字符，直到用户按 ESC 键为止。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">;程序名：T6-24.asm</span><br><span class="line">;功能：在屏幕上显示用户所按字符，直到用户按 ESC 键为止。</span><br><span class="line">assume cs:code</span><br><span class="line"></span><br><span class="line">CR = 0dh</span><br><span class="line">LF = 0ah</span><br><span class="line">ESCAPE = 1Bh</span><br><span class="line"></span><br><span class="line">code segment</span><br><span class="line">START:</span><br><span class="line">    push cs</span><br><span class="line">    pop ds</span><br><span class="line">COUNT:</span><br><span class="line">    mov ah,8</span><br><span class="line">    int 21h</span><br><span class="line">    cmp al,ESCAPE</span><br><span class="line">    jz short XIT</span><br><span class="line">    mov dl,al</span><br><span class="line">    mov ah,2</span><br><span class="line">    int 21h</span><br><span class="line">    cmp dl,CR</span><br><span class="line">    jnz COUNT</span><br><span class="line">    mov ah,2</span><br><span class="line">    int 21h</span><br><span class="line">    mov dl,LF</span><br><span class="line">    mov ah,2</span><br><span class="line">    int 21h</span><br><span class="line">    jmp COUNT</span><br><span class="line">XIT:</span><br><span class="line">    mov ax,4c00h</span><br><span class="line">    int 21h</span><br><span class="line">code ends</span><br><span class="line">    end start</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注：DOSBOX 装的是简化版的操作系统，该系统不支持 CTRL+C 功能。所以暂时无法对该程序进行验证。</p>
</blockquote>
<p>在 DOS 下的 exe 程序是可以通过快捷键 CTRL+C 终止程序的。当应用程序利用 DOS　系统功能调用进行字符输入输出时，DOS　通常要检测 CTRL+C 键。如果检测到，就先显示符号 “^C” ，并产生中断 “int 23h”。缺省的 23H 号中断处理程序是终止程序运行。DOS 提供的这一功能是为了方便用户随机终止一个执行错误或不必执行的程序。<br>DOS 为应用程序改变这种处理方法做了准备。应用程序只要改变 23H 号中断处理程序，就可基本控制住 CTRL+C 键的处理。为了改变 23H 号中断处理程序，应用程序得提供一个新的 23H 号中断处理程序，然后修改 23H 号中断向量，使其指向新的  23H 号中断处理程序。由于 DOS 在设置 PSP 时，已把当时的 23H 号中断向量保存到 PSP 中，且在程序终止时再自动从 PSP 中取出并恢复。所以，应用程序在修改 23H 号中断向量后，可不必恢复它。</p>
<p>下面的程序增加了 23H 号中断处理程序，该处理程序及其简单，只有一条中断返回指令 IRET，即不做任何处理。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">;程序名：T6-24A.asm</span><br><span class="line">;功能：在屏幕上显示用户所按字符，直到用户按 ESC 键为止。禁止使用 CTRL+C 结果程序。</span><br><span class="line">assume cs:code</span><br><span class="line"></span><br><span class="line">CR = 0dh</span><br><span class="line">LF = 0ah</span><br><span class="line">ESCAPE = 1Bh</span><br><span class="line"></span><br><span class="line">code segment</span><br><span class="line">new23h:</span><br><span class="line">    iret    ;新的中断处理程序，不需要做任何处理，直接返回就好。</span><br><span class="line">START:</span><br><span class="line">    push cs</span><br><span class="line">    pop ds</span><br><span class="line">    mov dx,offset new23h</span><br><span class="line">    mov ax,2523h            ;指向新的 23h 号中断向量</span><br><span class="line">    int 21h</span><br><span class="line">COUNT:</span><br><span class="line">    mov ah,8</span><br><span class="line">    int 21h</span><br><span class="line">    cmp al,ESCAPE</span><br><span class="line">    jz short XIT</span><br><span class="line">    mov dl,al</span><br><span class="line">    mov ah,2</span><br><span class="line">    int 21h</span><br><span class="line">    cmp dl,CR</span><br><span class="line">    jnz COUNT</span><br><span class="line">    mov ah,2</span><br><span class="line">    int 21h</span><br><span class="line">    mov dl,LF</span><br><span class="line">    mov ah,2</span><br><span class="line">    int 21h</span><br><span class="line">    jmp COUNT</span><br><span class="line">XIT:</span><br><span class="line">    mov ax,4c00h</span><br><span class="line">    int 21h</span><br><span class="line">code ends</span><br><span class="line">    end start</span><br></pre></td></tr></table></figure>

<p>尽管按 CTRL+C 键不再能终止该程序的运行，但屏幕上却显示出符号 “^C”。如果应用程序不在乎由于按 CTRL+C 键带来的符号，那么上述处理就可接受。如果不愿显示由 CTRL+C 键带来的符号，那么如下几种处理方法也许可以满足需求：（1）应用程序使用不检测 CTRL+C 键的 DOS 功能调用进行字符输入输出；（2）应用程序不利用 DOS 功能调用进行字符输入输出。对一般程序而言这两种方法不完全有效。首先，应用程序不利用 DOS 功能调用进行字符输入输出，就要利用 BISO 进行字符输入输出或直接进行输入输出，有时这样操作是比较麻烦的。其次，在大多数 DOS 系统功能调用期间，DOS 要查看 CTRL+BREAK 键是否被按下，如发现 CTRL+BREAK 键被按，则也会显示符号 “^C” 和 产生 INT 23H 中断。</p>
<h3 id="对-CTRL-BREAK-键的处理"><a href="#对-CTRL-BREAK-键的处理" class="headerlink" title="对 CTRL+BREAK 键的处理"></a>对 CTRL+BREAK 键的处理</h3><p>键盘中断处理程序（9H 号中断处理程序）发现 CTRL+BREAK 键被按时，将产生 INT 1BH。在 DOS 自举时，由 DOS 提供的 1BH 号中断处理程序将在约定的内存单元中设置一个标志，然后结束。DOS 通过该标志检测 CTRL+BREAK 键是否被按下，如果发现被按下，则像 CTRL+C 那样显示符号 “^C” 和产生 INT 23H。<br>如果应用程序要自己处理 CTRL+BREAK 键，则可通过提供新的 1BH 号中断处理程序的方法来实现。所以，如果应用程序要使得 CTRL+BREAK 键不干扰程序的运行，只要使 1BH 号中断处理程序不设置与 DOS 约定的内存单元。但要注意，DOS并不自动保存和恢复 1BH 号中断向量，所以如果应用程序提供新的 1BH 号中断处理程序，那么在修改 1BH 号中断向量前，先要保存原 1BH 号中断向量，在程序结束前恢复它。<br>下面的程序提供了新的 1BH 号中断处理程序。作为例子，新的 1BH 号中断处理程序只显示信息“**BREAK**”，然后就返回</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">;程序名：T6-24B.asm</span><br><span class="line">;功能：提供新的 1BH 号中断处理程序，且只显示信息“\*\*BREAK\*\*”，然后就返回</span><br><span class="line">assume cs:code</span><br><span class="line"></span><br><span class="line">CR = 0dh</span><br><span class="line">LF = 0ah</span><br><span class="line">ESCAPE = 1Bh</span><br><span class="line"></span><br><span class="line">code segment</span><br><span class="line">ODL1BH DD ?</span><br><span class="line">VPAGE DB ?</span><br><span class="line">MESS DB &#x27;**BREAK**&#x27;,0</span><br><span class="line">;</span><br><span class="line">;新的 1BH 号中断处理程序</span><br><span class="line">NEW1BH:</span><br><span class="line">    push ds     ;保护现场</span><br><span class="line">    push ax</span><br><span class="line">    push bx</span><br><span class="line">    push si</span><br><span class="line">    push cs</span><br><span class="line">    pop ds</span><br><span class="line">    CLD</span><br><span class="line">    mov si,offset MESS</span><br><span class="line">    mov bh,VPAGE            ;准备显示信息 **BREAK**</span><br><span class="line">    mov ah,0EH</span><br><span class="line">BRKNEXT:</span><br><span class="line">    lodsb</span><br><span class="line">    or al,al</span><br><span class="line">    jz short BRKEXIT</span><br><span class="line">    int 10H</span><br><span class="line">    jmp BRKNEXT</span><br><span class="line">BRKEXIT:</span><br><span class="line">    pop si</span><br><span class="line">    pop bx</span><br><span class="line">    pop ax</span><br><span class="line">    pop ds</span><br><span class="line">    iret</span><br><span class="line">;新的 23H 号中断处理程序</span><br><span class="line">NEW23H:</span><br><span class="line">    iret</span><br><span class="line">;主程序</span><br><span class="line">start:</span><br><span class="line">    push cs</span><br><span class="line">    pop ds</span><br><span class="line">    mov ah,0fh      ;取状态信息</span><br><span class="line">    int 10H</span><br><span class="line">    mov VPAGE,bh    ;保存当前显示页号</span><br><span class="line">    ;</span><br><span class="line">    mov ax,351bh</span><br><span class="line">    int 21h         ;取原 1bh 中断向量并保存</span><br><span class="line">    mov word ptr ODL1BH,bx</span><br><span class="line">    mov word ptr ODL1BH+2,es</span><br><span class="line">    ;</span><br><span class="line">    mov dx,offset NEW23H    ;置 23H 号中断向量</span><br><span class="line">    mov ax,2523H            ;使其指向新的处理程序</span><br><span class="line">    int 21h</span><br><span class="line">    ;</span><br><span class="line">    mov dx,offset NEW1BH    ;置 1BH 号中断向量</span><br><span class="line">    mov ax,251bh            ;使其指向新的处理程序</span><br><span class="line">    int 21h</span><br><span class="line">COUNT:</span><br><span class="line">    mov ah,8</span><br><span class="line">    int 21h</span><br><span class="line">    cmp al,ESCAPE</span><br><span class="line">    jz short XIT</span><br><span class="line">    mov dl,al</span><br><span class="line">    mov ah,2</span><br><span class="line">    int 21h</span><br><span class="line">    cmp dl,CR</span><br><span class="line">    jnz COUNT</span><br><span class="line">    mov ah,2</span><br><span class="line">    int 21h</span><br><span class="line">    mov dl,LF</span><br><span class="line">    mov ah,2</span><br><span class="line">    int 21h</span><br><span class="line">    jmp COUNT</span><br><span class="line">XIT:</span><br><span class="line">    lds dx,ODL1BH</span><br><span class="line">    mov ax,251bh    ;恢复原 1BH 号中断向量</span><br><span class="line">    int 21h</span><br><span class="line">    mov ax,4c00h</span><br><span class="line">    int 21h</span><br><span class="line">code ends</span><br><span class="line">    end start</span><br></pre></td></tr></table></figure>

<h3 id="一个能控制住-Ctrl-C-键和-CTRL-BREAK-键的例子"><a href="#一个能控制住-Ctrl-C-键和-CTRL-BREAK-键的例子" class="headerlink" title="一个能控制住 Ctrl+C 键和 CTRL+BREAK 键的例子"></a>一个能控制住 Ctrl+C 键和 CTRL+BREAK 键的例子</h3><p>在上一个例子中，控制住了 CTRL+BREAK 键。在其运行时，按 CTRL+C 键也不终止程序的运行，但仍会出现符号 “^C”。现在修改键盘管理程序（16H号中断处理程序），使其不返回 CTRL+C 键（即 ASCII 码 03H）。<br>在下面的程序中，提供了新的 16H 号中断处理程序，它“吃掉”了 CTRL+C 键，同时也过滤掉了 Ctrl+2 键（它类似于 Ctrl+C，其扫描码为 03H）。这样，DOS 就不可能检测到 CTRL+C 键了。新的 1BH 号中断处理程序仅时一条中断返回指令。所以不再提供新的 23H 号中断。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line">;程序名：T6-24C.asm</span><br><span class="line">;功能：提供新的 1BH 号中断处理程序，且只显示信息“\*\*BREAK\*\*”，然后就返回</span><br><span class="line">assume cs:code</span><br><span class="line"></span><br><span class="line">CR = 0dh</span><br><span class="line">LF = 0ah</span><br><span class="line">ESCAPE = 1Bh</span><br><span class="line"></span><br><span class="line">code segment</span><br><span class="line">ODL1BH DD ?</span><br><span class="line">ODL16H DD ?</span><br><span class="line">;</span><br><span class="line">;新的 16H 号中断处理程序</span><br><span class="line">NEWKEY PROC FAR</span><br><span class="line">NEW16H:</span><br><span class="line">    cmp ah,10H</span><br><span class="line">    jz PKEY</span><br><span class="line">    cmp ah,11h</span><br><span class="line">    jz PKEY2</span><br><span class="line">    or ah,ah</span><br><span class="line">    jz PKEY</span><br><span class="line">    jmp dword ptr cs:ODL16H     ;转原16H号中断处理程序</span><br><span class="line">    ;</span><br><span class="line">PKEY:</span><br><span class="line">    push ax</span><br><span class="line">PKEY1:</span><br><span class="line">    pop ax</span><br><span class="line">    push ax</span><br><span class="line">    pushf</span><br><span class="line">    call dword ptr cs:ODL16H    ;调原16H号中中断处理程序</span><br><span class="line">    cmp al,3</span><br><span class="line">    jz PKEY1</span><br><span class="line">    add sp,2</span><br><span class="line">    iret</span><br><span class="line">    ;</span><br><span class="line">PKEY2:</span><br><span class="line">    push ax</span><br><span class="line">PKEY3:</span><br><span class="line">    pop ax</span><br><span class="line">    push ax</span><br><span class="line">    pushf</span><br><span class="line">    call dword ptr cs:ODL16H</span><br><span class="line">    jz PKEY6</span><br><span class="line">    cmp al,3</span><br><span class="line">    jz PKEY4</span><br><span class="line">    cmp ax,0300h</span><br><span class="line">    jnz PKEY5</span><br><span class="line">    ;</span><br><span class="line">PKEY4:</span><br><span class="line">    xor ah,ah</span><br><span class="line">    pushf</span><br><span class="line">    call dword ptr cs:ODL16H</span><br><span class="line">    jmp PKEY3</span><br><span class="line">    ;</span><br><span class="line">PKEY5:</span><br><span class="line">    add sp,2</span><br><span class="line">    cmp ax,0300h</span><br><span class="line">    ret 2</span><br><span class="line">    ;</span><br><span class="line">PKEY6:</span><br><span class="line">    add sp,2</span><br><span class="line">    cmp ax,ax</span><br><span class="line">    ret 2</span><br><span class="line">NEWKEY ENDP</span><br><span class="line">NEW1BH:</span><br><span class="line">    iret</span><br><span class="line">;---------------------------------</span><br><span class="line">;主程序</span><br><span class="line">start:</span><br><span class="line">    push cs</span><br><span class="line">    pop ds</span><br><span class="line">    mov ax,3516h</span><br><span class="line">    int 21h</span><br><span class="line">    mov word ptr ODL16H,bx</span><br><span class="line">    mov word ptr ODL16H+2,es</span><br><span class="line">    ;</span><br><span class="line">    mov ax,351bh</span><br><span class="line">    int 21h</span><br><span class="line">    mov word ptr ODL1BH,bx</span><br><span class="line">    mov word ptr ODL1BH,es</span><br><span class="line">    ;</span><br><span class="line">    mov dx,offset NEW16H</span><br><span class="line">    mov ax,2516h</span><br><span class="line">    int 21h</span><br><span class="line">    mov dx,offset NEW16H</span><br><span class="line">    mov ax,2516h</span><br><span class="line">    int 21h</span><br><span class="line">    mov dx,offset NEW1BH</span><br><span class="line">    mov ax,251bh</span><br><span class="line">    int 21h</span><br><span class="line">COUNT:</span><br><span class="line">    mov ah,8</span><br><span class="line">    int 21h</span><br><span class="line">    cmp al,ESCAPE</span><br><span class="line">    jz short XIT</span><br><span class="line">    mov dl,al</span><br><span class="line">    mov ah,2</span><br><span class="line">    int 21h</span><br><span class="line">    cmp dl,CR</span><br><span class="line">    jnz COUNT</span><br><span class="line">    mov ah,2</span><br><span class="line">    int 21h</span><br><span class="line">    mov dl,LF</span><br><span class="line">    mov ah,2</span><br><span class="line">    int 21h</span><br><span class="line">    jmp COUNT</span><br><span class="line">XIT:</span><br><span class="line">    lds dx,ODL1BH</span><br><span class="line">    mov ax,251bh</span><br><span class="line">    int 21h</span><br><span class="line">    lds dx,cs:ODL16H</span><br><span class="line">    mov ax,2516h</span><br><span class="line">    int 21h</span><br><span class="line">    mov ax,4c00h</span><br><span class="line">    int 21h</span><br><span class="line">code ends</span><br><span class="line">    end start</span><br></pre></td></tr></table></figure>

<h1 id="TSR-程序设计举例"><a href="#TSR-程序设计举例" class="headerlink" title="TSR 程序设计举例"></a>TSR 程序设计举例</h1><p>TSR（Terminate and stay Resident）意为结束并驻留。TSR程序是一种特殊的　DOS　应用程序，不同于结束即退出的一般 DOS 应用程序。TSR程序装入内存并初次运行后，程序的大部分仍驻留在内存中，被某种条件激活后又投入运行。它能及时地处理许多驻留程序不能处理地时间，并可为单任务操作系统 DOS 增添一定地多任务处理能力。</p>
<h2 id="驻留的时钟显示程序"><a href="#驻留的时钟显示程序" class="headerlink" title="驻留的时钟显示程序"></a>驻留的时钟显示程序</h2><p>通常 TSR 程序由驻留内存部分和初始化部分组成。把TSR程序员装入内存时，初次运行的是初始化部分。初始化程序的主要功能是，对驻留部分完成必要的初始化工作；使驻留部分保留在内存中。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><span class="line">;程序名：T6-25.asm</span><br><span class="line">;功能：在内存中驻留显示时钟的程序</span><br><span class="line">assume cs:code,ds:code</span><br><span class="line"></span><br><span class="line">code segment</span><br><span class="line">count_val=18            ;间隔次数</span><br><span class="line">dpage=0                 ;显示页号</span><br><span class="line">row=0                   ;显示时钟行号</span><br><span class="line">column=80-buff_len      ;显示时钟的开始列号</span><br><span class="line">color=07h               ;显示时钟的属性</span><br><span class="line"></span><br><span class="line">;代码</span><br><span class="line">;1CH号中断处理程序使用的变量</span><br><span class="line">count dw count_val      ;计数</span><br><span class="line">hhhh db ?,?,&#x27;:&#x27;         ;时</span><br><span class="line">mmmm db ?,?,&#x27;:&#x27;         ;分</span><br><span class="line">ssss db ?,?             ;秒</span><br><span class="line">buff_len=$-offset hhhh  ;buff_len为显示信息长度</span><br><span class="line">cursor dw ?</span><br><span class="line">OLD1CH DD ?             ;保存原中断向量变量</span><br><span class="line">;1CH 号中断处理程序</span><br><span class="line">NEW1CH:</span><br><span class="line">    cmp cs:count,0</span><br><span class="line">    jz next</span><br><span class="line">    ;</span><br><span class="line">next:</span><br><span class="line">    mov cs:count,count_val</span><br><span class="line">    sti</span><br><span class="line">    ;再真正执行程序之前保护寄存器</span><br><span class="line">    push ds</span><br><span class="line">    push es</span><br><span class="line">    push ax</span><br><span class="line">    push bx</span><br><span class="line">    push cx</span><br><span class="line">    push dx</span><br><span class="line">    push si</span><br><span class="line">    push bp</span><br><span class="line">    ;</span><br><span class="line">    push cs</span><br><span class="line">    pop ds</span><br><span class="line">    push ds</span><br><span class="line">    pop es      ;置代码段寄存器</span><br><span class="line"></span><br><span class="line">    ;输出时间</span><br><span class="line">    call far ptr GET_T</span><br><span class="line">    ;取原光标位置</span><br><span class="line">    mov bh,dpage</span><br><span class="line">    mov ah,3</span><br><span class="line">    int 10h</span><br><span class="line">    ;保存原光标位置</span><br><span class="line">    mov cursor,dx</span><br><span class="line">    mov bp,offset hhhh</span><br><span class="line">    mov bh,dpage</span><br><span class="line">    mov dh,row</span><br><span class="line">    mov dl,column</span><br><span class="line">    mov bl,color</span><br><span class="line">    mov cx,buff_len</span><br><span class="line">    mov al,0</span><br><span class="line">    mov ah,13h          ;显示时钟</span><br><span class="line">    int 10h</span><br><span class="line">    mov bh,dpage</span><br><span class="line">    mov dx,cursor</span><br><span class="line">    mov ah,2</span><br><span class="line">    int 10h             ;恢复原光标</span><br><span class="line"></span><br><span class="line">    pop bp</span><br><span class="line">    pop si</span><br><span class="line">    pop dx</span><br><span class="line">    pop cx</span><br><span class="line">    pop bx</span><br><span class="line">    pop ax</span><br><span class="line">    pop es</span><br><span class="line">    pop ds</span><br><span class="line">    ;结束程序</span><br><span class="line">    jmp dword ptr cs:OLD1CH  ;替换 iret</span><br><span class="line"></span><br><span class="line">    GET_T proc far</span><br><span class="line">    mov ah,2                 ;取时间信息</span><br><span class="line">    int 1ah</span><br><span class="line">    mov al,ch                ;把时数转换为可显形式</span><br><span class="line">    call TTASC</span><br><span class="line">    ;call TECHO</span><br><span class="line">    xchg ah,al</span><br><span class="line">    mov word ptr hhhh,ax     ;保存</span><br><span class="line">    mov al,cl                ;把分转换为可显示形式</span><br><span class="line">    call TTASC</span><br><span class="line">    ;call TECHO</span><br><span class="line">    xchg ah,al</span><br><span class="line">    mov word ptr mmmm,ax    ;保存</span><br><span class="line">    mov al,dh               ;把秒转换为可写形式</span><br><span class="line">    call TTASC</span><br><span class="line">    ;call TECHO</span><br><span class="line">    xchg ah,al</span><br><span class="line">    mov word ptr ssss,ax    ;保存</span><br><span class="line">    ret</span><br><span class="line">    GET_T endp</span><br><span class="line"></span><br><span class="line">    ;将时间的压缩bcd码转换为ascii</span><br><span class="line">    ;输入参数al</span><br><span class="line">    ;输出参数ax</span><br><span class="line">    TTASC proc</span><br><span class="line">    mov ah,al</span><br><span class="line">    and al,0fh</span><br><span class="line">    shr ah,1</span><br><span class="line">    shr ah,1</span><br><span class="line">    shr ah,1</span><br><span class="line">    shr ah,1</span><br><span class="line">    add ax,3030h</span><br><span class="line">    ret</span><br><span class="line">    TTASC endp</span><br><span class="line"></span><br><span class="line">start:</span><br><span class="line">    push cs</span><br><span class="line">    pop ds</span><br><span class="line">    mov ax,351ch</span><br><span class="line">    int 21h</span><br><span class="line">    mov word ptr OLD1CH,bx</span><br><span class="line">    mov word ptr OLD1CH+2,es    ;保存原 1CH 号中断</span><br><span class="line"></span><br><span class="line">    mov dx,offset NEW1CH</span><br><span class="line">    mov ax,251ch</span><br><span class="line">    int 21h                     ;设置新的 1CH 号中断</span><br><span class="line"></span><br><span class="line">    ;计算驻留字节数并驻留退出</span><br><span class="line">    mov dx,offset start     ;欲驻留部分代码和数据的字节数</span><br><span class="line">    add dx,15               ;考虑字节数不是 16 倍数的情况</span><br><span class="line">    mov cl,4</span><br><span class="line">    shr dx,cl               ;转换成字节数</span><br><span class="line">    add dx,10h              ;加上 PSP 的长度</span><br><span class="line">    mov ah,31h</span><br><span class="line">    int 21h             ;结束并驻留</span><br><span class="line">code ends</span><br><span class="line">end start</span><br></pre></td></tr></table></figure>

<p>初始化部分包含了驻留退出的代码，把 1CH 号中断处理程序驻留在内存中，此外还把原 1CH 号中断向量的双字变量 OLD1CH 移到驻留区。<br>通过 DOS 的 31H 号功能调用进行驻留退出。该功能调用的主要入口参数是 DX&#x3D;驻留节数（一个节表示 16 个字节），驻留的内容从程序段前缀（PSP）开始计算，所以在计算驻留节数时，除了计算要驻留的数据和代码的长度外，还需要加上 PSP 的 10H 节。<br>DOS 的 31H 号功能调用与 4CH 号功能调用相比，所不同的是它在交出控制权时没有全部交出占用的内存资源，而是根据要求（由入口参数规定）保留部分。</p>
<h2 id="热键激活的-TSR-程序"><a href="#热键激活的-TSR-程序" class="headerlink" title="热键激活的 TSR 程序"></a>热键激活的 TSR 程序</h2><p>有多种方式或方法激活驻留的程序，键盘激活是常见的一种方法。下面是一个简单的热激活 TSR 程序的例子。热键设定为 CTRL+F8，每按一次 CTRL+F8 键，就在屏幕的固定位置显示一字符串。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line">;程序名：T6-26.asm</span><br><span class="line">;功能：简单的热键激活 TSR 程序</span><br><span class="line">assume cs:code,ds:code</span><br><span class="line">;常量说明</span><br><span class="line">BUFF_HEAD = 1AH     ;键盘缓冲区头指针保存单元偏移</span><br><span class="line">BUFF_TAIL = 1Ch     ;键盘缓冲区尾指针保存单元偏移</span><br><span class="line">BUFF_START = 1EH    ;键盘缓冲区开始偏移</span><br><span class="line">BUFF_END = 3EH      ;键盘缓冲区结束偏移</span><br><span class="line">CTRL_F8 = 6500H     ;激活键扫描码</span><br><span class="line">ROW = 10            ;行号</span><br><span class="line">COLUMN = 0          ;列号</span><br><span class="line">PAGEN = 0           ;显示页号</span><br><span class="line"></span><br><span class="line">code segment</span><br><span class="line">OLD9H DD ?             ;保存原中断向量变量</span><br><span class="line">MESS DB &#x27;Hello!&#x27;</span><br><span class="line">MESSLEN equ $-MESS</span><br><span class="line"></span><br><span class="line">;9H 号中断处理程序</span><br><span class="line">NEW9H:</span><br><span class="line">    pushf</span><br><span class="line">    call cs:OLD9H       ;调用原中断处理程序</span><br><span class="line">    sti                 ;开中断</span><br><span class="line">    push ds</span><br><span class="line">    push ax</span><br><span class="line">    push bx</span><br><span class="line">    ;</span><br><span class="line">    mov ax,40h</span><br><span class="line">    mov ds,ax</span><br><span class="line">    mov bx,ds:[BUFF_HEAD]</span><br><span class="line">    cmp bx,ds:[BUFF_TAIL]   ;判断键盘缓冲区是否为空</span><br><span class="line">    jz IOVER                ;是，结束</span><br><span class="line">    mov ax,ds:[bx]</span><br><span class="line">    cmp ax,CTRL_F8          ;是否为激活键</span><br><span class="line">    jz YES</span><br><span class="line">    ;</span><br><span class="line">IOVER:</span><br><span class="line">    pop bx                  ;结束处理</span><br><span class="line">    pop ax                  ;恢复现场</span><br><span class="line">    pop ds</span><br><span class="line">    iret                    ;中断返回</span><br><span class="line">    ;</span><br><span class="line">YES:</span><br><span class="line">    inc bx</span><br><span class="line">    inc bx                  ;调整键盘缓冲区头指针（取走激活键）</span><br><span class="line">    cmp bx,BUFF_END         ;指针是否到缓冲区尾</span><br><span class="line">    jnz YES1                ;否，转</span><br><span class="line">    mov bx,BUFF_START       ;是，指向头</span><br><span class="line">YES1:</span><br><span class="line">    mov ds:[BUFF_HEAD],bx   ;保存</span><br><span class="line">    ;</span><br><span class="line">    push cx</span><br><span class="line">    push dx</span><br><span class="line">    push bp</span><br><span class="line">    push es</span><br><span class="line">    mov ax,cs</span><br><span class="line">    mov es,ax</span><br><span class="line">    mov bp,offset MESS</span><br><span class="line">    mov cx,MESSLEN</span><br><span class="line">    mov dh,row</span><br><span class="line">    mov dl,COLUMN</span><br><span class="line">    mov bh,PAGEN</span><br><span class="line">    mov bl,07h</span><br><span class="line">    mov al,0            ;显示后不移动光标，串中不含属性</span><br><span class="line">    mov ah,13h</span><br><span class="line">    int 10h</span><br><span class="line">    ;</span><br><span class="line">    pop es</span><br><span class="line">    pop bp</span><br><span class="line">    pop dx</span><br><span class="line">    pop cx</span><br><span class="line">    jmp IOVER</span><br><span class="line">;----------------------</span><br><span class="line">;初始化代码</span><br><span class="line">INIT:</span><br><span class="line">    push cs</span><br><span class="line">    pop ds</span><br><span class="line">    mov ax,3509H</span><br><span class="line">    int 21h</span><br><span class="line">    mov word ptr OLD9H,bx</span><br><span class="line">    mov word ptr OLD9H+2,es     ;保存原 9H 号中断向量</span><br><span class="line">    ;</span><br><span class="line">    mov dx,offset NEW9H         ;置新的 9H 号中断向量</span><br><span class="line">    mov ax,2509h</span><br><span class="line">    int 21h</span><br><span class="line">    ;</span><br><span class="line">    mov dx,offset INIT+15</span><br><span class="line">    mov cl,4                    ;计算驻留节数</span><br><span class="line">    shr dx,cl</span><br><span class="line">    add dx,10h                  ;加上 PSP 的节数</span><br><span class="line">    mov al,0</span><br><span class="line">    mov ah,31h                  ;驻留退出</span><br><span class="line">    int 21h</span><br><span class="line">code ends</span><br><span class="line">end INIT</span><br></pre></td></tr></table></figure>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/196384295-495e6db6-3f87-40f3-9510-49d511ae26ea.png"
                      alt="4"
                ></p>
<blockquote>
<p>DOSBOX 不能使用热键，有兴趣的可以安装 MS-DOS 进行实验。</p>
</blockquote>
<p><a class="link"   target="_blank" rel="noopener" href="https://www.xitongzhijia.net/soft/243505.html" >MSDOS8.0原版镜像 V8.0 完全安装版<i class="fas fa-external-link-alt"></i></a><br><a class="link"   target="_blank" rel="noopener" href="http://t.zoukankan.com/yanhua-tj-p-13996585.html" >利用Vmware workstation安装MS-DOS<i class="fas fa-external-link-alt"></i></a></p>
<p>上面程序的初始化部分先保存了 9号中断向量，然后设置新的 9号中断向量，使其指向新的键盘中断处理程序，最后驻留结束。这样每当按键，就会运行新的键盘中断处理程序。新的键盘中断处理沉痼先调用老的键盘中断处理程序完成按键工作，然后通过检查键盘缓冲区，判断是否按下照约定的热键 CTRL+F8，如果按了就显示提示信息。</p>

        </div>

        
            <div class="post-copyright-info">
                <div class="article-copyright-info-container">
    <ul>
        <li>本文标题：8086汇编-简单应用程序的设计</li>
        <li>本文作者：9unk</li>
        <li>创建时间：2022-10-09 21:53:00</li>
        <li>
            本文链接：https://9unkk.github.io/2022/10/09/8086汇编-简单应用程序的设计/
        </li>
        <li>
            版权声明：本博客所有文章除特别声明外，均采用 <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">BY-NC-SA</a> 许可协议。转载请注明出处！
        </li>
    </ul>
</div>

            </div>
        

        
            <ul class="post-tags-box">
                
                    <li class="tag-item">
                        <a href="/tags/%E6%B1%87%E7%BC%96/">#汇编</a>&nbsp;
                    </li>
                
            </ul>
        

        
            <div class="article-nav">
                
                    <div class="article-prev">
                        <a class="prev"
                           rel="prev"
                           href="/2022/10/09/80386%E6%B1%87%E7%BC%96-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5/"
                        >
                            <span class="left arrow-icon flex-center">
                              <i class="fas fa-chevron-left"></i>
                            </span>
                            <span class="title flex-center">
                                <span class="post-nav-title-item">80386汇编-基本概念</span>
                                <span class="post-nav-item">上一篇</span>
                            </span>
                        </a>
                    </div>
                
                
                    <div class="article-next">
                        <a class="next"
                           rel="next"
                           href="/2022/09/27/8086%E6%B1%87%E7%BC%96-%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA%E4%B8%8E%E4%B8%AD%E6%96%AD/"
                        >
                            <span class="title flex-center">
                                <span class="post-nav-title-item">8086汇编-输入输出与中断</span>
                                <span class="post-nav-item">下一篇</span>
                            </span>
                            <span class="right arrow-icon flex-center">
                              <i class="fas fa-chevron-right"></i>
                            </span>
                        </a>
                    </div>
                
            </div>
        

        
    </div>
</div>


                
            </div>

        </div>

        <div class="page-main-content-bottom">
            <footer class="footer">
    <div class="info-container">
        <div class="copyright-info info-item">
            &copy;
            
              <span>2022</span>
              -
            
            2023&nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;<a href="/">9unk</a>
        </div>
        
        <div class="theme-info info-item">
            由 <a target="_blank" href="https://hexo.io">Hexo</a> 驱动&nbsp;|&nbsp;主题&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep v3.4.5</a>
        </div>
        
        
    </div>
</footer>

        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="tools-list">
        <!-- TOC aside toggle -->
        
            <li class="tools-item page-aside-toggle">
                <i class="fas fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
    </ul>
</div>

        </div>
    

    <div class="right-bottom-side-tools">
        <div class="side-tools-container">
    <ul class="side-tools-list">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-expand-width flex-center">
            <i class="fas fa-arrows-alt-h"></i>
        </li>

        <li class="tools-item tool-dark-light-toggle flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        

        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list">
        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>
        
            <li class="tools-item tool-scroll-to-top flex-center">
                <i class="arrow-up fas fa-arrow-up"></i>
                <span class="percent"></span>
            </li>
        
    </ul>
</div>

    </div>

    
        <aside class="page-aside">
            <div class="post-toc-wrap">
    <div class="post-toc">
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%A4%84%E7%90%86"><span class="nav-number">1.</span> <span class="nav-text">字符串处理</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%93%8D%E4%BD%9C%E6%8C%87%E4%BB%A4"><span class="nav-number">1.1.</span> <span class="nav-text">字符串操作指令</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AE%80%E5%8D%95%E8%AF%B4%E6%98%8E"><span class="nav-number">1.1.1.</span> <span class="nav-text">简单说明</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%A3%85%E5%85%A5%E6%8C%87%E4%BB%A4%EF%BC%88LOAD-String%EF%BC%89"><span class="nav-number">1.1.2.</span> <span class="nav-text">字符串装入指令（LOAD String）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%AD%98%E5%82%A8%E6%8C%87%E4%BB%A4%EF%BC%88Store-String%EF%BC%89"><span class="nav-number">1.1.3.</span> <span class="nav-text">字符串存储指令（Store String）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%BC%A0%E9%80%81%E6%8C%87%E4%BB%A4%EF%BC%88Move-String%EF%BC%89"><span class="nav-number">1.1.4.</span> <span class="nav-text">字符串传送指令（Move String）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%89%AB%E6%8F%8F%E6%8C%87%E4%BB%A4-Scan-String"><span class="nav-number">1.1.5.</span> <span class="nav-text">字符串扫描指令(Scan String)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%AF%94%E8%BE%83%E6%8C%87%E4%BB%A4"><span class="nav-number">1.1.6.</span> <span class="nav-text">字符串比较指令</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%87%8D%E5%A4%8D%E5%89%8D%E7%BC%80"><span class="nav-number">1.2.</span> <span class="nav-text">重复前缀</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%87%8D%E5%A4%8D%E5%89%8D%E7%BC%80-REP"><span class="nav-number">1.2.1.</span> <span class="nav-text">重复前缀 REP</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%87%8D%E5%A4%8D%E5%89%8D%E7%BC%80-REPZ-x2F-REPE"><span class="nav-number">1.2.2.</span> <span class="nav-text">重复前缀 REPZ&#x2F;REPE</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%87%8D%E5%A4%8D%E5%89%8D%E7%BC%80-REPNZ-x2F-REPNE"><span class="nav-number">1.2.3.</span> <span class="nav-text">重复前缀 REPNZ&#x2F;REPNE</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AF%B4%E6%98%8E"><span class="nav-number">1.2.4.</span> <span class="nav-text">说明</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%93%8D%E4%BD%9C%E6%8C%87%E4%BB%A4-1"><span class="nav-number">1.3.</span> <span class="nav-text">字符串操作指令</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8D%81%E8%BF%9B%E5%88%B6%E6%95%B0%E7%AE%97%E6%95%B0%E8%BF%90%E7%AE%97%E8%B0%83%E6%95%B4%E6%8C%87%E4%BB%A4%E5%8F%8A%E5%BA%94%E7%94%A8"><span class="nav-number">2.</span> <span class="nav-text">十进制数算数运算调整指令及应用</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%84%E5%90%88%E7%9A%84BCD%E7%A0%81%E7%9A%84%E7%AE%97%E6%95%B0%E8%BF%90%E7%AE%97%E8%B0%83%E6%95%B4%E6%8C%87%E4%BB%A4"><span class="nav-number">2.1.</span> <span class="nav-text">组合的BCD码的算数运算调整指令</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%84%E5%90%88%E7%9A%84BCD%E7%A0%81%E5%8A%A0%E6%B3%95%E8%B0%83%E6%95%B4%E6%8C%87%E4%BB%A4DAA%EF%BC%88Decimal-Adjust-for-Addition%EF%BC%89"><span class="nav-number">2.1.1.</span> <span class="nav-text">组合的BCD码加法调整指令DAA（Decimal Adjust for Addition）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%84%E5%90%88%E7%9A%84-BCD-%E7%A0%81%E5%87%8F%E6%B3%95%E8%B0%83%E6%95%B4%E6%8C%87%E4%BB%A4-DAS%EF%BC%88Decimal-Adjust-for-Subtraction%EF%BC%89"><span class="nav-number">2.1.2.</span> <span class="nav-text">组合的 BCD 码减法调整指令 DAS（Decimal Adjust for Subtraction）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%AA%E7%BB%84%E5%90%88%E7%9A%84-BCD-%E7%A0%81%E5%8A%A0%E6%B3%95%E8%B0%83%E6%95%B4%E6%8C%87%E4%BB%A4AAA%EF%BC%88ASCII-Adjust-for-Addition%EF%BC%89"><span class="nav-number">2.1.3.</span> <span class="nav-text">未组合的 BCD 码加法调整指令AAA（ASCII Adjust for Addition）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%AA%E7%BB%84%E5%90%88%E7%9A%84-BCD-%E7%A0%81%E5%87%8F%E6%B3%95%E8%B0%83%E6%95%B4%E6%8C%87%E4%BB%A4AAS%EF%BC%88ASCII-Adjust-for-Subtraction%EF%BC%89"><span class="nav-number">2.1.4.</span> <span class="nav-text">未组合的 BCD 码减法调整指令AAS（ASCII Adjust for Subtraction）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%AA%E7%BB%84%E5%90%88%E7%9A%84-BCD-%E4%B9%98%E6%B3%95%E8%B0%83%E6%95%B4%E6%8C%87%E4%BB%A4AAM%EF%BC%88ASCII-Adjust-for-Multiplication%EF%BC%89"><span class="nav-number">2.1.5.</span> <span class="nav-text">未组合的 BCD 乘法调整指令AAM（ASCII Adjust for Multiplication）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%AA%E7%BB%84%E5%90%88%E7%9A%84-BCD-%E7%A0%81%E9%99%A4%E6%B3%95%E8%B0%83%E6%95%B4%E6%8C%87%E4%BB%A4AAD%EF%BC%88ASCII-Adjust-for-Division%EF%BC%89"><span class="nav-number">2.1.6.</span> <span class="nav-text">未组合的 BCD 码除法调整指令AAD（ASCII Adjust for Division）</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BA%94%E7%94%A8%E4%B8%BE%E4%BE%8B"><span class="nav-number">2.2.</span> <span class="nav-text">应用举例</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#DOS-%E7%A8%8B%E5%BA%8F%E6%AE%B5%E5%89%8D%E7%BC%80%E5%92%8C%E7%89%B9%E6%AE%8A%E6%83%85%E5%86%B5%E5%A4%84%E7%90%86%E7%A8%8B%E5%BA%8F"><span class="nav-number">3.</span> <span class="nav-text">DOS 程序段前缀和特殊情况处理程序</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#DOS%E7%A8%8B%E5%BA%8F%E6%AE%B5%E5%89%8D%E7%BC%80-PSP"><span class="nav-number">3.1.</span> <span class="nav-text">DOS程序段前缀 PSP</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%88%E6%AD%A2%E7%A8%8B%E5%BA%8F%E7%9A%84%E5%8F%A6%E4%B8%80%E9%80%94%E5%BE%84"><span class="nav-number">3.2.</span> <span class="nav-text">终止程序的另一途径</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8F%96%E5%BE%97%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%8F%82%E6%95%B0"><span class="nav-number">3.3.</span> <span class="nav-text">应用程序取得命令行参数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AF%B9-CTRL-C-%E9%94%AE%E5%92%8C-CTRL-BREAK-%E9%94%AE%E7%9A%84%E5%A4%84%E7%90%86"><span class="nav-number">3.4.</span> <span class="nav-text">对 CTRL+C 键和 CTRL+BREAK 键的处理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#CTRL-C-%E9%94%AE%E7%9A%84%E5%A4%84%E7%90%86%E7%A8%8B%E5%BA%8F"><span class="nav-number">3.4.1.</span> <span class="nav-text">CTRL + C 键的处理程序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%B9-CTRL-BREAK-%E9%94%AE%E7%9A%84%E5%A4%84%E7%90%86"><span class="nav-number">3.4.2.</span> <span class="nav-text">对 CTRL+BREAK 键的处理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%80%E4%B8%AA%E8%83%BD%E6%8E%A7%E5%88%B6%E4%BD%8F-Ctrl-C-%E9%94%AE%E5%92%8C-CTRL-BREAK-%E9%94%AE%E7%9A%84%E4%BE%8B%E5%AD%90"><span class="nav-number">3.4.3.</span> <span class="nav-text">一个能控制住 Ctrl+C 键和 CTRL+BREAK 键的例子</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#TSR-%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E4%B8%BE%E4%BE%8B"><span class="nav-number">4.</span> <span class="nav-text">TSR 程序设计举例</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%A9%BB%E7%95%99%E7%9A%84%E6%97%B6%E9%92%9F%E6%98%BE%E7%A4%BA%E7%A8%8B%E5%BA%8F"><span class="nav-number">4.1.</span> <span class="nav-text">驻留的时钟显示程序</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%83%AD%E9%94%AE%E6%BF%80%E6%B4%BB%E7%9A%84-TSR-%E7%A8%8B%E5%BA%8F"><span class="nav-number">4.2.</span> <span class="nav-text">热键激活的 TSR 程序</span></a></li></ol></li></ol>
    </div>
</div>
        </aside>
    

    <div class="image-viewer-container">
    <img src="">
</div>


    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="搜索..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="popup-btn-close">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

</main>




<script src="/js/utils.js"></script>

<script src="/js/main.js"></script>

<script src="/js/header-shrink.js"></script>

<script src="/js/back2top.js"></script>

<script src="/js/dark-light-toggle.js"></script>



    
<script src="/js/local-search.js"></script>




    
<script src="/js/code-copy.js"></script>




    
<script src="/js/lazyload.js"></script>



<div class="post-scripts pjax">
    
        
<script src="/js/left-side-toggle.js"></script>

<script src="/js/libs/anime.min.js"></script>

<script src="/js/toc.js"></script>

    
</div>


    
<script src="/js/libs/pjax.min.js"></script>

<script>
    window.addEventListener('DOMContentLoaded', () => {
        window.pjax = new Pjax({
            selectors: [
                'head title',
                '.page-container',
                '.pjax'
            ],
            history: true,
            debug: false,
            cacheBust: false,
            timeout: 0,
            analytics: false,
            currentUrlFullReload: false,
            scrollRestoration: false,
            // scrollTo: true,
        });

        document.addEventListener('pjax:send', () => {
            KEEP.utils.pjaxProgressBarStart();
        });

        document.addEventListener('pjax:complete', () => {
            KEEP.utils.pjaxProgressBarEnd();
            window.pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'));
            KEEP.refresh();
        });
    });
</script>



</body>
</html>
