<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="咸鱼">
    <meta name="author" content="9unk">
    
    <title>
        
            8086汇编-子程序设计 |
        
        9unk Blog
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    <link rel="shortcut icon" href="/images/logo.jpg">
    
<link rel="stylesheet" href="/css/font-awesome.min.css">

    <script id="hexo-configurations">
    let KEEP = window.KEEP || {};
    KEEP.hexo_config = {"hostname":"example.com","root":"/","language":"zh-CN"};
    KEEP.theme_config = {"toc":{"enable":true,"number":true,"expand_all":false,"init_open":true},"style":{"primary_color":"#0066CC","avatar":"/images/logo.jpg","favicon":"/images/logo.jpg","article_img_align":"left","left_side_width":"260px","content_max_width":"920px","hover":{"shadow":false,"scale":false},"first_screen":{"enable":true,"background_img":"/images/bg.svg","description":"人初做事，如鸡伏卵，不舍而生气渐充。如燕营巢，不息而结构渐牢。如滋培之木，不见其长，有时而大。如有本之泉，不舍昼夜，盈科而后进，放乎四海。"},"scroll":{"progress_bar":{"enable":false},"percent":{"enable":true}}},"local_search":{"enable":true,"preload":true},"code_copy":{"enable":true,"style":"mac"},"pjax":{"enable":true},"lazyload":{"enable":true},"version":"3.4.5"};
    KEEP.language_ago = {"second":"%s 秒前","minute":"%s 分钟前","hour":"%s 小时前","day":"%s 天前","week":"%s 周前","month":"%s 个月前","year":"%s 年前"};
  </script>
<meta name="generator" content="Hexo 6.0.0"></head>


<body>
<div class="progress-bar-container">
    

    
        <span class="pjax-progress-bar"></span>
        <span class="pjax-progress-icon">
            <i class="fas fa-circle-notch fa-spin"></i>
        </span>
    
</div>


<main class="page-container">

    

    <div class="page-main-content">

        <div class="page-main-content-top">
            <header class="header-wrapper">

    <div class="header-content">
        <div class="left">
            
            <a class="logo-title" href="/">
                9unk Blog
            </a>
        </div>

        <div class="right">
            <div class="pc">
                <ul class="menu-list">
                    
                        <li class="menu-item">
                            <a class=""
                               href="/"
                            >
                                首页
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/archives"
                            >
                                归档
                            </a>
                        </li>
                    
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="fas fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/">首页</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/archives">归档</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle">

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    <div class="article-content-container">

        <div class="article-title">
            <span class="title-hover-animation">8086汇编-子程序设计</span>
        </div>

        
            <div class="article-header">
                <div class="avatar">
                    <img src="/images/logo.jpg">
                </div>
                <div class="info">
                    <div class="author">
                        <span class="name">9unk</span>
                        
                            <span class="author-label">Lv5</span>
                        
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fas fa-edit"></i>&nbsp;
        <span class="pc">2022-08-16 21:53:00</span>
        <span class="mobile">2022-08-16 21:53</span>
    </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fas fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/%E6%B1%87%E7%BC%96/">汇编</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
        <span class="article-wordcount article-meta-item">
            <i class="fas fa-file-word"></i>&nbsp;<span>16.7k 字</span>
        </span>
    
    
        <span class="article-min2read article-meta-item">
            <i class="fas fa-clock"></i>&nbsp;<span>73 分钟</span>
        </span>
    
    
</div>

                    </div>
                </div>
            </div>
        

        <div class="article-content markdown-body">
            <h1 id="子程序设计"><a href="#子程序设计" class="headerlink" title="子程序设计"></a>子程序设计</h1><p>当某个程序片段需要反复使用、或是具有通用性可以在多个程序中使用，我们就需要把这段代码设计为子程序。这样能用小缩短程序地长度，节约存储空间，减少程序设计地工作量。此外当某个程序片段地功能相对独立时，可以把它设计成子程序，这样便于模块化，也比那与程序地阅读、调试和修改。</p>
<h2 id="过程调用和返回指令"><a href="#过程调用和返回指令" class="headerlink" title="过程调用和返回指令"></a>过程调用和返回指令</h2><ol>
<li>过程调用（call）指令和过程返回（ret）指令属于程序控制指令。通常，过程调用指令用于由主程序转子程序，过程返回指令用于由子程序返回主程序。</li>
<li>过程调用指令，可以像无条件跳转指令一样进行跳转，且过程调用指令有段内调用和段间调用之分。与之相对应的。过程返回指令也有段内跳转和段间跳转。</li>
<li>段内调用和段内返回称为近调用和近返回，段间调用和段间返回称为远调用和远返回</li>
<li>在汇编语言中，过程也有远近之分。</li>
</ol>
<h3 id="过程调用指令"><a href="#过程调用指令" class="headerlink" title="过程调用指令"></a>过程调用指令</h3><ol>
<li>过程调用指令，首先把子程序的返回地址压入堆栈，以便执行完子程序后返回调用程序（主程序）继续往下执行。</li>
<li>按照转移目标是否是同一段来分，地址用指令分为段内调用和段间调用。</li>
<li>按照获得转移目标地址的方式来分，调用指令分为直接调用和间接调用。</li>
<li>过程调用指令不影响标志位。</li>
</ol>
<h4 id="段内直接调用"><a href="#段内直接调用" class="headerlink" title="段内直接调用"></a>段内直接调用</h4><p>段内直接调用指令用于调用当前段内的子程序，格式如下：<br>call 过程名（标号）</p>
<p>例如：<br>call sub1</p>
<p>这条指令相当于</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">push &quot;call sub1的下一条指令的偏移地址&quot;</span><br><span class="line">jmp sub1</span><br></pre></td></tr></table></figure>

<p>具体的操作分解如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sp &lt;= sp-2  ;提高栈顶</span><br><span class="line">[sp] &lt;= IP  ;call xxx的下一条指令的偏移地址。</span><br><span class="line">IP &lt;= IP+disp</span><br></pre></td></tr></table></figure>

<ol>
<li>call指令所在的偏移地址是，子程序的起始地址；</li>
<li>call 下面一条指令的偏移地址是，子程序的结束地址;</li>
<li>disp&#x3D;结束地址-起始地址。</li>
<li>段内直接调用指令中，是以一个字表示disp，所以转移范围在 -32768~+32767 之间。</li>
</ol>
<p><strong>总结验证</strong></p>
<blockquote>
<p>起始地址：076B:0008<br> 结束地址：076B:000B<br> disp&#x3D;3</p>
</blockquote>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/185186188-38f1f346-d227-4bd1-acae-609c3afceecc.png"
                      alt="图片"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/185191116-6761fb8c-f7b9-47ea-8c2d-786ff8b1e779.png"
                      alt="图片"
                ></p>
<p>从上图中可以看到，call 指令执行前 sp&#x3D;0000，指令执行之后 sp&#x3D;sp-2&#x3D;FFFE。内存中存储偏移地址 000B&#x3D;起始IP + disp&#x3D;0008+3。还需要注意一下，这里 IP寄存器 修改成了 0016</p>
<h4 id="段内间接转移"><a href="#段内间接转移" class="headerlink" title="段内间接转移"></a>段内间接转移</h4><p>段内间接转移格式如下：<br>call OPRD</p>
<p>例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">call BX</span><br><span class="line">call word ptr [bx]</span><br><span class="line">call varw   ;varw 字变量</span><br></pre></td></tr></table></figure>

<p>OPRD 是16位通用寄存器或字存储器操作数，具体操作分解如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sp &lt;= sp-2</span><br><span class="line">[sp] &lt;= IP</span><br><span class="line">IP &lt;= OPRD</span><br></pre></td></tr></table></figure>

<p><strong>总结验证</strong><br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/185667049-f1ebf52f-3936-46dc-8490-0a87d3c9fdbe.png"
                      alt="图片"
                ></p>
<h4 id="段间直接调用"><a href="#段间直接调用" class="headerlink" title="段间直接调用"></a>段间直接调用</h4><p>段间直接调用，用于调用其他代码段中的子程序。格式如下：<br><code>call 过程名（标号）</code></p>
<p>例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">call far ptr SUBRO</span><br><span class="line">call SUBF</span><br></pre></td></tr></table></figure>

<p>该指令把返回地址的段值压入堆栈，再把返回地址的偏移压入堆栈，达到保存返回地址的目的。</p>
<p>具体操作分解如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sp &lt;= sp-2</span><br><span class="line">[sp] &lt;= cs</span><br><span class="line">sp &lt;= sp-2</span><br><span class="line">[sp] &lt;= IP</span><br><span class="line">IP &lt;= 子程序的偏移地址</span><br><span class="line">CS &lt;= 子程序的代码段地址</span><br></pre></td></tr></table></figure>

<p><strong>总结验证</strong><br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/185669832-98db5bd0-7e7e-4993-a483-7a1f94cd2675.png"
                      alt="图片"
                ></p>
<blockquote>
<p>可以看到，远跳转的 call 指令，后面的地址是 “CS:IP”。堆栈中存放的也是 “CS:IP”</p>
</blockquote>
<h4 id="段间间接调用"><a href="#段间间接调用" class="headerlink" title="段间间接调用"></a>段间间接调用</h4><p>段间间接调用指令也用于调用其他代码段中的子程序。格式如下：<br><code>call OPRD</code><br>OPRD 是双字存储器操作数</p>
<p>具体操作分解如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sp &lt;= sp-2</span><br><span class="line">[sp] &lt;= cs</span><br><span class="line">sp &lt;= sp-2</span><br><span class="line">[sp] &lt;= IP</span><br><span class="line">IP &lt;= OPRD 的低字</span><br><span class="line">CS &lt;= OPRD 的高字</span><br></pre></td></tr></table></figure>

<p>例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">call DWORD PTR [bx]</span><br><span class="line">call VARD</span><br></pre></td></tr></table></figure>

<p><strong>总结验证</strong><br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/185675073-0a852913-257f-4792-9f1a-096527503f88.png"
                      alt="图片"
                ></p>
<blockquote>
<p>可以看到，变量类型只要是 dd 就行，当编译程序时会自动加上 far 属性。</p>
</blockquote>
<h3 id="过程返回指令"><a href="#过程返回指令" class="headerlink" title="过程返回指令"></a>过程返回指令</h3><p>过程返回指令把子程序的返回地址从堆栈弹出到 <code>IP</code> 或 <code>CS:IP</code>，从而返回到主程序继续我往下执行。过程返回指令不影响标志位。</p>
<h4 id="段内返回指令"><a href="#段内返回指令" class="headerlink" title="段内返回指令"></a>段内返回指令</h4><p>指令格式如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ret</span><br></pre></td></tr></table></figure>

<p>该指令完成的具体操作如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">IP &lt;= [SP]</span><br><span class="line">SP &lt;= SP+2</span><br></pre></td></tr></table></figure>

<p><strong>总结验证</strong><br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/185675073-0a852913-257f-4792-9f1a-096527503f88.png"
                      alt="图片"
                ></p>
<h4 id="段间返回指令"><a href="#段间返回指令" class="headerlink" title="段间返回指令"></a>段间返回指令</h4><p>指令格式如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ret</span><br></pre></td></tr></table></figure>

<p>该指令完成的具体操作如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">IP &lt;= [SP]</span><br><span class="line">SP &lt;= SP+2</span><br><span class="line">CS &lt;= [SP]</span><br><span class="line">SP &lt;= SP+2</span><br></pre></td></tr></table></figure>

<p><strong>总结验证</strong><br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/185728900-68aa2cac-c703-4721-9b53-914129b5cbe4.png"
                      alt="图片"
                ></p>
<blockquote>
<p>编译器自动把 RET 编译成另一个段间返回指令 RETF 。</p>
</blockquote>
<p><strong>段间返回指令 RETF</strong></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/185730402-94d30c58-d64b-4b24-a584-e6e96d839aca.png"
                      alt="图片"
                ><br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/185730489-4963f55f-02d5-4fc3-818d-23462fd285f1.png"
                      alt="图片"
                ></p>
<blockquote>
<p>可以看到我们使用段内 call 指令调用子程序，但使用的是 RETF 返回，导致程序返回出错。</p>
</blockquote>
<p>无论 RETF 出现在远过程还是近过程中，编译器总是会把它编译成段间返回指令。</p>
<h4 id="返回指令-立即数"><a href="#返回指令-立即数" class="headerlink" title="返回指令+立即数"></a>返回指令+立即数</h4><p>指令格式如下：<br><code>ret 表达式</code></p>
<blockquote>
<p>汇编程序会把表达式的结果取整。</p>
</blockquote>
<p>该指令会先弹出 “一个字” 或是 “双字” 作为返回地址，再根据 data 修改堆栈指针。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/185730918-37368f3d-b1d0-4b06-9507-2eb56ba9ac77.png"
                      alt="图片"
                ></p>
<blockquote>
<p>可以看到上面 <code>ret 4</code> 是吧 SP 寄存器改为了 4</p>
</blockquote>
<h2 id="过程定义语句"><a href="#过程定义语句" class="headerlink" title="过程定义语句"></a>过程定义语句</h2><p>过程定义语句（子程序定义语句），可把子程序起名，并且定义近类型或远类型。过程定义语句的格式如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">过程名 PROC [NEAR | FAR]</span><br><span class="line">    .</span><br><span class="line">    .</span><br><span class="line">    .</span><br><span class="line">过程名  ENDP</span><br></pre></td></tr></table></figure>
<blockquote>
<p>过程定义语句中，过程名必须要一致。现阶段程序的代码比较少，基本都使用 NEAR 属性。后面程序的代码多的时候，使用 FAR 属性会比较方便。</p>
</blockquote>
<h3 id="范例"><a href="#范例" class="headerlink" title="范例"></a>范例</h3><p>把一个十六进制数转换为对应 ASCII 码</p>
<h4 id="程序逻辑结构图"><a href="#程序逻辑结构图" class="headerlink" title="程序逻辑结构图"></a>程序逻辑结构图</h4><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/185746886-6cc547a1-ef79-4ad7-8d29-aa358bfab30f.png"
                      alt="HTOASC"
                ></p>
<h4 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">;程序名：HTOASC.asm</span><br><span class="line">;功能：实现把一个十六进制数转换为对应的 ASCII 码的程序。</span><br><span class="line">;方法一：分开计算，数字+30h，字母+37h</span><br><span class="line">assume ds:data,cs:code</span><br><span class="line"></span><br><span class="line">data segment</span><br><span class="line">number db 0Fh</span><br><span class="line">data ends</span><br><span class="line"></span><br><span class="line">code segment</span><br><span class="line">start:</span><br><span class="line">    mov ax,data</span><br><span class="line">    mov ds,ax</span><br><span class="line">    ;</span><br><span class="line">    mov al,number</span><br><span class="line">    call HTOASC</span><br><span class="line">    mov dl,al</span><br><span class="line">    mov ah,2</span><br><span class="line">    int 21h</span><br><span class="line">    mov ax,4c00h</span><br><span class="line">    int 21h</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">;-----------------------------------------------------</span><br><span class="line">HTOASC PROC NEAR</span><br><span class="line">;</span><br><span class="line">; 功能：把一个十六进制数转换为对应的 ASCII 码</span><br><span class="line">; 传参方式：寄存器传参</span><br><span class="line">; 入口参数：al</span><br><span class="line">; 出口参数：al</span><br><span class="line">;-----------------------------------------------------</span><br><span class="line">    pushf</span><br><span class="line">    and al,0fh</span><br><span class="line">    cmp al,0ah</span><br><span class="line">    jb num_add</span><br><span class="line">    add al,37h</span><br><span class="line">    jmp return</span><br><span class="line">num_add:</span><br><span class="line">    add al,30h</span><br><span class="line">return:</span><br><span class="line">    popf</span><br><span class="line">    ret</span><br><span class="line">HTOASC endp</span><br><span class="line">code ends</span><br><span class="line">end start</span><br></pre></td></tr></table></figure>

<h2 id="子程序举例"><a href="#子程序举例" class="headerlink" title="子程序举例"></a>子程序举例</h2><h3 id="例1"><a href="#例1" class="headerlink" title="例1"></a>例1</h3><p>把用ASCII码表示的两位十进制数，转换为对应的十进制数的子程序。设X为十位数，Y为个位数</p>
<h4 id="程序流程图"><a href="#程序流程图" class="headerlink" title="程序流程图"></a>程序流程图</h4><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/185761096-f8bf1c03-bffb-42c8-9b11-4a0e3d4c72d8.png"
                      alt="T4-1"
                ></p>
<h4 id="代码-1"><a href="#代码-1" class="headerlink" title="代码"></a>代码</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">;程序名：T4-1.asm</span><br><span class="line">;作者：啥都不会</span><br><span class="line">;创建日期：2022/3/14</span><br><span class="line">;修改日期：					修改者：</span><br><span class="line">;子程序名：subr</span><br><span class="line">;程序的描述：把用ASCII码表示的两位十进制数，转换为对应的十进制数的子程序。设X为十位数，Y为个位数</span><br><span class="line">;算法：10X+y</span><br><span class="line">;=============================================================================================</span><br><span class="line"></span><br><span class="line">assume cs:code,ds:data</span><br><span class="line"></span><br><span class="line">data segment</span><br><span class="line">    num db 31h,30h</span><br><span class="line">    val db ?</span><br><span class="line">data ends</span><br><span class="line"></span><br><span class="line">code segment</span><br><span class="line">start:</span><br><span class="line">    mov ax,data</span><br><span class="line">    mov ds,ax</span><br><span class="line">    ;</span><br><span class="line">    mov dh,num[0]</span><br><span class="line">    mov dl,num[1]</span><br><span class="line">    call subr</span><br><span class="line">    mov val,al</span><br><span class="line">stop:</span><br><span class="line">    mov ax,4c00h</span><br><span class="line">    int 21h</span><br><span class="line">;-----------------------------------------------------</span><br><span class="line">subr PROC</span><br><span class="line">;</span><br><span class="line">; 功能：两位ASCII码组成的十进制数，转换成十进制数</span><br><span class="line">; 传参方式：寄存器传参</span><br><span class="line">; 入口参数：dh高位、dl低位</span><br><span class="line">; 出口参数：al</span><br><span class="line">;-----------------------------------------------------</span><br><span class="line">    mov al,dh</span><br><span class="line">    and al,0fh</span><br><span class="line">    mov ah,10</span><br><span class="line">    mul ah</span><br><span class="line">    mov ah,dl</span><br><span class="line">    and ah,0fh</span><br><span class="line">    add al,ah</span><br><span class="line">    ret</span><br><span class="line">subr endp</span><br><span class="line">code ends</span><br><span class="line">end start</span><br></pre></td></tr></table></figure>

<h3 id="例2"><a href="#例2" class="headerlink" title="例2"></a>例2</h3><h4 id="程序流程图-1"><a href="#程序流程图-1" class="headerlink" title="程序流程图"></a>程序流程图</h4><ol>
<li><p>2-1<br>写一个把一个字大小的16进制数，转换成4个ASCII码的子程序<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/185780562-ea3e4e38-d01a-44bf-96f7-5be109327354.png"
                      alt="T4-2"
                ></p>
</li>
<li><p>2-2<br>利用子程序 HTASCS 按十六进制数形式显示地址为 F000:0000H 的字单元内容<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/185782043-520cab69-a4f3-40b0-935d-825e6b3ff03a.png"
                      alt="T4-2 - 2"
                ></p>
</li>
</ol>
<h4 id="代码-2"><a href="#代码-2" class="headerlink" title="代码"></a>代码</h4><ol>
<li><p>T4-2-1.asm</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">;程序名：T4-2-1.asm</span><br><span class="line">;作者：啥都不会</span><br><span class="line">;创建日期：2022/3/14</span><br><span class="line">;修改日期：					修改者：</span><br><span class="line">;子程序名：htascs</span><br><span class="line">;程序的描述：写一个把一个字大小的16进制数，转换成4个ASCII码</span><br><span class="line">;算法：把16进制数向左循环移位4次，使高四位变为低四位，</span><br><span class="line">;析出低四位调用子程序 htoasc 转换 1 位十六进制 ASCII 码，循环四次</span><br><span class="line">;优化：直接循环输出结果</span><br><span class="line">;=============================================================================================</span><br><span class="line">assume cs:code,ds:data</span><br><span class="line"></span><br><span class="line">data segment</span><br><span class="line">num dw 1234h</span><br><span class="line">data ends</span><br><span class="line"></span><br><span class="line">code segment</span><br><span class="line">start:</span><br><span class="line">    mov ax,data</span><br><span class="line">    mov ds,ax</span><br><span class="line">    ;</span><br><span class="line">    mov bx,num</span><br><span class="line">    call htascs</span><br><span class="line">    ;</span><br><span class="line">    mov ax,4c00h</span><br><span class="line">    int 21h</span><br><span class="line"></span><br><span class="line">;-----------------------------------------------------</span><br><span class="line">htascs PROC</span><br><span class="line">;</span><br><span class="line">; 功能：把一个字大小的16进制数，转换成4个ASCII码</span><br><span class="line">; 传参方式：寄存器传参</span><br><span class="line">; 入口参数：BX数值</span><br><span class="line">; 出口参数：无</span><br><span class="line">; 说    明：调用子函数 htascs</span><br><span class="line">;-----------------------------------------------------</span><br><span class="line">    mov cx,4</span><br><span class="line">htascs1:</span><br><span class="line">    ROL BX,1</span><br><span class="line">    ROL BX,1</span><br><span class="line">    ROL BX,1</span><br><span class="line">    ROL BX,1</span><br><span class="line">    mov al,bl</span><br><span class="line">    call HTOASC</span><br><span class="line">    mov dl,al</span><br><span class="line">    mov ah,2</span><br><span class="line">    int 21h</span><br><span class="line">    loop htascs1</span><br><span class="line">    ret</span><br><span class="line">htascs endp</span><br><span class="line"></span><br><span class="line">;-----------------------------------------------------</span><br><span class="line">HTOASC PROC NEAR</span><br><span class="line">;</span><br><span class="line">; 功能：把一个十六进制数转换为对应的 ASCII 码</span><br><span class="line">; 传参方式：寄存器传参</span><br><span class="line">; 入口参数：al</span><br><span class="line">; 出口参数：al</span><br><span class="line">;-----------------------------------------------------</span><br><span class="line">    pushf</span><br><span class="line">    and al,0fh</span><br><span class="line">    cmp al,0ah</span><br><span class="line">    jb num_add</span><br><span class="line">    add al,37h</span><br><span class="line">    jmp return</span><br><span class="line">num_add:</span><br><span class="line">    add al,30h</span><br><span class="line">return:</span><br><span class="line">    popf</span><br><span class="line">    ret</span><br><span class="line">HTOASC endp</span><br><span class="line">code ends</span><br><span class="line">end start</span><br></pre></td></tr></table></figure>
</li>
<li><p>T4-2-2.asm</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">;程序名：T4-2-2.asm</span><br><span class="line">;利用子程序 HTASCS 按十六进制数形式显示地址为 F000:0000H 的字单元内容</span><br><span class="line">assume cs:code</span><br><span class="line"></span><br><span class="line">code segment</span><br><span class="line">start:</span><br><span class="line">    mov ax,0f000h</span><br><span class="line">    mov ds,ax</span><br><span class="line">    ;</span><br><span class="line">    mov bx,[si]</span><br><span class="line">    call HTASCS</span><br><span class="line">    mov ax,4c00h</span><br><span class="line">    int 21h</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">;-----------------------------------------------------</span><br><span class="line">HTASCS PROC</span><br><span class="line">;</span><br><span class="line">; 功能：把一个字大小的16进制数，转换成4个ASCII码</span><br><span class="line">; 传参方式：寄存器传参</span><br><span class="line">; 入口参数：dx</span><br><span class="line">; 出口参数：DS:BX存储所得ASCII码串的缓冲区首地址</span><br><span class="line">;-----------------------------------------------------</span><br><span class="line">    mov cx,4</span><br><span class="line">HTASCS1:</span><br><span class="line">    ROL BX,1</span><br><span class="line">    ROL BX,1</span><br><span class="line">    ROL BX,1</span><br><span class="line">    ROL BX,1</span><br><span class="line">    mov al,dl</span><br><span class="line">    call HTOASC</span><br><span class="line">    mov dl,al</span><br><span class="line">    mov ah,2</span><br><span class="line">    int 21h</span><br><span class="line">    loop HTASCS1</span><br><span class="line">    ret</span><br><span class="line">HTASCS endp</span><br><span class="line"></span><br><span class="line">;-----------------------------------------------------</span><br><span class="line">HTOASC PROC NEAR</span><br><span class="line">;</span><br><span class="line">; 功能：把一个十六进制数转换为对应的 ASCII 码</span><br><span class="line">; 传参方式：寄存器传参</span><br><span class="line">; 入口参数：al</span><br><span class="line">; 出口参数：al</span><br><span class="line">;-----------------------------------------------------</span><br><span class="line">    pushf</span><br><span class="line">    and al,0fh</span><br><span class="line">    cmp al,0ah</span><br><span class="line">    jb num_add</span><br><span class="line">    add al,37h</span><br><span class="line">    jmp pop_stack</span><br><span class="line">num_add:</span><br><span class="line">    add al,30h</span><br><span class="line">pop_stack:</span><br><span class="line">    popf</span><br><span class="line">    ret</span><br><span class="line">HTOASC endp</span><br><span class="line">code ends</span><br><span class="line">end start</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="例3"><a href="#例3" class="headerlink" title="例3"></a>例3</h3><h4 id="程序流程图-2"><a href="#程序流程图-2" class="headerlink" title="程序流程图"></a>程序流程图</h4><ol>
<li><p>T4-3-1<br>把T3-11.asm改写成子程序，写一个把16位二进制数转换为5位十进制数ASCII码的子程序，为了简单，设二进制数为无符号数。</p>
<blockquote>
<p>例3的逻辑结构和 T3-11-2 是一样的，这里就不再画了</p>
</blockquote>
</li>
<li><p>T4-3-2<br>把8位二进制数转换为2位十六进制数的 ASCII 码<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/185801085-a7b55c88-f30c-4ab0-a400-0d8884c65f6c.png"
                      alt="T4-3-2"
                ></p>
</li>
</ol>
<h4 id="代码-3"><a href="#代码-3" class="headerlink" title="代码"></a>代码</h4><ol>
<li><p>T4-3-1</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">;程序名：T4-3-1.asm</span><br><span class="line">;功能：写一个把16位二进制数转换为5位十进制数ASCII码的子程序，为了简单二进制数为无符号数。把T3-11.asm改写成子程序。</span><br><span class="line"></span><br><span class="line">assume cs:code,ds:data</span><br><span class="line"></span><br><span class="line">data segment</span><br><span class="line">number dw 0AECFh</span><br><span class="line">result db 0,0,0,0,0,&#x27;$&#x27;</span><br><span class="line">data ends</span><br><span class="line"></span><br><span class="line">code segment</span><br><span class="line">start:</span><br><span class="line">    mov ax,data</span><br><span class="line">    mov ds,ax</span><br><span class="line">    ;</span><br><span class="line">    mov ax,number</span><br><span class="line">    lea si,result</span><br><span class="line">    call BTOASC</span><br><span class="line">    lea dx,[si]</span><br><span class="line">    mov ah,9</span><br><span class="line">    int 21h</span><br><span class="line">    ;</span><br><span class="line">    mov ax,4c00h</span><br><span class="line">    int 21h</span><br><span class="line"></span><br><span class="line">;-----------------------------------------------------</span><br><span class="line">BTOASC PROC</span><br><span class="line">;</span><br><span class="line">; 功能：把16位二进制数转换为5位十进制数</span><br><span class="line">; 传参方式：寄存器传参</span><br><span class="line">; 入口参数：AX=要转换的值、SI=存储结果的缓冲区首地址</span><br><span class="line">; 出口参数：DS:SI存储所得ASCII码串的缓冲区首地址</span><br><span class="line">;-----------------------------------------------------</span><br><span class="line">    mov di,5</span><br><span class="line">    mov cx,10</span><br><span class="line">L1:</span><br><span class="line">    xor dx,dx</span><br><span class="line">    div cx</span><br><span class="line">    add dl,30h</span><br><span class="line">    mov result[di-1],dl     ;用di判断循环，但是存储结果di需要减1</span><br><span class="line">    dec di</span><br><span class="line">    jnz L1</span><br><span class="line">    ;函数返回</span><br><span class="line">    ret</span><br><span class="line">BTOASC endp</span><br><span class="line">code ends</span><br><span class="line">end start</span><br></pre></td></tr></table></figure>
</li>
<li><p>T4-3-2</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">;程序名：T4-3-2.asm</span><br><span class="line">;功能：把8位二进制数转换为2位十六进制数的 ASCII 码</span><br><span class="line">assume cs:code,ds:data</span><br><span class="line">data segment</span><br><span class="line">char db 0abh</span><br><span class="line">data ends</span><br><span class="line"></span><br><span class="line">code segment</span><br><span class="line">start:</span><br><span class="line">    mov ax,data</span><br><span class="line">    mov ds,ax</span><br><span class="line">    ;</span><br><span class="line">    mov al,char</span><br><span class="line">    call WHTOASC</span><br><span class="line">    ;</span><br><span class="line">    mov cx,2</span><br><span class="line">    mov dx,ax</span><br><span class="line">L1:</span><br><span class="line">    xchg dh,dl</span><br><span class="line">    mov ah,2</span><br><span class="line">    int 21h</span><br><span class="line">    loop L1</span><br><span class="line">    ;</span><br><span class="line">    mov ax,4c00h</span><br><span class="line">    int 21h</span><br><span class="line">;-----------------------------------------------------</span><br><span class="line">WHTOASC PROC</span><br><span class="line">;</span><br><span class="line">; 功能：把8位二进制数转换为2位 ASCII 码</span><br><span class="line">; 传参方式：寄存器传参</span><br><span class="line">; 入口参数：AL=要转换的值</span><br><span class="line">; 出口参数：AH = 十六进制数高位的 ASCII 码</span><br><span class="line">;           AL = 十六进制数低位的 ASCII 码</span><br><span class="line">;其他说明：(1)近过程</span><br><span class="line">;          (2)除 AX 寄存器外,不影响其他寄存器</span><br><span class="line">;          (3)调用HTOASC 实现十六进制数到ASCII码的转换</span><br><span class="line">;-----------------------------------------------------</span><br><span class="line">    mov ah,al</span><br><span class="line">    shr al,1</span><br><span class="line">    shr al,1</span><br><span class="line">    shr al,1</span><br><span class="line">    shr al,1</span><br><span class="line">    call HTOASC</span><br><span class="line">    xchg ah,al</span><br><span class="line">    call HTOASC</span><br><span class="line">    ret</span><br><span class="line">WHTOASC endp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">;-----------------------------------------------------</span><br><span class="line">HTOASC PROC NEAR</span><br><span class="line">;</span><br><span class="line">; 功能：把一位十六进制数转换为对应的 ASCII 码</span><br><span class="line">; 传参方式：寄存器传参</span><br><span class="line">; 入口参数：al</span><br><span class="line">; 出口参数：al</span><br><span class="line">;-----------------------------------------------------</span><br><span class="line">    pushf</span><br><span class="line">    and al,0fh</span><br><span class="line">    cmp al,0ah</span><br><span class="line">    jb num_add</span><br><span class="line">    add al,37h</span><br><span class="line">    jmp pop_stack</span><br><span class="line">num_add:</span><br><span class="line">    add al,30h</span><br><span class="line">pop_stack:</span><br><span class="line">    popf</span><br><span class="line">    ret</span><br><span class="line">HTOASC endp</span><br><span class="line"></span><br><span class="line">code ends</span><br><span class="line">end start</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="寄存器的保护与恢复"><a href="#寄存器的保护与恢复" class="headerlink" title="寄存器的保护与恢复"></a>寄存器的保护与恢复</h3><p>子程序为了完成其功能，通常需要使用一些寄存器或存储单元存放内容。也就是说，子程序运行时通常会破坏寄存器的数据。所以在调用子程序时，我们还需要将，可能破坏的寄存器数据进行保护与恢复。</p>
<p><strong>寄存器保护与恢复的方法：</strong><br>在子程序一开始就把子程序中要改变的寄存器内容压入堆栈，在返回之前再恢复这些寄存器的内容。如下图所示：<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/192127943-a0efabbb-2b22-4513-8fb9-46a9e6db433b.png"
                      alt="图片"
                ></p>
<p>同时还要注意：子程序运行时，会影响到标志寄存器。因此有时我们还需要保护标志寄存器。指令如下：</p>
<p>pushf（保护标志寄存器）<br>popf（恢复标志寄存器）</p>
<h1 id="主程序与子程序之间的参数传递"><a href="#主程序与子程序之间的参数传递" class="headerlink" title="主程序与子程序之间的参数传递"></a>主程序与子程序之间的参数传递</h1><p>主程序在调用子程序时，通常需要向子程序传递参数（类似函数的参数）；同样，子程序运行后也经常要把一些结果参数传给主程序（类似函数的返回值）。主程序与子程序之间的这种信息传递称为参数传递。</p>
<ol>
<li>由主程序传递给子程序的参数称为子程序的入口参数</li>
<li>由子程序传给主程序的参数称为子程序的出口参数</li>
<li>子程序可以有入口参数，有出口参数；有入口参数，无出口参数；无入口参数，有出口参数</li>
</ol>
<p>参数传递的方法分别有：寄存器传递法、内存单元传递法、堆栈传递法和call 后续区传递法等。</p>
<blockquote>
<p>说到底，只要子程序能定位到参数在哪，就可以用这种方法传递参数。以上这些方法的区别在于，使用寄存器传递法的子程序，比使用其他参数方法的速度要快。</p>
</blockquote>
<h2 id="寄存器参数传递法"><a href="#寄存器参数传递法" class="headerlink" title="寄存器参数传递法"></a>寄存器参数传递法</h2><p>利用寄存器传递参数就是把参数放在约定的寄存器中。<br>优点：实现简单、调用方便。<br>缺点：因为寄存器个数有限，且寄存器还要存放其他数据，所以只适用于传递参数较少的情况</p>
<h3 id="例1-1"><a href="#例1-1" class="headerlink" title="例1"></a>例1</h3><h4 id="程序流程图-3"><a href="#程序流程图-3" class="headerlink" title="程序流程图"></a>程序流程图</h4><ol>
<li><p>T4-4<br>写一个 把大写字母改为小写字母的子程序。<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/186200621-5dcdb8cd-085c-423d-9f69-e1f99a3e6d3f.png"
                      alt="T4-4"
                ></p>
</li>
<li><p>T4-4-1<br>写一个把大写字母的字符串更改为小写字母的子程序。<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/186224985-1309de5b-f606-4c1d-a986-d17ebc60e100.png"
                      alt="T4-4-1"
                ></p>
</li>
</ol>
<h4 id="代码-4"><a href="#代码-4" class="headerlink" title="代码"></a>代码</h4><ol>
<li><p>T4-4.asm</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">;程序名：T4-5.asm</span><br><span class="line">;功能：写一个把一个大写字母更改为小写字母的子程序。</span><br><span class="line">;子程序名：UPTOLW</span><br><span class="line">assume cs:code,ds:data</span><br><span class="line"></span><br><span class="line">data segment</span><br><span class="line">char db &#x27;H&#x27;</span><br><span class="line">data ends</span><br><span class="line"></span><br><span class="line">code segment</span><br><span class="line">start:</span><br><span class="line">    mov ax,data</span><br><span class="line">    mov ds,ax</span><br><span class="line">    ;</span><br><span class="line">    mov al,char</span><br><span class="line">    call UPTOLW</span><br><span class="line">    ;</span><br><span class="line">    mov dl,al</span><br><span class="line">    mov ah,2</span><br><span class="line">    int 21h</span><br><span class="line">    ;</span><br><span class="line">    mov ax,4c00h</span><br><span class="line">    int 21h</span><br><span class="line"></span><br><span class="line">;-----------------------------------------------------</span><br><span class="line">UPTOLW PROC</span><br><span class="line">;</span><br><span class="line">; 功能：把一个大写字母更改为小写字母,其他字符不变</span><br><span class="line">; 传参方式：寄存器传参</span><br><span class="line">; 入口参数：AL=字符ASCII码</span><br><span class="line">; 出口参数：AL=字符ASCII码</span><br><span class="line">;-----------------------------------------------------</span><br><span class="line">    pushf</span><br><span class="line">    cmp al,&#x27;A&#x27;</span><br><span class="line">    jb UPTOLW1</span><br><span class="line">    cmp al,&#x27;Z&#x27;</span><br><span class="line">    JA UPTOLW1</span><br><span class="line">    add al,&#x27;a&#x27;-&#x27;A&#x27;</span><br><span class="line">    ;</span><br><span class="line">UPTOLW1:</span><br><span class="line">    popf</span><br><span class="line">    ret</span><br><span class="line">UPTOLW endp</span><br><span class="line">code ends</span><br><span class="line">end start</span><br></pre></td></tr></table></figure>
</li>
<li><p>T4-4-1.asm</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">;程序名：T4-4-1.asm</span><br><span class="line">;功能：写一个把大写字母的字符串更改为小写字母的子程序。</span><br><span class="line">;子程序名：UPTOLWS</span><br><span class="line">assume cs:code,ds:data</span><br><span class="line"></span><br><span class="line">data segment</span><br><span class="line">char db &#x27;HELLO&#x27;,0,0dh,0ah,&#x27;$&#x27;</span><br><span class="line">data ends</span><br><span class="line"></span><br><span class="line">code segment</span><br><span class="line">start:</span><br><span class="line">    mov ax,data</span><br><span class="line">    mov ds,ax</span><br><span class="line">    ;</span><br><span class="line">    lea si,char</span><br><span class="line">    call UPTOLWS</span><br><span class="line">    ;</span><br><span class="line">    mov dx,si</span><br><span class="line">    mov ah,9</span><br><span class="line">    int 21h</span><br><span class="line">    ;</span><br><span class="line">    mov ax,4c00h</span><br><span class="line">    int 21h</span><br><span class="line"></span><br><span class="line">;-----------------------------------------------------</span><br><span class="line">UPTOLWS PROC</span><br><span class="line">;</span><br><span class="line">; 功能：把一串大写字母更改为小写字母,其他字符不变</span><br><span class="line">; 传参方式：寄存器传参</span><br><span class="line">; 入口参数：SI=要转换字符的首地址</span><br><span class="line">; 出口参数：DS:SI存储所得ASCII码串的缓冲区首地址</span><br><span class="line">;-----------------------------------------------------</span><br><span class="line">    pushf</span><br><span class="line">    push ax</span><br><span class="line">    push cx</span><br><span class="line">    push si</span><br><span class="line">    ;</span><br><span class="line">    xor cx,cx</span><br><span class="line">L1:</span><br><span class="line">    inc si</span><br><span class="line">    inc cx</span><br><span class="line">    mov al,byte ptr [si-1]</span><br><span class="line">    cmp al,0</span><br><span class="line">    jz UPTOLW_POP</span><br><span class="line">    cmp al,&#x27;A&#x27;</span><br><span class="line">    jb UPTOLW_POP</span><br><span class="line">    cmp al,&#x27;Z&#x27;</span><br><span class="line">    ja UPTOLW_POP</span><br><span class="line">    ;</span><br><span class="line">    add al,20h</span><br><span class="line">    mov byte ptr [si-1],al</span><br><span class="line">    jmp L1</span><br><span class="line"></span><br><span class="line">UPTOLW_POP:  </span><br><span class="line">    pop si</span><br><span class="line">    pop cx</span><br><span class="line">    pop ax</span><br><span class="line">    popf</span><br><span class="line">    ;</span><br><span class="line">    ret</span><br><span class="line">UPTOLWS endp</span><br><span class="line">code ends</span><br><span class="line">end start</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="例2-1"><a href="#例2-1" class="headerlink" title="例2"></a>例2</h3><p>写一个判别字符是否为数字的子程序。并利用该子程序把一个字符出串中的所有数字字符删除。</p>
<h4 id="程序流程图-4"><a href="#程序流程图-4" class="headerlink" title="程序流程图"></a>程序流程图</h4><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/186377272-581b5fdc-eb04-478a-abcf-2c6ff1193cc4.png"
                      alt="T4-6"
                ></p>
<h4 id="代码-5"><a href="#代码-5" class="headerlink" title="代码"></a>代码</h4><ol>
<li><p>T4-5</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">;程序名：T4-5.asm</span><br><span class="line">;功能：写一个判别字符是否为数字的子程序。并利用该子程序把一个字符出串中的所有数字字符删除。</span><br><span class="line">;子程序名：ISDECM</span><br><span class="line">;处理方法：循环处理字符并复制到缓冲区中。缺点：多了复制字符的步骤。优点：准确性高</span><br><span class="line">assume cs:code,ds:data</span><br><span class="line">data segment</span><br><span class="line">string db &#x27;H1E2L3L4L5O&#x27;,0</span><br><span class="line">count dw $ - 1                  ;当前的偏移地址($)-1：表示字符串 string 的长度。</span><br><span class="line">result db 10 dup(0),0dh,0ah,&#x27;$&#x27;</span><br><span class="line">data ends</span><br><span class="line"></span><br><span class="line">code segment</span><br><span class="line">start:</span><br><span class="line">    mov ax,data</span><br><span class="line">    mov ds,ax</span><br><span class="line">    ;</span><br><span class="line">    mov cx,count</span><br><span class="line">L1:</span><br><span class="line">    mov al,string[si]</span><br><span class="line">    call ISDECM</span><br><span class="line">    inc si              ;inc 指令不影响 CF 位，所以不影响程序运行结果</span><br><span class="line">    jc L2</span><br><span class="line">    loop L1</span><br><span class="line">    jmp stop</span><br><span class="line">L2:</span><br><span class="line">    mov result[di],al   ;di 寄存器的默认值是0，且默认使用 ds 段寄存器</span><br><span class="line">    inc di</span><br><span class="line">    cmp cx,0</span><br><span class="line">    jz stop</span><br><span class="line">    ;dec cx</span><br><span class="line">    ;jnz L1</span><br><span class="line">    loop L1</span><br><span class="line">stop:</span><br><span class="line">    lea dx,result</span><br><span class="line">    mov ah,9</span><br><span class="line">    int 21h             ;输出结果</span><br><span class="line">    ;</span><br><span class="line">    mov ax,4c00h</span><br><span class="line">    int 21h</span><br><span class="line"></span><br><span class="line">;-----------------------------------------------------</span><br><span class="line">ISDECM PROC</span><br><span class="line">;</span><br><span class="line">; 功能：判别一个字符是否为数字</span><br><span class="line">; 传参方式：寄存器传参</span><br><span class="line">; 入口参数：AL=字符</span><br><span class="line">; 出口参数：CF为0表示是数字符，否则字符是非数字符</span><br><span class="line">;-----------------------------------------------------</span><br><span class="line">    cmp al,&#x27;0&#x27;</span><br><span class="line">    jb ISDECM1</span><br><span class="line">    cmp al,&#x27;9&#x27;</span><br><span class="line">    ja ISDECM1</span><br><span class="line">    CLC</span><br><span class="line">    ret</span><br><span class="line">ISDECM1:</span><br><span class="line">    STC</span><br><span class="line">    ret</span><br><span class="line">ISDECM endp</span><br><span class="line">code ends</span><br><span class="line">end start</span><br></pre></td></tr></table></figure>
</li>
<li><p>优化1</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">;程序名：T4-5-1.asm</span><br><span class="line">;功能：写一个判别字符是否为数字的子程序。并利用该子程序把一个字符出串中的所有数字字符删除。</span><br><span class="line">;子程序名：ISDECM</span><br><span class="line">;处理方法：循环处理字符，并替换原有字符。缺点：删除数字后，原有字符串与现有字符串宽度不一样，容易出错。优点：代码简洁了一点点。</span><br><span class="line">assume cs:code,ds:data</span><br><span class="line"></span><br><span class="line">data segment</span><br><span class="line">string db &#x27;AB=C950=asd&#x27;,0,0dh,0ah,&#x27;$&#x27;</span><br><span class="line">data ends</span><br><span class="line"></span><br><span class="line">code segment</span><br><span class="line">start:</span><br><span class="line">    mov ax,data</span><br><span class="line">    mov ds,ax</span><br><span class="line">    ;</span><br><span class="line">    mov si,offset string</span><br><span class="line">    mov di,si</span><br><span class="line">next:</span><br><span class="line">    mov al,[si]</span><br><span class="line">    inc si</span><br><span class="line">    or al,al</span><br><span class="line">    jz ok</span><br><span class="line">    call ISDECM</span><br><span class="line">    jnc NEXT</span><br><span class="line">    mov [di],al</span><br><span class="line">    inc di</span><br><span class="line">    jmp next</span><br><span class="line">ok:</span><br><span class="line">    mov [di],al</span><br><span class="line">    ;</span><br><span class="line">    lea dx,string</span><br><span class="line">    mov ah,9</span><br><span class="line">    int 21h</span><br><span class="line">    ;</span><br><span class="line">    mov ax,4c00h</span><br><span class="line">    int 21h</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">;-----------------------------------------------------</span><br><span class="line">ISDECM PROC</span><br><span class="line">;</span><br><span class="line">; 功能：判别一个字符是否为数字</span><br><span class="line">; 传参方式：寄存器传参</span><br><span class="line">; 入口参数：AL=字符</span><br><span class="line">; 出口参数：CF为0表示是数字符，否则字符是非数字符</span><br><span class="line">;-----------------------------------------------------</span><br><span class="line">    cmp al,&#x27;0&#x27;</span><br><span class="line">    jb ISDECM1</span><br><span class="line">    cmp al,&#x27;9&#x27;</span><br><span class="line">    ja ISDECM1</span><br><span class="line">    CLC</span><br><span class="line">    ret</span><br><span class="line">ISDECM1:</span><br><span class="line">    STC</span><br><span class="line">    ret</span><br><span class="line">ISDECM endp</span><br><span class="line">code ends</span><br><span class="line">end start</span><br></pre></td></tr></table></figure>
</li>
<li><p>优化2</p>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">;程序名：T4-5-2.asm</span><br><span class="line">;功能：写一个删除字符串中所有非字母字符，除了空格。</span><br><span class="line">;子程序名：ISDECMS</span><br><span class="line">assume cs:code,ds:data</span><br><span class="line"></span><br><span class="line">data segment</span><br><span class="line">string db &#x27;H!@EL36L0O asm&#x27;,0</span><br><span class="line">result db 14 dup(0),0dh,0ah,&#x27;$&#x27;</span><br><span class="line">data ends</span><br><span class="line"></span><br><span class="line">code segment</span><br><span class="line">start:</span><br><span class="line">    mov ax,data</span><br><span class="line">    mov ds,ax</span><br><span class="line">    ;</span><br><span class="line">    lea si,string</span><br><span class="line">    lea di,result</span><br><span class="line">    call ONLYHCARS</span><br><span class="line">    ;</span><br><span class="line">    lea dx,result</span><br><span class="line">    mov ah,9</span><br><span class="line">    int 21h</span><br><span class="line">    ;</span><br><span class="line">    mov ax,4c00h</span><br><span class="line">    int 21h</span><br><span class="line">;-----------------------------------------------------</span><br><span class="line">ONLYHCARS PROC</span><br><span class="line">;</span><br><span class="line">; 功能：删除字符串中非字母的字符</span><br><span class="line">; 传参方式：寄存器传参</span><br><span class="line">; 入口参数：si=字符串首地址，di-存放处理好的字符串首地址</span><br><span class="line">; 出口参数：di-处理好的字符串首地址</span><br><span class="line">;-----------------------------------------------------</span><br><span class="line">    pushf</span><br><span class="line">    push bx</span><br><span class="line">    push ax</span><br><span class="line">    push si</span><br><span class="line"></span><br><span class="line">    xor bx,bx</span><br><span class="line">ONLYHCARS0:</span><br><span class="line">    mov al,byte ptr [si]</span><br><span class="line">    inc si</span><br><span class="line">    cmp al,20h</span><br><span class="line">    jz charmove</span><br><span class="line">    ;</span><br><span class="line">    cmp al,0</span><br><span class="line">    jz LYHC_POP</span><br><span class="line">    ;</span><br><span class="line">    cmp al,&#x27;A&#x27;</span><br><span class="line">    ja ONLYHCARS1</span><br><span class="line">    cmp al,&#x27;a&#x27;</span><br><span class="line">    ja ONLYHCARS2</span><br><span class="line">    jmp ONLYHCARS0</span><br><span class="line">ONLYHCARS1:</span><br><span class="line">    cmp al,&#x27;Z&#x27;</span><br><span class="line">    jb charmove</span><br><span class="line">ONLYHCARS2:</span><br><span class="line">    cmp al,&#x27;z&#x27;</span><br><span class="line">    jb charmove</span><br><span class="line">    jmp ONLYHCARS0</span><br><span class="line">charmove:</span><br><span class="line">    mov [di],al</span><br><span class="line">    inc di</span><br><span class="line">    inc bx</span><br><span class="line">    jmp ONLYHCARS0</span><br><span class="line">    sub di,bx</span><br><span class="line">LYHC_POP:</span><br><span class="line">    pop si</span><br><span class="line">    pop ax</span><br><span class="line">    pop bx</span><br><span class="line">    popf</span><br><span class="line">    ret</span><br><span class="line">ONLYHCARS endp</span><br><span class="line">code ends</span><br><span class="line">end start</span><br></pre></td></tr></table></figure>

<h2 id="利用存储单元传递参数"><a href="#利用存储单元传递参数" class="headerlink" title="利用存储单元传递参数"></a>利用存储单元传递参数</h2><p>在参数较多的情况下，可利用内存变量来传递参数。<br>优点：子程序要处理的数据或送出的结果都是独立的存储单元，编写子程序时不容易出错。<br>缺点：占用了一定的存储单元，通用性较差。<br>解决方法：把参数组织成一张参数表，存放在某个存储区，然后再把存储区首地址传送给子程序。</p>
<blockquote>
<p>在当时内存空间是非常少的，因此当时的开发人员都非常注重内存空间的使用，尽量少使用内存。</p>
</blockquote>
<h3 id="例1-2"><a href="#例1-2" class="headerlink" title="例1"></a>例1</h3><p>写一个实现32位数相加的子程序</p>
<h4 id="程序流程图-5"><a href="#程序流程图-5" class="headerlink" title="程序流程图"></a>程序流程图</h4><ol>
<li><p>T4-6<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/186618748-efe4db60-e7b3-4c0e-97ce-0a3f44bb1b7a.png"
                      alt="T4-7-1"
                ></p>
</li>
<li><p>T4-6-1<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/186612755-d5850068-e8da-4836-841d-39283341b835.png"
                      alt="T4-7"
                ></p>
</li>
</ol>
<h4 id="代码-6"><a href="#代码-6" class="headerlink" title="代码"></a>代码</h4><ol>
<li><p>T4-6</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">;程序名：T4-6.asm</span><br><span class="line">;功能：实现32位数相加</span><br><span class="line">;子程序名：MADD</span><br><span class="line">;算法：使用顺序结构</span><br><span class="line"></span><br><span class="line">assume cs:code,ds:data</span><br><span class="line"></span><br><span class="line">data segment</span><br><span class="line">DATA1 dd 0ABCDABCDh</span><br><span class="line">DATA2 dd 0CDEFCDEFh</span><br><span class="line">DATA3 dw  0,0,0,0</span><br><span class="line">data ends</span><br><span class="line"></span><br><span class="line">code segment</span><br><span class="line">start:</span><br><span class="line">    mov ax,data</span><br><span class="line">    mov ds,ax</span><br><span class="line">    ;</span><br><span class="line">    call MADD</span><br><span class="line">    ;</span><br><span class="line">    mov ax,4c00h</span><br><span class="line">    int 21h</span><br><span class="line"></span><br><span class="line">;-----------------------------------------------------</span><br><span class="line">MADD PROC</span><br><span class="line">; 功能：32位数相加</span><br><span class="line">; 传参方式：存储单元传参</span><br><span class="line">; 入口参数：DATA1和DATA2分别存放要相加的32位数</span><br><span class="line">; 出口参数：DATA3缓冲区存放结果</span><br><span class="line">;说明： (1)32位数据的存放次序采用 “高高低低”的原则</span><br><span class="line">;       (2)可能产生的进位存放在 DATA3 开始的第5个字节中。</span><br><span class="line">;-----------------------------------------------------</span><br><span class="line">    pushf</span><br><span class="line">    push ax</span><br><span class="line">    push si</span><br><span class="line">    push dx</span><br><span class="line">    push bx</span><br><span class="line">    ;</span><br><span class="line">    xor si,si</span><br><span class="line">    xor dx,dx</span><br><span class="line">    ;算出低16位，进位值存在bx</span><br><span class="line">    mov ax,word ptr DATA1[si]</span><br><span class="line">    add ax,word ptr DATA2[si]</span><br><span class="line">    mov DATA3[si],ax</span><br><span class="line">    ;算出高16位，进位值存在dx</span><br><span class="line">    mov ax,word ptr DATA1[si+2]</span><br><span class="line">    adc ax,0    ;将上一次计算的进位值加进来</span><br><span class="line">    add ax,word ptr DATA2[si+2]</span><br><span class="line">    adc dx,0</span><br><span class="line">    mov word ptr DATA3[si+2],ax</span><br><span class="line">    mov word ptr DATA3[si+4],dx</span><br><span class="line">    ;</span><br><span class="line">    pop bx</span><br><span class="line">    pop dx</span><br><span class="line">    pop si</span><br><span class="line">    pop ax</span><br><span class="line">    popf</span><br><span class="line">    ret</span><br><span class="line">MADD endp</span><br><span class="line">code ends</span><br><span class="line">end start</span><br></pre></td></tr></table></figure>
</li>
<li><p>T4-6-1</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">;程序名：T4-6-1.asm</span><br><span class="line">;功能：写一个实现32位数相加的子程序</span><br><span class="line">;子程序名：MADD</span><br><span class="line">;算法：使用循环结构</span><br><span class="line"></span><br><span class="line">assume cs:code,ds:data</span><br><span class="line"></span><br><span class="line">data segment</span><br><span class="line">DATA1 dd 0ABCDABCDh</span><br><span class="line">DATA2 dd 0CDEFCDEFh</span><br><span class="line">DATA3 dw  0,0,0,0</span><br><span class="line">data ends</span><br><span class="line"></span><br><span class="line">code segment</span><br><span class="line">start:</span><br><span class="line">    mov ax,data</span><br><span class="line">    mov ds,ax</span><br><span class="line">    ;</span><br><span class="line">    call MADD</span><br><span class="line">    ;</span><br><span class="line">    mov ax,4c00h</span><br><span class="line">    int 21h</span><br><span class="line"></span><br><span class="line">;-----------------------------------------------------</span><br><span class="line">MADD PROC</span><br><span class="line">; 功能：32位数相加</span><br><span class="line">; 传参方式：存储单元传参</span><br><span class="line">; 入口参数：DATA1和DATA2分别存放要相加的32位数</span><br><span class="line">; 出口参数：DATA3缓冲区存放结果</span><br><span class="line">;说明： (1)32位数据的存放次序采用 “高高低低”的原则</span><br><span class="line">;       (2)可能产生的进位存放在 DATA3 开始的第5个字节中。</span><br><span class="line">;-----------------------------------------------------</span><br><span class="line">    pushf</span><br><span class="line">    push ax</span><br><span class="line">    push si</span><br><span class="line">    push dx</span><br><span class="line">    push bx</span><br><span class="line">    ;初始化</span><br><span class="line">    mov cx,2</span><br><span class="line">    xor si,si</span><br><span class="line">MADD1:</span><br><span class="line">    ;算出低16位，进位值存在bx</span><br><span class="line">    mov ax,word ptr DATA1[si]</span><br><span class="line">    adc ax,word ptr DATA2[si]</span><br><span class="line">    mov DATA3[si],ax</span><br><span class="line">    inc si</span><br><span class="line">    inc si</span><br><span class="line">    loop MADD1</span><br><span class="line">    ;处理进位</span><br><span class="line">    mov al,0</span><br><span class="line">    adc al,0</span><br><span class="line">    mov byte ptr DATA3+4,AL</span><br><span class="line">    ;</span><br><span class="line">    pop bx</span><br><span class="line">    pop dx</span><br><span class="line">    pop si</span><br><span class="line">    pop ax</span><br><span class="line">    popf</span><br><span class="line">    ret</span><br><span class="line">MADD endp</span><br><span class="line">code ends</span><br><span class="line">end start</span><br></pre></td></tr></table></figure></li>
</ol>
<blockquote>
<p>顺序结构和循环结构的代码行数都差不多，那哪个代码写的更加好一些。<br>我认为是顺序结构写的代码更加好一下，因为循环结构执行的代码比顺序结构执行的代码要多一些，其次顺序结构更容易理解。</p>
</blockquote>
<h3 id="例2-2"><a href="#例2-2" class="headerlink" title="例2"></a>例2</h3><p>设计一个以ASCII码表示的十进制数字符串转换为二进制数的子程序。</p>
<h4 id="程序流程图-6"><a href="#程序流程图-6" class="headerlink" title="程序流程图"></a>程序流程图</h4><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/186708338-d12ccd06-aa36-46f6-a54c-50008d350971.png"
                      alt="T4-8"
                ></p>
<h4 id="代码-7"><a href="#代码-7" class="headerlink" title="代码"></a>代码</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">;程序名：T4-7.asm</span><br><span class="line">;功能：设计一个以ASCII码表示的十进制数字符串转换为二进制数的子程序。</span><br><span class="line">;设表示十进制数不大于65535</span><br><span class="line">;这个子程序有两点不足：(1)没有检查数字串中是否有非十进制数字符存在 (2)不适用于数字串表示的十进制数超过值65535的情况。</span><br><span class="line">assume cs:code,ds:data</span><br><span class="line"></span><br><span class="line">data segment</span><br><span class="line">number db 5,&#x27;4&#x27;,&#x27;3&#x27;,&#x27;9&#x27;,&#x27;8&#x27;,&#x27;1&#x27;     ;数组的第一个值为要处理元素的个数</span><br><span class="line">data ends</span><br><span class="line"></span><br><span class="line">code segment</span><br><span class="line">start:</span><br><span class="line">    mov ax,data</span><br><span class="line">    mov ds,ax</span><br><span class="line">    lea bx,number</span><br><span class="line">    call DTOBIN</span><br><span class="line">    mov ax,4c00h</span><br><span class="line">    int 21h</span><br><span class="line">    </span><br><span class="line">;-----------------------------------------------------</span><br><span class="line">DTOBIN PROC</span><br><span class="line">; 功能：把用 ASCII 表示的十进制数字串转换为二进制。</span><br><span class="line">; 传参方式：寄存器传参,利用约定存储单元传参</span><br><span class="line">; 入口参数：DS:BX=缓冲区首地址</span><br><span class="line">; 出口参数：AX=转换得到的二进制数</span><br><span class="line">; 说明：    (1) 数字串的首地址存储的是要处理数字的个数</span><br><span class="line">;-----------------------------------------------------</span><br><span class="line">    push ax         ;设置初始值</span><br><span class="line">    push cx</span><br><span class="line">    push dx</span><br><span class="line">    xor ax,ax</span><br><span class="line">    mov cl,[bx]     ;将数字串的首地址，作为循环次数传入cl</span><br><span class="line">    inc bx</span><br><span class="line">    xor ch,ch       ;初始化ch</span><br><span class="line">    jcxz DTOBIN2    ;jcxz如果cx为0就不做操作，主要是判断值是否为空</span><br><span class="line">DTOBIN1:</span><br><span class="line">    mov dx,10</span><br><span class="line">    mul dx          ;ax*dx=ax*10</span><br><span class="line">    mov dl,[bx]     ;</span><br><span class="line">    inc bx</span><br><span class="line">    and dl,0fh      ;取各位数的值</span><br><span class="line">    ;这条指令可以去掉，因为乘数是16位，结果保存在 dx:ax 中</span><br><span class="line">    ;而每次计算结果小于 FFFF 没有溢出的情况，所以每次 mul 执行后 DX 必然是 0 ，没必要再去初始化。</span><br><span class="line">    ;xor dh,dh      </span><br><span class="line">    add ax,dx       ;ax=ax*10+dl</span><br><span class="line">    loop DTOBIN1</span><br><span class="line">DTOBIN2:</span><br><span class="line">    pop dx</span><br><span class="line">    pop cx</span><br><span class="line">    pop bx</span><br><span class="line">    ret</span><br><span class="line">DTOBIN endp</span><br><span class="line">code ends</span><br><span class="line">end start</span><br></pre></td></tr></table></figure>

<h2 id="利用堆栈传递参数"><a href="#利用堆栈传递参数" class="headerlink" title="利用堆栈传递参数"></a>利用堆栈传递参数</h2><p>如果使用堆栈传递参数，那么主程序在调用子程序之前，把需要传递的参数依次压入堆栈，子程序从堆栈中取入口参数；如果使用堆栈传递出口参数，那么子程序在返回前，把需要返回的参数存入堆栈，主程序在堆栈中取出口参数。<br>优点：不占用寄存器，也无需使用额外的存储单元。<br>缺点：需要考虑保护寄存器</p>
<blockquote>
<p>通常利用堆栈传递入口参数，利用寄存器传递出口参数</p>
</blockquote>
<h3 id="例1-3"><a href="#例1-3" class="headerlink" title="例1"></a>例1</h3><p>写一个测量字符串长度的子程序，设字符串以 0 为结束标志。</p>
<h4 id="程序流程图-7"><a href="#程序流程图-7" class="headerlink" title="程序流程图"></a>程序流程图</h4><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/187656884-ff93429e-3b46-4189-8280-792eb98dd5d2.png"
                      alt="T4-9"
                ></p>
<h4 id="代码-8"><a href="#代码-8" class="headerlink" title="代码"></a>代码</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">;程序名：T4-8.asm</span><br><span class="line">;功能：写一个测量字符串长度的子程序，设字符串以 0 为结束标志。</span><br><span class="line">;子程序名：STRLEN</span><br><span class="line">assume cs:code,ds:data</span><br><span class="line"></span><br><span class="line">data segment</span><br><span class="line">string db &#x27;Hello&#x27;,0</span><br><span class="line">data ends</span><br><span class="line"></span><br><span class="line">code segment</span><br><span class="line">start:</span><br><span class="line">    mov ax,data</span><br><span class="line">    mov ds,ax</span><br><span class="line"></span><br><span class="line">    lea dx,string</span><br><span class="line">    push ds</span><br><span class="line">    push dx</span><br><span class="line">    call STRLEN</span><br><span class="line">    mov ax,4c00h</span><br><span class="line">    int 21h</span><br><span class="line">;-----------------------------------------------------</span><br><span class="line">STRLEN PROC</span><br><span class="line">; 功能：测量字符串的长度</span><br><span class="line">; 传参方式：堆栈传参</span><br><span class="line">; 入口参数：字符串起始地址的段值和偏移地址在堆栈中</span><br><span class="line">; 出口参数：AX=字符串长度</span><br><span class="line">;------------------------------------------------------</span><br><span class="line">    push bp</span><br><span class="line">    mov bp,sp</span><br><span class="line">    push es</span><br><span class="line">    push di</span><br><span class="line">    ;</span><br><span class="line">    xor ax,ax</span><br><span class="line">    mov di,[bp+4]</span><br><span class="line">    mov es,[bp+6]</span><br><span class="line">STRLEN1:</span><br><span class="line">    mov bl,es:[di]</span><br><span class="line">    cmp bl,0</span><br><span class="line">    jz STRLEN2</span><br><span class="line">    inc di</span><br><span class="line">    inc ax</span><br><span class="line">    jmp STRLEN1</span><br><span class="line">STRLEN2:</span><br><span class="line">    pop di</span><br><span class="line">    pop es</span><br><span class="line">    mov sp,bp</span><br><span class="line">    pop bp</span><br><span class="line">    ret</span><br><span class="line">STRLEN endp</span><br><span class="line">code ends</span><br><span class="line">end start</span><br></pre></td></tr></table></figure>
<h2 id="利用-call-后续区传递参数"><a href="#利用-call-后续区传递参数" class="headerlink" title="利用 call 后续区传递参数"></a>利用 call 后续区传递参数</h2><p>CALL 后续区是指位于CALL指令后的存储区域。主程序在调用子程序之前，把入口参数存入CALL指令后的存储单元中，子程序根据保存在堆栈中的返回地址找到入口参数。</p>
<h3 id="例1-4"><a href="#例1-4" class="headerlink" title="例1"></a>例1</h3><p>写一个把字符串中所有大写字母转换为小写字母子程序</p>
<h4 id="程序结构图"><a href="#程序结构图" class="headerlink" title="程序结构图"></a>程序结构图</h4><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/187657164-07f41119-d043-499f-935a-c60b1c7b2da4.png"
                      alt="T4-10"
                ></p>
<h4 id="代码-9"><a href="#代码-9" class="headerlink" title="代码"></a>代码</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">;程序名：T4-9.asm</span><br><span class="line">;功能：把字符串中所有大写字母转换为小写字母</span><br><span class="line">;子程序名：STRLWR</span><br><span class="line">assume cs:code,ds:data</span><br><span class="line"></span><br><span class="line">data segment</span><br><span class="line">string db &#x27;HELLO&#x27;,&#x27;$&#x27;</span><br><span class="line">data ends</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">code segment</span><br><span class="line">start:</span><br><span class="line">    mov ax,data</span><br><span class="line">    mov ds,ax</span><br><span class="line">    call STRLWR</span><br><span class="line">    dw offset string        ;偏移地址和段地址参数都存放在代码区 call 指令后</span><br><span class="line">    dw seg data</span><br><span class="line">    mov dx,ax</span><br><span class="line">    mov ah,9</span><br><span class="line">    int 21h</span><br><span class="line">    mov ax,4c00h</span><br><span class="line">    int 21h</span><br><span class="line">;-----------------------------------------------------</span><br><span class="line">STRLWR PROC</span><br><span class="line">; 功能：把字符串中的所有大写字母改为小写字母</span><br><span class="line">; 传参方式：call 后续区传递参数</span><br><span class="line">; 入口参数：字符串起始地址的段值和偏移在call后续区</span><br><span class="line">; 出口参数：无</span><br><span class="line">;-----------------------------------------------------</span><br><span class="line">    push bp</span><br><span class="line">    mov bp,sp</span><br><span class="line">    push si</span><br><span class="line">    push ds</span><br><span class="line">    mov si,[bp+2]       ;call 指令后的偏移地址</span><br><span class="line">    mov ds,cs:[si+2]    ;取参数：段值</span><br><span class="line">    mov si,cs:[si]      ;取参数：偏移</span><br><span class="line">STRLWR1:</span><br><span class="line">    mov al,[si]</span><br><span class="line">    cmp al,&#x27;$&#x27;</span><br><span class="line">    jz STRLWR3</span><br><span class="line">    cmp al,&#x27;A&#x27;</span><br><span class="line">    JB STRLWR2</span><br><span class="line">    cmp AL,&#x27;Z&#x27;</span><br><span class="line">    JA STRLWR2</span><br><span class="line">    add AL,&#x27;a&#x27;-&#x27;A&#x27;</span><br><span class="line">    mov [si],al</span><br><span class="line">STRLWR2:</span><br><span class="line">    inc si</span><br><span class="line">    jmp STRLWR1</span><br><span class="line">STRLWR3:</span><br><span class="line">    add word ptr [bp+2],4   ;修改返回地址</span><br><span class="line">    mov si,[bp+2]           </span><br><span class="line">    mov ax,si               ;返回值</span><br><span class="line">    pop ds</span><br><span class="line">    pop si</span><br><span class="line">    mov sp,bp</span><br><span class="line">    pop bp</span><br><span class="line">    ret</span><br><span class="line">STRLWR endp</span><br><span class="line">code ends</span><br><span class="line">end start</span><br></pre></td></tr></table></figure>

<blockquote>
<p>一般不会用这种方法调用参数，容易出错。</p>
</blockquote>
<h1 id="DOS-功能调用及应用"><a href="#DOS-功能调用及应用" class="headerlink" title="DOS 功能调用及应用"></a>DOS 功能调用及应用</h1><p>MS-DOS 内包含了涉及设备驱动和文件管理等方面的子程序，DOS的各种命令就是通过适当地调用这些子程序实现的。DOS功能调用主要包括三方面的子恒徐：设备驱动（基本I&#x2F;O）、文件管理和其他（包括内存管理、置取时间、置取中断向量、终止程序等）。</p>
<h2 id="调用方法"><a href="#调用方法" class="headerlink" title="调用方法"></a>调用方法</h2><ol>
<li>根据情况准备 DOS 功能调用所需的参数。有部分功能是不需要参数的，但大部分调用需要入口参数，在调用前应按照要求准备好入口参数</li>
<li>把功能调用号送入 AH 寄存器</li>
<li>发送软中断指令 “int 21h”</li>
</ol>
<h3 id="例1-5"><a href="#例1-5" class="headerlink" title="例1"></a>例1</h3><p>调用 “int21” 2号功能，使喇叭发出 “嘟” 的声音。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">;程序名：T4-10.asm</span><br><span class="line">;功能：调用 &quot;int21&quot; 2号功能，使喇叭发出 &quot;嘟&quot; 的声音。</span><br><span class="line">assume cs:code</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">code segment</span><br><span class="line">start:</span><br><span class="line">    mov dl,7</span><br><span class="line">    mov ah,2</span><br><span class="line">    int 21h</span><br><span class="line">    mov ax,4c00h</span><br><span class="line">    int 21h</span><br><span class="line">code ends</span><br><span class="line">end start</span><br></pre></td></tr></table></figure>

<blockquote>
<p>大部分功能调用都有出口参数，在调用后，可根据有关功能调用的说明取得出口参数，如2号功能。</p>
</blockquote>
<p>还有个别功能很特殊，调用后就不再返回。例如 4CH 号功能就是结束程序的运行返回DOS。4CH 号功能调用有一个存放在 AL 寄存器中的入口参数，该入口参数是程序的结束码，其值大小不影响程序的结束。</p>
<h3 id="例2-3"><a href="#例2-3" class="headerlink" title="例2"></a>例2</h3><p>修改 4CH 号功能入口参数 AL 的值，查看是否会影响程序。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">;程序名：T4-11.asm</span><br><span class="line">;功能：修改 4CH 号功能入口参数 AL 的值，查看是否会影响程序。</span><br><span class="line">assume cs:code</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">code segment</span><br><span class="line">start:</span><br><span class="line">    mov dl,7</span><br><span class="line">    mov ah,2</span><br><span class="line">    int 21h</span><br><span class="line">    mov ax,4c20h</span><br><span class="line">    int 21h</span><br><span class="line">code ends</span><br><span class="line">end start</span><br></pre></td></tr></table></figure>

<h2 id="基本的-I-x2F-O-功能调用"><a href="#基本的-I-x2F-O-功能调用" class="headerlink" title="基本的 I&#x2F;O 功能调用"></a>基本的 I&#x2F;O 功能调用</h2><table>
<thead>
<tr>
<th align="center">AH</th>
<th align="center">功能</th>
<th align="center">调用参数</th>
<th align="center">返回参数</th>
</tr>
</thead>
<tbody><tr>
<td align="center">00</td>
<td align="center">程序终止(同INT 20H)</td>
<td align="center">CS&#x3D;程序段前缀</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">01</td>
<td align="center">键盘输入并回显</td>
<td align="center"></td>
<td align="center">AL&#x3D;输入字符</td>
</tr>
<tr>
<td align="center">02</td>
<td align="center">显示输出</td>
<td align="center">DL&#x3D;输出字符</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">03</td>
<td align="center">异步通迅输入</td>
<td align="center"></td>
<td align="center">AL&#x3D;输入数据</td>
</tr>
<tr>
<td align="center">04</td>
<td align="center">异步通迅输出</td>
<td align="center">DL&#x3D;输出数据</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">05</td>
<td align="center">打印机输出</td>
<td align="center">DL&#x3D;输出字符</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">06</td>
<td align="center">直接控制台I&#x2F;O</td>
<td align="center">DL&#x3D;FF(输入)</br>DL&#x3D;字符(输出)</td>
<td align="center">AL&#x3D;输入字符</td>
</tr>
<tr>
<td align="center">07</td>
<td align="center">键盘输入(无回显)</td>
<td align="center"></td>
<td align="center">AL&#x3D;输入字符</td>
</tr>
<tr>
<td align="center">08</td>
<td align="center">键盘输入(无回显)</br>检测Ctrl-Break</td>
<td align="center"></td>
<td align="center">AL&#x3D;输入字符</td>
</tr>
<tr>
<td align="center">09</td>
<td align="center">显示字符串</td>
<td align="center">DS:DX&#x3D;串地址</br>‘$’结束字符串</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">0A</td>
<td align="center">键盘输入到缓冲区</td>
<td align="center">DS:DX&#x3D;缓冲区首地址</br>(DS:DX)&#x3D;缓冲区最大字符数</td>
<td align="center">(DS:DX+1)&#x3D;实际输入的字符数</td>
</tr>
</tbody></table>
<blockquote>
<p>“int 21h”中断还有很多功能，我们在需要用到某个功能的时候再去查，不需要去记</p>
</blockquote>
<h2 id="应用举例"><a href="#应用举例" class="headerlink" title="应用举例"></a>应用举例</h2><h3 id="例1-6"><a href="#例1-6" class="headerlink" title="例1"></a>例1</h3><p>编写程序，从键盘接收输入字符，如果数字是 N，则响铃N次；如果不是数字，则不响铃；如果是 CTRL+C 结束程序。</p>
<h4 id="程序流程图-8"><a href="#程序流程图-8" class="headerlink" title="程序流程图"></a>程序流程图</h4><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/187860263-49ea55ea-6f87-48fd-b938-5a519ff9ed11.png"
                      alt="Ring"
                ></p>
<h4 id="代码-10"><a href="#代码-10" class="headerlink" title="代码"></a>代码</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">;程序名：Ring.asm</span><br><span class="line">;功能：编写程序，从键盘接收输入字符，如果数字是 N，则响铃N次；如果不是数字，则不响铃；如果是 CTRL+C 结束程序。</span><br><span class="line">assume cs:code,ds:data</span><br><span class="line"></span><br><span class="line">data segment</span><br><span class="line">CTRL_C equ 3</span><br><span class="line">Return db 0dh,0ah,&#x27;$&#x27;</span><br><span class="line">DATA1 db &#x27;please input number 1-9,quit with ctrl-c&#x27;,0dh,0ah,&#x27;$&#x27;</span><br><span class="line">ERROR db &#x27;wrong number,please input again or with ctrl-c&#x27;,0dh,0ah,&#x27;$&#x27;</span><br><span class="line">data ends</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">code segment</span><br><span class="line">start:</span><br><span class="line">    mov ax,data</span><br><span class="line">    mov ds,ax</span><br><span class="line">Loop0:</span><br><span class="line">    lea dx,DATA1</span><br><span class="line">    mov ah,9</span><br><span class="line">    int 21h</span><br><span class="line">Ring0:</span><br><span class="line">    mov ah,1</span><br><span class="line">    int 21h</span><br><span class="line">    lea dx,Return</span><br><span class="line">    mov ah,9</span><br><span class="line">    int 21h</span><br><span class="line">    ;如果上 ctrl+c 中之程序</span><br><span class="line">    cmp al,CTRL_C</span><br><span class="line">    jz stop</span><br><span class="line">    ;在1-9之间就响铃</span><br><span class="line">    cmp al,31h</span><br><span class="line">    jb ERROR1</span><br><span class="line">    cmp al,39h</span><br><span class="line">    ja ERROR1</span><br><span class="line">    ;</span><br><span class="line">    and al,0fh</span><br><span class="line">    mov cl,al</span><br><span class="line">Loop1:</span><br><span class="line">    mov dl,7</span><br><span class="line">    mov ah,2</span><br><span class="line">    int 21h</span><br><span class="line">    nop</span><br><span class="line">    nop</span><br><span class="line">    nop</span><br><span class="line">    loop Loop1</span><br><span class="line">    jmp Loop0</span><br><span class="line">ERROR1:</span><br><span class="line">    lea dx,ERROR</span><br><span class="line">    mov ah,9</span><br><span class="line">    int 21h</span><br><span class="line">   jmp Ring0</span><br><span class="line">stop:</span><br><span class="line">    mov ax,4c00h</span><br><span class="line">    int 21h</span><br><span class="line">code ends</span><br><span class="line">end start</span><br></pre></td></tr></table></figure>

<h3 id="例2-4"><a href="#例2-4" class="headerlink" title="例2"></a>例2</h3><p>写一个程序，用二进制数形式显示按键的ASCII码。</p>
<h4 id="程序流程图-9"><a href="#程序流程图-9" class="headerlink" title="程序流程图"></a>程序流程图</h4><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/187876828-055a541b-5ba6-438a-ab7b-c196027d4af9.png"
                      alt="T4-11"
                ></p>
<h4 id="代码-11"><a href="#代码-11" class="headerlink" title="代码"></a>代码</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">;程序名：T4-12.asm</span><br><span class="line">;写一个程序，用二进制数形式显示按键的ASCII码。</span><br><span class="line">assume cs:code</span><br><span class="line"></span><br><span class="line">code segment</span><br><span class="line">start:</span><br><span class="line">    mov ah,1</span><br><span class="line">    int 21h</span><br><span class="line">    call NEWLINE</span><br><span class="line">    mov bl,al</span><br><span class="line">    mov cx,8</span><br><span class="line">next:</span><br><span class="line">    shl bl,1</span><br><span class="line">    mov dl,30h</span><br><span class="line">    adc dl,0</span><br><span class="line">    mov ah,2</span><br><span class="line">    int 21h</span><br><span class="line">    loop next</span><br><span class="line">    ;</span><br><span class="line">    mov dl,&#x27;B&#x27;</span><br><span class="line">    mov ah,2</span><br><span class="line">    int 21h</span><br><span class="line">    ;</span><br><span class="line">    mov ax,4c00h</span><br><span class="line">    int 21h</span><br><span class="line"></span><br><span class="line">;--------------------------------------------------------</span><br><span class="line">NEWLINE PROC</span><br><span class="line">; 功能：形成回车和换行（光标移到写一行首）</span><br><span class="line">; 入口参数：无</span><br><span class="line">; 出口参数：无</span><br><span class="line">; 说    明：通过显示回车符形成回车，通过显示换行符形成换行</span><br><span class="line">;---------------------------------------------------------</span><br><span class="line">    push ax</span><br><span class="line">    push dx</span><br><span class="line">    mov dl,0dh</span><br><span class="line">    mov ah,2</span><br><span class="line">    int 21h</span><br><span class="line">    mov dl,0ah</span><br><span class="line">    mov ah,2</span><br><span class="line">    int 21h</span><br><span class="line">    pop dx</span><br><span class="line">    pop ax</span><br><span class="line">    ret</span><br><span class="line">NEWLINE endp</span><br><span class="line">code ends</span><br><span class="line">end start</span><br></pre></td></tr></table></figure>

<h3 id="例3-1"><a href="#例3-1" class="headerlink" title="例3"></a>例3</h3><p>写一个程序，它先接收一个字符串，然后显示其中数字符的个数、英文字母的个数和字符串的长度.</p>
<h4 id="程序流程图-10"><a href="#程序流程图-10" class="headerlink" title="程序流程图"></a>程序流程图</h4><ol>
<li><p>十六进制转十进制（除法运算）<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/189184107-05168f14-ff97-47ea-a9a7-9edcf170fe9b.png"
                      alt="T4-12"
                ></p>
</li>
<li><p>十六进制转十进制（加法运算）<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/189182065-f8d747b4-a172-4b4b-bfa4-6518f183cecf.png"
                      alt="T4-12-1"
                ></p>
</li>
</ol>
<h4 id="代码-12"><a href="#代码-12" class="headerlink" title="代码"></a>代码</h4><ol>
<li><p>十六进制转十进制（除法运算）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br></pre></td><td class="code"><pre><span class="line">;程序名：T4-13.asm</span><br><span class="line">;功能：写一个程序，它先接收一个字符串，然后显示其中数字符的个数、英文字母的个数和字符串的长度</span><br><span class="line">;算法：HEXTODEC 使用除法运算</span><br><span class="line">assume cs:code,ds:data,ss:stack</span><br><span class="line"></span><br><span class="line">data segment</span><br><span class="line">buffer db 128 dup(0)    ;未初始化数据要放在最前面</span><br><span class="line">string1 db &#x27;The number of letters is: %u&#x27;,0,0</span><br><span class="line">string2 db &#x27;The number of numbers is: %u&#x27;,0,0</span><br><span class="line">string3 db &#x27;String length is: %u&#x27;,0,0</span><br><span class="line">data ends</span><br><span class="line"></span><br><span class="line">stack segment</span><br><span class="line">print_buffer db 128 dup(0)</span><br><span class="line">stack ends </span><br><span class="line"></span><br><span class="line">code segment</span><br><span class="line">start:</span><br><span class="line">    mov ax,data</span><br><span class="line">    mov ds,ax</span><br><span class="line">    mov ax,stack</span><br><span class="line">    mov ss,ax</span><br><span class="line">    ;</span><br><span class="line">    lea bx,buffer</span><br><span class="line">    call INPUT</span><br><span class="line">    ;</span><br><span class="line">    push ds</span><br><span class="line">    push bx</span><br><span class="line">    call CHARSTAT</span><br><span class="line">    add sp,4</span><br><span class="line">    ;</span><br><span class="line">    lea dx,string1</span><br><span class="line">    push dx</span><br><span class="line">    xor dx,dx</span><br><span class="line">    mov dl,ah</span><br><span class="line">    push dx</span><br><span class="line">    call far ptr print</span><br><span class="line">    ;</span><br><span class="line">    call NEWLINE</span><br><span class="line">    ;</span><br><span class="line">    lea dx,string2</span><br><span class="line">    push dx</span><br><span class="line">    xor dx,dx</span><br><span class="line">    mov dl,al</span><br><span class="line">    push dx</span><br><span class="line">    call far ptr print</span><br><span class="line">    ;</span><br><span class="line">    call NEWLINE</span><br><span class="line">    ;</span><br><span class="line">    lea dx,buffer</span><br><span class="line">    push ds</span><br><span class="line">    push dx</span><br><span class="line">    call STRLEN</span><br><span class="line">    add sp,4</span><br><span class="line">    ;</span><br><span class="line">    lea dx,string3</span><br><span class="line">    push dx</span><br><span class="line">    push ax</span><br><span class="line">    call far ptr print</span><br><span class="line">    ;</span><br><span class="line">    mov ax,4c00h</span><br><span class="line">    int 21h</span><br><span class="line"></span><br><span class="line">;--------------------------------------------------------</span><br><span class="line">INPUT PROC</span><br><span class="line">; 功能：接收输入，并存储到 128字节大小的 bufer 缓冲区中</span><br><span class="line">; 入口参数：bx=buffer缓冲区首地址</span><br><span class="line">; 出口参数：bx=buffer缓冲区首地址</span><br><span class="line">; 说    明：通过显示回车符形成回车，通过显示换行符形成换行</span><br><span class="line">;---------------------------------------------------------</span><br><span class="line">    pushf</span><br><span class="line">    push ax</span><br><span class="line">    push bx</span><br><span class="line">INPUT1:</span><br><span class="line">    mov ah,1</span><br><span class="line">    int 21h</span><br><span class="line">    cmp al,0dh</span><br><span class="line">    jz INPUT2</span><br><span class="line">    mov [bx],al</span><br><span class="line">    inc bx</span><br><span class="line">    jmp INPUT1</span><br><span class="line">INPUT2:</span><br><span class="line">    pop bx</span><br><span class="line">    pop ax</span><br><span class="line">    popf</span><br><span class="line">    ;</span><br><span class="line">    ret</span><br><span class="line">INPUT endp</span><br><span class="line"></span><br><span class="line">;-----------------------------------------------------</span><br><span class="line">CHARSTAT PROC</span><br><span class="line">; 功能：统计字符串中的字母、数字、其他字符的个数</span><br><span class="line">; 传参方式：堆栈传参</span><br><span class="line">; 入口参数：字符串起始地址的段值和偏移地址在堆栈中</span><br><span class="line">; 出口参数：AH=字母个数、AL=数字的个数</span><br><span class="line">;------------------------------------------------------</span><br><span class="line">    push bp</span><br><span class="line">    mov bp,sp</span><br><span class="line">    pushf</span><br><span class="line">    push es</span><br><span class="line">    push di</span><br><span class="line">    push bx</span><br><span class="line">    ;</span><br><span class="line">    mov di,[bp+4]</span><br><span class="line">    mov es,[bp+6]</span><br><span class="line">    xor ax,ax</span><br><span class="line">CHARSTAT1:</span><br><span class="line">    mov bl,es:[di]</span><br><span class="line">    ;判断是否读取结束</span><br><span class="line">    cmp bl,0</span><br><span class="line">    jz CHARSTAT_POP</span><br><span class="line">    ;判断小写字母</span><br><span class="line">    cmp bl,&#x27;a&#x27;</span><br><span class="line">    jae CHARSTAT3</span><br><span class="line">    ;判断大写字母</span><br><span class="line">    cmp bl,&#x27;A&#x27;</span><br><span class="line">    jae CHARSTAT2</span><br><span class="line">    ;判断数字</span><br><span class="line">    cmp bl,&#x27;0&#x27;</span><br><span class="line">    jae CHARSTAT0</span><br><span class="line">    inc di</span><br><span class="line">    jmp CHARSTAT1</span><br><span class="line">CHARSTAT0:</span><br><span class="line">    cmp bl,&#x27;9&#x27;</span><br><span class="line">    jbe number</span><br><span class="line">    inc di</span><br><span class="line">    jmp CHARSTAT1</span><br><span class="line">CHARSTAT2:</span><br><span class="line">    ;判断字母</span><br><span class="line">    cmp bl,&#x27;Z&#x27;</span><br><span class="line">    jb letter</span><br><span class="line">    inc di</span><br><span class="line">    jmp CHARSTAT1</span><br><span class="line">CHARSTAT3:</span><br><span class="line">    cmp bl,&#x27;z&#x27;</span><br><span class="line">    jb letter</span><br><span class="line">    inc di</span><br><span class="line">    jmp CHARSTAT1</span><br><span class="line">letter:</span><br><span class="line">    inc ah</span><br><span class="line">    inc di</span><br><span class="line">    jmp CHARSTAT1</span><br><span class="line">number:</span><br><span class="line">    inc al</span><br><span class="line">    inc di</span><br><span class="line">    jmp CHARSTAT1</span><br><span class="line">    ;</span><br><span class="line">CHARSTAT_POP:</span><br><span class="line">    pop bx</span><br><span class="line">    pop di</span><br><span class="line">    pop es</span><br><span class="line">    popf</span><br><span class="line">    mov sp,bp</span><br><span class="line">    pop bp</span><br><span class="line">    ;</span><br><span class="line">    ret</span><br><span class="line">CHARSTAT endp</span><br><span class="line"></span><br><span class="line">;-----------------------------------------------------</span><br><span class="line">STRLEN PROC</span><br><span class="line">; 功能：测量字符串的长度</span><br><span class="line">; 传参方式：堆栈传参</span><br><span class="line">; 入口参数：字符串起始地址的段值和偏移地址在堆栈中</span><br><span class="line">; 出口参数：AX=字符串长度</span><br><span class="line">;------------------------------------------------------</span><br><span class="line">    push bp</span><br><span class="line">    mov bp,sp</span><br><span class="line">    push es</span><br><span class="line">    push di</span><br><span class="line">    ;</span><br><span class="line">    xor ax,ax</span><br><span class="line">    mov di,[bp+4]</span><br><span class="line">    mov es,[bp+6]</span><br><span class="line">STRLEN1:</span><br><span class="line">    mov bl,es:[di]</span><br><span class="line">    cmp bl,0</span><br><span class="line">    jz STRLEN2</span><br><span class="line">    inc di</span><br><span class="line">    inc ax</span><br><span class="line">    jmp STRLEN1</span><br><span class="line">STRLEN2:</span><br><span class="line">    pop di</span><br><span class="line">    pop es</span><br><span class="line">    mov sp,bp</span><br><span class="line">    pop bp</span><br><span class="line">    ret</span><br><span class="line">STRLEN endp</span><br><span class="line"></span><br><span class="line">;--------------------------------------------------------</span><br><span class="line">NEWLINE PROC</span><br><span class="line">; 功能：形成回车和换行（光标移到写一行首）</span><br><span class="line">; 入口参数：无</span><br><span class="line">; 出口参数：无</span><br><span class="line">; 说    明：通过显示回车符形成回车，通过显示换行符形成换行</span><br><span class="line">;---------------------------------------------------------</span><br><span class="line">    push ax</span><br><span class="line">    push dx</span><br><span class="line">    mov dl,0dh</span><br><span class="line">    mov ah,2</span><br><span class="line">    int 21h</span><br><span class="line">    mov dl,0ah</span><br><span class="line">    mov ah,2</span><br><span class="line">    int 21h</span><br><span class="line">    pop dx</span><br><span class="line">    pop ax</span><br><span class="line">    ret</span><br><span class="line">NEWLINE endp</span><br><span class="line"></span><br><span class="line">print proc far  </span><br><span class="line">    push bp</span><br><span class="line">    mov bp,sp</span><br><span class="line">    push ds</span><br><span class="line">    push es</span><br><span class="line">    push ss</span><br><span class="line">    push si</span><br><span class="line">    push di</span><br><span class="line">    push ax</span><br><span class="line">    push bx</span><br><span class="line">    push cx</span><br><span class="line">    push dx</span><br><span class="line"></span><br><span class="line">    ;判断在字符串中是否有 %d、%s等（同时将字符串复制），结束标志0</span><br><span class="line">    ;初始化寄存器</span><br><span class="line">    xor si,si</span><br><span class="line">    xor di,di</span><br><span class="line">    mov si,[bp+8]</span><br><span class="line">    lea di,print_buffer</span><br><span class="line">print1:</span><br><span class="line">    mov ax,[si]</span><br><span class="line">    cmp ax,0</span><br><span class="line">    jz print_b</span><br><span class="line">    ;</span><br><span class="line">    cmp ax,&#x27;u%&#x27;</span><br><span class="line">    jz decs</span><br><span class="line">    mov ss:[di],al</span><br><span class="line">    inc si</span><br><span class="line">    inc di</span><br><span class="line">    jmp print1</span><br><span class="line">    ;有：%d（将十六进制转换为十进制，复制）、%s（指定偏移，复制）</span><br><span class="line">decs:</span><br><span class="line">    call HEXTODEC</span><br><span class="line">    ;无：输出结果</span><br><span class="line">print_b:</span><br><span class="line"></span><br><span class="line">    mov al,&#x27;$&#x27;</span><br><span class="line">    mov ss:[di],al</span><br><span class="line">    mov ax,ss</span><br><span class="line">    mov ds,ax</span><br><span class="line">    lea dx,print_buffer</span><br><span class="line">    mov ah,9</span><br><span class="line">    int 21h</span><br><span class="line">;</span><br><span class="line">    pop dx</span><br><span class="line">    pop cx</span><br><span class="line">    pop bx</span><br><span class="line">    pop ax</span><br><span class="line">    pop di</span><br><span class="line">    pop si</span><br><span class="line">    pop ss</span><br><span class="line">    pop es</span><br><span class="line">    pop ds</span><br><span class="line">    mov sp,bp</span><br><span class="line">    pop bp</span><br><span class="line">    ret</span><br><span class="line">print endp</span><br><span class="line"></span><br><span class="line">CalOffset proc</span><br><span class="line">;如果 ax &lt;9；di+2</span><br><span class="line">    cmp ax,9</span><br><span class="line">    jb CalOffset1</span><br><span class="line">;如果 ax &lt;99；di+3</span><br><span class="line">    cmp ax,99</span><br><span class="line">    jb CalOffset2</span><br><span class="line">;如果 ax &lt;999；di+4</span><br><span class="line">    cmp ax,999</span><br><span class="line">    jb CalOffset3</span><br><span class="line">;如果 ax &lt;9999；di+5</span><br><span class="line">    cmp ax,9999</span><br><span class="line">    jb CalOffset4</span><br><span class="line">;如果 ax &gt; 9999；di+5</span><br><span class="line">    jmp CalOffset5</span><br><span class="line">CalOffset1:</span><br><span class="line">    ;di 为了符合循环，di 多加了1</span><br><span class="line">    add di,1</span><br><span class="line">    jmp CalOffset6</span><br><span class="line">CalOffset2:</span><br><span class="line">    add di,2</span><br><span class="line">    jmp CalOffset6</span><br><span class="line">CalOffset3:</span><br><span class="line">    add di,3</span><br><span class="line">    jmp CalOffset6</span><br><span class="line">CalOffset4:</span><br><span class="line">    add di,4</span><br><span class="line">CalOffset5:</span><br><span class="line">    add di,5</span><br><span class="line">CalOffset6:</span><br><span class="line">    ;将当前偏移备份到bx中</span><br><span class="line">    mov bx,di</span><br><span class="line">    ret</span><br><span class="line">CalOffset endp</span><br><span class="line"></span><br><span class="line">HEXTODEC PROC</span><br><span class="line">    mov cx,10</span><br><span class="line">    ;mov si,[bp+4]</span><br><span class="line">    mov ax,[bp+6]</span><br><span class="line">    call CalOffset</span><br><span class="line">L1:</span><br><span class="line">    xor dx,dx</span><br><span class="line">    div cx</span><br><span class="line">    add dl,30h</span><br><span class="line">    dec di</span><br><span class="line">    mov ss:print_buffer[di],dl     ;用di判断循环，但是存储结果di需要减1</span><br><span class="line">    cmp ax,0</span><br><span class="line">    jnz L1</span><br><span class="line">    mov di,bx   ;恢复偏移地址</span><br><span class="line">    ;</span><br><span class="line">    ret</span><br><span class="line">HEXTODEC endp</span><br><span class="line">code ends</span><br><span class="line">end start</span><br></pre></td></tr></table></figure>
</li>
<li><p>十六进制转十进制（加法运算）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br></pre></td><td class="code"><pre><span class="line">;程序名：T4-13-1.asm</span><br><span class="line">;功能：写一个程序，它先接收一个字符串，然后显示其中数字符的个数、英文字母的个数和字符串的长度</span><br><span class="line">;算法：HEXTODEC 使用加法运算</span><br><span class="line">assume cs:code,ds:data,ss:stack</span><br><span class="line"></span><br><span class="line">data segment</span><br><span class="line">buffer db 128 dup(0)    ;未初始化数据要放在最前面</span><br><span class="line">string1 db &#x27;The number of letters is: %u&#x27;,0,0</span><br><span class="line">string2 db &#x27;The number of numbers is: %u&#x27;,0,0</span><br><span class="line">string3 db &#x27;String length is: %u&#x27;,0,0</span><br><span class="line">data ends</span><br><span class="line"></span><br><span class="line">stack segment</span><br><span class="line">print_buffer db 128 dup(0)</span><br><span class="line">stack ends </span><br><span class="line"></span><br><span class="line">code segment</span><br><span class="line">start:</span><br><span class="line">    mov ax,data</span><br><span class="line">    mov ds,ax</span><br><span class="line">    mov ax,stack</span><br><span class="line">    mov ss,ax</span><br><span class="line">    ;</span><br><span class="line">    lea bx,buffer</span><br><span class="line">    call INPUT</span><br><span class="line">    ;</span><br><span class="line">    push ds</span><br><span class="line">    push bx</span><br><span class="line">    call CHARSTAT</span><br><span class="line">    add sp,4</span><br><span class="line">    ;</span><br><span class="line">    lea dx,string1</span><br><span class="line">    push dx</span><br><span class="line">    xor dx,dx</span><br><span class="line">    mov dl,ah</span><br><span class="line">    push dx</span><br><span class="line">    call far ptr print</span><br><span class="line">    ;</span><br><span class="line">    call NEWLINE</span><br><span class="line">    ;</span><br><span class="line">    lea dx,string2</span><br><span class="line">    push dx</span><br><span class="line">    xor dx,dx</span><br><span class="line">    mov dl,al</span><br><span class="line">    push dx</span><br><span class="line">    call far ptr print</span><br><span class="line">    ;</span><br><span class="line">    call NEWLINE</span><br><span class="line">    ;</span><br><span class="line">    lea dx,buffer</span><br><span class="line">    push ds</span><br><span class="line">    push dx</span><br><span class="line">    call STRLEN</span><br><span class="line">    add sp,8</span><br><span class="line">    ;</span><br><span class="line">    lea dx,string3</span><br><span class="line">    push dx</span><br><span class="line">    push ax</span><br><span class="line">    call far ptr print</span><br><span class="line">    ;</span><br><span class="line">    mov ax,4c00h</span><br><span class="line">    int 21h</span><br><span class="line"></span><br><span class="line">;--------------------------------------------------------</span><br><span class="line">INPUT PROC</span><br><span class="line">; 功能：接收输入，并存储到 128字节大小的 bufer 缓冲区中</span><br><span class="line">; 入口参数：bx=buffer缓冲区首地址</span><br><span class="line">; 出口参数：bx=buffer缓冲区首地址</span><br><span class="line">; 说    明：通过显示回车符形成回车，通过显示换行符形成换行</span><br><span class="line">;---------------------------------------------------------</span><br><span class="line">    pushf</span><br><span class="line">    push ax</span><br><span class="line">    push bx</span><br><span class="line">INPUT1:</span><br><span class="line">    mov ah,1</span><br><span class="line">    int 21h</span><br><span class="line">    cmp al,0dh</span><br><span class="line">    jz INPUT2</span><br><span class="line">    mov [bx],al</span><br><span class="line">    inc bx</span><br><span class="line">    jmp INPUT1</span><br><span class="line">INPUT2:</span><br><span class="line">    pop bx</span><br><span class="line">    pop ax</span><br><span class="line">    popf</span><br><span class="line">    ;</span><br><span class="line">    ret</span><br><span class="line">INPUT endp</span><br><span class="line"></span><br><span class="line">;-----------------------------------------------------</span><br><span class="line">CHARSTAT PROC</span><br><span class="line">; 功能：统计字符串中的字母、数字、其他字符的个数</span><br><span class="line">; 传参方式：堆栈传参</span><br><span class="line">; 入口参数：字符串起始地址的段值和偏移地址在堆栈中</span><br><span class="line">; 出口参数：AH=字母个数、AL=数字的个数</span><br><span class="line">;------------------------------------------------------</span><br><span class="line">    push bp</span><br><span class="line">    mov bp,sp</span><br><span class="line">    pushf</span><br><span class="line">    push es</span><br><span class="line">    push di</span><br><span class="line">    push bx</span><br><span class="line">    ;</span><br><span class="line">    mov di,[bp+4]</span><br><span class="line">    mov es,[bp+6]</span><br><span class="line">    xor ax,ax</span><br><span class="line">CHARSTAT1:</span><br><span class="line">    mov bl,es:[di]</span><br><span class="line">    ;判断是否读取结束</span><br><span class="line">    cmp bl,0</span><br><span class="line">    jz CHARSTAT_POP</span><br><span class="line">    ;判断小写字母</span><br><span class="line">    cmp bl,&#x27;a&#x27;</span><br><span class="line">    jae CHARSTAT3</span><br><span class="line">    ;判断大写字母</span><br><span class="line">    cmp bl,&#x27;A&#x27;</span><br><span class="line">    jae CHARSTAT2</span><br><span class="line">    ;判断数字</span><br><span class="line">    cmp bl,&#x27;0&#x27;</span><br><span class="line">    jae CHARSTAT0</span><br><span class="line">    inc di</span><br><span class="line">    jmp CHARSTAT1</span><br><span class="line">CHARSTAT0:</span><br><span class="line">    cmp bl,&#x27;9&#x27;</span><br><span class="line">    jbe number</span><br><span class="line">    inc di</span><br><span class="line">    jmp CHARSTAT1</span><br><span class="line">CHARSTAT2:</span><br><span class="line">    ;判断字母</span><br><span class="line">    cmp bl,&#x27;Z&#x27;</span><br><span class="line">    jb letter</span><br><span class="line">    inc di</span><br><span class="line">    jmp CHARSTAT1</span><br><span class="line">CHARSTAT3:</span><br><span class="line">    cmp bl,&#x27;z&#x27;</span><br><span class="line">    jb letter</span><br><span class="line">    inc di</span><br><span class="line">    jmp CHARSTAT1</span><br><span class="line">letter:</span><br><span class="line">    inc ah</span><br><span class="line">    inc di</span><br><span class="line">    jmp CHARSTAT1</span><br><span class="line">number:</span><br><span class="line">    inc al</span><br><span class="line">    inc di</span><br><span class="line">    jmp CHARSTAT1</span><br><span class="line">    ;</span><br><span class="line">CHARSTAT_POP:</span><br><span class="line">    pop bx</span><br><span class="line">    pop di</span><br><span class="line">    pop es</span><br><span class="line">    popf</span><br><span class="line">    mov sp,bp</span><br><span class="line">    pop bp</span><br><span class="line">    ;</span><br><span class="line">    ret</span><br><span class="line">CHARSTAT endp</span><br><span class="line"></span><br><span class="line">;-----------------------------------------------------</span><br><span class="line">STRLEN PROC</span><br><span class="line">; 功能：测量字符串的长度</span><br><span class="line">; 传参方式：堆栈传参</span><br><span class="line">; 入口参数：字符串起始地址的段值和偏移地址在堆栈中</span><br><span class="line">; 出口参数：AX=字符串长度</span><br><span class="line">;------------------------------------------------------</span><br><span class="line">    push bp</span><br><span class="line">    mov bp,sp</span><br><span class="line">    push es</span><br><span class="line">    push di</span><br><span class="line">    ;</span><br><span class="line">    xor ax,ax</span><br><span class="line">    mov di,[bp+4]</span><br><span class="line">    mov es,[bp+6]</span><br><span class="line">STRLEN1:</span><br><span class="line">    mov bl,es:[di]</span><br><span class="line">    cmp bl,0</span><br><span class="line">    jz STRLEN2</span><br><span class="line">    inc di</span><br><span class="line">    inc ax</span><br><span class="line">    jmp STRLEN1</span><br><span class="line">STRLEN2:</span><br><span class="line">    pop di</span><br><span class="line">    pop es</span><br><span class="line">    mov sp,bp</span><br><span class="line">    pop bp</span><br><span class="line">    ret</span><br><span class="line">STRLEN endp</span><br><span class="line"></span><br><span class="line">;--------------------------------------------------------</span><br><span class="line">NEWLINE PROC</span><br><span class="line">; 功能：形成回车和换行（光标移到写一行首）</span><br><span class="line">; 入口参数：无</span><br><span class="line">; 出口参数：无</span><br><span class="line">; 说    明：通过显示回车符形成回车，通过显示换行符形成换行</span><br><span class="line">;---------------------------------------------------------</span><br><span class="line">    push ax</span><br><span class="line">    push dx</span><br><span class="line">    mov dl,0dh</span><br><span class="line">    mov ah,2</span><br><span class="line">    int 21h</span><br><span class="line">    mov dl,0ah</span><br><span class="line">    mov ah,2</span><br><span class="line">    int 21h</span><br><span class="line">    pop dx</span><br><span class="line">    pop ax</span><br><span class="line">    ret</span><br><span class="line">NEWLINE endp</span><br><span class="line"></span><br><span class="line">print proc far  </span><br><span class="line">    push bp</span><br><span class="line">    mov bp,sp</span><br><span class="line">    push ds</span><br><span class="line">    push es</span><br><span class="line">    push ss</span><br><span class="line">    push si</span><br><span class="line">    push di</span><br><span class="line">    push ax</span><br><span class="line">    push bx</span><br><span class="line">    push cx</span><br><span class="line">    push dx</span><br><span class="line"></span><br><span class="line">    ;判断在字符串中是否有 %d、%s等（同时将字符串复制），结束标志0</span><br><span class="line">    ;初始化寄存器</span><br><span class="line">    xor si,si</span><br><span class="line">    xor di,di</span><br><span class="line">    mov si,[bp+8]</span><br><span class="line">    lea di,print_buffer</span><br><span class="line">print1:</span><br><span class="line">    mov ax,[si]</span><br><span class="line">    cmp ax,0</span><br><span class="line">    jz print_b</span><br><span class="line">    ;</span><br><span class="line">    cmp ax,&#x27;u%&#x27;</span><br><span class="line">    jz unsigned_int</span><br><span class="line">    ;</span><br><span class="line">    ;cmp ax,&#x27;%s&#x27;</span><br><span class="line">    ;jz %s</span><br><span class="line">    ;</span><br><span class="line">    ;cmp ax,&#x27;%x&#x27;</span><br><span class="line">    ;jz %x</span><br><span class="line">    mov ss:[di],al</span><br><span class="line">    inc si</span><br><span class="line">    ;inc si</span><br><span class="line">    ;inc di</span><br><span class="line">    inc di</span><br><span class="line">    jmp print1</span><br><span class="line">    ;有：%d（将十六进制转换为十进制，复制）、%s（指定偏移，复制）</span><br><span class="line">unsigned_int:</span><br><span class="line">    call HEXTODEC</span><br><span class="line">    ;无：输出结果</span><br><span class="line">print_b:</span><br><span class="line"></span><br><span class="line">    mov al,&#x27;$&#x27;</span><br><span class="line">    mov ss:[di],al</span><br><span class="line">    mov ax,ss</span><br><span class="line">    mov ds,ax</span><br><span class="line">    lea dx,print_buffer</span><br><span class="line">    mov ah,9</span><br><span class="line">    int 21h</span><br><span class="line">;</span><br><span class="line">    pop dx</span><br><span class="line">    pop cx</span><br><span class="line">    pop bx</span><br><span class="line">    pop ax</span><br><span class="line">    pop di</span><br><span class="line">    pop si</span><br><span class="line">    pop ss</span><br><span class="line">    pop es</span><br><span class="line">    pop ds</span><br><span class="line">    mov sp,bp</span><br><span class="line">    pop bp</span><br><span class="line">    ret</span><br><span class="line">print endp</span><br><span class="line"></span><br><span class="line">HEXTODEC PROC</span><br><span class="line">    xor dx,dx</span><br><span class="line">    mov ax,[bp+6]</span><br><span class="line">    mov bx,ax</span><br><span class="line">    ;结果小于9，就直接+30h，存储到ss:di中</span><br><span class="line">    cmp ax,9</span><br><span class="line">    jbe HEXTODEC4</span><br><span class="line">HEXTODEC1:</span><br><span class="line">    add ax,6</span><br><span class="line">    adc dl,dl</span><br><span class="line">    sub bx,0ah</span><br><span class="line">    cmp bx,9</span><br><span class="line">    jbe HEXTODEC2</span><br><span class="line">    jmp HEXTODEC1</span><br><span class="line">    ;运算结束后，判断是否有进位</span><br><span class="line">HEXTODEC2:</span><br><span class="line">    cmp dl,0</span><br><span class="line">    jz HEXTODEC3</span><br><span class="line">    ;有进位，先存储dl，再存储ax</span><br><span class="line">    add dl,30h</span><br><span class="line">    mov ss:[di],dl</span><br><span class="line">    inc di</span><br><span class="line">HEXTODEC3:</span><br><span class="line">    ;无进位，处理ax，并存储到 ss:di 中</span><br><span class="line">    call HTASCS</span><br><span class="line">    jmp HEXTODEC5</span><br><span class="line">HEXTODEC4:          </span><br><span class="line">    add al,30h</span><br><span class="line">    mov ss:[di],al</span><br><span class="line">    inc di</span><br><span class="line">HEXTODEC5:</span><br><span class="line">    ;</span><br><span class="line">    ret</span><br><span class="line">HEXTODEC endp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">;-----------------------------------------------------</span><br><span class="line">HTASCS PROC</span><br><span class="line">; 功能：把一个字大小的16进制数(每个位必须&lt;=9)，转换成4个ASCII码,存储内存中。</span><br><span class="line">; 传参方式：寄存器传参</span><br><span class="line">; 入口参数：AX</span><br><span class="line">; 出口参数：ss:di（位置可自定义）</span><br><span class="line">;-----------------------------------------------------</span><br><span class="line">    mov cx,4</span><br><span class="line">    mov bh,0        ;bh 作为计数器，判断最高位是否为0。默认最高位是0</span><br><span class="line">HTASCS1:</span><br><span class="line">    ROL AX,1</span><br><span class="line">    ROL AX,1</span><br><span class="line">    ROL AX,1</span><br><span class="line">    ROL AX,1</span><br><span class="line">    mov bl,al</span><br><span class="line">    and bl,0fh</span><br><span class="line">    cmp bl,0</span><br><span class="line">    jnz HTASCS2      ;判断最高位是否为0，不为0，bh置1</span><br><span class="line">    cmp bh,1</span><br><span class="line">    jz HTASCS3       ;如果最高位大于等于1，保存结果</span><br><span class="line">    jmp HTASCS4      ;如果最高位是0，就不保存结果</span><br><span class="line">HTASCS2:</span><br><span class="line">    mov bh,1</span><br><span class="line">HTASCS3:</span><br><span class="line">    add bl,30h</span><br><span class="line">    mov ss:[di],bl</span><br><span class="line">    inc di</span><br><span class="line">HTASCS4:</span><br><span class="line">    loop HTASCS1</span><br><span class="line">    ret</span><br><span class="line">HTASCS endp</span><br><span class="line">code ends</span><br><span class="line">end start</span><br></pre></td></tr></table></figure></li>
</ol>
<blockquote>
<p>T4-12-1 的子程序 “HTASCS”，将一个字的十进制数转换为ASCII，并保存到 ss:di。同时会判断最高的位置，并存储相应值。</p>
</blockquote>
<ol start="3">
<li>使用 int21 接收字符串输入<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br></pre></td><td class="code"><pre><span class="line">;程序名：T4-12-2.asm</span><br><span class="line">;功能：写一个程序，它先接收一个字符串，然后显示其中数字符的个数、英文字母的个数和字符串的长度</span><br><span class="line">;使用 int21 中断，10号功能接收输入</span><br><span class="line">assume cs:code,ds:data,ss:stack</span><br><span class="line"></span><br><span class="line">data segment</span><br><span class="line">MLENGTH = 128</span><br><span class="line">buffer db MLENGTH</span><br><span class="line">       db 0</span><br><span class="line">       db MLENGTH dup (0)</span><br><span class="line">string1 db &#x27;The number of letters is: %u&#x27;,0,0</span><br><span class="line">string2 db &#x27;The number of numbers is: %u&#x27;,0,0</span><br><span class="line">string3 db &#x27;String length is: %u&#x27;,0,0</span><br><span class="line">data ends</span><br><span class="line"></span><br><span class="line">stack segment</span><br><span class="line">print_buffer db 128 dup(0)</span><br><span class="line">stack ends </span><br><span class="line"></span><br><span class="line">code segment</span><br><span class="line">start:</span><br><span class="line">    mov ax,data</span><br><span class="line">    mov ds,ax</span><br><span class="line">    mov ax,stack</span><br><span class="line">    mov ss,ax</span><br><span class="line">    ;</span><br><span class="line">    ;lea bx,buffer</span><br><span class="line">    ;call INPUT</span><br><span class="line">    mov dx,offset buffer</span><br><span class="line">    mov ah,10</span><br><span class="line">    int 21h</span><br><span class="line">    ;</span><br><span class="line">    push ds</span><br><span class="line">    mov bx,offset buffer+2</span><br><span class="line">    push bx</span><br><span class="line">    call CHARSTAT</span><br><span class="line">    add sp,4</span><br><span class="line">    ;</span><br><span class="line">    lea dx,string1</span><br><span class="line">    push dx</span><br><span class="line">    xor dx,dx</span><br><span class="line">    mov dl,ah</span><br><span class="line">    push dx</span><br><span class="line">    call far ptr print</span><br><span class="line">    ;</span><br><span class="line">    call NEWLINE</span><br><span class="line">    ;</span><br><span class="line">    lea dx,string2</span><br><span class="line">    push dx</span><br><span class="line">    xor dx,dx</span><br><span class="line">    mov dl,al</span><br><span class="line">    push dx</span><br><span class="line">    call far ptr print</span><br><span class="line">    ;</span><br><span class="line">    call NEWLINE</span><br><span class="line">    ;</span><br><span class="line">    mov dx,offset buffer+2  ;使用 int21 中断，10号功能接收字符串，字符串首地址偏移需要+2</span><br><span class="line">    push ds</span><br><span class="line">    push dx</span><br><span class="line">    call STRLEN</span><br><span class="line">    add sp,8</span><br><span class="line">    ;</span><br><span class="line">    lea dx,string3</span><br><span class="line">    push dx</span><br><span class="line">    push ax</span><br><span class="line">    call far ptr print</span><br><span class="line">    ;</span><br><span class="line">    mov ax,4c00h</span><br><span class="line">    int 21h</span><br><span class="line"></span><br><span class="line">;-----------------------------------------------------</span><br><span class="line">CHARSTAT PROC</span><br><span class="line">; 功能：统计字符串中的字母、数字、其他字符的个数</span><br><span class="line">; 传参方式：堆栈传参</span><br><span class="line">; 入口参数：字符串起始地址的段值和偏移地址在堆栈中</span><br><span class="line">; 出口参数：AH=字母个数、AL=数字的个数</span><br><span class="line">;------------------------------------------------------</span><br><span class="line">    push bp</span><br><span class="line">    mov bp,sp</span><br><span class="line">    pushf</span><br><span class="line">    push es</span><br><span class="line">    push di</span><br><span class="line">    push bx</span><br><span class="line">    ;</span><br><span class="line">    mov di,[bp+4]</span><br><span class="line">    mov es,[bp+6]</span><br><span class="line">    xor ax,ax</span><br><span class="line">CHARSTAT1:</span><br><span class="line">    mov bl,es:[di]</span><br><span class="line">    ;判断是否读取结束,这里用0dh</span><br><span class="line">    cmp bl,0dh</span><br><span class="line">    jz CHARSTAT_POP</span><br><span class="line">    ;判断小写字母</span><br><span class="line">    cmp bl,&#x27;a&#x27;</span><br><span class="line">    jae CHARSTAT3</span><br><span class="line">    ;判断大写字母</span><br><span class="line">    cmp bl,&#x27;A&#x27;</span><br><span class="line">    jae CHARSTAT2</span><br><span class="line">    ;判断数字</span><br><span class="line">    cmp bl,&#x27;0&#x27;</span><br><span class="line">    jae CHARSTAT0</span><br><span class="line">    inc di</span><br><span class="line">    jmp CHARSTAT1</span><br><span class="line">CHARSTAT0:</span><br><span class="line">    cmp bl,&#x27;9&#x27;</span><br><span class="line">    jbe number</span><br><span class="line">    inc di</span><br><span class="line">    jmp CHARSTAT1</span><br><span class="line">CHARSTAT2:</span><br><span class="line">    ;判断字母</span><br><span class="line">    cmp bl,&#x27;Z&#x27;</span><br><span class="line">    jb letter</span><br><span class="line">    inc di</span><br><span class="line">    jmp CHARSTAT1</span><br><span class="line">CHARSTAT3:</span><br><span class="line">    cmp bl,&#x27;z&#x27;</span><br><span class="line">    jb letter</span><br><span class="line">    inc di</span><br><span class="line">    jmp CHARSTAT1</span><br><span class="line">letter:</span><br><span class="line">    inc ah</span><br><span class="line">    inc di</span><br><span class="line">    jmp CHARSTAT1</span><br><span class="line">number:</span><br><span class="line">    inc al</span><br><span class="line">    inc di</span><br><span class="line">    jmp CHARSTAT1</span><br><span class="line">    ;</span><br><span class="line">CHARSTAT_POP:</span><br><span class="line">    pop bx</span><br><span class="line">    pop di</span><br><span class="line">    pop es</span><br><span class="line">    popf</span><br><span class="line">    mov sp,bp</span><br><span class="line">    pop bp</span><br><span class="line">    ;</span><br><span class="line">    ret</span><br><span class="line">CHARSTAT endp</span><br><span class="line"></span><br><span class="line">;-----------------------------------------------------</span><br><span class="line">STRLEN PROC</span><br><span class="line">; 功能：测量字符串的长度</span><br><span class="line">; 传参方式：堆栈传参</span><br><span class="line">; 入口参数：字符串起始地址的段值和偏移地址在堆栈中</span><br><span class="line">; 出口参数：AX=字符串长度</span><br><span class="line">;------------------------------------------------------</span><br><span class="line">    push bp</span><br><span class="line">    mov bp,sp</span><br><span class="line">    push es</span><br><span class="line">    push di</span><br><span class="line">    ;</span><br><span class="line">    xor ax,ax</span><br><span class="line">    mov di,[bp+4]</span><br><span class="line">    mov es,[bp+6]</span><br><span class="line">STRLEN1:</span><br><span class="line">    mov bl,es:[di]</span><br><span class="line">    cmp bl,0dh      ;int 21号功能，字符串最后存储的是0dh</span><br><span class="line">    jz STRLEN2</span><br><span class="line">    inc di</span><br><span class="line">    inc ax</span><br><span class="line">    jmp STRLEN1</span><br><span class="line">STRLEN2:</span><br><span class="line">    pop di</span><br><span class="line">    pop es</span><br><span class="line">    mov sp,bp</span><br><span class="line">    pop bp</span><br><span class="line">    ret</span><br><span class="line">STRLEN endp</span><br><span class="line"></span><br><span class="line">;--------------------------------------------------------</span><br><span class="line">NEWLINE PROC</span><br><span class="line">; 功能：形成回车和换行（光标移到写一行首）</span><br><span class="line">; 入口参数：无</span><br><span class="line">; 出口参数：无</span><br><span class="line">; 说    明：通过显示回车符形成回车，通过显示换行符形成换行</span><br><span class="line">;---------------------------------------------------------</span><br><span class="line">    push ax</span><br><span class="line">    push dx</span><br><span class="line">    mov dl,0dh</span><br><span class="line">    mov ah,2</span><br><span class="line">    int 21h</span><br><span class="line">    mov dl,0ah</span><br><span class="line">    mov ah,2</span><br><span class="line">    int 21h</span><br><span class="line">    pop dx</span><br><span class="line">    pop ax</span><br><span class="line">    ret</span><br><span class="line">NEWLINE endp</span><br><span class="line"></span><br><span class="line">print proc far  </span><br><span class="line">    push bp</span><br><span class="line">    mov bp,sp</span><br><span class="line">    push ds</span><br><span class="line">    push es</span><br><span class="line">    push ss</span><br><span class="line">    push si</span><br><span class="line">    push di</span><br><span class="line">    push ax</span><br><span class="line">    push bx</span><br><span class="line">    push cx</span><br><span class="line">    push dx</span><br><span class="line"></span><br><span class="line">    ;判断在字符串中是否有 %d、%s等（同时将字符串复制），结束标志0</span><br><span class="line">    ;初始化寄存器</span><br><span class="line">    xor si,si</span><br><span class="line">    xor di,di</span><br><span class="line">    mov si,[bp+8]</span><br><span class="line">    lea di,print_buffer</span><br><span class="line">print1:</span><br><span class="line">    mov ax,[si]</span><br><span class="line">    cmp ax,0</span><br><span class="line">    jz print_b</span><br><span class="line">    ;</span><br><span class="line">    cmp ax,&#x27;u%&#x27;</span><br><span class="line">    jz unsigned_int</span><br><span class="line">    ;</span><br><span class="line">    ;cmp ax,&#x27;%s&#x27;</span><br><span class="line">    ;jz %s</span><br><span class="line">    ;</span><br><span class="line">    ;cmp ax,&#x27;%x&#x27;</span><br><span class="line">    ;jz %x</span><br><span class="line">    mov ss:[di],al</span><br><span class="line">    inc si</span><br><span class="line">    ;inc si</span><br><span class="line">    ;inc di</span><br><span class="line">    inc di</span><br><span class="line">    jmp print1</span><br><span class="line">    ;有：%d（将十六进制转换为十进制，复制）、%s（指定偏移，复制）</span><br><span class="line">unsigned_int:</span><br><span class="line">    call HEXTODEC</span><br><span class="line">    ;无：输出结果</span><br><span class="line">print_b:</span><br><span class="line"></span><br><span class="line">    mov al,&#x27;$&#x27;</span><br><span class="line">    mov ss:[di],al</span><br><span class="line">    mov ax,ss</span><br><span class="line">    mov ds,ax</span><br><span class="line">    lea dx,print_buffer</span><br><span class="line">    mov ah,9</span><br><span class="line">    int 21h</span><br><span class="line">;</span><br><span class="line">    pop dx</span><br><span class="line">    pop cx</span><br><span class="line">    pop bx</span><br><span class="line">    pop ax</span><br><span class="line">    pop di</span><br><span class="line">    pop si</span><br><span class="line">    pop ss</span><br><span class="line">    pop es</span><br><span class="line">    pop ds</span><br><span class="line">    mov sp,bp</span><br><span class="line">    pop bp</span><br><span class="line">    ret</span><br><span class="line">print endp</span><br><span class="line"></span><br><span class="line">HEXTODEC PROC</span><br><span class="line">    xor dx,dx</span><br><span class="line">    mov ax,[bp+6]</span><br><span class="line">    mov bx,ax</span><br><span class="line">    ;结果小于9，就直接+30h，存储到ss:di中</span><br><span class="line">    cmp ax,9</span><br><span class="line">    jbe HEXTODEC4</span><br><span class="line">HEXTODEC1:</span><br><span class="line">    add ax,6</span><br><span class="line">    adc dl,dl</span><br><span class="line">    sub bx,0ah</span><br><span class="line">    cmp bx,9</span><br><span class="line">    jbe HEXTODEC2</span><br><span class="line">    jmp HEXTODEC1</span><br><span class="line">    ;运算结束后，判断是否有进位</span><br><span class="line">HEXTODEC2:</span><br><span class="line">    cmp dl,0</span><br><span class="line">    jz HEXTODEC3</span><br><span class="line">    ;有进位，先存储dl，再存储ax</span><br><span class="line">    add dl,30h</span><br><span class="line">    mov ss:[di],dl</span><br><span class="line">    inc di</span><br><span class="line">HEXTODEC3:</span><br><span class="line">    ;无进位，处理ax，并存储到 ss:di 中</span><br><span class="line">    call HTASCS</span><br><span class="line">    jmp HEXTODEC5</span><br><span class="line">HEXTODEC4:          </span><br><span class="line">    add al,30h</span><br><span class="line">    mov ss:[di],al</span><br><span class="line">    inc di</span><br><span class="line">HEXTODEC5:</span><br><span class="line">    ;</span><br><span class="line">    ret</span><br><span class="line">HEXTODEC endp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">;-----------------------------------------------------</span><br><span class="line">HTASCS PROC</span><br><span class="line">; 功能：把一个字大小的16进制数(每个位必须&lt;=9)，转换成4个ASCII码,存储内存中。</span><br><span class="line">; 传参方式：寄存器传参</span><br><span class="line">; 入口参数：AX，</span><br><span class="line">; 出口参数：ss:di（位置可自定义）</span><br><span class="line">;-----------------------------------------------------</span><br><span class="line">    mov cx,4</span><br><span class="line">    mov bh,0        ;bh 作为计数器，判断最高位是否为0。默认最高位是0</span><br><span class="line">HTASCS1:</span><br><span class="line">    ROL AX,1</span><br><span class="line">    ROL AX,1</span><br><span class="line">    ROL AX,1</span><br><span class="line">    ROL AX,1</span><br><span class="line">    mov bl,al</span><br><span class="line">    and bl,0fh</span><br><span class="line">    cmp bl,0</span><br><span class="line">    jnz HTASCS2      ;判断最高位是否为0，不为0，bh置1</span><br><span class="line">    cmp bh,1</span><br><span class="line">    jz HTASCS3       ;如果最高位大于等于1，保存结果</span><br><span class="line">    jmp HTASCS4      ;如果最高位是0，就不保存结果</span><br><span class="line">HTASCS2:</span><br><span class="line">    mov bh,1</span><br><span class="line">HTASCS3:</span><br><span class="line">    add bl,30h</span><br><span class="line">    mov ss:[di],bl</span><br><span class="line">    inc di</span><br><span class="line">HTASCS4:</span><br><span class="line">    loop HTASCS1</span><br><span class="line">    ret</span><br><span class="line">HTASCS endp</span><br><span class="line">code ends</span><br><span class="line">end start</span><br></pre></td></tr></table></figure></li>
</ol>
<p>上面的程序执行结束后会出现问题，第一行的输出结果会错误，但是在调试过程中是正确的。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/189300226-5aadb27a-39d9-4bd2-87b4-51d694b754eb.png"
                      alt="图片"
                ></p>
<blockquote>
<p>我认为是 int21 的10号功能，接收字符串输入之后，屏幕光标位置会重新定位还原到之前的输入点。后面输出结果会覆盖之前的输入的字符串，问题在于当前输出的结果，没有输入字符串长，那么多出来的这几个字符并不会被覆盖，导致第一行显示结果错误。</p>
</blockquote>
<h3 id="例4"><a href="#例4" class="headerlink" title="例4"></a>例4</h3><p>写一个显示指定内存单元内容的程序。具体要求是：用户按十六进制数的形式输入指定内存单元的段值和偏移，然后用十六进制数形式显示指定字节单元的内容。</p>
<h4 id="程序流程图-11"><a href="#程序流程图-11" class="headerlink" title="程序流程图"></a>程序流程图</h4><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/189802089-e98f37b1-0822-4127-8fe5-a5ab713d92b6.png"
                      alt="T4-13"
                ></p>
<h4 id="代码-13"><a href="#代码-13" class="headerlink" title="代码"></a>代码</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br></pre></td><td class="code"><pre><span class="line">;程序名：T4-13.asm</span><br><span class="line">;写一个显示指定内存单元内容的程序。</span><br><span class="line">;具体要求是：用户按十六进制数的形式输入指定内存单元的段值和偏移，然后用十六进制数形式显示指定字节单元的内容。</span><br><span class="line">;子程序名：GETADR</span><br><span class="line">assume cs:code,ds:data</span><br><span class="line"></span><br><span class="line">data segment</span><br><span class="line">addr dw 0</span><br><span class="line">string db &#x27;1&#x27;</span><br><span class="line">segr db 0,0,0,0</span><br><span class="line">error db &#x27;Please enter the correct memory address&#x27;,&#x27;$&#x27;</span><br><span class="line">data ends</span><br><span class="line"></span><br><span class="line">code segment</span><br><span class="line">start:</span><br><span class="line">    mov ax,data     ;这里的data是随机变动的，要输出指定位置的内存是需要指定段地址</span><br><span class="line">    mov ds,ax</span><br><span class="line">    ;</span><br><span class="line">    lea si,segr</span><br><span class="line">    lea di,addr</span><br><span class="line">    call GETADR</span><br><span class="line">    ;</span><br><span class="line">    mov dl,20h</span><br><span class="line">    mov ah,2</span><br><span class="line">    int 21h</span><br><span class="line">    ;</span><br><span class="line">    mov al,byte ptr es:[di]</span><br><span class="line">    call AHTOASC</span><br><span class="line">    mov cx,2</span><br><span class="line">    mov dx,ax</span><br><span class="line">L1:</span><br><span class="line">    xchg dh,dl</span><br><span class="line">    mov ah,2</span><br><span class="line">    int 21h</span><br><span class="line">    loop L1</span><br><span class="line">    ;</span><br><span class="line">    mov ax,4c00h</span><br><span class="line">    int 21h</span><br><span class="line"></span><br><span class="line">;-----------------------------------------------------</span><br><span class="line">GETADR PROC</span><br><span class="line">; 功能：用户输入的十六进制转换成二进制 &quot;段值:偏移&quot;</span><br><span class="line">; 传参方式：ds:si=需要处理数据的缓冲区首地址,ds:di=存入结果的缓冲区首地址</span><br><span class="line">; 入口参数：无</span><br><span class="line">; 出口参数：ES:DI</span><br><span class="line">;------------------------------------------------------</span><br><span class="line">    pushf</span><br><span class="line">    push ax</span><br><span class="line">    push dx</span><br><span class="line">    push bx</span><br><span class="line">    ;</span><br><span class="line">    ;获取段地址</span><br><span class="line">    call GETSTR</span><br><span class="line">    mov bx,[di]</span><br><span class="line">    mov es,bx</span><br><span class="line">    ;获取分隔符</span><br><span class="line">    mov ah,1</span><br><span class="line">    int 21h</span><br><span class="line">    ;获取偏移</span><br><span class="line">    call GETSTR</span><br><span class="line">    mov bx,[di]</span><br><span class="line">    mov di,bx</span><br><span class="line">    ;判断分隔符是否为冒号</span><br><span class="line">    cmp al,3ah</span><br><span class="line">    jnz GETADR_error</span><br><span class="line">    ;</span><br><span class="line">    mov ax,es</span><br><span class="line">    cmp ax,-1</span><br><span class="line">    jz GETADR_error</span><br><span class="line">    cmp di,-1</span><br><span class="line">    jz GETADR_error</span><br><span class="line">    ;</span><br><span class="line">GETADR1:</span><br><span class="line">    pop bx</span><br><span class="line">    pop dx</span><br><span class="line">    pop ax</span><br><span class="line">    popf</span><br><span class="line">    ret</span><br><span class="line">GETADR_error:</span><br><span class="line">    call NEWLINE</span><br><span class="line">    mov dx,offset error</span><br><span class="line">    mov ah,9</span><br><span class="line">    int 21h</span><br><span class="line">    mov ax,4c00h</span><br><span class="line">    int 21h</span><br><span class="line">;    pop bx</span><br><span class="line">;    pop dx</span><br><span class="line">;    pop ax</span><br><span class="line">;    popf</span><br><span class="line">GETADR endp</span><br><span class="line"></span><br><span class="line">;--------------------------------------------------------</span><br><span class="line">GETSTR PROC</span><br><span class="line">; 功能：接收4个键盘输入0~9、A~F、a~f。</span><br><span class="line">; 入口参数：si=buffer缓冲区首地址</span><br><span class="line">; 出口参数：di=存储结果的缓冲区首地址,如果输入错误bx=-1</span><br><span class="line">;---------------------------------------------------------</span><br><span class="line">    pushf</span><br><span class="line">    push ax</span><br><span class="line">    push cx</span><br><span class="line">    push si</span><br><span class="line">    xor bx,bx</span><br><span class="line">    xor ax,ax</span><br><span class="line">    mov cx,4</span><br><span class="line">GETSTR0:</span><br><span class="line">    ;接收输入</span><br><span class="line">    mov ah,1</span><br><span class="line">    int 21h</span><br><span class="line">    </span><br><span class="line">    ;处理数字</span><br><span class="line">    sub al,30h</span><br><span class="line">    jb GETSTR_error</span><br><span class="line">    cmp al,9</span><br><span class="line">    ja GETSTR1</span><br><span class="line">    jmp GETSTR_loop</span><br><span class="line">    ;</span><br><span class="line">GETSTR1:</span><br><span class="line">    ;处理大写字母</span><br><span class="line">    sub al,7</span><br><span class="line">    cmp al,0ah</span><br><span class="line">    jb GETSTR_error</span><br><span class="line">    cmp al,0fh</span><br><span class="line">    ja GETSTR2</span><br><span class="line">    jmp GETSTR_loop</span><br><span class="line">GETSTR2:</span><br><span class="line">    ;处理小写字母</span><br><span class="line">    sub al,20h</span><br><span class="line">    cmp al,0ah</span><br><span class="line">    jb GETSTR_error</span><br><span class="line">    cmp al,0fh</span><br><span class="line">    ja GETSTR_error</span><br><span class="line">    jmp GETSTR_loop</span><br><span class="line">GETSTR_error:</span><br><span class="line">    mov bx,-1</span><br><span class="line">    jmp GETSTR_pop</span><br><span class="line">    ;</span><br><span class="line">GETSTR_loop:</span><br><span class="line">    ;将每次循环处理好的字符存到buffer中</span><br><span class="line">    mov byte ptr [si],al</span><br><span class="line">    inc si</span><br><span class="line">    loop GETSTR0</span><br><span class="line">    ;</span><br><span class="line">GETSTR_pop:</span><br><span class="line">    sub si,4</span><br><span class="line">    call INOADR</span><br><span class="line">    ;</span><br><span class="line">    pop si</span><br><span class="line">    pop cx</span><br><span class="line">    pop ax</span><br><span class="line">    popf</span><br><span class="line">    ret</span><br><span class="line">GETSTR endp</span><br><span class="line"></span><br><span class="line">;--------------------------------------------------------</span><br><span class="line">INOADR PROC</span><br><span class="line">; 功能：将处理好的输入，转换为地址</span><br><span class="line">; 入口参数：si=需要处理数据的缓冲区首地址,di=存入结果的buffer缓冲区首地址</span><br><span class="line">; 出口参数：di=存入结果的buffer缓冲区首地址</span><br><span class="line">;---------------------------------------------------------</span><br><span class="line">    pushf</span><br><span class="line">    push ax</span><br><span class="line">    push cx</span><br><span class="line">    push si</span><br><span class="line">    ;</span><br><span class="line">    xor ax,ax</span><br><span class="line">    xor bx,bx</span><br><span class="line">    mov dx,4</span><br><span class="line">    mov cx,4</span><br><span class="line">INOADR1:</span><br><span class="line">    ;处理数据</span><br><span class="line">    mov al,byte ptr [si]</span><br><span class="line">    inc si</span><br><span class="line">    or bl,al</span><br><span class="line">    dec dx</span><br><span class="line">    jz INOADR2</span><br><span class="line">    shl bx,cl</span><br><span class="line">    jmp INOADR1</span><br><span class="line">INOADR2:</span><br><span class="line">    mov word ptr [di],bx</span><br><span class="line">    pop si</span><br><span class="line">    pop cx</span><br><span class="line">    pop ax</span><br><span class="line">    popf</span><br><span class="line">    ret</span><br><span class="line">INOADR endp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">;-----------------------------------------------------</span><br><span class="line">AHTOASC PROC</span><br><span class="line">;</span><br><span class="line">; 功能：把8位二进制数转换为2位 ASCII 码</span><br><span class="line">; 传参方式：寄存器传参</span><br><span class="line">; 入口参数：AL=要转换的值</span><br><span class="line">; 出口参数：AH = 十六进制数高位的 ASCII 码</span><br><span class="line">;           AL = 十六进制数低位的 ASCII 码</span><br><span class="line">;其他说明：(1)近过程</span><br><span class="line">;          (2)除 AX 寄存器外,不影响其他寄存器</span><br><span class="line">;          (3)调用HTOASC 实现十六进制数到ASCII码的转换</span><br><span class="line">;-----------------------------------------------------</span><br><span class="line">    mov ah,al</span><br><span class="line">    shr al,1</span><br><span class="line">    shr al,1</span><br><span class="line">    shr al,1</span><br><span class="line">    shr al,1</span><br><span class="line">    call HTOASC</span><br><span class="line">    xchg ah,al</span><br><span class="line">    call HTOASC</span><br><span class="line">    ret</span><br><span class="line">AHTOASC endp</span><br><span class="line"></span><br><span class="line">;-----------------------------------------------------</span><br><span class="line">HTOASC PROC NEAR</span><br><span class="line">;</span><br><span class="line">; 功能：把一个十六进制数转换为对应的 ASCII 码</span><br><span class="line">; 传参方式：寄存器传参</span><br><span class="line">; 入口参数：al</span><br><span class="line">; 出口参数：al</span><br><span class="line">;-----------------------------------------------------</span><br><span class="line">    pushf</span><br><span class="line">    and al,0fh</span><br><span class="line">    cmp al,0ah</span><br><span class="line">    jb num_add</span><br><span class="line">    add al,37h</span><br><span class="line">    jmp pop_stack</span><br><span class="line">num_add:</span><br><span class="line">    add al,30h</span><br><span class="line">pop_stack:</span><br><span class="line">    popf</span><br><span class="line">    ret</span><br><span class="line">HTOASC endp</span><br><span class="line"></span><br><span class="line">;--------------------------------------------------------</span><br><span class="line">NEWLINE PROC</span><br><span class="line">; 功能：形成回车和换行（光标移到写一行首）</span><br><span class="line">; 入口参数：无</span><br><span class="line">; 出口参数：无</span><br><span class="line">; 说    明：通过显示回车符形成回车，通过显示换行符形成换行</span><br><span class="line">;---------------------------------------------------------</span><br><span class="line">    push ax</span><br><span class="line">    push dx</span><br><span class="line">    mov dl,0dh</span><br><span class="line">    mov ah,2</span><br><span class="line">    int 21h</span><br><span class="line">    mov dl,0ah</span><br><span class="line">    mov ah,2</span><br><span class="line">    int 21h</span><br><span class="line">    pop dx</span><br><span class="line">    pop ax</span><br><span class="line">    ret</span><br><span class="line">NEWLINE endp</span><br><span class="line">code ends</span><br><span class="line">    end start</span><br></pre></td></tr></table></figure>

<h1 id="磁盘文件管理及应用"><a href="#磁盘文件管理及应用" class="headerlink" title="磁盘文件管理及应用"></a>磁盘文件管理及应用</h1><p>DOS磁盘文件管理功能调用是 DOS 功能的重要组成部分，不仅有助于汇编语言程序设计练习，也有助于文件管理系统的理解。</p>
<h2 id="DOS-磁盘文件管理功能调用"><a href="#DOS-磁盘文件管理功能调用" class="headerlink" title="DOS 磁盘文件管理功能调用"></a>DOS 磁盘文件管理功能调用</h2><ol>
<li>DOS 磁盘文件管理功能调用中，用于表示文件名的ASCII字符串必须以 ASCII 码值 0 结尾，这样的字符串通常称为 ASCIIZ 串。</li>
<li>文件名可以是包含盘符和路径的文件标识。</li>
<li>如果没有盘符，那么默认是当盘，如果路径不是从根目录开始，那么就会从当前目录开始。</li>
</ol>
<p>这些功能调用均利用标志 CF 表示调用是否从成功，如果不成功，那么AX含有错误代码。常见错误代码如下：</p>
<table>
<thead>
<tr>
<th align="center">错误代码</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">01</td>
<td align="left">无效的功能号</td>
</tr>
<tr>
<td align="center">02</td>
<td align="left">文件未找到</td>
</tr>
<tr>
<td align="center">03</td>
<td align="left">路径未找到</td>
</tr>
<tr>
<td align="center">04</td>
<td align="left">同时打开文件太多</td>
</tr>
<tr>
<td align="center">05</td>
<td align="left">拒绝存取</td>
</tr>
<tr>
<td align="center">06</td>
<td align="left">无效的文件号(柄)</td>
</tr>
</tbody></table>
<h3 id="创建文件（3CH号功能调用）"><a href="#创建文件（3CH号功能调用）" class="headerlink" title="创建文件（3CH号功能调用）"></a>创建文件（3CH号功能调用）</h3><p>功能：创建一个新的或老的文件<br>入口参数：<br>        DS:DX&#x3D;文件名字符串首地址<br>        CX&#x3D;文件属性<br>出口参数：<br>        CF&#x3D;0 表示成功，AX&#x3D;文件号（柄）<br>        CF&#x3D;1 表示失败，AX&#x3D;错误代码</p>
<p>说明：</p>
<ol>
<li>可指定的文件属性</li>
</ol>
<table>
<thead>
<tr>
<th align="center">代码号</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">00H</td>
<td align="center">普通</td>
</tr>
<tr>
<td align="center">01H</td>
<td align="center">只读</td>
</tr>
<tr>
<td align="center">02H</td>
<td align="center">隐含</td>
</tr>
<tr>
<td align="center">04H</td>
<td align="center">系统</td>
</tr>
</tbody></table>
<ol start="2">
<li>文件创建成功后，文件长度定为0</li>
</ol>
<h3 id="打开文件（3DH号功能调用）"><a href="#打开文件（3DH号功能调用）" class="headerlink" title="打开文件（3DH号功能调用）"></a>打开文件（3DH号功能调用）</h3><p>功能：打开文件<br>入口参数：<br>        DS:DX&#x3D;代表文件名的字符串的首地址<br>        AL&#x3D;存取方式<br>出口参数：<br>        CF&#x3D;0 表示成功，AX&#x3D;文件号（柄）<br>        CF&#x3D;1 表示失败，AX&#x3D;错误代码。</p>
<ol>
<li>存取方式规定如下：</li>
</ol>
<table>
<thead>
<tr>
<th align="center">代码号</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">00H</td>
<td align="center">只读方式</td>
</tr>
<tr>
<td align="center">01H</td>
<td align="center">只写方式</td>
</tr>
<tr>
<td align="center">02H</td>
<td align="center">独写方式</td>
</tr>
</tbody></table>
<ol start="2">
<li>文件打开成功后，文件指针定位于开始的第一个字节（偏移0）处。</li>
</ol>
<h3 id="读文件（3FH号功能调用）"><a href="#读文件（3FH号功能调用）" class="headerlink" title="读文件（3FH号功能调用）"></a>读文件（3FH号功能调用）</h3><p>功能：读文件<br>入口参数：<br>        BX&#x3D;文件号（柄）<br>        CX&#x3D;字节数<br>        DS:DX&#x3D;准备存放所读数据的缓冲区首地址。<br>出口参数：<br>        CF&#x3D;0 表示成功，AX&#x3D;实际读到的字节数。<br>        CF&#x3D;1 表示失败，AX&#x3D;错误代码</p>
<p>说明：</p>
<ol>
<li>通常情况下,实际读到的字节数与需要读入的字节数相同，除非不够读。</li>
<li>缓冲区应保证能容下所读到的数据</li>
<li>文件应以读或读写方式打开</li>
<li>读文件后，文件指针将定位到读出字节之后的第一个字节处</li>
</ol>
<h3 id="写文件（40H号功能调用）"><a href="#写文件（40H号功能调用）" class="headerlink" title="写文件（40H号功能调用）"></a>写文件（40H号功能调用）</h3><p>功能：写文件<br>入口参数：<br>        BX&#x3D;文件号（柄）<br>        CX&#x3D;写入字节数<br>        DS:DX&#x3D;存放写数据的缓冲区的首地址<br>出口参数：<br>        CF&#x3D;0 表示成功，AX&#x3D;实际写入的字节数<br>        CF&#x3D;1 表示失败，AX&#x3D;错误代码<br>说明：</p>
<ol>
<li>通常情况下，实际写入的字节数与需要写入的字节数相同，除非磁盘已满</li>
<li>文件应以写或读写的方式打开</li>
<li>写文件后，文件指针将定位到写入字节后的第一个字节数</li>
</ol>
<h3 id="关闭文件（3EH号功能）"><a href="#关闭文件（3EH号功能）" class="headerlink" title="关闭文件（3EH号功能）"></a>关闭文件（3EH号功能）</h3><p>功能：关闭文件<br>入口参数：<br>        CF&#x3D;0 表示成功<br>        CF&#x3D;1 表示失败</p>
<p>说明：</p>
<ol>
<li>文件号是打开文件时系统给定的文件号。</li>
</ol>
<h3 id="移动文件读写指针（42H号功能调用）"><a href="#移动文件读写指针（42H号功能调用）" class="headerlink" title="移动文件读写指针（42H号功能调用）"></a>移动文件读写指针（42H号功能调用）</h3><p>功能：移动文件（读写）指针<br>入口参数：<br>        CF&#x3D;0 表示成功，此时 DX:AX&#x3D;移动后的文件指针值。<br>        CF&#x3D;1 表示失败，此时 AX&#x3D;1 表示无效的移动方式，AX&#x3D;6 表示无效的文件号。<br>说明：</p>
<ol>
<li><p>文件指针值（双字）是以问年间首字节为0计算的。</p>
</li>
<li><p>移动方式和表示的意义如下：</p>
<table>
<thead>
<tr>
<th align="center">代码号</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">00H</td>
<td align="center">移动文件后指针值&#x3D;0（文件头）+移动位移量</td>
</tr>
<tr>
<td align="center">01H</td>
<td align="center">当前文件指针值+移动位移量</td>
</tr>
<tr>
<td align="center">02H</td>
<td align="center">文件长（文件尾）+移动位移量</td>
</tr>
</tbody></table>
</li>
<li><p>在第一种移动方式中，移动位移量总是正的</p>
</li>
<li><p>在后两种移动方式中，移动位移量可正可负</p>
</li>
<li><p>该子功能不考虑文件指针是否超出文件范围</p>
</li>
</ol>
<h3 id="删除文件（41H号功能调用）"><a href="#删除文件（41H号功能调用）" class="headerlink" title="删除文件（41H号功能调用）"></a>删除文件（41H号功能调用）</h3><p>功能：删除文件<br>入口参数：<br>        DS:DX&#x3D;代表文件名的字符串首地址。<br>出口参数：<br>        CF&#x3D;0 表示成功<br>        CF&#x3D;1 表示失败，AX&#x3D;错误代码<br>说明：只能删除一个普通文件</p>
<h3 id="例1-7"><a href="#例1-7" class="headerlink" title="例1"></a>例1</h3><p>显示文本内容。文本文件固定为当前目录下的test.txt<br>文件读取流程：打开文件、读取文件、输出内容、关闭文件</p>
<p>打开文件：以只读方式打开文件，并且根据返回值输出不同的信息。<br>读文件：传入相应参数，判断有效读取字节数（AX）和将要读取字节数（CX）是否一致<br>关闭文件：如不能关闭文件，提示错误信息。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line">;程序名：T4-14.asm</span><br><span class="line">;功能：显示文本内容。文本文件固定为当前目录下的test.txt</span><br><span class="line">;执行过程：打开文件，按顺序读取文件，每次读一个字符，把所有字符在屏幕上显示出来，关闭文件。</span><br><span class="line">;txt文本文件结束符ASCII为1AH</span><br><span class="line"></span><br><span class="line">assume cs:code,ds:data</span><br><span class="line"></span><br><span class="line">data segment</span><br><span class="line">fname db &#x27;test.txt&#x27;,0</span><br><span class="line">handle dw 0</span><br><span class="line">buffer db 0</span><br><span class="line">flag db 0</span><br><span class="line">error1 db &#x27;ERROR: Invalid function&#x27;,07h,24h</span><br><span class="line">error2 db &#x27;ERROR: file cannot be found&#x27;,07h,24h</span><br><span class="line">error3 db &#x27;ERROR: path not found&#x27;,07h,24h</span><br><span class="line">error4 db &#x27;ERROR: Too many files open at the same time&#x27;,07h,24h</span><br><span class="line">error5 db &#x27;ERROR: Access Denied&#x27;,07h,24h</span><br><span class="line">error6 db &#x27;ERROR: cannot close file&#x27;,07h,24h</span><br><span class="line">data ends</span><br><span class="line"></span><br><span class="line">code segment</span><br><span class="line">start:</span><br><span class="line">    mov ax,data</span><br><span class="line">    mov ds,ax</span><br><span class="line">    ;</span><br><span class="line">    lea dx,fname</span><br><span class="line">    call far ptr openfile</span><br><span class="line">    ;</span><br><span class="line">read:</span><br><span class="line">    mov bx,handle</span><br><span class="line">    lea dx,buffer</span><br><span class="line">    mov cx,1</span><br><span class="line">    call far ptr readfile</span><br><span class="line">    mov ah,flag</span><br><span class="line">    cmp ah,1</span><br><span class="line">    jz closes</span><br><span class="line">    ;</span><br><span class="line">    mov dl,buffer</span><br><span class="line">    cmp dl,0</span><br><span class="line">    jz closes</span><br><span class="line">    cmp dl,1Ah</span><br><span class="line">    jz closes</span><br><span class="line">    call far ptr output</span><br><span class="line">    jmp read</span><br><span class="line">    ;</span><br><span class="line">closes:</span><br><span class="line">    mov bx,handle</span><br><span class="line">    call far ptr closefile</span><br><span class="line">    ;</span><br><span class="line">    mov ax,4c00h</span><br><span class="line">    int 21h</span><br><span class="line"></span><br><span class="line">;入口参数：DS:DX</span><br><span class="line">;出口参数：缓冲区handle</span><br><span class="line">openfile proc far</span><br><span class="line">    push bp</span><br><span class="line">    push si</span><br><span class="line">    push dx</span><br><span class="line">    ;</span><br><span class="line">    xor si,si</span><br><span class="line">    mov ax,3d00h    ;以只读方式打开文件</span><br><span class="line">    int 21h</span><br><span class="line">    jc next         </span><br><span class="line">    mov handle[si],ax</span><br><span class="line">    jmp stack</span><br><span class="line">next:</span><br><span class="line">    xor dl,dl</span><br><span class="line">    adc dl,0</span><br><span class="line">    mov flag,dl</span><br><span class="line">    ;</span><br><span class="line">    xor bh,bh</span><br><span class="line">    mov bl,2</span><br><span class="line">error:</span><br><span class="line">    cmp al,bl</span><br><span class="line">    jz error22</span><br><span class="line">    jz error33</span><br><span class="line">    jz error44</span><br><span class="line">    inc bl</span><br><span class="line">    jmp error</span><br><span class="line">error22:</span><br><span class="line">    mov dx,offset error2</span><br><span class="line">    jmp outputop</span><br><span class="line">error33:</span><br><span class="line">    mov dx,offset error3</span><br><span class="line">    jmp outputop</span><br><span class="line">error44:</span><br><span class="line">    mov dx,offset error3</span><br><span class="line">outputop:</span><br><span class="line">    mov ah,9</span><br><span class="line">    int 21h</span><br><span class="line">stack:</span><br><span class="line">    pop si</span><br><span class="line">    pop dx</span><br><span class="line">    pop bp</span><br><span class="line">    ret</span><br><span class="line">openfile endp</span><br><span class="line"></span><br><span class="line">;入口参数：bx（文件句柄）、dx 数据缓冲区地址、cx：读取多少字节</span><br><span class="line">readfile proc far</span><br><span class="line">    ;读取一个字节</span><br><span class="line">    mov ah,3Fh</span><br><span class="line">    int 21h</span><br><span class="line">    ;</span><br><span class="line">    cmp ax,cx</span><br><span class="line">    jz stack1</span><br><span class="line">    mov buffer,0</span><br><span class="line">stack1:</span><br><span class="line">    ret</span><br><span class="line">readfile endp</span><br><span class="line"></span><br><span class="line">output proc far</span><br><span class="line">    push ax</span><br><span class="line">    mov ah,02</span><br><span class="line">    int 21h</span><br><span class="line">    pop ax</span><br><span class="line">    ret</span><br><span class="line">output endp</span><br><span class="line"></span><br><span class="line">closefile proc far</span><br><span class="line">    mov ah,3EH</span><br><span class="line">    int 21h</span><br><span class="line">    jnc stack2</span><br><span class="line">    ;</span><br><span class="line">    mov dl,0ah</span><br><span class="line">    mov ah,2</span><br><span class="line">    int 21h</span><br><span class="line">    mov dx,offset error6</span><br><span class="line">    mov ah,9</span><br><span class="line">    int 21h</span><br><span class="line">stack2:</span><br><span class="line">    ret</span><br><span class="line">closefile endp</span><br><span class="line">code ends</span><br><span class="line">    end start</span><br></pre></td></tr></table></figure>
<blockquote>
<p>这段代码中多写了一些不必要且重复的判断。这个程序当时写的急，没有把各个子程序的信息详细写明。</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line">;程序名：T4-14-1.asm</span><br><span class="line">;功能：写一个显示文本文件内容的程序。文本文件固定为当前目录下的 TEST.TXT 文件</span><br><span class="line">;具体算法：(1) 打开文件</span><br><span class="line">;          (2) 按顺序读取文件，每次读一个字符，把所读字符在屏幕上显示出来</span><br><span class="line">;          (3) 关闭文件</span><br><span class="line">;说    明：考虑到 TEST.TXT 是文本文件，所以认为 ASCII 码的值为 1AH 的字符就是文件结束符。</span><br><span class="line">;子程序名：READCH</span><br><span class="line">assume ds:data,cs:code</span><br><span class="line"></span><br><span class="line">EOF = 1AH</span><br><span class="line">data segment</span><br><span class="line">fname db &#x27;test.txt&#x27;,0</span><br><span class="line">error1 db &#x27;File not found&#x27;,07h,0</span><br><span class="line">error2 db &#x27;Reading error&#x27;,07h,0</span><br><span class="line">buffer db ?</span><br><span class="line">data ends</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">code segment</span><br><span class="line">start:</span><br><span class="line">    mov ax,data</span><br><span class="line">    mov ds,ax</span><br><span class="line">    ;</span><br><span class="line">    mov dx,offset fname</span><br><span class="line">    mov ax,3d00h    ;只读模式打开文件</span><br><span class="line">    int 21h</span><br><span class="line">    jnc open_ok     ;打开成功</span><br><span class="line">    ;</span><br><span class="line">    mov si,offset error1</span><br><span class="line">    call  DMESS     ;显示打开不成功的信息</span><br><span class="line">    jmp over</span><br><span class="line">    ;</span><br><span class="line">open_ok:</span><br><span class="line">    mov bx,ax</span><br><span class="line">cont:</span><br><span class="line">    call READCH     ;从文件中读一个字符</span><br><span class="line">    jc READERR</span><br><span class="line">    cmp al,EOF</span><br><span class="line">    jz type_ok</span><br><span class="line">    call putch</span><br><span class="line">    jmp cont</span><br><span class="line">    ;</span><br><span class="line">READERR:</span><br><span class="line">    mov si,offset error2</span><br><span class="line">    call DMESS</span><br><span class="line">    ;</span><br><span class="line">TYPE_OK:</span><br><span class="line">    mov ah,3Eh</span><br><span class="line">    int 21h</span><br><span class="line">over:</span><br><span class="line">    mov ax,4c00h</span><br><span class="line">    int 21h</span><br><span class="line">;-----------------------------------------------------</span><br><span class="line">READCH PROC</span><br><span class="line">; 功能：每次从文件中按顺序读一个字符。</span><br><span class="line">; 传参方式：寄存器传参</span><br><span class="line">; 入口参数：AL=十六进制</span><br><span class="line">; 出口参数：AX=高4位，低4位</span><br><span class="line">; 说    明：子程序通过进位标志CF来反映是否正确读到字符，</span><br><span class="line">;如果读时发生错误，则CF置位，否则CF清零。考虑到万一文本</span><br><span class="line">;文件没有文件结束符的情况，所以该子程序还判断是否的却已</span><br><span class="line">;读到文件尾（如果实际读到的字符为0就意味着文件结束），</span><br><span class="line">;当这种情况发生时，就返回一个文件结束符。</span><br><span class="line">;------------------------------------------------------</span><br><span class="line">    mov cx,1</span><br><span class="line">    mov dx,offset buffer</span><br><span class="line">    mov ah,3FH</span><br><span class="line">    int 21h</span><br><span class="line">    jc READCH2</span><br><span class="line">    cmp ax,cx</span><br><span class="line">    mov al,EOF</span><br><span class="line">    jb READCH1</span><br><span class="line">    mov AL,BUFFER</span><br><span class="line">READCH1:</span><br><span class="line">    CLC</span><br><span class="line">READCH2:</span><br><span class="line">    ret</span><br><span class="line">READCH endp</span><br><span class="line"></span><br><span class="line">;-----------------------------------------------------</span><br><span class="line">DMESS PROC</span><br><span class="line">;</span><br><span class="line">; 功能：显示一个以 0 结束符的字符串</span><br><span class="line">; 入口参数：SI = 字符串首地址</span><br><span class="line">; 出口参数：无</span><br><span class="line">;-----------------------------------------------------</span><br><span class="line">DMESS1:</span><br><span class="line">    mov DL,[SI]</span><br><span class="line">    inc SI</span><br><span class="line">    or DL,DL</span><br><span class="line">    jz DMESS2</span><br><span class="line">    mov ah,2</span><br><span class="line">    int 21h</span><br><span class="line">    jmp DMESS1</span><br><span class="line">DMESS2:</span><br><span class="line">    ret</span><br><span class="line">DMESS endp</span><br><span class="line">;-----------------------------------------------------</span><br><span class="line">PUTCH PROC</span><br><span class="line">;</span><br><span class="line">; 功能：使用 int 21h的 2 号功能输出字符。</span><br><span class="line">; 传参方式：寄存器传参</span><br><span class="line">; 入口参数：al</span><br><span class="line">; 出口参数：无</span><br><span class="line">;-----------------------------------------------------</span><br><span class="line">    push dx</span><br><span class="line">    mov dl,al</span><br><span class="line">    mov ah,2</span><br><span class="line">    int 21h</span><br><span class="line">    pop dx</span><br><span class="line">    ret</span><br><span class="line">PUTCH endp</span><br><span class="line">code ends</span><br><span class="line">end start</span><br></pre></td></tr></table></figure>

<h3 id="例2-5"><a href="#例2-5" class="headerlink" title="例2"></a>例2</h3><p>把键盘上输入的全部字符，存入某个文件的程序。文件固定为当前根目录下的test.txt。如果它已经存在，则更新它。</p>
<ol>
<li><p>书中的举例（重新建立 test.txt 覆盖原数据，写入输入数据）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">;程序名：T4-15.asm</span><br><span class="line">;功能：把键盘上输入的字符全部字符（直到CTRL+Z键，值1AH）存入文件 test.txt 中，</span><br><span class="line">;如果 test.txt 文件已存在则更新它。</span><br><span class="line">assume cs:code,ds:data</span><br><span class="line"></span><br><span class="line">EOF = 1AH</span><br><span class="line"></span><br><span class="line">data segment</span><br><span class="line">FNAME db &#x27;\TEST.txt&#x27;,0</span><br><span class="line">ERRMESS1 db &#x27;Can not create file&#x27;,07h,&#x27;$&#x27;</span><br><span class="line">ERRMESS2 db &#x27;Writing error&#x27;,07h,&#x27;$&#x27;</span><br><span class="line">BUFFER db ?</span><br><span class="line">data ends</span><br><span class="line"></span><br><span class="line">code segment</span><br><span class="line">start:</span><br><span class="line">    mov ax,data</span><br><span class="line">    mov ds,ax</span><br><span class="line">    ;</span><br><span class="line">    mov dx,offset FNAME     ;建立文件</span><br><span class="line">    mov cx,0</span><br><span class="line">    mov ah,3CH</span><br><span class="line">    int 21h</span><br><span class="line">    jnc CREA_OK             ;建立成功，跳转</span><br><span class="line">    ;</span><br><span class="line">    mov dx,offset ERRMESS1  ;显示不能新建文件提示信息</span><br><span class="line">    call DISPMESS</span><br><span class="line">    jmp over</span><br><span class="line">    ;</span><br><span class="line">CREA_OK:</span><br><span class="line">    mov bx,ax               ;保存文件句柄</span><br><span class="line">CONT:</span><br><span class="line">    call GETCHAR            ;接收一个键</span><br><span class="line">    push ax</span><br><span class="line">    call WRITECH            ;向文件写所读的字符</span><br><span class="line">    pop ax</span><br><span class="line">    jc WERROR               ;写出错，转</span><br><span class="line">    cmp AL,EOF              ;是否已读到文件结束符</span><br><span class="line">    jnz CONT                ;不是，继续</span><br><span class="line">    jmp CLOSEF              ;遇文件结束符，转结束</span><br><span class="line">    ;</span><br><span class="line">WERROR:</span><br><span class="line">    mov dx,offset ERRMESS2  ;显示写出错误提示信息</span><br><span class="line">    call DISPMESS</span><br><span class="line">    ;</span><br><span class="line">CLOSEF:</span><br><span class="line">    MOV ah,3EH              ;关闭文件</span><br><span class="line">    int 21h</span><br><span class="line">over:</span><br><span class="line">    mov ax,4c00h</span><br><span class="line">    int 21h</span><br><span class="line"></span><br><span class="line">;-----------------------------------------------------</span><br><span class="line">WRITECH PROC</span><br><span class="line">;</span><br><span class="line">; 功能：把需要写入的一个字节，送入缓冲区</span><br><span class="line">;-----------------------------------------------------</span><br><span class="line">    mov BUFFER,AL</span><br><span class="line">    mov dx,offset BUFFER</span><br><span class="line">    mov cx,1</span><br><span class="line">    mov ah,40h</span><br><span class="line">    int 21h</span><br><span class="line">    ret</span><br><span class="line">WRITECH endp</span><br><span class="line"></span><br><span class="line">;-----------------------------------------------------</span><br><span class="line">GETCHAR PROC</span><br><span class="line">; 功能：输入一个字符</span><br><span class="line">;-----------------------------------------------------</span><br><span class="line">    mov ah,1</span><br><span class="line">    int 21h</span><br><span class="line">    ret</span><br><span class="line">GETCHAR endp</span><br><span class="line"></span><br><span class="line">;--------------------------------------------------------</span><br><span class="line">DISPMESS PROC</span><br><span class="line">; 功能：显示由 DX 所指的提示信息</span><br><span class="line">; 入口参数：DX=字符串首地址</span><br><span class="line">; 出口参数：无</span><br><span class="line">;---------------------------------------------------------</span><br><span class="line">    mov ah,9</span><br><span class="line">    int 21h</span><br><span class="line">    ret</span><br><span class="line">DISPMESS endp</span><br><span class="line">code ends</span><br><span class="line">end start</span><br></pre></td></tr></table></figure>
</li>
<li><p>读 test 文件，在写入输入缓冲区的内容，实现文件更新</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line">;程序名：T4-15-1.asm</span><br><span class="line">;功能：把键盘上输入的全部字符，存入某个文件的程序</span><br><span class="line">;文件固定为当前根目录下的test.txt。如果它已经存在，则更新它。</span><br><span class="line"></span><br><span class="line">;打开文件（判断是否已存在），如已存在：读取文件并存入缓冲区、读取键盘输入存入缓冲区</span><br><span class="line">;如不存在：创建文件，将输入存入缓冲区</span><br><span class="line"></span><br><span class="line">assume cs:code,ds:data</span><br><span class="line">data segment</span><br><span class="line">fname db &#x27;test.txt&#x27;,0</span><br><span class="line">handle dw 0</span><br><span class="line">flag db 0</span><br><span class="line">read_buffer db 0</span><br><span class="line">input_buffer db 30 dup(0)</span><br><span class="line">len dw 0</span><br><span class="line">message db &#x27;Please enter the data you want to write: &#x27;,24h</span><br><span class="line">input_error db &#x27;Please enter char$&#x27;</span><br><span class="line">close_error db &#x27;ERROR: cannot close file&#x27;,07h,24h</span><br><span class="line">data ends</span><br><span class="line"></span><br><span class="line">code segment</span><br><span class="line">start:</span><br><span class="line">    mov ax,data</span><br><span class="line">    mov ds,ax</span><br><span class="line">open:</span><br><span class="line">    ;打开文件，并判断是否打开成功</span><br><span class="line">    call far ptr openfile</span><br><span class="line">    jnc create_ok</span><br><span class="line">    ;创建文件</span><br><span class="line">create:</span><br><span class="line">    lea dx,fname</span><br><span class="line">    mov cx,0</span><br><span class="line">    mov ah,3ch</span><br><span class="line">    int 21h</span><br><span class="line">    jmp open    ;创建文件后，还需要打开文件才能写入数据</span><br><span class="line">    ;文件创建成功，提示输入</span><br><span class="line">create_ok:</span><br><span class="line">    xor di,di</span><br><span class="line">read_ch:</span><br><span class="line">    ;读文件，并将内容复制到缓冲区中。</span><br><span class="line">    mov bx,handle</span><br><span class="line">    lea dx,read_buffer</span><br><span class="line">    mov cx,1</span><br><span class="line">    mov ax,3Fh</span><br><span class="line">    int 21h</span><br><span class="line">    cmp ax,0            ;如果没有正确读到字符，ax=0</span><br><span class="line">    jz input_ch</span><br><span class="line">    ;将读到的字符传入写字符缓冲区（只需要将文件内容读一遍，原文件字符就不会被覆盖）</span><br><span class="line">    ;mov al,read_buffer</span><br><span class="line">    ;mov input_buffer[di],al</span><br><span class="line">    ;inc di</span><br><span class="line">    jmp read_ch</span><br><span class="line"></span><br><span class="line">input_ch:</span><br><span class="line">    call far ptr input</span><br><span class="line">    ;输入成功，将字符串写到文件中</span><br><span class="line">write:</span><br><span class="line">    lea dx,input_buffer</span><br><span class="line">    mov bx,handle</span><br><span class="line">    mov cx,len</span><br><span class="line">    mov ah,40h</span><br><span class="line">    int 21h</span><br><span class="line">close:</span><br><span class="line">    call far ptr closefile</span><br><span class="line">    mov ax,4c00h</span><br><span class="line">    int 21h</span><br><span class="line"></span><br><span class="line">openfile proc far</span><br><span class="line">    lea dx,fname</span><br><span class="line">    mov ax,3d02h    ;以读写方式打开文件</span><br><span class="line">    int 21h</span><br><span class="line">    mov handle,ax</span><br><span class="line">stack:</span><br><span class="line">    ret</span><br><span class="line">openfile endp</span><br><span class="line"></span><br><span class="line">input proc far</span><br><span class="line">    ;打印提示信息</span><br><span class="line">    lea dx,message</span><br><span class="line">    mov ah,9</span><br><span class="line">    int 21h</span><br><span class="line">loop_input:</span><br><span class="line">    ;用户输入</span><br><span class="line">    mov ah,1</span><br><span class="line">    int 21h</span><br><span class="line">    ;判断用户输入结束按键</span><br><span class="line">    cmp al,0dh</span><br><span class="line">    jz returnA</span><br><span class="line">    ;根据情况设置用户输入规则</span><br><span class="line">    cmp al,20h</span><br><span class="line">    jb input_err</span><br><span class="line">    ;</span><br><span class="line">    mov input_buffer[di],al</span><br><span class="line">    inc di</span><br><span class="line">    jmp loop_input</span><br><span class="line">input_err:</span><br><span class="line">    ;换行</span><br><span class="line">    mov dl,0ah</span><br><span class="line">    mov ah,2</span><br><span class="line">    int 21h</span><br><span class="line">    ;</span><br><span class="line">    lea dx,input_error</span><br><span class="line">    mov ah,9</span><br><span class="line">    int 21h</span><br><span class="line">    jmp stop</span><br><span class="line">stop:</span><br><span class="line">    mov ax,4c00h</span><br><span class="line">    int 21h</span><br><span class="line">returnA:</span><br><span class="line">    mov input_buffer[di],0  ;1AH</span><br><span class="line">    mov len,di</span><br><span class="line">    ret</span><br><span class="line">input endp</span><br><span class="line"></span><br><span class="line">closefile proc far</span><br><span class="line">    mov bx,handle</span><br><span class="line">    mov ah,3EH</span><br><span class="line">    int 21h</span><br><span class="line">    jnc stack2</span><br><span class="line">    ;</span><br><span class="line">    mov dl,0ah</span><br><span class="line">    mov ah,2</span><br><span class="line">    int 21h</span><br><span class="line">    mov dx,offset close_error</span><br><span class="line">    mov ah,9</span><br><span class="line">    int 21h</span><br><span class="line">stack2:</span><br><span class="line">    ret</span><br><span class="line">closefile endp</span><br><span class="line">code ends</span><br><span class="line">    end start</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用42h号功能，修改文件读写指针，实现更新功能</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line">;程序名：T4-15.asm</span><br><span class="line">;功能：把键盘上输入的全部字符（直到Ctrl+Z键，值1AH）存入某个文件的程序</span><br><span class="line">;文件固定为当前根目录下的test.txt。如果它已经存在，则更新它</span><br><span class="line">;算法：使用 42H 号功能实现</span><br><span class="line"></span><br><span class="line">assume cs:code,ds:data</span><br><span class="line">data segment</span><br><span class="line">fname db &#x27;test.txt&#x27;,0</span><br><span class="line">handle dw 0</span><br><span class="line">flag db 0</span><br><span class="line">read_buffer db 0</span><br><span class="line">input_buffer db 30 dup(0)</span><br><span class="line">len dw 0</span><br><span class="line">message db &#x27;Please enter the data you want to write: &#x27;,24h</span><br><span class="line">input_error db &#x27;Please enter char$&#x27;</span><br><span class="line">close_error db &#x27;ERROR: cannot close file&#x27;,07h,24h</span><br><span class="line">data ends</span><br><span class="line"></span><br><span class="line">code segment</span><br><span class="line">start:</span><br><span class="line">    mov ax,data</span><br><span class="line">    mov ds,ax</span><br><span class="line">open:</span><br><span class="line">    ;打开文件，并判断是否打开成功</span><br><span class="line">    call far ptr openfile</span><br><span class="line">    jnc create_ok</span><br><span class="line">    ;创建文件</span><br><span class="line">create:</span><br><span class="line">    lea dx,fname</span><br><span class="line">    mov cx,0</span><br><span class="line">    mov ah,3ch</span><br><span class="line">    int 21h</span><br><span class="line">    jmp open    ;创建文件后，还需要打开文件才能写入数据</span><br><span class="line">    ;文件创建成功，提示输入</span><br><span class="line">create_ok:</span><br><span class="line">    ;修改读写指针</span><br><span class="line">    mov bx,handle</span><br><span class="line">    xor cx,cx</span><br><span class="line">    xor dx,dx</span><br><span class="line">    mov ax,4202h</span><br><span class="line">    int 21h</span><br><span class="line"></span><br><span class="line">input_ch:</span><br><span class="line">    call far ptr input</span><br><span class="line">    ;输入成功，将字符串写到文件中</span><br><span class="line">write:</span><br><span class="line">    lea dx,input_buffer</span><br><span class="line">    mov bx,handle</span><br><span class="line">    mov cx,len</span><br><span class="line">    mov ah,40h</span><br><span class="line">    int 21h</span><br><span class="line">close:</span><br><span class="line">    call far ptr closefile</span><br><span class="line">    mov ax,4c00h</span><br><span class="line">    int 21h</span><br><span class="line"></span><br><span class="line">openfile proc far</span><br><span class="line">    lea dx,fname</span><br><span class="line">    mov ax,3d02h    ;以读写方式打开文件</span><br><span class="line">    int 21h</span><br><span class="line">    mov handle,ax</span><br><span class="line">stack:</span><br><span class="line">    ret</span><br><span class="line">openfile endp</span><br><span class="line"></span><br><span class="line">input proc far</span><br><span class="line">    ;打印提示信息</span><br><span class="line">    lea dx,message</span><br><span class="line">    mov ah,9</span><br><span class="line">    int 21h</span><br><span class="line">loop_input:</span><br><span class="line">    xor di,di</span><br><span class="line">    ;用户输入</span><br><span class="line">    mov ah,1</span><br><span class="line">    int 21h</span><br><span class="line">    ;判断用户输入结束按键</span><br><span class="line">    cmp al,0dh</span><br><span class="line">    jz returnA</span><br><span class="line">    ;根据情况设置用户输入规则</span><br><span class="line">    cmp al,20h</span><br><span class="line">    jb input_err</span><br><span class="line">    ;</span><br><span class="line">    mov input_buffer[di],al</span><br><span class="line">    inc di</span><br><span class="line">    jmp loop_input</span><br><span class="line">input_err:</span><br><span class="line">    ;换行</span><br><span class="line">    mov dl,0ah</span><br><span class="line">    mov ah,2</span><br><span class="line">    int 21h</span><br><span class="line">    ;</span><br><span class="line">    lea dx,input_error</span><br><span class="line">    mov ah,9</span><br><span class="line">    int 21h</span><br><span class="line">    jmp stop</span><br><span class="line">stop:</span><br><span class="line">    mov ax,4c00h</span><br><span class="line">    int 21h</span><br><span class="line">returnA:</span><br><span class="line">    mov input_buffer[di],0  ;1AH</span><br><span class="line">    mov len,di</span><br><span class="line">    ret</span><br><span class="line">input endp</span><br><span class="line"></span><br><span class="line">closefile proc far</span><br><span class="line">    mov bx,handle</span><br><span class="line">    mov ah,3EH</span><br><span class="line">    int 21h</span><br><span class="line">    jnc stack2</span><br><span class="line">    ;</span><br><span class="line">    mov dl,0ah</span><br><span class="line">    mov ah,2</span><br><span class="line">    int 21h</span><br><span class="line">    mov dx,offset close_error</span><br><span class="line">    mov ah,9</span><br><span class="line">    int 21h</span><br><span class="line">stack2:</span><br><span class="line">    ret</span><br><span class="line">closefile endp</span><br><span class="line">code ends</span><br><span class="line">    end start</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="例3-2"><a href="#例3-2" class="headerlink" title="例3"></a>例3</h3><p>写一个程序把文件2拼接到文件1上。文件1固定为当前目录下的TEST1，文件2固定为当前目录下的TEST2<br>该示例是使用到 21中断的<code>42h号</code> 功能，疑问文件读写指针实现的。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line">;程序名：T4-17.asm</span><br><span class="line">;功能：写一个程序把文件2拼接到文件1上。文件1固定为当前目录下的TEST1，文件2固定为当前目录下的TEST2</span><br><span class="line">assume cs:code,ds:data</span><br><span class="line">;符号常量定义</span><br><span class="line">BUFFLEN = 512</span><br><span class="line">;数据段</span><br><span class="line">data segment</span><br><span class="line">fname1 db &#x27;test1.txt&#x27;,0</span><br><span class="line">fname2 db &#x27;test2.txt&#x27;,0</span><br><span class="line">handle1 dw 0</span><br><span class="line">handle2 dw 0</span><br><span class="line">ERRMESS1 db &#x27;Can not open file&#x27;,07h,&#x27;$&#x27;</span><br><span class="line">ERRMESS2 db &#x27;Reading eror&#x27;,07h,&#x27;$&#x27;</span><br><span class="line">ERRMESS3 db &#x27;Writing error&#x27;,07h,&#x27;$&#x27;</span><br><span class="line">BUFFER db BUFFLEN dup(0)</span><br><span class="line">data ends</span><br><span class="line">;代码段</span><br><span class="line">code segment</span><br><span class="line">start:</span><br><span class="line">    mov ax,data</span><br><span class="line">    mov ds,ax</span><br><span class="line">    mov dx,offset fname1</span><br><span class="line">    mov ax,3d01h</span><br><span class="line">    int 21h</span><br><span class="line">    jnc OPENOK1</span><br><span class="line">    ;</span><br><span class="line">ERR1:</span><br><span class="line">    mov dx,offset ERRMESS1</span><br><span class="line">    call DISPMESS</span><br><span class="line">    jmp OVER</span><br><span class="line">OPENOK1:</span><br><span class="line">    mov handle1,ax</span><br><span class="line">    mov dx,offset fname2</span><br><span class="line">    mov ax,3d00h</span><br><span class="line">    int 21h</span><br><span class="line">    jnc OPENOK2</span><br><span class="line">    ;</span><br><span class="line">    mov bx,handle1</span><br><span class="line">    mov ah,3Eh</span><br><span class="line">    int 21h</span><br><span class="line">    jmp ERR1</span><br><span class="line">OPENOK2:</span><br><span class="line">    mov handle2,ax</span><br><span class="line">    mov bx,handle1</span><br><span class="line">    xor cx,cx</span><br><span class="line">    xor dx,dx</span><br><span class="line">    mov ax,4202h</span><br><span class="line">    int 21h</span><br><span class="line">    ;</span><br><span class="line">CONT:</span><br><span class="line">    mov dx,offset BUFFER</span><br><span class="line">    mov cx,BUFFLEN</span><br><span class="line">    mov bx,handle2</span><br><span class="line">    mov ah,3fh</span><br><span class="line">    int 21h</span><br><span class="line">    jc RERR</span><br><span class="line">    ;</span><br><span class="line">    or ax,ax</span><br><span class="line">    jz copyok</span><br><span class="line">    mov cx,ax</span><br><span class="line">    mov bx,handle1</span><br><span class="line">    mov ah,40h</span><br><span class="line">    int 21h</span><br><span class="line">    jnc CONT</span><br><span class="line">WERR:</span><br><span class="line">    mov dx,offset ERRMESS3</span><br><span class="line">    call DISPMESS</span><br><span class="line">    jmp SHORT COPYOK</span><br><span class="line">    ;</span><br><span class="line">RERR:</span><br><span class="line">    mov dx,offset ERRMESS2</span><br><span class="line">    call DISPMESS</span><br><span class="line">COPYOK:</span><br><span class="line">    mov bx,handle1</span><br><span class="line">    mov ah,3Eh</span><br><span class="line">    int 21h</span><br><span class="line">    mov BX,handle2</span><br><span class="line">    mov AH,3Eh</span><br><span class="line">    int 21h</span><br><span class="line">    ;</span><br><span class="line">OVER:</span><br><span class="line">    mov ah,4ch</span><br><span class="line">    int 21h</span><br><span class="line">;--------------------------------------------------------</span><br><span class="line">DISPMESS PROC</span><br><span class="line">; 功能：显示由 DX 所指的提示信息</span><br><span class="line">; 入口参数：DX=字符串首地址</span><br><span class="line">; 出口参数：无</span><br><span class="line">;---------------------------------------------------------</span><br><span class="line">    mov ah,9</span><br><span class="line">    int 21h</span><br><span class="line">    ret</span><br><span class="line">DISPMESS endp</span><br><span class="line">code ends</span><br><span class="line">end start</span><br></pre></td></tr></table></figure>


        </div>

        
            <div class="post-copyright-info">
                <div class="article-copyright-info-container">
    <ul>
        <li>本文标题：8086汇编-子程序设计</li>
        <li>本文作者：9unk</li>
        <li>创建时间：2022-08-16 21:53:00</li>
        <li>
            本文链接：https://9unkk.github.io/2022/08/16/8086-hui-bian-zi-cheng-xu-she-ji/
        </li>
        <li>
            版权声明：本博客所有文章除特别声明外，均采用 <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">BY-NC-SA</a> 许可协议。转载请注明出处！
        </li>
    </ul>
</div>

            </div>
        

        
            <ul class="post-tags-box">
                
                    <li class="tag-item">
                        <a href="/tags/%E6%B1%87%E7%BC%96/">#汇编</a>&nbsp;
                    </li>
                
            </ul>
        

        
            <div class="article-nav">
                
                    <div class="article-prev">
                        <a class="prev"
                           rel="prev"
                           href="/2022/09/27/8086-hui-bian-shu-ru-shu-chu-yu-zhong-duan/"
                        >
                            <span class="left arrow-icon flex-center">
                              <i class="fas fa-chevron-left"></i>
                            </span>
                            <span class="title flex-center">
                                <span class="post-nav-title-item">8086汇编-输入输出与中断</span>
                                <span class="post-nav-item">上一篇</span>
                            </span>
                        </a>
                    </div>
                
                
                    <div class="article-next">
                        <a class="next"
                           rel="next"
                           href="/2022/08/09/8086-hui-bian-cheng-xu-she-ji/"
                        >
                            <span class="title flex-center">
                                <span class="post-nav-title-item">8086汇编-程序设计</span>
                                <span class="post-nav-item">下一篇</span>
                            </span>
                            <span class="right arrow-icon flex-center">
                              <i class="fas fa-chevron-right"></i>
                            </span>
                        </a>
                    </div>
                
            </div>
        

        
    </div>
</div>


                
            </div>

        </div>

        <div class="page-main-content-bottom">
            <footer class="footer">
    <div class="info-container">
        <div class="copyright-info info-item">
            &copy;
            
              <span>2022</span>
              -
            
            2025&nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;<a href="/">9unk</a>
        </div>
        
        <div class="theme-info info-item">
            由 <a target="_blank" href="https://hexo.io">Hexo</a> 驱动&nbsp;|&nbsp;主题&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep v3.4.5</a>
        </div>
        
        
    </div>
</footer>

        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="tools-list">
        <!-- TOC aside toggle -->
        
            <li class="tools-item page-aside-toggle">
                <i class="fas fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
    </ul>
</div>

        </div>
    

    <div class="right-bottom-side-tools">
        <div class="side-tools-container">
    <ul class="side-tools-list">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-expand-width flex-center">
            <i class="fas fa-arrows-alt-h"></i>
        </li>

        <li class="tools-item tool-dark-light-toggle flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        

        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list">
        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>
        
            <li class="tools-item tool-scroll-to-top flex-center">
                <i class="arrow-up fas fa-arrow-up"></i>
                <span class="percent"></span>
            </li>
        
    </ul>
</div>

    </div>

    
        <aside class="page-aside">
            <div class="post-toc-wrap">
    <div class="post-toc">
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AD%90%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1"><span class="nav-number">1.</span> <span class="nav-text">子程序设计</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BF%87%E7%A8%8B%E8%B0%83%E7%94%A8%E5%92%8C%E8%BF%94%E5%9B%9E%E6%8C%87%E4%BB%A4"><span class="nav-number">1.1.</span> <span class="nav-text">过程调用和返回指令</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%87%E7%A8%8B%E8%B0%83%E7%94%A8%E6%8C%87%E4%BB%A4"><span class="nav-number">1.1.1.</span> <span class="nav-text">过程调用指令</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%AE%B5%E5%86%85%E7%9B%B4%E6%8E%A5%E8%B0%83%E7%94%A8"><span class="nav-number">1.1.1.1.</span> <span class="nav-text">段内直接调用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%AE%B5%E5%86%85%E9%97%B4%E6%8E%A5%E8%BD%AC%E7%A7%BB"><span class="nav-number">1.1.1.2.</span> <span class="nav-text">段内间接转移</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%AE%B5%E9%97%B4%E7%9B%B4%E6%8E%A5%E8%B0%83%E7%94%A8"><span class="nav-number">1.1.1.3.</span> <span class="nav-text">段间直接调用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%AE%B5%E9%97%B4%E9%97%B4%E6%8E%A5%E8%B0%83%E7%94%A8"><span class="nav-number">1.1.1.4.</span> <span class="nav-text">段间间接调用</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%87%E7%A8%8B%E8%BF%94%E5%9B%9E%E6%8C%87%E4%BB%A4"><span class="nav-number">1.1.2.</span> <span class="nav-text">过程返回指令</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%AE%B5%E5%86%85%E8%BF%94%E5%9B%9E%E6%8C%87%E4%BB%A4"><span class="nav-number">1.1.2.1.</span> <span class="nav-text">段内返回指令</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%AE%B5%E9%97%B4%E8%BF%94%E5%9B%9E%E6%8C%87%E4%BB%A4"><span class="nav-number">1.1.2.2.</span> <span class="nav-text">段间返回指令</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BF%94%E5%9B%9E%E6%8C%87%E4%BB%A4-%E7%AB%8B%E5%8D%B3%E6%95%B0"><span class="nav-number">1.1.2.3.</span> <span class="nav-text">返回指令+立即数</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BF%87%E7%A8%8B%E5%AE%9A%E4%B9%89%E8%AF%AD%E5%8F%A5"><span class="nav-number">1.2.</span> <span class="nav-text">过程定义语句</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%8C%83%E4%BE%8B"><span class="nav-number">1.2.1.</span> <span class="nav-text">范例</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%A8%8B%E5%BA%8F%E9%80%BB%E8%BE%91%E7%BB%93%E6%9E%84%E5%9B%BE"><span class="nav-number">1.2.1.1.</span> <span class="nav-text">程序逻辑结构图</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81"><span class="nav-number">1.2.1.2.</span> <span class="nav-text">代码</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AD%90%E7%A8%8B%E5%BA%8F%E4%B8%BE%E4%BE%8B"><span class="nav-number">1.3.</span> <span class="nav-text">子程序举例</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BE%8B1"><span class="nav-number">1.3.1.</span> <span class="nav-text">例1</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%A8%8B%E5%BA%8F%E6%B5%81%E7%A8%8B%E5%9B%BE"><span class="nav-number">1.3.1.1.</span> <span class="nav-text">程序流程图</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81-1"><span class="nav-number">1.3.1.2.</span> <span class="nav-text">代码</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BE%8B2"><span class="nav-number">1.3.2.</span> <span class="nav-text">例2</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%A8%8B%E5%BA%8F%E6%B5%81%E7%A8%8B%E5%9B%BE-1"><span class="nav-number">1.3.2.1.</span> <span class="nav-text">程序流程图</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81-2"><span class="nav-number">1.3.2.2.</span> <span class="nav-text">代码</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BE%8B3"><span class="nav-number">1.3.3.</span> <span class="nav-text">例3</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%A8%8B%E5%BA%8F%E6%B5%81%E7%A8%8B%E5%9B%BE-2"><span class="nav-number">1.3.3.1.</span> <span class="nav-text">程序流程图</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81-3"><span class="nav-number">1.3.3.2.</span> <span class="nav-text">代码</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%84%E5%AD%98%E5%99%A8%E7%9A%84%E4%BF%9D%E6%8A%A4%E4%B8%8E%E6%81%A2%E5%A4%8D"><span class="nav-number">1.3.4.</span> <span class="nav-text">寄存器的保护与恢复</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%BB%E7%A8%8B%E5%BA%8F%E4%B8%8E%E5%AD%90%E7%A8%8B%E5%BA%8F%E4%B9%8B%E9%97%B4%E7%9A%84%E5%8F%82%E6%95%B0%E4%BC%A0%E9%80%92"><span class="nav-number">2.</span> <span class="nav-text">主程序与子程序之间的参数传递</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AF%84%E5%AD%98%E5%99%A8%E5%8F%82%E6%95%B0%E4%BC%A0%E9%80%92%E6%B3%95"><span class="nav-number">2.1.</span> <span class="nav-text">寄存器参数传递法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BE%8B1-1"><span class="nav-number">2.1.1.</span> <span class="nav-text">例1</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%A8%8B%E5%BA%8F%E6%B5%81%E7%A8%8B%E5%9B%BE-3"><span class="nav-number">2.1.1.1.</span> <span class="nav-text">程序流程图</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81-4"><span class="nav-number">2.1.1.2.</span> <span class="nav-text">代码</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BE%8B2-1"><span class="nav-number">2.1.2.</span> <span class="nav-text">例2</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%A8%8B%E5%BA%8F%E6%B5%81%E7%A8%8B%E5%9B%BE-4"><span class="nav-number">2.1.2.1.</span> <span class="nav-text">程序流程图</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81-5"><span class="nav-number">2.1.2.2.</span> <span class="nav-text">代码</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%A9%E7%94%A8%E5%AD%98%E5%82%A8%E5%8D%95%E5%85%83%E4%BC%A0%E9%80%92%E5%8F%82%E6%95%B0"><span class="nav-number">2.2.</span> <span class="nav-text">利用存储单元传递参数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BE%8B1-2"><span class="nav-number">2.2.1.</span> <span class="nav-text">例1</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%A8%8B%E5%BA%8F%E6%B5%81%E7%A8%8B%E5%9B%BE-5"><span class="nav-number">2.2.1.1.</span> <span class="nav-text">程序流程图</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81-6"><span class="nav-number">2.2.1.2.</span> <span class="nav-text">代码</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BE%8B2-2"><span class="nav-number">2.2.2.</span> <span class="nav-text">例2</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%A8%8B%E5%BA%8F%E6%B5%81%E7%A8%8B%E5%9B%BE-6"><span class="nav-number">2.2.2.1.</span> <span class="nav-text">程序流程图</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81-7"><span class="nav-number">2.2.2.2.</span> <span class="nav-text">代码</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%A9%E7%94%A8%E5%A0%86%E6%A0%88%E4%BC%A0%E9%80%92%E5%8F%82%E6%95%B0"><span class="nav-number">2.3.</span> <span class="nav-text">利用堆栈传递参数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BE%8B1-3"><span class="nav-number">2.3.1.</span> <span class="nav-text">例1</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%A8%8B%E5%BA%8F%E6%B5%81%E7%A8%8B%E5%9B%BE-7"><span class="nav-number">2.3.1.1.</span> <span class="nav-text">程序流程图</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81-8"><span class="nav-number">2.3.1.2.</span> <span class="nav-text">代码</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%A9%E7%94%A8-call-%E5%90%8E%E7%BB%AD%E5%8C%BA%E4%BC%A0%E9%80%92%E5%8F%82%E6%95%B0"><span class="nav-number">2.4.</span> <span class="nav-text">利用 call 后续区传递参数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BE%8B1-4"><span class="nav-number">2.4.1.</span> <span class="nav-text">例1</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%A8%8B%E5%BA%8F%E7%BB%93%E6%9E%84%E5%9B%BE"><span class="nav-number">2.4.1.1.</span> <span class="nav-text">程序结构图</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81-9"><span class="nav-number">2.4.1.2.</span> <span class="nav-text">代码</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#DOS-%E5%8A%9F%E8%83%BD%E8%B0%83%E7%94%A8%E5%8F%8A%E5%BA%94%E7%94%A8"><span class="nav-number">3.</span> <span class="nav-text">DOS 功能调用及应用</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B0%83%E7%94%A8%E6%96%B9%E6%B3%95"><span class="nav-number">3.1.</span> <span class="nav-text">调用方法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BE%8B1-5"><span class="nav-number">3.1.1.</span> <span class="nav-text">例1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BE%8B2-3"><span class="nav-number">3.1.2.</span> <span class="nav-text">例2</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E7%9A%84-I-x2F-O-%E5%8A%9F%E8%83%BD%E8%B0%83%E7%94%A8"><span class="nav-number">3.2.</span> <span class="nav-text">基本的 I&#x2F;O 功能调用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BA%94%E7%94%A8%E4%B8%BE%E4%BE%8B"><span class="nav-number">3.3.</span> <span class="nav-text">应用举例</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BE%8B1-6"><span class="nav-number">3.3.1.</span> <span class="nav-text">例1</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%A8%8B%E5%BA%8F%E6%B5%81%E7%A8%8B%E5%9B%BE-8"><span class="nav-number">3.3.1.1.</span> <span class="nav-text">程序流程图</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81-10"><span class="nav-number">3.3.1.2.</span> <span class="nav-text">代码</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BE%8B2-4"><span class="nav-number">3.3.2.</span> <span class="nav-text">例2</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%A8%8B%E5%BA%8F%E6%B5%81%E7%A8%8B%E5%9B%BE-9"><span class="nav-number">3.3.2.1.</span> <span class="nav-text">程序流程图</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81-11"><span class="nav-number">3.3.2.2.</span> <span class="nav-text">代码</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BE%8B3-1"><span class="nav-number">3.3.3.</span> <span class="nav-text">例3</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%A8%8B%E5%BA%8F%E6%B5%81%E7%A8%8B%E5%9B%BE-10"><span class="nav-number">3.3.3.1.</span> <span class="nav-text">程序流程图</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81-12"><span class="nav-number">3.3.3.2.</span> <span class="nav-text">代码</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BE%8B4"><span class="nav-number">3.3.4.</span> <span class="nav-text">例4</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%A8%8B%E5%BA%8F%E6%B5%81%E7%A8%8B%E5%9B%BE-11"><span class="nav-number">3.3.4.1.</span> <span class="nav-text">程序流程图</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81-13"><span class="nav-number">3.3.4.2.</span> <span class="nav-text">代码</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%A3%81%E7%9B%98%E6%96%87%E4%BB%B6%E7%AE%A1%E7%90%86%E5%8F%8A%E5%BA%94%E7%94%A8"><span class="nav-number">4.</span> <span class="nav-text">磁盘文件管理及应用</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#DOS-%E7%A3%81%E7%9B%98%E6%96%87%E4%BB%B6%E7%AE%A1%E7%90%86%E5%8A%9F%E8%83%BD%E8%B0%83%E7%94%A8"><span class="nav-number">4.1.</span> <span class="nav-text">DOS 磁盘文件管理功能调用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E6%96%87%E4%BB%B6%EF%BC%883CH%E5%8F%B7%E5%8A%9F%E8%83%BD%E8%B0%83%E7%94%A8%EF%BC%89"><span class="nav-number">4.1.1.</span> <span class="nav-text">创建文件（3CH号功能调用）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%89%93%E5%BC%80%E6%96%87%E4%BB%B6%EF%BC%883DH%E5%8F%B7%E5%8A%9F%E8%83%BD%E8%B0%83%E7%94%A8%EF%BC%89"><span class="nav-number">4.1.2.</span> <span class="nav-text">打开文件（3DH号功能调用）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AF%BB%E6%96%87%E4%BB%B6%EF%BC%883FH%E5%8F%B7%E5%8A%9F%E8%83%BD%E8%B0%83%E7%94%A8%EF%BC%89"><span class="nav-number">4.1.3.</span> <span class="nav-text">读文件（3FH号功能调用）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%86%99%E6%96%87%E4%BB%B6%EF%BC%8840H%E5%8F%B7%E5%8A%9F%E8%83%BD%E8%B0%83%E7%94%A8%EF%BC%89"><span class="nav-number">4.1.4.</span> <span class="nav-text">写文件（40H号功能调用）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B3%E9%97%AD%E6%96%87%E4%BB%B6%EF%BC%883EH%E5%8F%B7%E5%8A%9F%E8%83%BD%EF%BC%89"><span class="nav-number">4.1.5.</span> <span class="nav-text">关闭文件（3EH号功能）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%A7%BB%E5%8A%A8%E6%96%87%E4%BB%B6%E8%AF%BB%E5%86%99%E6%8C%87%E9%92%88%EF%BC%8842H%E5%8F%B7%E5%8A%9F%E8%83%BD%E8%B0%83%E7%94%A8%EF%BC%89"><span class="nav-number">4.1.6.</span> <span class="nav-text">移动文件读写指针（42H号功能调用）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%A0%E9%99%A4%E6%96%87%E4%BB%B6%EF%BC%8841H%E5%8F%B7%E5%8A%9F%E8%83%BD%E8%B0%83%E7%94%A8%EF%BC%89"><span class="nav-number">4.1.7.</span> <span class="nav-text">删除文件（41H号功能调用）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BE%8B1-7"><span class="nav-number">4.1.8.</span> <span class="nav-text">例1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BE%8B2-5"><span class="nav-number">4.1.9.</span> <span class="nav-text">例2</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BE%8B3-2"><span class="nav-number">4.1.10.</span> <span class="nav-text">例3</span></a></li></ol></li></ol></li></ol>
    </div>
</div>
        </aside>
    

    <div class="image-viewer-container">
    <img src="">
</div>


    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="搜索..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="popup-btn-close">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

</main>




<script src="/js/utils.js"></script>

<script src="/js/main.js"></script>

<script src="/js/header-shrink.js"></script>

<script src="/js/back2top.js"></script>

<script src="/js/dark-light-toggle.js"></script>



    
<script src="/js/local-search.js"></script>




    
<script src="/js/code-copy.js"></script>




    
<script src="/js/lazyload.js"></script>



<div class="post-scripts pjax">
    
        
<script src="/js/left-side-toggle.js"></script>

<script src="/js/libs/anime.min.js"></script>

<script src="/js/toc.js"></script>

    
</div>


    
<script src="/js/libs/pjax.min.js"></script>

<script>
    window.addEventListener('DOMContentLoaded', () => {
        window.pjax = new Pjax({
            selectors: [
                'head title',
                '.page-container',
                '.pjax'
            ],
            history: true,
            debug: false,
            cacheBust: false,
            timeout: 0,
            analytics: false,
            currentUrlFullReload: false,
            scrollRestoration: false,
            // scrollTo: true,
        });

        document.addEventListener('pjax:send', () => {
            KEEP.utils.pjaxProgressBarStart();
        });

        document.addEventListener('pjax:complete', () => {
            KEEP.utils.pjaxProgressBarEnd();
            window.pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'));
            KEEP.refresh();
        });
    });
</script>



</body>
</html>
