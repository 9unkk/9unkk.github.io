<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="咸鱼">
    <meta name="author" content="9unk">
    
    <title>
        
            160-crackme |
        
        9unk Blog
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    <link rel="shortcut icon" href="/images/logo.jpg">
    
<link rel="stylesheet" href="/css/font-awesome.min.css">

    <script id="hexo-configurations">
    let KEEP = window.KEEP || {};
    KEEP.hexo_config = {"hostname":"example.com","root":"/","language":"zh-CN"};
    KEEP.theme_config = {"toc":{"enable":true,"number":true,"expand_all":false,"init_open":true},"style":{"primary_color":"#0066CC","avatar":"/images/logo.jpg","favicon":"/images/logo.jpg","article_img_align":"left","left_side_width":"260px","content_max_width":"920px","hover":{"shadow":false,"scale":false},"first_screen":{"enable":true,"background_img":"/images/bg.svg","description":"人初做事，如鸡伏卵，不舍而生气渐充。如燕营巢，不息而结构渐牢。如滋培之木，不见其长，有时而大。如有本之泉，不舍昼夜，盈科而后进，放乎四海。"},"scroll":{"progress_bar":{"enable":false},"percent":{"enable":true}}},"local_search":{"enable":true,"preload":true},"code_copy":{"enable":true,"style":"mac"},"pjax":{"enable":true},"lazyload":{"enable":true},"version":"3.4.5"};
    KEEP.language_ago = {"second":"%s 秒前","minute":"%s 分钟前","hour":"%s 小时前","day":"%s 天前","week":"%s 周前","month":"%s 个月前","year":"%s 年前"};
  </script>
<meta name="generator" content="Hexo 6.0.0"></head>


<body>
<div class="progress-bar-container">
    

    
        <span class="pjax-progress-bar"></span>
        <span class="pjax-progress-icon">
            <i class="fas fa-circle-notch fa-spin"></i>
        </span>
    
</div>


<main class="page-container">

    

    <div class="page-main-content">

        <div class="page-main-content-top">
            <header class="header-wrapper">

    <div class="header-content">
        <div class="left">
            
            <a class="logo-title" href="/">
                9unk Blog
            </a>
        </div>

        <div class="right">
            <div class="pc">
                <ul class="menu-list">
                    
                        <li class="menu-item">
                            <a class=""
                               href="/"
                            >
                                首页
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/archives"
                            >
                                归档
                            </a>
                        </li>
                    
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="fas fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/">首页</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/archives">归档</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle">

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    <div class="page-template-container">
        
        
        <div class="page-template-content markdown-body">
            
                <h1 id="001-abexcm5"><a href="#001-abexcm5" class="headerlink" title="001-abexcm5"></a>001-abexcm5</h1><h2 id="查看程序基本信息"><a href="#查看程序基本信息" class="headerlink" title="查看程序基本信息"></a>查看程序基本信息</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/226123773-62d032c7-e5b1-40f7-9dbd-f2499bd1aa69.png"
                      alt="54"
                ><br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/226123851-858781b5-f05c-436e-81ec-b5337390d4b3.png"
                      alt="55"
                ></p>
<h2 id="搜索字符串"><a href="#搜索字符串" class="headerlink" title="搜索字符串"></a>搜索字符串</h2><ol>
<li><p>F9 运行到程序领空<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/226124216-cc303ba3-9ca6-4c0a-8ea8-9537c8967034.png"
                      alt="56"
                ></p>
</li>
<li><p>在当前模块搜索字符串<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/226124340-9eb7b5ad-ed6e-4f92-b1c8-c59e4432517f.png"
                      alt="57"
                ><br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/226124376-65d49ac9-e4bd-4267-8739-2e61ad26850d.png"
                      alt="58"
                ></p>
</li>
</ol>
<h2 id="程序分析（静态-动态）"><a href="#程序分析（静态-动态）" class="headerlink" title="程序分析（静态+动态）"></a>程序分析（静态+动态）</h2><ol>
<li><p>分析关键指令<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/226124604-3b00c2c7-7e7b-45e8-a6dd-d3d011395f95.png"
                      alt="59"
                ></p>
</li>
<li><p>在关键函数出设置断点，F9进行动态调试，找到序列号<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/226125679-3dbfb274-fa00-4bef-90cd-d44fe843e8ca.png"
                      alt="60"
                ></p>
</li>
<li><p>向上溯源，找到第一个处理字符串的函数<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/226129881-7a66809c-0c62-40ae-91ae-958a3a1d410d.png"
                      alt="61"
                ></p>
</li>
</ol>
<p>程序分为3段：<br>1、将字符串 “OS” 和 “4562-ABEX” 拼接，结果为”OS4562-ABEX”<br>2、将 “OS45” 各字节+2，结果为 “QU6762-ABEX”<br>3、将 4023FD(“L2C-5781”) 和 40225C(“QU6762-ABEX”) 处的字符串拼接到 402000 地址处，结果为 “L2C-5781QU6762-ABEX”</p>
<h2 id="编写注册机"><a href="#编写注册机" class="headerlink" title="编写注册机"></a>编写注册机</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> _CRT_SECURE_NO_WARNINGS</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;windows.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">char</span> str1[<span class="number">12</span>] = <span class="string">&quot;OS&quot;</span>;</span><br><span class="line">	<span class="type">char</span> str2[] = <span class="string">&quot;4562-ABEX&quot;</span>;</span><br><span class="line">	<span class="type">char</span> str3[] = <span class="string">&quot;L2C-5781&quot;</span>;</span><br><span class="line">	<span class="type">char</span> result[<span class="number">20</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">	<span class="built_in">strcat</span>(str1,str2);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		str1[i] = str1[i] + <span class="number">2</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">strcat</span>(result,str3);</span><br><span class="line">	<span class="built_in">strcat</span>(result, str1);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>, result);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="002-Cruehead-CrackMe-3"><a href="#002-Cruehead-CrackMe-3" class="headerlink" title="002-Cruehead-CrackMe-3"></a>002-Cruehead-CrackMe-3</h1><h2 id="查看程序基本信息-1"><a href="#查看程序基本信息-1" class="headerlink" title="查看程序基本信息"></a>查看程序基本信息</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/226189965-4ceab85e-7e5d-483a-98f0-76001db0f5a5.png"
                      alt="62"
                ><br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/226190152-dd196bdb-0f2e-401a-90f7-bb3b5a09bc68.png"
                      alt="63"
                ></p>
<blockquote>
<p>exeinfo未识别使用的编程语言，打开程序也没有发现任何注册点，只有一个 exit 按钮。</p>
</blockquote>
<h2 id="动态调试程序"><a href="#动态调试程序" class="headerlink" title="动态调试程序"></a>动态调试程序</h2><h1 id="Acid-burn"><a href="#Acid-burn" class="headerlink" title="Acid burn"></a>Acid burn</h1><h2 id="查看程序基本信息-2"><a href="#查看程序基本信息-2" class="headerlink" title="查看程序基本信息"></a>查看程序基本信息</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/223346153-e9b42f85-bba6-4894-993a-081e99a7cc55.png"
                      alt="1"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/223346775-5cb2a76a-a049-4974-8757-80d08d56dc8c.png"
                      alt="2"
                ></p>
<h2 id="下载Delphi反编译工具IDR"><a href="#下载Delphi反编译工具IDR" class="headerlink" title="下载Delphi反编译工具IDR"></a>下载Delphi反编译工具IDR</h2><p><a class="link"   target="_blank" rel="noopener" href="https://codeload.github.com/crypto2011/IDR/zip/refs/tags/27_01_2019" >IDR<i class="fas fa-external-link-alt"></i></a></p>
<p><a class="link"   target="_blank" rel="noopener" href="https://objects.githubusercontent.com/github-production-release-asset-2e65be/41132122/3bbc4300-0041-11eb-9150-46f815ce5c72?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIAIWNJYAX4CSVEH53A/20230307/us-east-1/s3/aws4_request&X-Amz-Date=20230307T074050Z&X-Amz-Expires=300&X-Amz-Signature=8fac668fbed0964e9f994c0acd6017b59a4933fb8f9511fd710e6de757e217e4&X-Amz-SignedHeaders=host&actor_id=25861639&key_id=0&repo_id=41132122&response-content-disposition=attachment;%20filename=Release.9-26-2020.7z&response-content-type=application/octet-stream" >SwissArmyKnife<i class="fas fa-external-link-alt"></i></a> 是X64dbg导入”.MAP”文件的插件，后续可能会用到，可以先装上。  </p>
<h2 id="分析程序"><a href="#分析程序" class="headerlink" title="分析程序"></a>分析程序</h2><ol>
<li><p>拖入程序到 IDR 进行自动分析<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/223369898-0408f2c8-f50d-41de-9a0c-c4bac46e1da0.png"
                      alt="3"
                ></p>
</li>
<li><p>选择 form 窗口<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/223371342-aebe3eab-b514-43e8-b55b-0f9d122756cd.png"
                      alt="4"
                ></p>
</li>
<li><p>双击选择我们需要逆的窗口<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/223371705-77211552-76cc-4364-b7ab-ef3e06e535d6.png"
                      alt="5"
                ></p>
</li>
<li><p>在两个button按钮下面双击查看右侧代码，找到主程序<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/223372290-d31c4768-d7b5-4d46-bc02-7f900eb68ca9.png"
                      alt="6"
                ></p>
</li>
<li><p>在 “0042F4D5” 地址处发现关键跳转<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/223373456-dae52da8-bf38-47c1-8938-500bdd2f7ef3.png"
                      alt="7"
                ></p>
</li>
<li><p>在关键跳转上面发现程序调用了 strcmp，上面两个局部变量可能就有我们破解程序的关键字符串<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/223375596-3b50ed6c-7a3c-47d3-998f-096fb9f0b874.png"
                      alt="9"
                ></p>
</li>
</ol>
<h2 id="x64dbg动态调试"><a href="#x64dbg动态调试" class="headerlink" title="x64dbg动态调试"></a>x64dbg动态调试</h2><ol>
<li><p>使用快捷键 “Ctrl+G” 定位到关键跳转的位置，并 F2 设置断点<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/223376262-fa1f6095-5baf-4c3b-b46a-6e93ee4bab81.png"
                      alt="8"
                ></p>
</li>
<li><p>F9 运行程序，其中 [ebp-10] 是输入字符串，另一个科恩那个就是关键字符串<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/223377590-74a9316a-0b9f-4e7c-b75d-c42f0e150f2e.png"
                      alt="10"
                ></p>
</li>
<li><p>新开一个程序进行验证<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/223378745-5c6f71bb-0247-4400-b3c8-b5fc7cd4a7c2.png"
                      alt="11"
                ></p>
</li>
</ol>
<h2 id="继续分析第二个窗口"><a href="#继续分析第二个窗口" class="headerlink" title="继续分析第二个窗口"></a>继续分析第二个窗口</h2><ol>
<li><p>结果错误，程序可能是通过算法根据用户名来生成的硬编码<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/223385581-adac17b1-002b-4fa7-9119-05cab92e0c26.png"
                      alt="12"
                ></p>
</li>
<li><p>继续向上分析字符串处理函数<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/223615153-db9f91a7-7ed1-4bbc-abe5-3b0027c62b9b.png"
                      alt="14"
                ></p>
</li>
</ol>
<ul>
<li>StrCat()：拼接字符串</li>
<li>IntToStr()：整数转换成字符串</li>
<li>StrLAsg()：复制Ansi字符串</li>
</ul>
<blockquote>
<p>要注意：IntToStr 这一段，这里将地址 “ds:[0x00431750]” 的值转换为 “8528”。也就是说最终结果存在 “ds:[0x00431750]” 地址处。</p>
</blockquote>
<ol start="3">
<li>“8528”是关键硬编码，需要注意 “8528” 是十进制数，转换为2进制数为 “2150”<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/223651560-fe217fb0-4680-4e78-b9a8-21173b7a40c9.png"
                      alt="16"
                ><br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/223650017-9d478b6b-a108-445d-abc1-9a2adcb6afc6.png"
                      alt="15"
                ></li>
</ol>
<blockquote>
<p>这里涉及到 “ds:[0x00431750]” 地址的操作都要记录下来。</p>
</blockquote>
<ol start="4">
<li><p>分析算法<br>最后再动态调试得出算法：(0x29 * username[0])*2</p>
</li>
<li><p>编写注册机</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">作者：9unk</span></span><br><span class="line"><span class="comment">时间：2023-3-8</span></span><br><span class="line"><span class="comment">功能：Serial/Name 窗口注册机</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _CRT_SECURE_NO_WARNINGS</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> </span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">int</span> num = <span class="number">0x29</span>;</span><br><span class="line">	<span class="type">char</span> username[<span class="number">20</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">	<span class="type">char</span> result[<span class="number">5</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;请输入用户名：&quot;</span>);</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,&amp;username);</span><br><span class="line">	num = (num * username[<span class="number">0</span>])*<span class="number">2</span>;</span><br><span class="line">	itoa(num,result,<span class="number">10</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;硬编码：CW-%s-CRACKED&quot;</span>,result);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<blockquote>
<p>再分析程序过程中，我并没有想到关注函数 IntToStr()，将 “8528” 转换为十六进制，导致我调试了了好几遍才找到关键算法。</p>
</blockquote>
<h1 id="Afkayas-1"><a href="#Afkayas-1" class="headerlink" title="Afkayas.1"></a>Afkayas.1</h1><ol>
<li><p>找到关键字符串 “You Get It”，并在上面找到关键跳转。<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/223769225-27949ff6-c5bd-438a-820c-937562c477bd.png"
                      alt="18"
                ></p>
</li>
<li><p>向上查找影响 ZF 标志位的指令<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/223769706-3087a0ed-1511-4251-9e3e-fefdee518372.png"
                      alt="19"
                ></p>
</li>
<li><p>向上溯源找到可能与结果相关，且改变 ESI 值得指令<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/223773338-6b62029f-655c-4ba5-8f68-fd8565c4f923.png"
                      alt="20"
                ></p>
</li>
</ol>
<blockquote>
<p>很明显 esi 存储的是 VbaStrSmp 函数的返回值</p>
</blockquote>
<ol start="4">
<li>在 OD 中定位到 VbaStrSmp 函数地址，设置断点，最后再运行程序看看。<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/223775020-3e1835f0-42a1-4d93-b805-4511db88e68f.png"
                      alt="21"
                ></li>
</ol>
<blockquote>
<p>此时看到 EAX 参数很有肯能是硬编码，最后通过确认发现是正确的。</p>
</blockquote>
<ol start="5">
<li>再向上看会发现一个 “VbaStrCat” 函数，且其中有个参数 “AKA-“<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/223775854-85f19f6d-2d05-4fcc-b9f4-f1dc1ed44cc5.png"
                      alt="22"
                ></li>
</ol>
<blockquote>
<p>之前我们分析过 StrCat 函数，”AKA-“ 作为其中的一个参数，而 EAX 在下面的 StrCmp 函数中作为存放结果的参数，那么 ECX 就是关键硬编码部分了。</p>
</blockquote>
<ol start="6">
<li>继续向上找修改 ECX 的指令，并尝试调试<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/223778169-8da21bfc-de31-421d-98ca-654c0f2342b6.png"
                      alt="23"
                ><br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/223779582-90c0ed07-350e-4e69-a029-14b46d6dbff9.png"
                      alt="24"
                ></li>
</ol>
<blockquote>
<p>在这里可以看到硬编码存储在 [ebp-0x1C] &#x3D; 001B0D34 地址处。</p>
</blockquote>
<ol start="7">
<li><p>继续向上找涉及 [ebp-0x1C] 的指令，并设置断点。最后在内存窗口定位到 001B0D34 地址处，当我们后续动态调试程序的时候，发现这个位置的数据改变时，就是我们调试到关键算法的位置处了。<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/223781714-439ad92e-fe41-45ae-ba24-d2dc52e28be7.png"
                      alt="25"
                ><br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/223782120-e259c818-ab89-4610-8f80-67400962ace6.png"
                      alt="26"
                ></p>
</li>
<li><p>call 跟进去之后发现全是 windows 领空，在执行 call 指令后，发现结果变了，这也就说明了 487759 是通过这个windows API 实现的，我们在这个 API 位置设置断点。<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/223785359-4dfa836c-086d-4d3b-b820-bbf3b469cf72.png"
                      alt="27"
                ></p>
</li>
<li><p>重新调试程序，到达 windows 领空的时候直接使用快捷键 “Alt+F9” 执行到用户代码。<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/223803979-518eac46-7e61-44ea-bbb6-229ee9b53a88.png"
                      alt="28"
                ></p>
</li>
</ol>
<blockquote>
<p>此时程序执行到另一个位置，下面应该就是算法部分的代码了</p>
</blockquote>
<ol start="10">
<li>继续单步调试<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/223804570-21f40b40-cb6b-4461-bf8d-f6a7e1683ad9.png"
                      alt="29"
                ></li>
</ol>
<blockquote>
<p>这里看到涉及字符串处理函数，且存在 [ebp-0x1C]</p>
</blockquote>
<ol start="11">
<li><p>继续单步调试，最后发现算法部分<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/223805037-8e1fcb1f-c58d-49b2-8064-2d49d2199e26.png"
                      alt="30"
                ></p>
</li>
<li><p>分析算法<br>算法：(strlen(name) * 0x17CFB)+name[0]</p>
</li>
<li><p>编写注册机</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">作者：9unk</span></span><br><span class="line"><span class="comment">时间：2023-3-9</span></span><br><span class="line"><span class="comment">功能：Afkayas.1 注册机</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _CRT_SECURE_NO_WARNINGS</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> <span class="keyword">warning</span>(disable:4996)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> </span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">int</span> len = <span class="number">0</span>;</span><br><span class="line">	<span class="type">int</span> num = <span class="number">0</span>;</span><br><span class="line">	<span class="type">char</span> username[<span class="number">20</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">	<span class="type">char</span> result[<span class="number">7</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;请输入用户名：&quot;</span>);</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,&amp;username);</span><br><span class="line">	<span class="keyword">while</span> (username[len] != <span class="number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		len++;</span><br><span class="line">	&#125;</span><br><span class="line">	num = (len * <span class="number">0x17CFB</span>) + username[<span class="number">0</span>];</span><br><span class="line">	itoa(num,result,<span class="number">10</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;硬编码：AKA-%s&quot;</span>,result);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h1 id="ajj-1"><a href="#ajj-1" class="headerlink" title="ajj.1"></a>ajj.1</h1><ol>
<li>LDR 加载并打开程序<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/224246309-ccdb834a-5f17-4ca3-8100-943beccadd29.png"
                      alt="31"
                ></li>
</ol>
<blockquote>
<p>打开程序后发现该程序没有确认按钮，且注册成功后是在下方panel窗口显示图片。现在唯一想到的是 enter 打开触发确认机制，实现结果注册码校验。</p>
</blockquote>
<ol start="2">
<li>双击进入注册码的窗口，并查看是否存在关键函数或字符串<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/224247398-3bf89725-8e3b-4d2c-afb9-efa314636413.png"
                      alt="32"
                ></li>
</ol>
<blockquote>
<p>这里找到一个strcmp函数</p>
</blockquote>
<ol start="3">
<li><p>在该地址处进行断点，动态调试<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/224247983-1a9766d1-e4e5-4099-a0f4-737600b7b80e.png"
                      alt="33"
                ></p>
</li>
<li><p>进行验证<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/224248390-e3d5fc83-4ad5-4483-9721-f38b613d9321.png"
                      alt="34"
                ></p>
</li>
</ol>
<blockquote>
<p>一开始按 enter 键没有用，之后在窗口上乱点一通，触发了确认按钮（确认按钮就是，双击panel窗口），这里也验证码了注册码是正确的。</p>
</blockquote>
<ol start="5">
<li>重新换另一个用户名试试，看看注册码哪里会进行改动<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/224249149-a7a2f2fd-6f35-4ce1-bda1-2dbb4a7d6a7b.png"
                      alt="35"
                ></li>
</ol>
<blockquote>
<p>比较两个注册码，发现中间打的数字不一样，注册码最后还会拼接用户名</p>
</blockquote>
<ol start="6">
<li>查找关键算法<br>看看 strcatn 函数，分析后发现这个和我们的结果好像没啥关系<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/224251134-3a98d0d8-bd58-4424-89b7-fa71c828baae.png"
                      alt="36"
                ></li>
</ol>
<p>继续看看有没有 9 这个数字<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/224252605-2ca6f4dd-1657-4b42-9849-ccc5ce9a7d1f.png"
                      alt="37"
                ></p>
<blockquote>
<p>这里是 ASCII 码 “9”</p>
</blockquote>
<p>回到 LDR 窗口，向上看看有没有可疑的代码<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/224253968-3b00ac4f-091f-4cab-adbf-adcc93f9ad0f.png"
                      alt="38"
                ></p>
<blockquote>
<p>这边有一个 intostr 函数，和下面的代码对应的上</p>
</blockquote>
<p>在 “00457C60” 地址处断点，调试看一下。为了方便操作，我这里直接复制地址，在 x64dbg 命令行用命令直接断点。<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/224255781-362db905-e48e-4468-b076-d0443a967084.png"
                      alt="39"
                ><br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/224256073-92de8574-140f-42ab-9cf0-07020373df42.png"
                      alt="40"
                ></p>
<p>这里 [ebx+2F8] 的结果是4，硬要和用户扯上关系，只有用户名长度了（此时的用户名是 test）<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/224257141-449fddec-16f3-4df4-ba18-25a32ddd1941.png"
                      alt="41"
                ></p>
<p>整段代码调试下来，就画红框的几个是真正执行的代码<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/224263436-4062ffdc-9026-46b2-9df3-06e041b23b7a.png"
                      alt="42"
                ></p>
<blockquote>
<p>在分析程序过程中要同时把常见函数（包括入口参数和出口参数）记录下来，这样能方便我们快速分析程序</p>
</blockquote>
<ol start="5">
<li>算法<br>黑头Sun Bird+[疑似用户名长度+5]+dseloffc-012-OK+[用户名]</li>
</ol>
<p>算法很简单，手动验证一下。</p>
<p>用户名：aaaaaa<br>注册码：黑头Sun Bird11dseloffc-012-OKaaaaaa<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/224266121-bc9f4221-528a-4205-ab8f-504f38f6e0cb.png"
                      alt="43"
                ></p>
<ol start="6">
<li>程序分析到这里就结束了，但是这个数字是从哪里来的呢？<br>双击各个窗口会发现，这里一个按钮事件就是一个封装的函数<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/224266669-9626947b-94f1-488e-a40f-71d7a514b339.png"
                      alt="44"
                ></li>
</ol>
<p>如果上面猜测是正确的，那么用户名的长度应该是在用户名窗口得到的，我们进入用户名窗口看一下<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/224267484-861d6383-b321-4fc2-b111-0a6df16aaee0.png"
                      alt="45"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/224268427-9ed69dcc-61f9-4be5-b7a6-8c836187f0c9.png"
                      alt="46"
                ></p>
<p>到这里程序都分析结束了</p>
<h1 id="ajj-2"><a href="#ajj-2" class="headerlink" title="ajj.2"></a>ajj.2</h1><ol>
<li><p>用 LDR 没法反编译程序，用 exeinfo 查看，发现程序加了 UPX 壳。<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/224274004-2fae2821-bf35-4ea7-b982-1a0a7d6e37c2.png"
                      alt="47"
                ></p>
</li>
<li><p>直接用 upx 脱壳<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/224274610-0e1536c7-2a3a-45e3-8bd0-695502afdc38.png"
                      alt="48"
                ></p>
</li>
<li><p>重新用 LDR 进行加载，发现有几个隐藏窗口<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/224530640-3e9c5918-5c5d-4cfc-8a9e-f321fb025cba.png"
                      alt="49"
                ></p>
</li>
</ol>
<blockquote>
<p>鼠标放在隐藏窗口，会发现隐藏的是 edit2、timer1、timer2</p>
</blockquote>
<ol start="4">
<li>切换到 froms -&gt; text 下面，查看个控件的属性<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/224532090-aa0bb386-db49-49b2-8a1d-78aab7c1a67f.png"
                      alt="51"
                ><br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/224532038-47e70f53-f984-4589-8fdc-dc937cc6ed35.png"
                      alt="50"
                ></li>
</ol>
<blockquote>
<p>TabOrder：使用上下键来选择控件，TabOrder的值从0开始。Interval：表示计时器延迟多长时间，默认单位是毫秒。</p>
</blockquote>
<p>5.Edit1没有触发事件，我们真正输入注册名的窗口在 Edit2<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/224532864-21ca76cd-d1ef-4a13-9ffd-f5ce4879514b.png"
                      alt="52"
                > </p>
<ol start="6">
<li>在 Edit2 处设置断点<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25861639/224532979-85340472-8e7e-4ec8-b7bd-5145909bb00e.png"
                      alt="53"
                ></li>
</ol>

            
        </div>
        <div class="page-template-comments">
            
        </div>
    </div>
</div>


                
            </div>

        </div>

        <div class="page-main-content-bottom">
            <footer class="footer">
    <div class="info-container">
        <div class="copyright-info info-item">
            &copy;
            
              <span>2022</span>
              -
            
            2023&nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;<a href="/">9unk</a>
        </div>
        
        <div class="theme-info info-item">
            由 <a target="_blank" href="https://hexo.io">Hexo</a> 驱动&nbsp;|&nbsp;主题&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep v3.4.5</a>
        </div>
        
        
    </div>
</footer>

        </div>
    </div>

    

    <div class="right-bottom-side-tools">
        <div class="side-tools-container">
    <ul class="side-tools-list">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-expand-width flex-center">
            <i class="fas fa-arrows-alt-h"></i>
        </li>

        <li class="tools-item tool-dark-light-toggle flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        

        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list">
        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>
        
            <li class="tools-item tool-scroll-to-top flex-center">
                <i class="arrow-up fas fa-arrow-up"></i>
                <span class="percent"></span>
            </li>
        
    </ul>
</div>

    </div>

    

    <div class="image-viewer-container">
    <img src="">
</div>


    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="搜索..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="popup-btn-close">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

</main>




<script src="/js/utils.js"></script>

<script src="/js/main.js"></script>

<script src="/js/header-shrink.js"></script>

<script src="/js/back2top.js"></script>

<script src="/js/dark-light-toggle.js"></script>



    
<script src="/js/local-search.js"></script>




    
<script src="/js/code-copy.js"></script>




    
<script src="/js/lazyload.js"></script>



<div class="post-scripts pjax">
    
</div>


    
<script src="/js/libs/pjax.min.js"></script>

<script>
    window.addEventListener('DOMContentLoaded', () => {
        window.pjax = new Pjax({
            selectors: [
                'head title',
                '.page-container',
                '.pjax'
            ],
            history: true,
            debug: false,
            cacheBust: false,
            timeout: 0,
            analytics: false,
            currentUrlFullReload: false,
            scrollRestoration: false,
            // scrollTo: true,
        });

        document.addEventListener('pjax:send', () => {
            KEEP.utils.pjaxProgressBarStart();
        });

        document.addEventListener('pjax:complete', () => {
            KEEP.utils.pjaxProgressBarEnd();
            window.pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'));
            KEEP.refresh();
        });
    });
</script>



</body>
</html>
